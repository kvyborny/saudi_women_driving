{smcl}
{com}{sf}{ul off}{txt}{.-}
      name:  {res}<unnamed>
       {txt}log:  {res}/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/results/log_files/Data cleaning_30 Mar 2025.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res}30 Mar 2025, 22:49:44
{txt}
{com}. 
.         set     seed 20190228
{txt}
{com}.         set     sortseed 20190228
{txt}
{com}.         
.         do              "$rep_code/cleaning/Wave 1 cleaning.do"
{txt}
{com}. ***** REMEMBER TO RUN SETTINGS.DO FILE FIRST ******
. 
. /******************************************************************************
> 
>                First analysis of Uber and Wusool Intervention             
> 
> Purpose:  1- Prepare a balance table for the four treatment groups
>                                            
> Created: July 14, 2019 by Hussain Alshammasi                                   
> Last edited: June 16, 2020 by Adam Soliman
> *******************************************************************************/
. clear all
{res}{txt}
{com}. set more off
{txt}
{com}. 
. 
. **************************************************************************
. * Import Exel data:
. *                                                      
. * The dataset was shared by Chaza in Excel format which combines data    
. * from baseline and some administrative data for Alnahda beneficiaries.  
. * The treatment indicator is in variables driving_ct and wusool_ct.
. * "None" indicates not being randomized to the treatment or control sample.
. * Randomization was done by Chaza. Find code in:
. * Dropbox\EPoD Female Transport\4. Surveys\DoFiles\Randomization code-20180827
. * 
. * The 4 treatment groups are:
. *      1- Driving Treatment Wusool Control
. *      2- Driving Treatment Wusool Treatment
. *      3- Driving Control Wusool Treatment
. *      4- Driving Control Wusool Control
. *
. *
. **************************************************************************
. 
. /* bring in the exclusion sheet to merge later
> import excel "RCT admin and wave 1/Data/Exclusion sheet.xlsx", sheet("Sheet1") cellrange(A1:F1096) firstrow clear
> drop if new_id == .
> save "RCT admin and wave 1/Data/Exclusion_sheet.dta", replace
> */
. 
. import excel "${c -(}data{c )-}/RCT admin and wave 1/Raw/deidentified commute dataset-20191017.xlsx", ///
> sheet("Full Uber dataset") cellrange(A1:CG1114) firstrow clear
{res}{text}(85 vars, 1,113 obs)

{com}. 
. *labeling variables with first row
. foreach var of varlist * {c -(}
{txt}  2{com}.   label variable `var' "`=`var'[1]'"
{txt}  3{com}. {c )-}
{txt}note: label truncated to 80 characters
note: label truncated to 80 characters
note: label truncated to 80 characters
note: label truncated to 80 characters
note: label truncated to 80 characters
note: label truncated to 80 characters
note: label truncated to 80 characters
note: label truncated to 80 characters
note: label truncated to 80 characters

{com}. 
. drop if _n == 1 //dropping explanation of variable name after variables have been labeled
{txt}(1 observation deleted)

{com}. drop if new_id == "" // dropping blank observations 
{txt}(33 observations deleted)

{com}. 
. * drop if driving_ct == "None" & wusool_ct == "None" //these are women who were excluded from randomization
. 
. 
. 
. 
. ////////////////////////////////////////////////////////////////////////////////
> /* THIS IS A NEW SECTION AS OF AUG 2, 2023: 
> 
> THIS IS MEANT TO RESOLVE THE DATA GENERATION INCONSISTENCIES THAT ARISE FROM 
> DUPLICATES THAT, WHEN SORTED BY NEW_ID, ARE RANDOMLY SORTED WITHIN NEW_ID AND 
> THEREFORE THE OBSERVATIONS THAT GET TAGGED AS A DUPLICATE CAN VARY WHEN THIS FILE
> IS RE-RUN.
> 
> OBSERVATIONS FOR ALL BUT ONE PARTICIPANT CAN BE SORTED UNIQUELY BY new_id AND 
> RecordedDate. FOR THE PARTICIPANT WITH TWO OBSERVATIONS THAT CANNOT BE UNIQUELY
> SORTED BY RecordedDate, WE WILL CREATE AN _n VARIABLE WHICH PRESERVES THE ORDER
> IN WHICH THOSE OBSERVATIONS WERE RECORDED IN THE ORIGINAL RAW DATA FILE. WE'LL 
> THEN TAKE THE LAST NON-MISSING VALUE OF EACH VARIABLE ACCORDING TO RecordedDate
> AND _n. THIS WILL GUARANTEE REPLICABILITY EACH TIME THIS FILE IS RUN. 
> */
. 
.         * preserve raw data order of observations
.         gen raw_order = _n
{txt}
{com}.         
.         * test that sorting by new_id RecordedDate and raw_order gives us a unique sort
.         duplicates report new_id RecordedDate raw_order

{p 0 4}{txt}Duplicates in terms of {res} new_id RecordedDate raw_order{p_end}

{txt}{hline 10}{c TT}{hline 27}
   Copies {c |} Observations       Surplus
{hline 10}{c +}{hline 27}
        1 {c |}         {res}1079             0
{txt}{hline 10}{c BT}{hline 27}

{com}.         
.         if r(unique_value)!= r(N) {c -(}
.                 di error "Not a unique sort for duplicates"
.                 break
.         {c )-}
{txt}
{com}.         
.         * sort by new_id RecordedDate and raw_order - this gives us a unique sort
.         sort new_id RecordedDate raw_order
{txt}
{com}.         collapse (lastnm) cohort_alnahda-old_id Institution-raw_order, by(new_id)
{res}{txt}
{com}. 
.         
. 
. 
. ////////////////////////////////////////////////////////////////////////////////
> 
. tab driving_ct wusool_ct 

                      {txt}{c |}                   (lastnm) wusool_ct
  (lastnm) driving_ct {c |}   Control  Control..       None  None th..  Treatment {c |}     Total
{hline 22}{c +}{hline 55}{c +}{hline 10}
              Control {c |}{res}       132          0          0          0        149 {txt}{c |}{res}       281 
{txt}Control then treatm.. {c |}{res}         0          0          0          0          2 {txt}{c |}{res}         2 
{txt}Control then treatm.. {c |}{res}         0          0          0          0          1 {txt}{c |}{res}         1 
{txt}                 None {c |}{res}         0          0        288          0          0 {txt}{c |}{res}       288 
{txt}None then Treatment.. {c |}{res}         0          0          2          0          0 {txt}{c |}{res}         2 
{txt}None then Treatment.. {c |}{res}         0          0          1          0          0 {txt}{c |}{res}         1 
{txt}None then treatment.. {c |}{res}         1          0          0          2          0 {txt}{c |}{res}         3 
{txt}            Treatment {c |}{res}       232          0          0          0        251 {txt}{c |}{res}       483 
{txt}Treatment then none.. {c |}{res}         0          1          0          0          0 {txt}{c |}{res}         1 
{txt}{hline 22}{c +}{hline 55}{c +}{hline 10}
                Total {c |}{res}       365          1        291          2        403 {txt}{c |}{res}     1,062 
{txt}
{com}. **************************************************************
. *  clean and summarize treatment groups (including updates)  *
. **************************************************************
. 
. tab driving_ct 

                    {txt}(lastnm) driving_ct {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                                Control {c |}{res}        281       26.46       26.46
{txt}  Control then treatment (May12mistake) {c |}{res}          2        0.19       26.65
{txt}Control then treatment (alnahdanominee) {c |}{res}          1        0.09       26.74
{txt}                                   None {c |}{res}        288       27.12       53.86
{txt}     None then Treatment (May12mistake) {c |}{res}          2        0.19       54.05
{txt}    None then Treatment(alnahdanominee) {c |}{res}          1        0.09       54.14
{txt}     None then treatment (May12mistake) {c |}{res}          3        0.28       54.43
{txt}                              Treatment {c |}{res}        483       45.48       99.91
{txt}Treatment then none (very old, risk t.. {c |}{res}          1        0.09      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}      1,062      100.00
{txt}
{com}. 
. gen driving_ct2 = ""
{txt}(1,062 missing values generated)

{com}. replace driving_ct2 = "Control" if driving_ct == "Control" 
{txt}variable {bf}{res}driving_ct2{sf}{txt} was {bf}{res}str1{sf}{txt} now {bf}{res}str7{sf}
{txt}(281 real changes made)

{com}. replace driving_ct2 = "Treatment" if driving_ct == "Treatment"  ///
>                                                                 | driving_ct == "Treatment then none (very old, risk that her daughter filled the survey on her behalf)" 
{txt}variable {bf}{res}driving_ct2{sf}{txt} was {bf}{res}str7{sf}{txt} now {bf}{res}str9{sf}
{txt}(484 real changes made)

{com}. 
. replace driving_ct2 = "Control" if  driving_ct == "Control then treatment (May12mistake)" ///
>                                   |  driving_ct == "Control then treatment (alnahdanominee)"  // People who were assigned to be in the control, but were signed up to driving anyway
{txt}(3 real changes made)

{com}.                                                                   
.                                                                   
. replace driving_ct2 = "" if  driving_ct == "None then Treatment  (May12mistake)" ///
>                                   |  driving_ct == "None then Treatment (May12mistake)" ///
>                                   |  driving_ct == "None then Treatment(alnahdanominee)" ///
>                                   |  driving_ct == "None then treatment (May12mistake)" // People who were assigned to NOT be in the experiment, but were signed up to driving anyway
{txt}(0 real changes made)

{com}.                                                                   
. tab driving_ct2         

{txt}driving_ct2 {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
    Control {c |}{res}        284       36.98       36.98
{txt}  Treatment {c |}{res}        484       63.02      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        768      100.00
{txt}
{com}. 
. ************** signed agreement ******************
. * generating an indicator for signing the driving subsidy agreement. Note that 300 people signed the agreement.
. gen signed = .
{txt}(1,062 missing values generated)

{com}. replace signed = 1 if signed_agreement == "Yes" | signed_agreement == "No, but filled schedule" | signed_agreement == "No,but filled schedule"
{txt}(300 real changes made)

{com}. tab signed  // total people who signed is 300.

     {txt}signed {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        300      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        300      100.00
{txt}
{com}. tab driving_ct signed 

                      {txt}{c |}   signed
  (lastnm) driving_ct {c |}         1 {c |}     Total
{hline 22}{c +}{hline 11}{c +}{hline 10}
Control then treatm.. {c |}{res}         2 {txt}{c |}{res}         2 
{txt}Control then treatm.. {c |}{res}         1 {txt}{c |}{res}         1 
{txt}None then Treatment.. {c |}{res}         2 {txt}{c |}{res}         2 
{txt}None then Treatment.. {c |}{res}         1 {txt}{c |}{res}         1 
{txt}None then treatment.. {c |}{res}         3 {txt}{c |}{res}         3 
{txt}            Treatment {c |}{res}       291 {txt}{c |}{res}       291 
{txt}{hline 22}{c +}{hline 11}{c +}{hline 10}
                Total {c |}{res}       300 {txt}{c |}{res}       300 
{txt}
{com}. tab driving_ct2 signed  // Note that we will drop those who got the treatment but were not initially randomized to get it

{txt}driving_ct {c |}   signed
         2 {c |}         1 {c |}     Total
{hline 11}{c +}{hline 11}{c +}{hline 10}
   Control {c |}{res}         3 {txt}{c |}{res}         3 
{txt} Treatment {c |}{res}       291 {txt}{c |}{res}       291 
{txt}{hline 11}{c +}{hline 11}{c +}{hline 10}
     Total {c |}{res}       294 {txt}{c |}{res}       294 
{txt}
{com}.                                                                                                         
.                                                                   
. tab wusool_ct

                     {txt}(lastnm) wusool_ct {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                                Control {c |}{res}        365       34.37       34.37
{txt}Control (very old, risk that her daug.. {c |}{res}          1        0.09       34.46
{txt}                                   None {c |}{res}        291       27.40       61.86
{txt}       None then Control (May12mistake) {c |}{res}          2        0.19       62.05
{txt}                              Treatment {c |}{res}        403       37.95      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}      1,062      100.00
{txt}
{com}. 
. gen wusool_ct2 = ""
{txt}(1,062 missing values generated)

{com}. replace wusool_ct2 = "Control" if wusool_ct == "Control" ///
>       | wusool_ct == "Control (very old, risk that her daughter filled the survey on her behalf)" 
{txt}variable {bf}{res}wusool_ct2{sf}{txt} was {bf}{res}str1{sf}{txt} now {bf}{res}str7{sf}
{txt}(366 real changes made)

{com}.           
. replace wusool_ct2 = "Treatment" if wusool_ct == "Treatment"  
{txt}variable {bf}{res}wusool_ct2{sf}{txt} was {bf}{res}str7{sf}{txt} now {bf}{res}str9{sf}
{txt}(403 real changes made)

{com}. 
. replace wusool_ct2 = "" if wusool_ct == "None then Control (May12mistake)" | wusool_ct == "None" 
{txt}(0 real changes made)

{com}. 
. 
. tab wusool_ct2 

 {txt}wusool_ct2 {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
    Control {c |}{res}        366       47.59       47.59
{txt}  Treatment {c |}{res}        403       52.41      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        769      100.00
{txt}
{com}. 
. tab wusool_ct2 driving_ct2  

           {txt}{c |}      driving_ct2
wusool_ct2 {c |}   Control  Treatment {c |}     Total
{hline 11}{c +}{hline 22}{c +}{hline 10}
   Control {c |}{res}       132        233 {txt}{c |}{res}       365 
{txt} Treatment {c |}{res}       152        251 {txt}{c |}{res}       403 
{txt}{hline 11}{c +}{hline 22}{c +}{hline 10}
     Total {c |}{res}       284        484 {txt}{c |}{res}       768 
{txt}
{com}. 
. * generating groups in one column for later use in the balance table command
. gen group = "Uber"+driving_ct2+" "+ "Wusool" +wusool_ct2
{txt}
{com}. tab group

                        {txt}group {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
                  Uber Wusool {c |}{res}        293       27.59       27.59
{txt}           Uber WusoolControl {c |}{res}          1        0.09       27.68
{txt}    UberControl WusoolControl {c |}{res}        132       12.43       40.11
{txt}  UberControl WusoolTreatment {c |}{res}        152       14.31       54.43
{txt}  UberTreatment WusoolControl {c |}{res}        233       21.94       76.37
{txt}UberTreatment WusoolTreatment {c |}{res}        251       23.63      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}      1,062      100.00
{txt}
{com}. 
. * generating treatment indicators
. gen driving_T = .
{txt}(1,062 missing values generated)

{com}. replace driving_T = 0 if driving_ct2 == "Control"
{txt}(284 real changes made)

{com}. replace driving_T = 1 if driving_ct2 == "Treatment"
{txt}(484 real changes made)

{com}. tab driving_T 

  {txt}driving_T {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        284       36.98       36.98
{txt}          1 {c |}{res}        484       63.02      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        768      100.00
{txt}
{com}. 
. gen wusool_T = .
{txt}(1,062 missing values generated)

{com}. replace wusool_T = 0 if wusool_ct2 == "Control"
{txt}(366 real changes made)

{com}. replace wusool_T = 1 if wusool_ct2 == "Treatment"
{txt}(403 real changes made)

{com}. tab wusool_T 

   {txt}wusool_T {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        366       47.59       47.59
{txt}          1 {c |}{res}        403       52.41      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        769      100.00
{txt}
{com}. 
. replace Notes = "" if new_id == "1617" //there was a mistake in the notes for this ID
{txt}(1 real change made)

{com}.                                                                   
. 
. ************ Dropping late joiners from same household ************
. * There was imbalance in the number of household members in the study, possibly because
. * members from the same household were added upon request after finding out that someone
. * from their household was selected to treatment. We drop members from the same household
. * who joined the study in a later cohort. ONLY BIG FAMILIES?
. 
. 
. sort  Institution file_nbr new_id
{txt}
{com}. by Institution file_nbr: gen HH_size = _N
{txt}
{com}. 
. quietly bysort Institution file_nbr:  gen dup_file = cond(_N==1,0,_n) //generating unique identifier for household to tab household size
{txt}
{com}. replace dup_file = 0 if dup_file == 1
{txt}(231 real changes made)

{com}. replace dup_file = 1 if dup_file > 0
{txt}(378 real changes made)

{com}. 
. tab HH_size if dup_file == 0

    {txt}HH_size {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        453       66.23       66.23
{txt}          2 {c |}{res}        134       19.59       85.82
{txt}          3 {c |}{res}         65        9.50       95.32
{txt}          4 {c |}{res}         21        3.07       98.39
{txt}          5 {c |}{res}          7        1.02       99.42
{txt}          6 {c |}{res}          2        0.29       99.71
{txt}          7 {c |}{res}          1        0.15       99.85
{txt}          8 {c |}{res}          1        0.15      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        684      100.00
{txt}
{com}. 
. 
. * A late joiner is a household member that is in a later  randmization cohort than the cohort of the first household member to join the study.
. * Cohorts were numbered in sequence. 1.1, 1.2, 1.3, 2.1, 2.2, 3. 1 for Alnahda, 2 for Insan, 3 for Mawadah
. 
. sort Institution file_nbr randomization_cohort
{txt}
{com}. 
. quietly by Institution file_nbr: egen double min_cohort = min(randomization_cohort) //generating a variable containing the minimum cohort for each household
{txt}
{com}. 
. gen late_joiner = 0
{txt}
{com}. 
. order Institution file_nbr new_id HH_size randomization_cohort min_cohort late_joiner
{txt}
{com}. 
. replace late_joiner = 1 if randomization_cohort != min_cohort //26 participants were identified as late joiners
{txt}(66 real changes made)

{com}. 
. tab late_joiner

{txt}late_joiner {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        996       93.79       93.79
{txt}          1 {c |}{res}         66        6.21      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      1,062      100.00
{txt}
{com}. 
. * drop if late_joiner == 1 \\ tag late joiners, no dropping 
. 
. **************** Treatment Given Variables *******************************
. 
. **** remove suspended from treatment and control *****
. 
. * After the randomization for treatment happened and before giving treatment, 
. * some participants graduated from Alnahda beneficiary program and were no longer eligible
. * to get the uber subsidy. We decided to remove them from the analysis along with everyone who
. * graduated to make sure that the drop is not affected by treatment group.
. * The variable Suspended_admin indicates if they graduated
. 
. tab Suspended_admin

       {txt}(lastnm) {c |}
Suspended_admin {c |}      Freq.     Percent        Cum.
{hline 16}{c +}{hline 35}
                {c |}{res}        126       24.90       24.90
{txt}              0 {c |}{res}        202       39.92       64.82
{txt}          إيقاف {c |}{res}         16        3.16       67.98
{txt}         طي قيد {c |}{res}        162       32.02      100.00
{txt}{hline 16}{c +}{hline 35}
          Total {c |}{res}        506      100.00
{txt}
{com}. gen Suspended = 0 //generating indicatort for graduation from Alnahda (or suspended)
{txt}
{com}. replace Suspended = 1 if Suspended_admin == "إيقاف" | Suspended_admin == "طي قيد"
{txt}(178 real changes made)

{com}. tab Suspended  //150 graduated

  {txt}Suspended {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        884       83.24       83.24
{txt}          1 {c |}{res}        178       16.76      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      1,062      100.00
{txt}
{com}. tab group if Suspended == 1 // Note that some were just control or receiving just wusool subsidy

                        {txt}group {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
                  Uber Wusool {c |}{res}         21       11.80       11.80
{txt}    UberControl WusoolControl {c |}{res}         26       14.61       26.40
{txt}  UberControl WusoolTreatment {c |}{res}         27       15.17       41.57
{txt}  UberTreatment WusoolControl {c |}{res}         42       23.60       65.17
{txt}UberTreatment WusoolTreatment {c |}{res}         62       34.83      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}        178      100.00
{txt}
{com}. * drop if Suspended == 1
. 
. 
. *note these 5 get dropped after this block
. *browse if new_id == "1562" | new_id == "1637" | new_id == "10584" | new_id == "10703" | new_id == "10728"
. 
. **************** Given Driving Subsidy Treatment Status *******************************
. tab driving_T  //we will drop those randomized to get driving subsidy did not get it because they did not answer even with multple attempts to offer it

  {txt}driving_T {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        284       36.98       36.98
{txt}          1 {c |}{res}        484       63.02      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        768      100.00
{txt}
{com}. 
. *We decided to drop those that did not answer from all treatment arms only if they were not from the initial randomization, ie from cohort 1.2 or above.
. 
. *5 women not given driving treatment because of no answer:
. tab new_id if driving_T == 1  & invited_eventdate == "None" & signed == .  & randomization_cohort != 1.1

     {txt}new_id {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
      10584 {c |}{res}          1       20.00       20.00
{txt}      10703 {c |}{res}          1       20.00       40.00
{txt}      10728 {c |}{res}          1       20.00       60.00
{txt}       1562 {c |}{res}          1       20.00       80.00
{txt}       1637 {c |}{res}          1       20.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}          5      100.00
{txt}
{com}. * drop if driving_T == 1  & invited_eventdate == "None" & signed == . & randomization_cohort != 1.1
. 
. tab driving_T 

  {txt}driving_T {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        284       36.98       36.98
{txt}          1 {c |}{res}        484       63.02      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        768      100.00
{txt}
{com}. 
. replace signed = 0 if driving_T ==1 & signed == .
{txt}(193 real changes made)

{com}. tab signed  // total signed remaining is 285.

     {txt}signed {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        193       39.15       39.15
{txt}          1 {c |}{res}        300       60.85      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        493      100.00
{txt}
{com}. 
. 
. **************** Given Wusool information Treatment Status *******************************
. ****** need to revisit this section
. * Some did not get Wusool info over the phone or in the event even though they were supposed to. We drop them from the analysis except if they got the driving treatment
. tab wusool_T

   {txt}wusool_T {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        366       47.59       47.59
{txt}          1 {c |}{res}        403       52.41      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        769      100.00
{txt}
{com}. 
. 
. *drop those that did not get wusool info but keep those who got driving T:
. tab Haveyouheardaboutthisprogra //this question asked if they heard about a transportation subsidy program

                          {txt}(lastnm) {c |}
       Haveyouheardaboutthisprogra {c |}      Freq.     Percent        Cum.
{hline 35}{c +}{hline 35}
                                 0 {c |}{res}         67       21.07       21.07
{txt}                                No {c |}{res}        154       48.43       69.50
{txt}                          Not sure {c |}{res}         27        8.49       77.99
{txt}                               Yes {c |}{res}         67       21.07       99.06
{txt}       Yes, heard at alnahda event {c |}{res}          1        0.31       99.37
{txt}      Yes, heard at alnahda khazna {c |}{res}          1        0.31       99.69
{txt}                                no {c |}{res}          1        0.31      100.00
{txt}{hline 35}{c +}{hline 35}
                             Total {c |}{res}        318      100.00
{txt}
{com}. tab Doyouknowthenameoftheprog //if they said yes, this question asked if thet knew the name of the program

     {txt}(lastnm) Doyouknowthenameoftheprog {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                                      0 {c |}{res}         69       21.70       21.70
{txt}                                     No {c |}{res}        191       60.06       81.76
{txt}                    No, do not remember {c |}{res}          1        0.31       82.08
{txt}                      Yes, the name is: {c |}{res}         57       17.92      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}        318      100.00
{txt}
{com}. gen wusool_T_offered = 1 if wusool_T == 1 //generating indicator for giving wussol info treatment. Start by assuming everyone got the treatment if they were supoosed to
{txt}(659 missing values generated)

{com}. tab wusool_T_offered 

{txt}wusool_T_of {c |}
      fered {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        403      100.00      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        403      100.00
{txt}
{com}. 
. * The following IDs were not asked about wusool
. tab new_id if wusool_T == 1  & (Haveyouheardaboutthisprogra == "" | Haveyouheardaboutthisprogra=="0") ///
>                              & (Doyouknowthenameoftheprog == "" | Doyouknowthenameoftheprog=="0") & dup == 0

     {txt}new_id {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
      10077 {c |}{res}          1        1.10        1.10
{txt}       1008 {c |}{res}          1        1.10        2.20
{txt}       1009 {c |}{res}          1        1.10        3.30
{txt}      10103 {c |}{res}          1        1.10        4.40
{txt}       1013 {c |}{res}          1        1.10        5.49
{txt}       1014 {c |}{res}          1        1.10        6.59
{txt}       1015 {c |}{res}          1        1.10        7.69
{txt}      10171 {c |}{res}          1        1.10        8.79
{txt}       1020 {c |}{res}          1        1.10        9.89
{txt}       1025 {c |}{res}          1        1.10       10.99
{txt}      10257 {c |}{res}          1        1.10       12.09
{txt}       1026 {c |}{res}          1        1.10       13.19
{txt}      10308 {c |}{res}          1        1.10       14.29
{txt}       1037 {c |}{res}          1        1.10       15.38
{txt}       1042 {c |}{res}          1        1.10       16.48
{txt}       1047 {c |}{res}          1        1.10       17.58
{txt}       1049 {c |}{res}          1        1.10       18.68
{txt}      10584 {c |}{res}          1        1.10       19.78
{txt}      10585 {c |}{res}          1        1.10       20.88
{txt}       1061 {c |}{res}          1        1.10       21.98
{txt}       1063 {c |}{res}          1        1.10       23.08
{txt}      10664 {c |}{res}          1        1.10       24.18
{txt}      10667 {c |}{res}          1        1.10       25.27
{txt}      10668 {c |}{res}          1        1.10       26.37
{txt}      10684 {c |}{res}          1        1.10       27.47
{txt}      10690 {c |}{res}          1        1.10       28.57
{txt}      10700 {c |}{res}          1        1.10       29.67
{txt}      10703 {c |}{res}          1        1.10       30.77
{txt}       1071 {c |}{res}          1        1.10       31.87
{txt}      10717 {c |}{res}          1        1.10       32.97
{txt}      10731 {c |}{res}          1        1.10       34.07
{txt}       1081 {c |}{res}          1        1.10       35.16
{txt}       1082 {c |}{res}          1        1.10       36.26
{txt}       1084 {c |}{res}          1        1.10       37.36
{txt}       1091 {c |}{res}          1        1.10       38.46
{txt}       1094 {c |}{res}          1        1.10       39.56
{txt}       1103 {c |}{res}          1        1.10       40.66
{txt}       1125 {c |}{res}          1        1.10       41.76
{txt}       1144 {c |}{res}          1        1.10       42.86
{txt}       1162 {c |}{res}          1        1.10       43.96
{txt}       1163 {c |}{res}          1        1.10       45.05
{txt}       1172 {c |}{res}          1        1.10       46.15
{txt}       1183 {c |}{res}          1        1.10       47.25
{txt}       1199 {c |}{res}          1        1.10       48.35
{txt}       1206 {c |}{res}          1        1.10       49.45
{txt}       1214 {c |}{res}          1        1.10       50.55
{txt}       1223 {c |}{res}          1        1.10       51.65
{txt}       1251 {c |}{res}          1        1.10       52.75
{txt}       1263 {c |}{res}          1        1.10       53.85
{txt}       1269 {c |}{res}          1        1.10       54.95
{txt}       1276 {c |}{res}          1        1.10       56.04
{txt}       1294 {c |}{res}          1        1.10       57.14
{txt}       1327 {c |}{res}          1        1.10       58.24
{txt}       1337 {c |}{res}          1        1.10       59.34
{txt}       1346 {c |}{res}          1        1.10       60.44
{txt}       1349 {c |}{res}          1        1.10       61.54
{txt}       1377 {c |}{res}          1        1.10       62.64
{txt}       1383 {c |}{res}          1        1.10       63.74
{txt}       1386 {c |}{res}          1        1.10       64.84
{txt}       1405 {c |}{res}          1        1.10       65.93
{txt}       1407 {c |}{res}          1        1.10       67.03
{txt}       1418 {c |}{res}          1        1.10       68.13
{txt}       1423 {c |}{res}          1        1.10       69.23
{txt}       1435 {c |}{res}          1        1.10       70.33
{txt}       1445 {c |}{res}          1        1.10       71.43
{txt}       1467 {c |}{res}          1        1.10       72.53
{txt}       1469 {c |}{res}          1        1.10       73.63
{txt}       1470 {c |}{res}          1        1.10       74.73
{txt}       1480 {c |}{res}          1        1.10       75.82
{txt}       1483 {c |}{res}          1        1.10       76.92
{txt}       1496 {c |}{res}          1        1.10       78.02
{txt}       1508 {c |}{res}          1        1.10       79.12
{txt}       1511 {c |}{res}          1        1.10       80.22
{txt}       1524 {c |}{res}          1        1.10       81.32
{txt}       1527 {c |}{res}          1        1.10       82.42
{txt}       1549 {c |}{res}          1        1.10       83.52
{txt}       1562 {c |}{res}          1        1.10       84.62
{txt}       1568 {c |}{res}          1        1.10       85.71
{txt}       1583 {c |}{res}          1        1.10       86.81
{txt}       1602 {c |}{res}          1        1.10       87.91
{txt}       1637 {c |}{res}          1        1.10       89.01
{txt}       1639 {c |}{res}          1        1.10       90.11
{txt}       1642 {c |}{res}          1        1.10       91.21
{txt}       1648 {c |}{res}          1        1.10       92.31
{txt}       1655 {c |}{res}          1        1.10       93.41
{txt}       1664 {c |}{res}          1        1.10       94.51
{txt}       1705 {c |}{res}          1        1.10       95.60
{txt}       1747 {c |}{res}          1        1.10       96.70
{txt}       1752 {c |}{res}          1        1.10       97.80
{txt}       1766 {c |}{res}          1        1.10       98.90
{txt}       1773 {c |}{res}          1        1.10      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         91      100.00
{txt}
{com}.                                                          
. replace wusool_T_offered = 0 if wusool_T == 1  & (Haveyouheardaboutthisprogra == "" | Haveyouheardaboutthisprogra=="0") ///
>                              & (Doyouknowthenameoftheprog == "" | Doyouknowthenameoftheprog=="0") ///
>                                                          
{txt}(150 real changes made)

{com}.                                                          
. * drop if wusool_T == 1 &  wusool_T_offered == 0 & driving_T == 0 & randomization_cohort != 1.1 //21 dropped because of not receiving wusool info and not being in the driving treatment group
. 
. 
. tab wusool_T wusool_T_offered 

           {txt}{c |}   wusool_T_offered
  wusool_T {c |}         0          1 {c |}     Total
{hline 11}{c +}{hline 22}{c +}{hline 10}
         1 {c |}{res}       150        253 {txt}{c |}{res}       403 
{txt}{hline 11}{c +}{hline 22}{c +}{hline 10}
     Total {c |}{res}       150        253 {txt}{c |}{res}       403 
{txt}
{com}. 
. tab driving_ct2 wusool_ct2

{txt}driving_ct {c |}      wusool_ct2
         2 {c |}   Control  Treatment {c |}     Total
{hline 11}{c +}{hline 22}{c +}{hline 10}
   Control {c |}{res}       132        152 {txt}{c |}{res}       284 
{txt} Treatment {c |}{res}       233        251 {txt}{c |}{res}       484 
{txt}{hline 11}{c +}{hline 22}{c +}{hline 10}
     Total {c |}{res}       365        403 {txt}{c |}{res}       768 
{txt}
{com}. 
. ***********************************************************
. *    Cleaning variables
. ***********************************************************
. *Data came from surveys or admin data. We use both to fill where needed.
. ************ Age Variable ************ 
. 
. destring age,replace
{txt}age: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(157 missing values generated)
{res}{txt}
{com}. count if age == . //1 missing data (only available in category age variable)
  {res}157
{txt}
{com}. label var age "Age"
{txt}
{com}. 
. ************* Marital Status Variable based on admin and survey question ************
. *admin data:
. gen maritalstatus2 = ""
{txt}(1,062 missing values generated)

{com}. replace maritalstatus2 = "Divorced" if marital_admin == "مطلقة " | marital_admin == "مطلقة"
{txt}variable {bf}{res}maritalstatus2{sf}{txt} was {bf}{res}str1{sf}{txt} now {bf}{res}str8{sf}
{txt}(238 real changes made)

{com}. replace maritalstatus2 = "Married" if marital_admin == "متزوجه" | marital_admin == "متزوجة" ///
>                                     | marital_admin == "متزوجة (سجين)" | marital_admin == "الارمله متزوجة وتسكن مع الزوج والابناء "
{txt}(162 real changes made)

{com}.                                                                         
. replace maritalstatus2 = "Single" if marital_admin == "عزباء"
{txt}(246 real changes made)

{com}. replace maritalstatus2 = "widowed" if marital_admin == "أرملة" | marital_admin == "أرملة " | marital_admin == "ارملة" ///
>                                  | marital_admin == "ارملة وتسكن مع الأبناء" 
{txt}(17 real changes made)

{com}. replace maritalstatus2 = "Family of Prisinor" if marital_admin == "أسرة سجين"
{txt}variable {bf}{res}maritalstatus2{sf}{txt} was {bf}{res}str8{sf}{txt} now {bf}{res}str18{sf}
{txt}(1 real change made)

{com}. replace maritalstatus2 = "abandoned" if marital_admin == "مهجورة" | marital_admin == "مهجوره "
{txt}(4 real changes made)

{com}. 
. gen married1 = .
{txt}(1,062 missing values generated)

{com}. replace married1 = 1 if maritalstatus2 == "Married" 
{txt}(162 real changes made)

{com}. replace married1 = 0 if maritalstatus2 != "Married" & maritalstatus2 != ""  //marriage indicator from admin data
{txt}(506 real changes made)

{com}. 
. *Survey data:
. rename ماهيحالتكالاجتماعية maritalstatus3
{res}{txt}
{com}. gen maritalstatus4 = ""
{txt}(1,062 missing values generated)

{com}. replace maritalstatus4 = "Divorced" if maritalstatus3 == "مطلقة"
{txt}variable {bf}{res}maritalstatus4{sf}{txt} was {bf}{res}str1{sf}{txt} now {bf}{res}str8{sf}
{txt}(145 real changes made)

{com}. replace maritalstatus4 = "Married"  if maritalstatus3 == "متزوجة"
{txt}(54 real changes made)

{com}. replace maritalstatus4 = "Single"   if maritalstatus3 == "عزباء"
{txt}(131 real changes made)

{com}. replace maritalstatus4 = "Prefer not to answer"  if maritalstatus3 == "أفضل عدم الإجابة على هذا السؤال"
{txt}variable {bf}{res}maritalstatus4{sf}{txt} was {bf}{res}str8{sf}{txt} now {bf}{res}str20{sf}
{txt}(5 real changes made)

{com}. replace maritalstatus4 = "widowed" if maritalstatus3 == "أرملة"
{txt}(66 real changes made)

{com}. 
. gen married2 = .
{txt}(1,062 missing values generated)

{com}. replace married2 = 1 if maritalstatus4 == "Married" 
{txt}(54 real changes made)

{com}. replace married2 = 0 if maritalstatus4 != "Married" & maritalstatus2 != "Prefer not to answer"  //marriage indicator from survey data
{txt}(1,008 real changes made)

{com}. 
. gen married = . //generating a combined variable to fill from both admin and survey data as needed
{txt}(1,062 missing values generated)

{com}. replace married = 1 if married1 == 1 | married2 == 1 //if either admin or survey indicate married, we consider her married
{txt}(170 real changes made)

{com}. replace married = 0 if married1 == 0 & married2 == 0 //if both admin and survey indicate not married, we consider her not married
{txt}(503 real changes made)

{com}. replace married = 0 if married1 == . & married2 == 0 //if admin indicated not married but survey is missing, we consider her not married
{txt}(389 real changes made)

{com}. replace married = 0 if married1 == 0 & married2 == . //if survey indicated not married but admin is missing, we consider her not married
{txt}(0 real changes made)

{com}. label var married "Married"
{txt}
{com}. tab married

    {txt}Married {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        892       83.99       83.99
{txt}          1 {c |}{res}        170       16.01      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      1,062      100.00
{txt}
{com}. 
. ************ Education Variable ************
. 
. *years of education (assume college = 4 years, Diploma = 2 years, Elementary =3 years, Masters =2 years, Primary = 6 years, Read&write = 1 year ,Secondary = 3 years:
. 
. *Start with Survey data (Whatisyourlevelofeducation) and fill from admin (Education) if survey data is missing or prefer not to answer:
. gen education_level = Whatisyourlevelofeducation
{txt}(408 missing values generated)

{com}. replace education_level = Education if education_level =="" | education_level =="0" | education_level =="I prefer not to answer this question"
{txt}(227 real changes made)

{com}. tab education_level

                        {txt}education_level {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                                College {c |}{res}         45        5.62        5.62
{txt}                                Diploma {c |}{res}         19        2.38        8.00
{txt}                             Elementary {c |}{res}         75        9.38       17.38
{txt}                                Masters {c |}{res}          2        0.25       17.62
{txt}                                Primary {c |}{res}         60        7.50       25.12
{txt}                         Read and Write {c |}{res}         32        4.00       29.12
{txt}                              Secondary {c |}{res}         99       12.38       41.50
{txt}                            أقرا و أكتب {c |}{res}          7        0.88       42.38
{txt}                                   أمية {c |}{res}         15        1.88       44.25
{txt}                              أول ثانوي {c |}{res}          2        0.25       44.50
{txt}                             أول ثانوية {c |}{res}          1        0.12       44.62
{txt}                              أول متوسط {c |}{res}          2        0.25       44.88
{txt}                             أولى ثانوي {c |}{res}          2        0.25       45.12
{txt}                                إبتدائي {c |}{res}         14        1.75       46.88
{txt}                                 إعدادي {c |}{res}         15        1.88       48.75
{txt}                                ابتدائي {c |}{res}         21        2.62       51.38
{txt}        افضل عدم الإجابة على هذا السؤال {c |}{res}          5        0.62       52.00
{txt}                              بكالوريوس {c |}{res}         34        4.25       56.25
{txt}                             بكالوريوس  {c |}{res}         21        2.62       58.88
{txt}                              بكالويوس  {c |}{res}          1        0.12       59.00
{txt}                             تدرس ثانوي {c |}{res}          1        0.12       59.12
{txt}                             تقرأ وتكتب {c |}{res}          1        0.12       59.25
{txt}                             ثالث ثانوي {c |}{res}          4        0.50       59.75
{txt}                             ثالث متوسط {c |}{res}          1        0.12       59.88
{txt}                                  ثانوي {c |}{res}         92       11.50       71.38
{txt}                                 ثانوية {c |}{res}         58        7.25       78.62
{txt}                             ثاني ثانوي {c |}{res}          1        0.12       78.75
{txt}                            ثاني ثانوية {c |}{res}          8        1.00       79.75
{txt}                             ثاني دبلوم {c |}{res}          4        0.50       80.25
{txt}                             ثاني متوسط {c |}{res}          2        0.25       80.50
{txt}                           خامس ابتدائي {c |}{res}          1        0.12       80.62
{txt}                          خامس محو أمية {c |}{res}          1        0.12       80.75
{txt}                                  دبلوم {c |}{res}         54        6.75       87.50
{txt}                                 دبلوم  {c |}{res}          5        0.62       88.12
{txt}                           رابع ابتدائي {c |}{res}          3        0.38       88.50
{txt}                           سادس ابتدائي {c |}{res}          1        0.12       88.62
{txt}                            شهادة دبلوم {c |}{res}         12        1.50       90.12
{txt}                           طالبة جامعية {c |}{res}          3        0.38       90.50
{txt}                                   كلية {c |}{res}         52        6.50       97.00
{txt}                      متخرجة من الثانوي {c |}{res}          1        0.12       97.12
{txt}                                  متوسط {c |}{res}         10        1.25       98.38
{txt}                                 متوسطة {c |}{res}         13        1.62      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}        800      100.00
{txt}
{com}. 
. gen education2 = . //this is years of education
{txt}(1,062 missing values generated)

{com}. label var education2 "Education"
{txt}
{com}. 
. replace education2 = 18 if education_level == "Masters" | education_level == "ماجستير"  
{txt}(2 real changes made)

{com}. 
. replace education2 = 16 if education_level == "College" | education_level == "تعليم جامعي" ///
>                          | education_level == "بكالوريوس" | education_level == "بكالوريوس "  ///
>                                                  | education_level == "بكالويوس " |  education_level == "طالبة جامعية"
{txt}(104 real changes made)

{com}. 
. replace education2 = 13 if education_level == "ثاني دبلوم"
{txt}(4 real changes made)

{com}. 
. replace education2 = 14 if education_level == "Diploma" | education_level == "دبلوم" ///
>                          | education_level == "شهادة دبلوم" | education_level == "كلية" | education_level == "دبلوم " ///
> 
{txt}(142 real changes made)

{com}. 
. replace education2 = 12 if education_level == "Secondary" | education_level == "ثانوي" /// 
>                          | education_level == "ثالث ثانوي" | education_level == "ثانوية" ///
>                                                  | education_level == "متخرجة من الثانوي"
{txt}(254 real changes made)

{com}. 
. replace education2 = 11 if education_level == "ثاني ثانوية" | education_level == "ثاني ثانوي" 
{txt}(9 real changes made)

{com}. 
. replace education2 = 10 if education_level == "أولى ثانوي" | education_level == "أول ثانوي" | education_level == "أول ثانوية"
{txt}(5 real changes made)

{com}. 
.                                                                                  
. replace education2 = 9 if education_level == "Elementary" | education_level == "متوسط" ///
>                         | education_level == "إعدادي" | education_level == "ثالث متوسط" ///
>                                                 | education_level == "متوسطة"
{txt}(114 real changes made)

{com}. 
. replace education2 = 8 if education_level =="ثاني متوسط"                                       
{txt}(2 real changes made)

{com}. 
. replace education2 = 7 if education_level =="أول متوسط"                                 
{txt}(2 real changes made)

{com}.                 
. replace education2 = 6 if education_level == "Primary" | education_level == "إبتدائي" ///
>                         | education_level == "ابتدائي"  | education_level =="تدرس ثانوي" ///
>                                                 | education_level == "سادس ابتدائي"
{txt}(97 real changes made)

{com}. 
.                                                 
. replace education2 = 5 if education_level == "خامس ابتدائي"                          
{txt}(1 real change made)

{com}.                                                 
. replace education2 = 5 if education_level == "رابع ابتدائي"                          
{txt}(3 real changes made)

{com}.                                                                                                 
. replace education2 = 1 if education_level == "Read and Write" | education_level == "أقرا و أكتب" | education_level == "تقرأ وتكتب" | education_level == "خامس محو أمية"
{txt}(41 real changes made)

{com}. 
. replace education2 = 0 if education_level == "أمية" 
{txt}(15 real changes made)

{com}. //12 prefer not to answer
. 
. tab education2

  {txt}Education {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         15        1.89        1.89
{txt}          1 {c |}{res}         41        5.16        7.04
{txt}          5 {c |}{res}          4        0.50        7.55
{txt}          6 {c |}{res}         97       12.20       19.75
{txt}          7 {c |}{res}          2        0.25       20.00
{txt}          8 {c |}{res}          2        0.25       20.25
{txt}          9 {c |}{res}        114       14.34       34.59
{txt}         10 {c |}{res}          5        0.63       35.22
{txt}         11 {c |}{res}          9        1.13       36.35
{txt}         12 {c |}{res}        254       31.95       68.30
{txt}         13 {c |}{res}          4        0.50       68.81
{txt}         14 {c |}{res}        142       17.86       86.67
{txt}         16 {c |}{res}        104       13.08       99.75
{txt}         18 {c |}{res}          2        0.25      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. * The following are dummy variables for each level of education:
. gen education_masters = 0
{txt}
{com}. replace education_masters = 1 if education_level == "Masters" | education_level == "ماجستير" 
{txt}(2 real changes made)

{com}. replace education_masters = . if education_level == "" | education_level == "افضل عدم الإجابة على هذا السؤال" 
{txt}(267 real changes made, 267 to missing)

{com}. tab education_masters

{txt}education_m {c |}
     asters {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        793       99.75       99.75
{txt}          1 {c |}{res}          2        0.25      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. gen education_college = 0
{txt}
{com}. replace education_college = 1 if education_level == "College" | education_level == "تعليم جامعي" ///
>                          | education_level == "بكالوريوس" | education_level == "بكالوريوس "  ///
>                                                  | education_level == "بكالويوس " |  education_level == "طالبة جامعية"                                                
{txt}(104 real changes made)

{com}. replace education_college = . if education_level == "" | education_level == "افضل عدم الإجابة على هذا السؤال" 
{txt}(267 real changes made, 267 to missing)

{com}. tab education_college

{txt}education_c {c |}
     ollege {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        691       86.92       86.92
{txt}          1 {c |}{res}        104       13.08      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. 
. gen education_diploma = 0
{txt}
{com}. replace education_diploma = 1 if education_level == "ثاني دبلوم" | education_level == "Diploma" | education_level == "دبلوم" ///
>                          | education_level == "شهادة دبلوم" | education_level == "كلية" | education_level == "دبلوم " 
{txt}(146 real changes made)

{com}. replace education_diploma = . if education_level == "" | education_level == "افضل عدم الإجابة على هذا السؤال" 
{txt}(267 real changes made, 267 to missing)

{com}. tab education_diploma

{txt}education_d {c |}
     iploma {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        649       81.64       81.64
{txt}          1 {c |}{res}        146       18.36      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. gen education_highschool = 0
{txt}
{com}. replace education_highschool = 1 if education_level == "Secondary" | education_level == "ثانوي" /// 
>                                   | education_level == "ثالث ثانوي" | education_level == "ثانوية" ///
>                                                           | education_level == "متخرجة من الثانوي" | education_level == "ثاني ثانوية" | education_level == "ثاني ثانوي" ///
>                                                           | education_level == "أولى ثانوي" | education_level == "أول ثانوي" | education_level == "أول ثانوية"
{txt}(268 real changes made)

{com}. replace education_highschool = . if education_level == "" | education_level == "افضل عدم الإجابة على هذا السؤال" 
{txt}(267 real changes made, 267 to missing)

{com}. tab education_highschool

{txt}education_h {c |}
  ighschool {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        527       66.29       66.29
{txt}          1 {c |}{res}        268       33.71      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. 
. gen education_elementary = 0
{txt}
{com}. replace education_elementary = 1 if education_level == "Elementary" | education_level == "متوسط" ///
>                                   | education_level == "إعدادي" | education_level == "ثالث متوسط" ///
>                                                         | education_level == "متوسطة" | education_level =="ثاني متوسط"   | education_level =="أول متوسط" 
{txt}(118 real changes made)

{com}. replace education_elementary = . if education_level == "" | education_level == "افضل عدم الإجابة على هذا السؤال" 
{txt}(267 real changes made, 267 to missing)

{com}. tab education_elementary

{txt}education_e {c |}
  lementary {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        677       85.16       85.16
{txt}          1 {c |}{res}        118       14.84      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. gen education_primary = 0
{txt}
{com}. replace education_primary = 1 if education_level == "Primary" | education_level == "إبتدائي" ///
>                         | education_level == "ابتدائي"  | education_level =="تدرس ثانوي" ///
>                                                 | education_level == "سادس ابتدائي" | education_level == "خامس ابتدائي" | education_level == "رابع ابتدائي"                    
{txt}(101 real changes made)

{com}. replace education_primary = . if education_level == "" | education_level == "افضل عدم الإجابة على هذا السؤال" 
{txt}(267 real changes made, 267 to missing)

{com}. tab education_primary

{txt}education_p {c |}
     rimary {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        694       87.30       87.30
{txt}          1 {c |}{res}        101       12.70      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. 
. gen education_read = 0
{txt}
{com}. replace education_read = 1 if education_level == "Read and Write" | education_level == "أقرا و أكتب" | education_level == "تقرأ وتكتب" | education_level == "خامس محو أمية"         
{txt}(41 real changes made)

{com}. replace education_read = . if education_level == "" | education_level == "افضل عدم الإجابة على هذا السؤال" 
{txt}(267 real changes made, 267 to missing)

{com}. tab education_read

{txt}education_r {c |}
        ead {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        754       94.84       94.84
{txt}          1 {c |}{res}         41        5.16      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. 
. gen no_education = 0
{txt}
{com}. replace no_education = 1 if education_level == "0" | education_level == "أمية" 
{txt}(15 real changes made)

{com}. replace no_education = . if education_level == "" | education_level == "افضل عدم الإجابة على هذا السؤال" 
{txt}(267 real changes made, 267 to missing)

{com}. tab no_education        

{txt}no_educatio {c |}
          n {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        780       98.11       98.11
{txt}          1 {c |}{res}         15        1.89      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. *The following is a dummy variable = 1 if years of education were more than 12. This was chosen because high school is 12 years of education
. gen educated = .
{txt}(1,062 missing values generated)

{com}. replace educated = 0 if education2 <= 12 & education2 !=.
{txt}(543 real changes made)

{com}. replace educated = 1 if education2 > 12 & education2 !=.
{txt}(252 real changes made)

{com}. tab educated

   {txt}educated {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        543       68.30       68.30
{txt}          1 {c |}{res}        252       31.70      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        795      100.00
{txt}
{com}. 
. ************ Employment Variable ************
. *Based on admin data:
. gen employment1 = ""
{txt}(1,062 missing values generated)

{com}. replace employment1 = "Housewife" if Employed_admin == "ربة المنزل" | Employed_admin == "ربة منزل"
{txt}variable {bf}{res}employment1{sf}{txt} was {bf}{res}str1{sf}{txt} now {bf}{res}str9{sf}
{txt}(170 real changes made)

{com}. replace employment1 = "Student" if Employed_admin == "طالبة" | Employed_admin == "طالبة عن بعد" | Employed_admin == "طالبة/ موظفة" | Employed_admin == "موظفة/ طالبة"
{txt}(154 real changes made)

{com}. replace employment1 = "Unemployed" if Employed_admin == "عاطلة" | Employed_admin == "لاتعمل" | Employed_admin == "لاتعمل "
{txt}variable {bf}{res}employment1{sf}{txt} was {bf}{res}str9{sf}{txt} now {bf}{res}str10{sf}
{txt}(283 real changes made)

{com}. replace employment1 = "Retired" if Employed_admin == "متقاعدة"
{txt}(1 real change made)

{com}. replace employment1 = "Employed" if Employed_admin == "موظفة" | Employed_admin == "تعمل"
{txt}(105 real changes made)

{com}. 
. tab employment1

{txt}employment1 {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
   Employed {c |}{res}        105       14.73       14.73
{txt}  Housewife {c |}{res}        170       23.84       38.57
{txt}    Retired {c |}{res}          1        0.14       38.71
{txt}    Student {c |}{res}        154       21.60       60.31
{txt} Unemployed {c |}{res}        283       39.69      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        713      100.00
{txt}
{com}. 
. *Based on survey question "are you employed":
. rename هلأنتموظفة are_you_employed
{res}{txt}
{com}. 
. gen employed = .
{txt}(1,062 missing values generated)

{com}. replace employed = 0 if ///
>         are_you_employed == "No, I am not employed and I am looking for a job" | ///
>         are_you_employed == "No, and I am looking for a job" | ///
>         are_you_employed == "لا، أنا طالبة وأنوي العمل بعد التخرج" | ///
>         are_you_employed == "لا، وأبحث عن وظيفة" | ///
>         are_you_employed == "لا، ولا أبحث عن وظيفة" | ///
>         are_you_employed == "لا، ولا أبحث عن وظيفة"  
{txt}(760 real changes made)

{com}. 
. replace employed = 1 if ///
>         are_you_employed == "Yes, I am employed and open to looking for a different job" | ///
>         are_you_employed == "Yes, and I am looking for a different job" | ///
>         are_you_employed == "نعم، وأبحث عن وظيفة أخرى" | ///
>         are_you_employed == "نعم، ولا أبحث عن وظيفة أخرى" 
{txt}(198 real changes made)

{com}.         
. *Combining admin and survey data:
. replace employed = 1 if employed == . & employment1 == "Employed"
{txt}(7 real changes made)

{com}. replace employed = 0 if employed == . & employment1 != "Employed"
{txt}(97 real changes made)

{com}. tab employed    

   {txt}employed {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        857       80.70       80.70
{txt}          1 {c |}{res}        205       19.30      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      1,062      100.00
{txt}
{com}. 
. ************ Car Ownership Variable ************
. *This was asked in the survey. How many cars does your household own?
. 
. rename كمعددالسياراتالتيتمتلكهاأسر car
{res}{txt}
{com}. 
. replace car = "I prefer not to answer" if car ==  "أفضل عدم الإجابة على هذا السؤال"
{txt}(21 real changes made)

{com}. replace car = "More than 4" if car ==  "أكثر من 4"
{txt}(9 real changes made)

{com}. 
. gen car2 = car
{txt}(52 missing values generated)

{com}. replace car2 = "4" if car == "More than 4" //if they answerwed more than 4, we record it as 4
{txt}(9 real changes made)

{com}. replace car2 = "." if car == "I prefer not to answer"
{txt}(21 real changes made)

{com}. label var car2 "Car Ownership"
{txt}
{com}. 
. destring car2,replace //making variable numeric
{txt}car2: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(73 missing values generated)
{res}{txt}
{com}. tab car2 //number of cars per household

        {txt}Car {c |}
  Ownership {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        427       43.17       43.17
{txt}          1 {c |}{res}        406       41.05       84.23
{txt}          2 {c |}{res}        111       11.22       95.45
{txt}          3 {c |}{res}         30        3.03       98.48
{txt}          4 {c |}{res}         15        1.52      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        989      100.00
{txt}
{com}. 
. *A dummy variable for car ownership
. gen icar =.
{txt}(1,062 missing values generated)

{com}. replace icar = 0 if car2==0
{txt}(427 real changes made)

{com}. replace icar =1 if car2 > 0 & car2!=.
{txt}(562 real changes made)

{com}. label var icar "Car Ownership"
{txt}
{com}. tab icar

        {txt}Car {c |}
  Ownership {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        427       43.17       43.17
{txt}          1 {c |}{res}        562       56.83      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        989      100.00
{txt}
{com}. 
. 
. ************ Driving Likelihood Variable ************
. * A question in the survey asked about the likelihood of driving
. rename ماهياحتماليةقيادتكالسيارةب driving_likelihood_ar
{res}{txt}
{com}. 
. *generating a dummy variable = 1 if likely to drive. We consider any indication of possible driving in the future to be "likely to drive"
. gen driving_not_unlikely_BL = .
{txt}(1,062 missing values generated)

{com}. replace driving_not_unlikely_BL = 0 if  driving_likelihood_ar == "أمر مستبعد" |  ///
>                                                                 driving_likelihood_ar == "Somewhat unlikely"
{txt}(139 real changes made)

{com}. 
. replace driving_not_unlikely_BL = 1 if  driving_likelihood_ar == "Likely" | ///
>                                                                 driving_likelihood_ar == "Somewhat likely" | ///
>                                                                 driving_likelihood_ar == "محتمل" | ///
>                                                                 driving_likelihood_ar == "محتمل/ليس في البداية" ///
>                                                                 | driving_likelihood_ar == "محتمل/ليس في البداية" | ///
>                                                                 driving_likelihood_ar == "من الممكن/ ليس في البداية" ///
>                                                                 | driving_likelihood_ar == "احتمالية قليلة"          
{txt}(814 real changes made)

{com}. lab var driving_not_unlikely_BL ///
>                 "Somewhat likely, likely, or likely but not at first to drive when ban lifted"
{txt}
{com}.         
. tab driving_not_unlikely_BL  // 14 missing.  2 observations "0" & 9 prefer not to answer & 2 "indifferent" & one from insan not surveyed

   {txt}Somewhat {c |}
    likely, {c |}
 likely, or {c |}
 likely but {c |}
     not at {c |}
   first to {c |}
 drive when {c |}
 ban lifted {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        139       14.59       14.59
{txt}          1 {c |}{res}        814       85.41      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        953      100.00
{txt}
{com}. 
. ** أمر مستبعد unlikely محتمل likely محتمل/ليس في البداية" likely but not at firstمن الممكن/ ليس في البداية likely but not at first احتمالية قليلة somewhat likely
. 
. ************ Driving School Registration Likelihood Variable ************
. 
. 
. rename هلسجلتفيمدرسةالقيادة drivingschool_register //question asks have you registered to driving school. 11 missing
{res}{txt}
{com}. 
. gen drivingschool_register2 = drivingschool_register
{txt}(52 missing values generated)

{com}. replace drivingschool_register2 = "Prefer not to answer" if drivingschool_register == "0" | drivingschool_register == "أفضل عدم الإجابة على هذا السؤال"
{txt}(72 real changes made)

{com}. replace drivingschool_register2 = "No, but planning to" if drivingschool_register == "لا، لم اسجل لكن أنوي اقيام بذلك" 
{txt}(616 real changes made)

{com}. replace drivingschool_register2 = "No, and not planning to" if drivingschool_register == "لا، ولا أنوي التسجيل" 
{txt}(226 real changes made)

{com}. replace drivingschool_register2 = "Yes, I registered" if drivingschool_register == "نعم، سجلت" 
{txt}(96 real changes made)

{com}. 
. 
. gen reg_dr = . // variable about registration to school prior to experiment start. 3 participants registered before experiment. 2 are in treatment
{txt}(1,062 missing values generated)

{com}. replace reg_dr = 1 if drivingschool_register2 == "Yes, I registered"
{txt}(96 real changes made)

{com}. replace reg_dr = 0 if drivingschool_register2 != "Yes, I registered" & drivingschool_register2 != "" ///
>                     & drivingschool_register2 != "Prefer not to answer" ///
>                                         & drivingschool_register2 != "0"
{txt}(842 real changes made)

{com}. 
. gen dr_Def_No = . // variable about their intent to register before experiment
{txt}(1,062 missing values generated)

{com}. label variable dr_Def_No "Driving School Registration Intent before experiment"
{txt}
{com}. 
. replace dr_Def_No = 0 if drivingschool_register2 == "No, and not planning to" 
{txt}(226 real changes made)

{com}. replace dr_Def_No = 1 if drivingschool_register2 == "No, but planning to" 
{txt}(616 real changes made)

{com}. 
. 
. *generating new HH_size after dropping the late joiners and all other drops:
. 
. **** more of how many from hh in study 
.  
. order Institution file_nbr new_id
{txt}
{com}. sort  Institution file_nbr new_id
{txt}
{com}. by Institution file_nbr: gen HH_size2 = _N
{txt}
{com}. order Institution file_nbr new_id HH_size2 randomization_cohort
{txt}
{com}. 
. tab HH_size2 

   {txt}HH_size2 {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        453       42.66       42.66
{txt}          2 {c |}{res}        268       25.24       67.89
{txt}          3 {c |}{res}        195       18.36       86.25
{txt}          4 {c |}{res}         84        7.91       94.16
{txt}          5 {c |}{res}         35        3.30       97.46
{txt}          6 {c |}{res}         12        1.13       98.59
{txt}          7 {c |}{res}          7        0.66       99.25
{txt}          8 {c |}{res}          8        0.75      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      1,062      100.00
{txt}
{com}. label var HH_size2 "HH Members"
{txt}
{com}. 
. 
. 
. ***********************************************************
. *    generate fixed effect variables
. ***********************************************************
. 
. tostring randomization_cohort, gen(randomization_cohort2)
{txt}randomization_cohort2 generated as {res:str3}

{com}. 
. 
. 
. 
. destring new_id, replace
{txt}new_id: all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. 
. 
. * create baseline searching dummy variable
. tab are_you_employed

                    {txt}(lastnm) هلأنتموظفة {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                                      0 {c |}{res}         41        4.06        4.06
{txt}        أفضل عدم الإجابة على هذا السؤال {c |}{res}         11        1.09        5.15
{txt}   لا، أنا طالبة وأنوي العمل بعد التخرج {c |}{res}        175       17.33       22.48
{txt}                     لا، وأبحث عن وظيفة {c |}{res}        419       41.49       63.96
{txt}                  لا، ولا أبحث عن وظيفة {c |}{res}        166       16.44       80.40
{txt}               نعم، وأبحث عن وظيفة أخرى {c |}{res}        128       12.67       93.07
{txt}            نعم، ولا أبحث عن وظيفة أخرى {c |}{res}         70        6.93      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}      1,010      100.00
{txt}
{com}. gen BLsearch = 0 if are_you_employed == "أفضل عدم الإجابة على هذا السؤال" | are_you_employed == "لا، ولا أبحث عن وظيفة" | are_you_employed == "نعم، ولا أبحث عن وظيفة أخرى" | are_you_employed == "0" 
{txt}(774 missing values generated)

{com}. replace BLsearch = 1 if are_you_employed == "لا، أنا طالبة وأنوي العمل بعد التخرج" | are_you_employed == "لا، وأبحث عن وظيفة" | are_you_employed == "نعم، وأبحث عن وظيفة أخرى"
{txt}(722 real changes made)

{com}. label variable BLsearch "baseline job search"
{txt}
{com}. 
. ***** bring in exclusion sheet and drop necessary observations
. merge m:1 new_id using "${c -(}data{c )-}/RCT admin and wave 1/Raw/Exclusion_sheet.dta"
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}               0
{txt}{col 5}Matched{col 30}{res}           1,062{txt}  (_merge==3)
{col 5}{hline 41}

{com}. drop _merge
{txt}
{com}. 
. 
. rename new_id participantid
{res}{txt}
{com}. replace driving_ctoriginal = "None" if driving_ctoriginal == "None "
{txt}(1 real change made)

{com}. 
. * create dummy for missing covariates
. 
. /*
> gen educationmi = (education2 ==.)
> replace education2 = 0 if educationmi == 1 
> 
> gen marriedmi = (married ==.)
> replace married = 0 if marriedmi == 1 
> 
> gen hhsizemi = (HH_size2 ==.)
> replace HH_size2 = 0 if hhsizemi == 1 
> 
> gen carmi = (car2 ==.)
> replace car2 = 0 if carmi == 1 
> 
> gen agemi = (age ==.)
> replace age = 0 if agemi == 1 
> 
> gen hhsizegrmed = (HH_size2>=2)
> label var hhsizegrmed "HH Size Greater/Equal to Median"
> */
. 
. ***     ADDITIONAL CLEANING FOR MERGE WITH WAVE 3/FINAL ANALYSIS
. 
. rename group group_BL
{res}{txt}
{com}. rename employed employed_BL
{res}{txt}
{com}. 
.  replace age =. if age==0
{txt}(0 real changes made)

{com}.         * NOTE: there are 3 observations with age==0 
.         
.         gen cohort = 1 if randomization_cohort2=="1.1"
{txt}(531 missing values generated)

{com}.         replace cohort = 2 if randomization_cohort2=="1.2"
{txt}(221 real changes made)

{com}.         replace cohort = 3 if randomization_cohort2=="1.3"
{txt}(40 real changes made)

{com}.         replace cohort = 4 if randomization_cohort2=="2.1"
{txt}(157 real changes made)

{com}.         replace cohort = 5 if randomization_cohort2=="2.2"
{txt}(30 real changes made)

{com}.         replace cohort = 6 if randomization_cohort2=="3"
{txt}(82 real changes made)

{com}.         
.         * clean likert version of driving likelihood variable
.         gen driving_likely_likert_BL = .
{txt}(1,062 missing values generated)

{com}.         replace driving_likely_likert_BL = 1 if driving_likelihood_ar == "أمر مستبعد"
{txt}(139 real changes made)

{com}.         replace driving_likely_likert_BL = 2 if driving_likelihood_ar == "احتمالية قليلة"
{txt}(108 real changes made)

{com}.         replace driving_likely_likert_BL = 3 if driving_likelihood_ar == "من الممكن/ ليس في البداية" ///
>                                                                                         | driving_likelihood_ar == "محتمل/ليس في البداية"
{txt}(127 real changes made)

{com}.         replace driving_likely_likert_BL = 4 if driving_likelihood_ar == "محتمل"
{txt}(579 real changes made)

{com}.         lab var driving_likely_likert_BL "Likert scale of likeliness to drive (w1)"
{txt}
{com}.         /* Translation:  أمر مستبعد unlikely محتمل likely محتمل/ليس في البداية" likely but not at firstمن الممكن/ ليس في بداية likely but not at first احتمالية قليلة somewhat likely */
.         
.         * create driving likely binary using most likely ==1 and else==0
.         gen driving_likely_BL = 0 if driving_likely_likert_BL!=.
{txt}(109 missing values generated)

{com}.         replace driving_likely_BL = 1 if driving_likely_likert_BL==4
{txt}(579 real changes made)

{com}.         lab var driving_likely_BL "Likely to drive when ban is lifted"
{txt}
{com}.         
.         drop driving_likelihood_ar
{txt}
{com}.         
.                 
.         * create edu var 
.         gen edu_category = 0 if education2<12 & education2!=.
{txt}(773 missing values generated)

{com}.         replace edu_category = 1 if education2==12
{txt}(254 real changes made)

{com}.         replace edu_category = 2 if education2>12 & education2!=.
{txt}(252 real changes made)

{com}.         lab def educat 0 "Less than secondary (<12 yrs)" 1 "Completed secondary (12 yrs)" ///
>         2 "Any tertiary (>12 yrs)"      
{txt}
{com}.         lab val edu_category educat
{txt}
{com}.         lab var edu_category "Education level"
{txt}
{com}.         
.         * Update edu vars 
.         gen less_than_primary = 0
{txt}
{com}.         replace less_than_primary = 1 if no_education==1 | education_read==1 | education2==0
{txt}(56 real changes made)

{com}.         replace less_than_primary = . if no_education==. & education_read==. & ///
>          education_primary==. &  education_elementary==. & education_highschool==. & ///
>          education_diploma==. & education_college==. & education_masters==. & education2==.
{txt}(267 real changes made, 267 to missing)

{com}.         lab var less_than_primary "Less than primary"
{txt}
{com}.         
.         gen elementary = 0
{txt}
{com}.         replace elementary = 1 if education_primary==1 | education_elementary==1 
{txt}(219 real changes made)

{com}.         replace elementary = . if no_education==. & education_read==. & ///
>          education_primary==. & education_elementary==. & education_highschool==. & ///
>          education_diploma==. & education_college==. & education_masters==. & education2==.
{txt}(267 real changes made, 267 to missing)

{com}.         lab var elementary "Elementary (1-5 yrs)"
{txt}
{com}.         
.         gen highschool = 0
{txt}
{com}.         replace highschool = 1 if education_highschool==1 
{txt}(268 real changes made)

{com}.         replace highschool = . if no_education==. & education_read==. & ///
>          education_primary==. & education_elementary==. & education_highschool==. & ///
>          education_diploma==. & education_college==. & education_masters==. ///
>          & education2==.
{txt}(267 real changes made, 267 to missing)

{com}.         lab var highschool "Highschool (6-12 yrs)"
{txt}
{com}.         
.         gen any_tertiary_edu = 0 
{txt}
{com}.         replace any_tertiary_edu = 1 if education_diploma==1 | education_college==1 | education_masters==1
{txt}(252 real changes made)

{com}.         replace any_tertiary_edu = . if no_education==. & education_read==. & ///
>          education_primary==. & education_elementary==. & education_highschool==. & ///
>          education_diploma==. & education_college==. & education_masters==. & ///
>          education2==.
{txt}(267 real changes made, 267 to missing)

{com}.         lab var any_tertiary_edu "Any tertiary education (13+ yrs)"
{txt}
{com}.         
.         
.         * label edu vars
.         lab var no_education "No education"
{txt}
{com}.         lab var education_read "Literate"
{txt}
{com}.         lab var education_primary "Primary school"
{txt}
{com}.         lab var education_elementary "Elementary school"
{txt}
{com}.         lab var education_highschool "High school"
{txt}
{com}.         lab var education_diploma "Diploma"
{txt}
{com}.         lab var education_college "College"
{txt}
{com}.         lab var education_masters "Masters"
{txt}
{com}.         
.         
.         * labor force status: employed, unemployed and searching, out of labor force
.         gen LF_status_BL = .
{txt}(1,062 missing values generated)

{com}.         lab var LF_status_BL "Labor force status at BL"
{txt}
{com}.         replace LF_status_BL = 0 if employed_BL ==0 & BLsearch==0
{txt}(218 real changes made)

{com}.         replace LF_status_BL = 1 if employed_BL ==0 & BLsearch==1
{txt}(594 real changes made)

{com}.         replace LF_status_BL = 2 if employed_BL ==1 
{txt}(205 real changes made)

{com}.         lab def lfstat 0 "out of LF at BL" 1 "unemployed at BL" 2 "employed at BL"
{txt}
{com}.         lab val LF_status_BL lfstat
{txt}
{com}.         
.         * labor force status binary: out of labor force, in labor force
.         gen LF_BL = . 
{txt}(1,062 missing values generated)

{com}.         replace LF_BL = 0 if employed_BL ==0 & BLsearch==0
{txt}(218 real changes made)

{com}.         replace LF_BL = 1 if employed_BL ==0 & BLsearch==1
{txt}(594 real changes made)

{com}.         replace LF_BL = 1 if employed_BL ==1 
{txt}(205 real changes made)

{com}.         lab def lf 0 "Out of labor force at BL" 1 "In the labor force at BL" 
{txt}
{com}.         lab val LF_BL lf
{txt}
{com}. 
.         
.         lab var LF_BL "In labor force at BL" 
{txt}
{com}.         lab var employed_BL "Employed at BL" 
{txt}
{com}.         lab var BLsearch "Searching for jobs at BL"
{txt}
{com}.         
.         * create opposite var (to match what we have in the paper tables)
.         gen not_in_LF_BL = . 
{txt}(1,062 missing values generated)

{com}.         replace not_in_LF_BL = 1 if employed_BL ==0 & BLsearch==0
{txt}(218 real changes made)

{com}.         replace not_in_LF_BL = 0 if employed_BL ==0 & BLsearch==1
{txt}(594 real changes made)

{com}.         replace not_in_LF_BL = 0 if employed_BL ==1 
{txt}(205 real changes made)

{com}.         lab def notf 0 "In labor force at BL" 1 "Not in the labor force at BL" 
{txt}
{com}.         lab val not_in_LF_BL notlf
{txt}
{com}.         lab var not_in_LF_BL "Out of LF at BL"
{txt}
{com}.         
.         * unemployed
.         gen unemployed_BL = .
{txt}(1,062 missing values generated)

{com}.         replace unemployed_BL = 0 if employed_BL ==0 & BLsearch==0
{txt}(218 real changes made)

{com}.         replace unemployed_BL = 0 if employed_BL ==1 & BLsearch==0
{txt}(70 real changes made)

{com}.         replace unemployed_BL = 0 if employed_BL ==1 & BLsearch==1
{txt}(128 real changes made)

{com}.         replace unemployed_BL = 1 if employed_BL ==0 & BLsearch==1
{txt}(594 real changes made)

{com}.         lab var unemployed_BL "Unemployed (searching for job) at BL"
{txt}
{com}.         
.         * on-the-job search at BL
.         gen on_job_search_BL = .
{txt}(1,062 missing values generated)

{com}.         replace on_job_search_BL = 0 if employed_BL ==0
{txt}(857 real changes made)

{com}.         replace on_job_search_BL = 0 if employed_BL ==1 & BLsearch==0
{txt}(70 real changes made)

{com}.         replace on_job_search_BL = 1 if employed_BL ==1 & BLsearch==1
{txt}(128 real changes made)

{com}.         lab var on_job_search_BL "On-the-job search at BL"
{txt}
{com}.         
.         * Re-create household size
.         rename كمعددالأشخاصفيأسرتكالقاطن hh_les18
{res}{txt}
{com}.         rename AL hh_more18
{res}{txt}
{com}.          
.         replace hh_les18="1" if hh_les18== "1`"
{txt}(1 real change made)

{com}.         destring hh_les18, replace
{txt}hh_les18: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(79 missing values generated)
{res}{txt}
{com}.         lab var hh_les18 "Number of HH members <18 (un-winsorized)"
{txt}
{com}. 
.         replace hh_more18="1" if hh_more18=="1بنت"
{txt}(1 real change made)

{com}.         destring hh_more18, replace
{txt}hh_more18: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(87 missing values generated)
{res}{txt}
{com}.         replace hh_more18=0 if hh_more18==. & hh_les18!=.
{txt}(15 real changes made)

{com}.         replace hh_more18 = hh_more18 + 1 if hh_more18!=.
{txt}(990 real changes made)

{com}.         lab var hh_more18 "Number of HH members 18+ (un-winsorized)"
{txt}
{com}. 
.         
.         * assumption 1: if hh_more18 is missing but hh_les18 is not missing, then
.         * assume respondent meant to put '0' (which becomes 1 to include themselves)
.         * assumption 2: if hh_les18 is missing but hh_more18 is not missing, then
.         * assume respondent meant to put '0'
.         replace hh_more18=1 if hh_more18==. & hh_les18!=.
{txt}(0 real changes made)

{com}.         replace hh_les18=0 if hh_les18==. & hh_more18!=.
{txt}(7 real changes made)

{com}.         
.         * move Excluded values to missing to avoid affecting the winsorizing step
.         replace hh_more18 = . if Excluded==1
{txt}(403 real changes made, 403 to missing)

{com}.         replace hh_les18 = . if Excluded==1
{txt}(403 real changes made, 403 to missing)

{com}.         
.         * winsorize
.         winsor2 hh_more18, cuts(0 95)
{txt}
{com}.         lab var hh_more18_w "Number of HH members age 18+ (right tail winsor)" 
{txt}
{com}.         
.         winsor2 hh_les18, cuts(0 95)
{txt}
{com}.         lab var hh_les18_w "Number of HH members age <18 (right tail winsor)" 
{txt}
{com}.         
.         gen household_size = hh_les18_w + hh_more18_w
{txt}(475 missing values generated)

{com}.         lab var household_size "Household size" 
{txt}
{com}.         
.         * Ratio of children to adults in the household
.         gen hh_kid_adu_ratio = hh_les18_w/hh_more18_w
{txt}(475 missing values generated)

{com}.         lab var hh_kid_adu_ratio "Ratio of children to adults in household"
{txt}
{com}.         
.                 * now cut this at the median
.                 xtile hh_kid_adult_abovemed = hh_kid_adu_ratio, nq(2)
{txt}
{com}.                 recode hh_kid_adult_abovemed (1 = 0) (2 = 1)
{txt}(587 changes made to {bf:hh_kid_adult_abovemed})

{com}.                 lab var hh_kid_adult_abovemed "Ratio of children to adults in HH, split at median"
{txt}
{com}.                 
.         * One child and multiple children
.                 gen one_child = 0 if hh_les18_w!=.
{txt}(475 missing values generated)

{com}.                 replace one_child = 1 if hh_les18_w==1
{txt}(87 real changes made)

{com}.                 lab var one_child "One child in the household"
{txt}
{com}.                 
.                 gen mult_children = 0 if hh_les18_w!=.
{txt}(475 missing values generated)

{com}.                 replace mult_children = 1 if hh_les18_w>1 & hh_les18_w!=.
{txt}(391 real changes made)

{com}.                 lab var mult_children "Multiple children in the household"
{txt}
{com}.         
.         * marital status 
.         gen marital_admin_eng = ""
{txt}(1,062 missing values generated)

{com}.         replace marital_admin_eng = "Divorced/seperated" if marital_admin == "مطلقة " | ///
>                 marital_admin == "مطلقة" |marital_admin == "أسرة سجين"| ///
>                 marital_admin == "مهجورة" | marital_admin == "مهجوره "
{txt}variable {bf}{res}marital_admin_eng{sf}{txt} was {bf}{res}str1{sf}{txt} now {bf}{res}str18{sf}
{txt}(243 real changes made)

{com}.         replace marital_admin_eng = "Married" if marital_admin == "متزوجه" | ///
>                 marital_admin == "متزوجة" | marital_admin == "متزوجة (سجين)" | ///
>                 marital_admin == "الارمله متزوجة وتسكن مع الزوج والابناء "                                                     
{txt}(162 real changes made)

{com}.         replace marital_admin_eng = "Never-married" if marital_admin == "عزباء"
{txt}(246 real changes made)

{com}.         replace marital_admin_eng = "Widowed" if marital_admin == "أرملة" | ///
>                 marital_admin == "أرملة " | marital_admin == "ارملة" | marital_admin ///
>                 == "ارملة وتسكن مع الأبناء"
{txt}(17 real changes made)

{com}.         lab var marital_admin_eng "Marital status pulled from admin data"
{txt}
{com}.         
.         gen marital_survey_BL = ""
{txt}(1,062 missing values generated)

{com}.         replace marital_survey_BL = "Divorced/seperated" if maritalstatus3 == "مطلقة"
{txt}variable {bf}{res}marital_survey_BL{sf}{txt} was {bf}{res}str1{sf}{txt} now {bf}{res}str18{sf}
{txt}(145 real changes made)

{com}.         replace marital_survey_BL = "Married"  if maritalstatus3 == "متزوجة"
{txt}(54 real changes made)

{com}.         replace marital_survey_BL = "Never-married"   if maritalstatus3 == "عزباء"
{txt}(131 real changes made)

{com}.         replace marital_survey_BL = "Prefer not to answer"  if ///
>                 maritalstatus3 == "أفضل عدم الإجابة على هذا السؤال"
{txt}variable {bf}{res}marital_survey_BL{sf}{txt} was {bf}{res}str18{sf}{txt} now {bf}{res}str20{sf}
{txt}(5 real changes made)

{com}.         replace marital_survey_BL = "Widowed" if maritalstatus3 == "أرملة"
{txt}(66 real changes made)

{com}.         lab var marital_survey_BL "Marital status BL"
{txt}
{com}.         
.         gen relationship_status_BL = marital_survey_BL
{txt}(661 missing values generated)

{com}.         replace relationship_status_BL = marital_admin_eng if marital_survey_BL==""
{txt}(530 real changes made)

{com}.         replace relationship_status_BL= "" if relationship_status_BL=="Prefer not to answer"
{txt}(5 real changes made)

{com}.         lab var relationship_status_BL "Relationship status at BL"
{txt}
{com}.         
.         encode relationship_status_BL, gen(rel_status_BL)
{txt}
{com}.         lab def relstatus 1 "Divorced/seperated" 2 "Married" 3 "Never-married" 4 "Widowed"
{txt}
{com}.         lab val rel_status_BL relstatus
{txt}
{com}.         lab var rel_status_BL "Relationship status at BL, numeric"
{txt}
{com}.         
.         * widowed, divorced/separated, never-married, and married dummies
.         gen widowed = 1 if relationship_status_BL=="Widowed"
{txt}(980 missing values generated)

{com}.         replace widowed = 0 if inlist(relationship_status_BL, "Divorced/seperated", ///
>                 "Married", "Never-married")
{txt}(844 real changes made)

{com}.         lab var widowed "Widowed"
{txt}
{com}.         
.         gen divorced_separated = 1 if relationship_status_BL=="Divorced/seperated"
{txt}(741 missing values generated)

{com}.         replace divorced_separated = 0 if ///
>                 inlist(relationship_status_BL, "Widowed", "Married", "Never-married")
{txt}(605 real changes made)

{com}.         lab var divorced_separated "Divorced or separated"
{txt}
{com}.         
.         gen single = 1 if relationship_status_BL=="Never-married"
{txt}(706 missing values generated)

{com}.         replace single = 0 if ///
>                 inlist(relationship_status_BL, "Widowed", "Married", "Divorced/seperated")
{txt}(570 real changes made)

{com}.         lab var single "Never-married"
{txt}
{com}.         
.         * fix to married var (BL version seems to be created incorrectly)
.         rename married married_old
{res}{txt}
{com}.         label var married_old "Orig version w/ mistake"
{txt}
{com}.         
.         gen married = 1 if relationship_status_BL=="Married"
{txt}(895 missing values generated)

{com}.         replace married = 0 if inlist(relationship_status_BL, "Divorced/seperated", ///
>                 "Widowed", "Never-married")
{txt}(759 real changes made)

{com}.         lab var married "Married"
{txt}
{com}.         
.         * dummy for husband influence (to use in HTE models)
.         gen husb_influence = 0 if relationship_status_BL!=""
{txt}(136 missing values generated)

{com}.         replace husb_influence = 1 if inlist(relationship_status_BL, "Divorced/seperated", ///
>                 "Married")
{txt}(488 real changes made)

{com}.         lab var husb_influence "Husband influence - married or divorced/separated"
{txt}
{com}.         
.         /* version of husband/co-parent that is 1 if married or divorced/separated 
>            with at least one kid under 18 in the HH (original coding of this variable)
>         */
.         gen husb_influence_kids_original = 0 if relationship_status_BL!="" & hh_les18_w!=. 
{txt}(478 missing values generated)

{com}.         replace husb_influence_kids_original = 1 if relationship_status_BL=="Married"
{txt}(167 real changes made)

{com}.         replace husb_influence_kids_original = 1 if relationship_status_BL=="Divorced/seperated" ///
>         & hh_les18_w>0 & hh_les18_w!=.
{txt}(170 real changes made)

{com}.         lab var husb_influence_kids_original ///
>         "Husband influence - married or divorced/separated with 1+ kids in HH; Original var"
{txt}note: label truncated to 80 characters

{com}.         lab def husb_infl_kids 0 "No husband/co-parent" 1 "Has husband/co-parent"
{txt}
{com}.         lab val husb_influence_kids_original husb_infl_kids
{txt}
{com}.         
.         /* NOTE: we found a mistake in the code where single and widowed women who are
>         missing a value for number of HH members under 18 have a missing value for 
>         "has husband/co-parent" (ie husb_infl_kids). This mistake carried into our 
>         original AER submission. These observations should have a value of 0 for this
>         variable. We are preserving the original version of the variable as 
>         husb_infl_kids_original and will update the variable to correct for this mistake.
>         Most divorced/separated women have children, we are making the assumption that
>         women who are divorced/separated and missing values for number of children in
>         the household do have children as most do
>         */
.         
.         gen husb_influence_kids = 0 if relationship_status_BL!="" & hh_les18_w!=.
{txt}(478 missing values generated)

{com}.         replace husb_influence_kids = 1 if relationship_status_BL=="Married"
{txt}(167 real changes made)

{com}.         replace husb_influence_kids = 1 if relationship_status_BL=="Divorced/seperated" ///
>         & hh_les18_w>0 & hh_les18_w!=.
{txt}(170 real changes made)

{com}.         replace husb_influence_kids = 0 if inlist(relationship_status_BL, "Never-married", ///
>         "Widowed") & hh_les18_w==.
{txt}(166 real changes made)

{com}.         replace husb_influence_kids = 1 if relationship_status_BL=="Divorced/seperated" & hh_les18_w==.
{txt}(126 real changes made)

{com}.         lab var husb_influence_kids "Husband influence - married or divorced/separated with 1+ kids in HH"
{txt}
{com}.         lab val husb_influence_kids husb_infl_kids
{txt}
{com}.         
. 
.         
.         /*      version of husband influence (with kids) where we assume if hh_les18_w is
>                 missing, that they don't have kids [this is for a robustness check]
>         */
.         gen husb_influence_kids_alt = 0 if relationship_status_BL!="" 
{txt}(136 missing values generated)

{com}.         replace husb_influence_kids_alt = 1 if relationship_status_BL=="Married"
{txt}(167 real changes made)

{com}.         replace husb_influence_kids_alt = 1 if relationship_status_BL=="Divorced/seperated" ///
>         & hh_les18_w>0 & hh_les18_w!=.
{txt}(170 real changes made)

{com}.         lab var husb_influence_kids_alt "Husband influence - married or divorced/separated with 1+ kids in HH, missing kids = no kids"
{txt}note: label truncated to 80 characters

{com}.         
.         /*      version of rel_status_BL to use in HTE by marital status, but create 
>                 categories for:
>                 - divorced/separated with kids
>                 - married
>                 - single
>                 - widowed + divorced/separated no kids
>         */
.         
.         gen hte_rel_status = 1 if rel_status_BL==1 & hh_les18_w>0 & hh_les18_w!=.
{txt}(892 missing values generated)

{com}.         replace hte_rel_status = 2 if rel_status_BL==2 
{txt}(167 real changes made)

{com}.         replace hte_rel_status = 3 if rel_status_BL==3
{txt}(356 real changes made)

{com}.         replace hte_rel_status = 4 if rel_status_BL==4 | (rel_status_BL==1 & hh_les18_w==0)
{txt}(107 real changes made)

{com}.         * in case there are missing hh_les18_w for married or single women, move to missing
.         replace hte_rel_status = . if hh_les18_w==.
{txt}(216 real changes made, 216 to missing)

{com}.         lab def status 1 "Has co-parent" 2 "Married" 3 "Never-married" 4 "Widowed or has no co-parent"
{txt}
{com}.         lab val hte_rel_status status
{txt}
{com}.         lab var hte_rel_status "Relationship status groups for HTE (BL)"
{txt}
{com}.         
.         /*      Now let's do an alternative version of this hte relationship status var,
>                 similar to what we did with husb_influence_kids_alt where we assume if 
>                 hh_les18_w is missing, that they don't have kids
>         */
.         
.         gen hte_rel_status_alt = 1 if rel_status_BL==1 & hh_les18_w>0 & hh_les18_w!=.
{txt}(892 missing values generated)

{com}.         replace hte_rel_status_alt = 2 if rel_status_BL==2 
{txt}(167 real changes made)

{com}.         replace hte_rel_status_alt = 3 if rel_status_BL==3
{txt}(356 real changes made)

{com}.         replace hte_rel_status_alt = 4 if rel_status_BL==4 
{txt}(82 real changes made)

{com}.         replace hte_rel_status_alt = 4 if rel_status_BL==1 & (hh_les18_w==0 | hh_les18_w==.)
{txt}(151 real changes made)

{com}.         lab val hte_rel_status_alt status
{txt}
{com}.         lab var hte_rel_status_alt "Relationship status groups for HTE, missing kids = no kids (BL)"
{txt}
{com}.         
.         
.                 
.         
.         * worked before 
.         destring Intotalhowmanyyearsdidyou BD, replace
{txt}Intotalhowmanyyearsdidyou: all characters numeric; {res}replaced {txt}as {res}double
{txt}(418 missing values generated)
{res}{txt}BD: all characters numeric; {res}replaced {txt}as {res}int
{txt}(418 missing values generated)
{res}{txt}
{com}.         gen ever_employed_BL = 0 if inlist(Wereyouemployedbefore, "0", "No")
{txt}(798 missing values generated)

{com}.         replace ever_employed_BL = 0 if Whatisyourcurrentmonthlysal=="Never been employed"
{txt}(5 real changes made)

{com}.         replace ever_employed_BL = 0 if employed_BL == 0
{txt}(612 real changes made)

{com}.         replace ever_employed_BL = 1 if inlist(Wereyouemployedbefore, "Yes")
{txt}(155 real changes made)

{com}.         // This should be unconditional, so move currently employed to "yes"
.         replace ever_employed_BL = 1 if employed_BL ==1 
{txt}(140 real changes made)

{com}.         replace ever_employed_BL = 1 if (Intotalhowmanyyearsdidyou>0 & Intotalhowmanyyearsdidyou!=.)
{txt}(46 real changes made)

{com}.         replace ever_employed_BL = 1 if (BD>0 & BD!=.)
{txt}(4 real changes made)

{com}.         lab var ever_employed_BL "Has ever been employed"
{txt}
{com}.         
.         * working experience
.         //NOTES: we don't know which var is public sector and which is private, so add 
.         // and label as private or public
.         gen work_experience_BL = Intotalhowmanyyearsdidyou
{txt}(418 missing values generated)

{com}.         replace work_experience_BL = work_experience_BL + BD
{txt}(40 real changes made)

{com}.         winsor2 work_experience_BL, cuts(0 95)
{txt}
{com}.         rename work_experience_BL work_experience_orig_BL
{res}{txt}
{com}.         lab var work_experience_orig_BL "Work experience with outliers at BL"
{txt}
{com}.         rename work_experience_BL_w work_experience_BL
{res}{txt}
{com}.         // move to 0 if they've never worked before
.         replace work_experience_BL = 0 if inlist(Wereyouemployedbefore, "0", "No")
{txt}(3 real changes made)

{com}.         replace work_experience_BL = 0 if Whatisyourcurrentmonthlysal=="Never been employed"
{txt}(2 real changes made)

{com}.         // let's make an unconditional version
.         lab var work_experience_BL "Number of years worked in private or public sectors"
{txt}
{com}.         // move those who have never been employed to 0
.         replace work_experience_BL = 0 if ever_employed_BL==0                                                                           
{txt}(330 real changes made)

{com}. 
.         
.         // let's make this conditional on ever employed
.         gen work_experience_cond_BL = work_experience_BL
{txt}(88 missing values generated)

{com}.         replace work_experience_cond_BL = . if ever_employed_BL!=1
{txt}(717 real changes made, 717 to missing)

{com}.         lab var work_experience_cond_BL "Number of years worked in private or public sectors $|$ ever employed"
{txt}
{com}.         
. 
.         
.         
.         * monthly salary
.         replace Whatisyourcurrentmonthlysal = "Less than 3000" if ///
>                 Whatisyourcurrentmonthlysal=="أقل من 3000 ريال"
{txt}(66 real changes made)

{com}.         replace Whatisyourcurrentmonthlysal = "I prefer not to answer this question" ///
>                 if Whatisyourcurrentmonthlysal=="أفضل عدم إجابة هذا السؤال"
{txt}(113 real changes made)

{com}.                 
.         gen salary_BL_cat = Whatisyourcurrentmonthlysal
{txt}(418 missing values generated)

{com}.         replace salary_BL_cat = "" if inlist(Whatisyourcurrentmonthlysal, ///
>                 "I prefer not to answer this question", "0")
{txt}(202 real changes made)

{com}.         lab var salary_BL_cat "Baseline monthly salary in ranges (string)"
{txt}
{com}.         
.         replace salary_BL_cat = "3000-4999" if inlist(salary_BL_cat,"3000 -4999", "3000 – 4999", ///
>                 "3000-4999")
{txt}(121 real changes made)

{com}.         replace salary_BL_cat = "5000-6999" if inlist(salary_BL_cat, "5000 -6999", "5000 – 6999", ///
>                 "5000-6999")    
{txt}(13 real changes made)

{com}.          
.         * make conditional monthly salaries     
.         gen salary_less3k_BL = 0 if inlist(salary_BL_cat, "Less than 3000", "3000-4999", ///
>         "5000-6999", "8000-8999") &  ever_employed_BL==1
{txt}(846 missing values generated)

{com}.         replace salary_less3k_BL = 1 if salary_BL_cat=="Less than 3000" & ///
>         ever_employed_BL==1 
{txt}(79 real changes made)

{com}.         lab var salary_less3k_BL "Monthly salary: less than 800 USD"
{txt}
{com}.         gen salary_3kto4999_BL = 0 if inlist(salary_BL_cat, "Less than 3000", "3000-4999", ///
>         "5000-6999", "8000-8999") & ever_employed_BL==1 
{txt}(846 missing values generated)

{com}.         replace salary_3kto4999_BL = 1 if salary_BL_cat =="3000-4999" & ///
>         ever_employed_BL==1 
{txt}(121 real changes made)

{com}.         lab var salary_3kto4999_BL "Monthly salary: 800-1,330 USD"
{txt}
{com}.         gen salary_5kto6999_BL = 0 if inlist(salary_BL_cat, "Less than 3000", "3000-4999", ///
>         "5000-6999", "8000-8999") & ever_employed_BL==1 
{txt}(846 missing values generated)

{com}.         replace salary_5kto6999_BL = 1 if salary_BL_cat =="5000-6999" & ///
>         ever_employed_BL==1 
{txt}(15 real changes made)

{com}.         lab var salary_5kto6999_BL "Monthly salary: 1,330-1,865 USD"
{txt}
{com}.         gen salary_7kto8999_BL = 0 if inlist(salary_BL_cat, "Less than 3000", "3000-4999", ///
>         "5000-6999", "8000-8999") & ever_employed_BL==1 
{txt}(846 missing values generated)

{com}.         replace salary_7kto8999_BL = 1 if salary_BL_cat=="8000-8999" & ///
>         ever_employed_BL==1 
{txt}(1 real change made)

{com}.         lab var salary_7kto8999_BL "Monthly salary: 1,865-2,400 USD"            
{txt}
{com}.         
.         * Now make salary_BL_cat a numeric var
.         rename salary_BL_cat salary_BL_cat_str
{res}{txt}
{com}.         gen salary_BL_cat = 1 if salary_BL_cat_str== "Less than 3000" &  ever_employed_BL==1
{txt}(983 missing values generated)

{com}.         replace salary_BL_cat = 2 if salary_BL_cat_str== "3000-4999" &  ever_employed_BL==1
{txt}(121 real changes made)

{com}.         replace salary_BL_cat = 3 if salary_BL_cat_str== "5000-6999" &  ever_employed_BL==1
{txt}(15 real changes made)

{com}.         replace salary_BL_cat = 4 if salary_BL_cat_str== "8000-8999" &  ever_employed_BL==1
{txt}(1 real change made)

{com}.         lab def salary 1 "Less than SAR 3000" 2 "SAR 3000-4999" 3 "SAR 5000-6999" ///
>         4 "SAR 8000-8999"
{txt}
{com}.         lab val salary_BL_cat salary
{txt}
{com}.         lab var salary_BL_cat "Baseline monthly salary in ranges"
{txt}
{com}.         
.         
.         * would register for training if it were less 3000 SAR
.         gen wouldregister_less3000_BL = يقولونأنالتكاليفيمكنأنتصلا 
{txt}(396 missing values generated)

{com}.         replace wouldregister_less3000_BL = "1" if wouldregister_less3000_BL=="نعم" ///
>                 | wouldregister_less3000_BL=="0" | wouldregister_less3000_BL== ///
>                 "أفضل عدم الإجابة على هذا السؤال"
{txt}(559 real changes made)

{com}.         replace wouldregister_less3000_BL = "0" if wouldregister_less3000_BL== "لا"
{txt}(107 real changes made)

{com}.         lab var wouldregister_less3000_BL "Would register for training if it was <3000 SAR"
{txt}
{com}.         destring wouldregister_less3000_BL, replace
{txt}wouldregister_less3000_BL: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(396 missing values generated)
{res}{txt}
{com}.         // NOTES: We made this unconditional - '0's were coded to yes, because they had previously
.         // said they were interested in the training. 
.         
.         * create driving registration interest at BL variable
.         rename drivingschool_register2 drivingschool_register2_BL
{res}{txt}
{com}.         lab var drivingschool_register2_BL "BL interest in registration (before asking about <3000 SAR cost)"
{txt}
{com}.         gen interest_registration = "No" if drivingschool_register2_BL== ///
>         "No, and not planning to"
{txt}(836 missing values generated)

{com}.         replace interest_registration = "No" if wouldregister_less3000_BL==0
{txt}(1 real change made)

{com}.         replace interest_registration = "No, but planning to" if ///
>         drivingschool_register2_BL == "No, but planning to"
{txt}variable {bf}{res}interest_registration{sf}{txt} was {bf}{res}str2{sf}{txt} now {bf}{res}str19{sf}
{txt}(616 real changes made)

{com}.         replace interest_registration = "Yes" if wouldregister_less3000_BL== 1
{txt}(559 real changes made)

{com}.         replace interest_registration = "Yes" if drivingschool_register2_BL == ///
>         "Yes, I registered"
{txt}(41 real changes made)

{com}.         lab var interest_registration "BL interest in registration, including if it cost <3000 SAR"
{txt}
{com}.         
.         * age - 4 groups
.         gen age_4group = 1 if age>=18 & age<25
{txt}(825 missing values generated)

{com}.         replace age_4group = 2 if age>=25 & age<35
{txt}(220 real changes made)

{com}.         replace age_4group = 3 if age>=35 & age<45
{txt}(254 real changes made)

{com}.         replace age_4group = 4 if age>=45 & age!=.
{txt}(193 real changes made)

{com}.         lab var age_4group "Age - 4 categories (18-24, 25-34, 35-44, 45+)"
{txt}
{com}.         
.         
.         
.         * Other labeling fixes
.         * Other labelling
.         lab var randomization_cohort2 "Randomization cohort"
{txt}
{com}.         lab var file_nbr "Household ID"
{txt}
{com}.         lab var participantid "Individual ID"
{txt}
{com}.         lab var group_BL "4 category treatment status"
{txt}
{com}.         lab var driving_T "Driving training"
{txt}
{com}.         lab var wusool_T "Wusool subsidy"
{txt}
{com}.         
.         destring participantid, replace
{txt}participantid already numeric; no {res}replace
{txt}
{com}.         
. * create car ownership variable
.         gen owns_car = 0 if car=="0"
{txt}(635 missing values generated)

{com}.         replace owns_car = 1 if inlist(car, "1", "2", "3", "4", "More than 4")
{txt}(562 real changes made)

{com}.         lab var owns_car "HH owns car"
{txt}
{com}.         
.         gen cars = 0 if car=="0"
{txt}(635 missing values generated)

{com}.         replace cars = 1 if car == "1" 
{txt}(406 real changes made)

{com}.         replace cars = 2 if inlist(car, "2", "3", "4", "More than 4")
{txt}(156 real changes made)

{com}.         lab var cars "Cars in the household"
{txt}
{com}.         lab def c 0 "No cars" 1 "1 car" 2 "2+ cars"
{txt}
{com}.         lab val cars c
{txt}
{com}.         
.                 
.         * dummies for one and 2+ cars
.         gen one_car = 0 if car=="0"
{txt}(635 missing values generated)

{com}.         replace one_car = 0 if inlist(car, "2", "3", "4", "More than 4")
{txt}(156 real changes made)

{com}.         replace one_car = 1 if car=="1"
{txt}(406 real changes made)

{com}.         lab var one_car "Household has 1 car"
{txt}
{com}.         
.         gen mult_cars = 0 if car=="0" | car=="1"
{txt}(229 missing values generated)

{com}.         replace mult_cars = 1 if inlist(car, "2", "3", "4", "More than 4")
{txt}(156 real changes made)

{com}.         lab var mult_cars "Household has 2+ cars"
{txt}
{com}.         
.         * clean up car variable
.         gen cars_num = car
{txt}(52 missing values generated)

{com}.         replace cars_num = "" if car == "I prefer not to answer"
{txt}(21 real changes made)

{com}.         replace cars_num = "5" if car == "More than 4"
{txt}(9 real changes made)

{com}.         destring cars_num, replace
{txt}cars_num: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(73 missing values generated)
{res}{txt}
{com}.         lab def car 0 "No cars" 1 "1" 2 "2" 3 "3" 4 "4" 5 "More than 4 cars"
{txt}
{com}.         lab val cars_num car
{txt}
{com}.         lab var cars_num "Cars in houeshold, numeric"
{txt}
{com}. 
.         * create indicator for being from AlNahda's pool of participants
.         gen AlNahda = 1 if Institution=="Alanahda"
{txt}(269 missing values generated)

{com}.         replace AlNahda = 0 if inlist(Institution,"Insan", "Mawaddah")
{txt}(269 real changes made)

{com}.         lab def alnahda 0 "Other" 1 "Alnahda"
{txt}
{com}.         lab val AlNahda alnahda
{txt}
{com}.         lab var AlNahda "AlNahda beneficiary"
{txt}
{com}.         
.         * Create dummy for whether the respondent was enrolled with someone else in her HH
.         egen num_enrolled_HH = count(participantid) if Excluded==0, by(file_nbr)
{txt}(456 missing values generated)

{com}.         lab var num_enrolled_HH "Number of respondents in household"
{txt}
{com}.         gen HH_enrolled = 0 if num_enrolled_HH == 1 & Excluded==0
{txt}(706 missing values generated)

{com}.         replace HH_enrolled = 1 if num_enrolled_HH >1 & num_enrolled_HH!=. & Excluded==0
{txt}(250 real changes made)

{com}.         lab var HH_enrolled "Multiple household members enrolled together"
{txt}
{com}. 
. 
.         
.         * Let's adjust household size as it conflicts with number of respondents per household
.         // Assumption: If hh_more18_w < num_enrolled_HH, then adjust hh_more18_w so that
.         // hh_more18_w == num_enrolled_HH
.         gen hh_more18_update = 1 if hh_more18_w < num_enrolled_HH & hh_more18_w!=. ///
>                 & num_enrolled_HH!=. & Excluded==0
{txt}(1,034 missing values generated)

{com}.         lab var hh_more18_update "hh_more18 was < number of enrolled in the HH and was updated to reflect that"
{txt}
{com}.         replace hh_more18_w = num_enrolled_HH if hh_more18_w < num_enrolled_HH & hh_more18_w!=. ///
>                 & num_enrolled_HH!=. & Excluded==0
{txt}(28 real changes made)

{com}.                 
.         * now adjust household_size variable to reflect this
.         replace household_size = hh_more18_w + hh_les18_w if hh_more18_update==1 & Excluded==0
{txt}(28 real changes made)

{com}. 
. 
.         * Create dummy for whether respondent is "constrained" by having at least 1 kid in the household
.         gen constrained = 1 if hh_les18_w>0 & hh_les18_w!=.
{txt}(584 missing values generated)

{com}.         replace constrained = 0 if hh_les18_w==0        
{txt}(109 real changes made)

{com}.         lab var constrained "At least one child <18 in household"
{txt}
{com}.         
.         
.         * CREATE NGO INSTITUTION VARIABLE
.         gen NGO = 1 if Institution=="Alanahda"
{txt}(269 missing values generated)

{com}.         replace NGO = 2 if Institution=="Insan"
{txt}(187 real changes made)

{com}.         replace NGO = 3 if Institution=="Mawaddah"
{txt}(82 real changes made)

{com}.         lab var NGO "Beneficiary's NGO"
{txt}
{com}.         
.         
.         /* NOTE: adding HTE variables:
>         
>         Let's create binary versions of selected controls that we want to test HTE for. */      
.         
.         * Age
.         xtile age_med = age, nq(2)      
{txt}
{com}.         recode age_med (1 = 0) (2 = 1)
{txt}(905 changes made to {bf:age_med})

{com}.         lab var age_med "Age - above median"
{txt}
{com}.         
.         * Education - completed highschool or above
.         gen edu_nohs = 0 if inlist(edu_category,1,2)    
{txt}(556 missing values generated)

{com}.         replace edu_nohs = 1 if edu_category==0 
{txt}(289 real changes made)

{com}.         lab var edu_nohs "Less than highschool"
{txt}
{com}.         
.         * Ever married 
.         gen ever_married = 0 if rel_status!=.
{txt}(136 missing values generated)

{com}.         replace ever_married = 1 if inlist(rel_status, 1,2,4)
{txt}(570 real changes made)

{com}.         lab var ever_married "Ever-married"
{txt}
{com}.                 
.         
. * RECREATE STRATA VARIABLES
.         * age
.         gen age_group="Old"
{txt}
{com}.         replace age_group="Young" if inrange(age, 18,24)
{txt}variable {bf}{res}age_group{sf}{txt} was {bf}{res}str3{sf}{txt} now {bf}{res}str5{sf}
{txt}(237 real changes made)

{com}.         replace age_group="Other" if كمعمرك=="أفضل عدم الإجابة على هذا السؤال"
{txt}(2 real changes made)

{com}.         encode age_group, gen (age_group_code)
{txt}
{com}.         drop age_group
{txt}
{com}.         rename age_group_code age_group
{res}{txt}
{com}.         lab var age_group "Strata BL age group"
{txt}
{com}. 
.         * Number of cars
.         gen car_group="Car"
{txt}
{com}.         replace car_group="No car" if car=="0"
{txt}variable {bf}{res}car_group{sf}{txt} was {bf}{res}str3{sf}{txt} now {bf}{res}str6{sf}
{txt}(427 real changes made)

{com}.         replace car_group="Other" if car=="I prefer not to answer"
{txt}(21 real changes made)

{com}.         replace car_group = "" if car==""
{txt}(52 real changes made)

{com}.         encode car_group,gen (car_group_code)
{txt}
{com}.         drop car_group
{txt}
{com}.         rename car_group_code car_group
{res}{txt}
{com}.         lab var car_group "Strata BL car group"
{txt}
{com}.         
.         * Likelihood of driving
.         gen drivingreg_group = 1 if inlist(drivingschool_register2_BL, ///
>         "No, but planning to", "Yes, I registered")
{txt}(350 missing values generated)

{com}.         replace drivingreg_group = 0 if inlist(drivingschool_register2_BL, ///
>         "No, and not planning to", "Prefer not to answer")
{txt}(298 real changes made)

{com}.         lab var drivingreg_group "Strata BL: expressed interest in registering for training"
{txt}
{com}.         
.                 * OLD VERSION OF LIKELIHOOD OF DRIVING VAR
.                 gen OLD_drivingreg_group="No,notplanning"
{txt}
{com}.                 replace OLD_drivingreg_group="No,planning" if drivingschool_register== ///
>                 "لا، لم اسجل لكن أنوي اقيام بذلك"
{txt}(616 real changes made)

{com}.                 replace OLD_drivingreg_group="Other" if drivingschool_register== ///
>                 "أفضل عدم الإجابة على هذا السؤال"
{txt}(28 real changes made)

{com}.                 encode OLD_drivingreg_group,gen(OLD_drivingreg_group_code)
{txt}
{com}.                 drop OLD_drivingreg_group
{txt}
{com}.                 rename OLD_drivingreg_group_code OLD_drivingreg_group
{res}{txt}
{com}.         
.         * create strata
.         egen group_strata = concat(drivingreg_group age_group car_group randomization_cohort2)
{txt}
{com}.         lab var group_strata "Strata groups (recreated)"
{txt}
{com}.         
.         
. * Finally, add "_BL" to end of all relevant vars
.         * some already have '_BL' at the end, let's skip these
.         lookfor _BL

{txt}Variable      Storage   Display    Value
    name         type    format    label      Variable label
{hline}
{p 0 48}{res}{bind:group_BL       }{txt}{bind: str29   }{bind:%29s      }{space 1}{bind:         }{bind:  }{res}{res}4 category treatment status{p_end}
{p 0 48}{bind:employed_BL    }{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Employed at BL{p_end}
{p 0 48}{bind:driving_not_u~L}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Somewhat likely, likely, or likely but not at first to drive when ban lifted{p_end}
{p 0 48}{bind:drivingschool~L}{txt}{bind: str57   }{bind:%57s      }{space 1}{bind:         }{bind:  }{res}{res}BL interest in registration (before asking about <3000 SAR cost){p_end}
{p 0 48}{bind:driving_li~t_BL}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Likert scale of likeliness to drive (w1){p_end}
{p 0 48}{bind:driving_li~y_BL}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Likely to drive when ban is lifted{p_end}
{p 0 48}{bind:LF_status_BL   }{txt}{bind: float   }{bind:%16.0g    }{space 1}{bind:lfstat   }{bind:  }{res}{res}Labor force status at BL{p_end}
{p 0 48}{bind:LF_BL          }{txt}{bind: float   }{bind:%24.0g    }{space 1}{bind:lf       }{bind:  }{res}{res}In labor force at BL{p_end}
{p 0 48}{bind:not_in_LF_BL   }{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:notlf    }{bind:  }{res}{res}Out of LF at BL{p_end}
{p 0 48}{bind:unemployed_BL  }{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Unemployed (searching for job) at BL{p_end}
{p 0 48}{bind:on_job_search~L}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}On-the-job search at BL{p_end}
{p 0 48}{bind:marital_surve~L}{txt}{bind: str20   }{bind:%20s      }{space 1}{bind:         }{bind:  }{res}{res}Marital status BL{p_end}
{p 0 48}{bind:relationship_~L}{txt}{bind: str20   }{bind:%20s      }{space 1}{bind:         }{bind:  }{res}{res}Relationship status at BL{p_end}
{p 0 48}{bind:rel_status_BL  }{txt}{bind: long    }{bind:%18.0g    }{space 1}{txt}relstatus{p_end}
{p 0 48}{space 44}{bind:  }{res}{res}Relationship status at BL, numeric{p_end}
{p 0 48}{bind:ever_employed~L}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Has ever been employed{p_end}
{p 0 48}{bind:work_exper~g_BL}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Work experience with outliers at BL{p_end}
{p 0 48}{bind:work_exper~e_BL}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Number of years worked in private or public sectors{p_end}
{p 0 48}{bind:work_exper~d_BL}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Number of years worked in private or public sectors $|$ ever employed{p_end}
{p 0 48}{bind:salary_BL_cat~r}{txt}{bind: str36   }{bind:%36s      }{space 1}{bind:         }{bind:  }{res}{res}Baseline monthly salary in ranges (string){p_end}
{p 0 48}{bind:salary_less3k~L}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Monthly salary: less than 800 USD{p_end}
{p 0 48}{bind:salary_3kto49~L}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Monthly salary: 800-1,330 USD{p_end}
{p 0 48}{bind:salary_5kto69~L}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Monthly salary: 1,330-1,865 USD{p_end}
{p 0 48}{bind:salary_7kto89~L}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Monthly salary: 1,865-2,400 USD{p_end}
{p 0 48}{bind:salary_BL_cat  }{txt}{bind: float   }{bind:%18.0g    }{space 1}{bind:salary   }{bind:  }{res}{res}Baseline monthly salary in ranges{p_end}
{p 0 48}{bind:wouldregister~L}{txt}{bind: byte    }{bind:%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Would register for training if it was <3000 SAR{p_end}
{txt}
{com}.         local suffix_vars `r(varlist)'
{txt}
{com}.         * and some we don't want to include
.         local   skip_vars Institution file_nbr participantid randomization_cohort ///
>                         randomization_cohort2 NGO num_enrolled_HH group_strata Randomization ///
>                         driving_ct wusool_ct national_id hh_les18 hh_les18_w hh_more18 hh_more18_w driving_ct2 ///
>                         wusool_ct2 driving_T wusool_T driving_ctoriginal wusool_ctoriginal ///
>                         Excluded Exclusion household_size HH_enrolled married single widowed ///
>                         divorced_separated hte_rel_status hte_rel_status_alt husb_influence ///
>                         husb_influence_kids husb_influence_kids_alt cars one_car mult_cars car ///
>                         car2 icar cars_num BLsearch
{txt}
{com}.                         
.         ds _all
{txt}{col 1}Institution{col 26}Uber_invite{col 51}d~_likely_BL
{col 1}file_nbr{col 26}uberinvite~e{col 51}edu_category
{col 1}participan~d{col 26}Areyouatal~e{col 51}less_than_~y
{col 1}HH_size2{col 26}Doyouthink~o{col 51}elementary
{col 1}randomizat~t{col 26}Wusool_inf~n{col 51}highschool
{col 1}randomizat~2{col 26}wusoolinfo~e{col 51}any_tertia~u
{col 1}HH_size{col 26}Haveyouhea~a{col 51}LF_status_BL
{col 1}min_cohort{col 26}Doyouknowt~g{col 51}LF_BL
{col 1}late_joiner{col 26}BR{col 51}not_in_LF_BL
{col 1}cohort_aln~a{col 26}May23_rein~s{col 51}unemployed~L
{col 1}old_id{col 26}call_date_~e{col 51}on_job_sea~L
{col 1}Admininfor~n{col 26}call_answe~e{col 51}hh_more18_w
{col 1}birthdate{col 26}BV{col 51}hh_les18_w
{col 1}birthyear{col 26}BW{col 51}household_~e
{col 1}source{col 26}August1inv~s{col 51}hh_kid_adu~o
{col 1}age{col 26}BY{col 51}hh_kid_adu~d
{col 1}L{col 26}BZ{col 51}one_child
{col 1}correctage~s{col 26}CA{col 51}mult_child~n
{col 1}Education{col 26}CB{col 51}marital_ad~g
{col 1}Employed_a~n{col 26}UberSchedu~s{col 51}marital_su~L
{col 1}marital_ad~n{col 26}invited_ev~e{col 51}relationsh~L
{col 1}Suspended_~n{col 26}attended_e~e{col 51}rel_status~L
{col 1}Neighborho~n{col 26}signed_agr~t{col 51}widowed
{col 1}category_i~n{col 26}Notes{col 51}divorced_s~d
{col 1}haskids_ad~n{col 26}raw_order{col 51}single
{col 1}mobile_admin{col 26}driving_ct2{col 51}married
{col 1}national_id{col 26}signed{col 51}husb_influ~e
{col 1}nationalid~e{col 26}wusool_ct2{col 51}husb_influ~l
{col 1}Randomizat~n{col 26}group_BL{col 51}husb_influ~s
{col 1}driving_ct{col 26}driving_T{col 51}husb_influ~t
{col 1}wusool_ct{col 26}wusool_T{col 51}hte_rel_st~s
{col 1}Baseline{col 26}dup_file{col 51}hte_rel_st~t
{col 1}RecordedDate{col 26}Suspended{col 51}ever_emplo~L
{col 1}BaselineDate{col 26}wusool_T_o~d{col 51}work_ex~g_BL
{col 1}ملاحظاتالا~ل{col 26}maritalsta~2{col 51}work_ex~e_BL
{col 1}mobile{col 26}married1{col 51}work_ex~d_BL
{col 1}لقدقرأتالم~ه{col 26}maritalsta~4{col 51}salary_BL_~r
{col 1}كمعمرك{col 26}married2{col 51}salary_les~L
{col 1}maritalsta~3{col 26}married_old{col 51}salary_3kt~L
{col 1}الحيالسكني{col 26}education~el{col 51}salary_5kt~L
{col 1}الحيالسكني~t{col 26}education2{col 51}salary_7kt~L
{col 1}hh_les18{col 26}education_~s{col 51}salary_BL_~t
{col 1}hh_more18{col 26}education_~e{col 51}wouldregis~L
{col 1}car{col 26}education_~a{col 51}interest_r~n
{col 1}هللديكجوال~ي{col 26}education~ol{col 51}age_4group
{col 1}are_you_em~d{col 26}educati~tary{col 51}owns_car
{col 1}drivingsch~r{col 26}educati~mary{col 51}cars
{col 1}هلتعرفينكم~ر{col 26}education_~d{col 51}one_car
{col 1}كمباعتبارك~ص{col 26}no_education{col 51}mult_cars
{col 1}يقولونأنال~ا{col 26}educated{col 51}cars_num
{col 1}Additional~n{col 26}employment1{col 51}AlNahda
{col 1}call_date{col 26}employed_BL{col 51}num_enroll~H
{col 1}call_answe~d{col 26}car2{col 51}HH_enrolled
{col 1}consent{col 26}icar{col 51}hh_more18_~e
{col 1}Wouldyouli~u{col 26}driving_no~L{col 51}constrained
{col 1}AZ{col 26}drivingsch~L{col 51}NGO
{col 1}Whatisyour~n{col 26}reg_dr{col 51}age_med
{col 1}Wereyouemp~e{col 26}dr_Def_No{col 51}edu_nohs
{col 1}Intotalhow~u{col 26}BLsearch{col 51}ever_married
{col 1}BD{col 26}driving_ct~l{col 51}age_group
{col 1}Whatisyour~l{col 26}wusool_cto~l{col 51}car_group
{col 1}Howmuchdod~c{col 26}Excluded{col 51}drivingreg~p
{col 1}BG{col 26}Exclusion{col 51}OLD_drivin~p
{col 1}Doyouhavea~t{col 26}cohort{col 51}group_strata
{col 1}BI{col 26}driving~t_BL

{com}.         local full_list `r(varlist)'
{txt}
{com}. 
.         local missing_BL_suffix: list full_list - suffix_vars 
{txt}
{com}.         local missing_BL_suffix: list missing_BL_suffix - skip_vars
{txt}
{com}. 
. foreach var of local missing_BL_suffix {c -(}
{txt}  2{com}.         rename `var' `var'_BL
{txt}  3{com}. {c )-}
{res}{txt}
{com}.         
. * create final treatment variables (first for tables, second for estimation)
. gen treat = 0 if driving_ct2 == "Control" & wusool_ct2 == "Control"
{txt}(930 missing values generated)

{com}. replace treat = 1 if driving_ct2 == "Treatment" 
{txt}(484 real changes made)

{com}. replace treat = 2 if wusool_ct2 == "Treatment"
{txt}(403 real changes made)

{com}. replace treat = 3 if driving_ct2 == "Treatment" & wusool_ct2 == "Treatment"
{txt}(251 real changes made)

{com}. label define treat 0 "Control" 1 "Driving" 2 "Information" 3 "Both"
{txt}
{com}. label values treat treat
{txt}
{com}. label variable treat "Original treatment status"
{txt}
{com}. 
. gen uber = 1 if treat == 1 | treat == 3 
{txt}(578 missing values generated)

{com}. replace uber = 0 if treat == 2 | treat == 0 & treat !=.
{txt}(284 real changes made)

{com}. label var uber "Free driving training"
{txt}
{com}. 
. gen wusool = 1 if treat == 2 | treat == 3 
{txt}(659 missing values generated)

{com}. replace wusool = 0 if treat == 1 | treat == 0 & treat !=.
{txt}(365 real changes made)

{com}. label var wusool "Commute subsidy information"
{txt}
{com}. 
. * other updates
.         lab def treatments_4 0 "Control" 1 "Driving Treatment Only" 2 ///
>         "Subsidy Info Treatment Only" 3 "Both Treatments"
{txt}
{com}.         lab val treat treatments_4
{txt}
{com}. 
. save "${c -(}data{c )-}/RCT admin and wave 1/Final/Wave1.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT admin and wave 1/Final/Wave1.dta{rm}
saved
{p_end}

{com}. 
{txt}end of do-file

{com}.         do              "$rep_code/cleaning/Wave 2 cleaning.do"
{txt}
{com}. ***** REMEMBER TO RUN SETTINGS.DO FILE FIRST ******
. 
. /******************************************************************************
> 
> Purpose:  Clean Wave 2 Data
>                                            
> Created: June 16, 2020
> *******************************************************************************/
. clear all
{res}{txt}
{com}. set more off
{txt}
{com}. 
. **************************************************************************
. 
. * get order randomizing info
. import excel "${c -(}data{c )-}/RCT wave 2/Raw/block randomizer.xlsx", sheet("Sheet2")  firstrow clear
{res}{text}(5 vars, 1,256 obs)

{com}. drop if _n == 1 
{txt}(1 observation deleted)

{com}. destring FL_17_DO_Wusool FL_17_DO_Driving FL_17_DO_Travel FL_17_DO_Traveldiaryonpaper, replace
{txt}FL_17_DO_Wusool: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(814 missing values generated)
{res}{txt}FL_17_DO_Driving: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(814 missing values generated)
{res}{txt}FL_17_DO_Travel: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(814 missing values generated)
{res}{txt}FL_17_DO_Traveldiaryonpaper: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(814 missing values generated)
{res}{txt}
{com}. rename ResponseId ResponseID
{res}{txt}
{com}. egen blockorder = concat(FL_17_DO_Wusool FL_17_DO_Driving FL_17_DO_Travel FL_17_DO_Traveldiaryonpaper)
{txt}
{com}. replace blockorder = "" if FL_17_DO_Wusool == .
{txt}(814 real changes made)

{com}. destring blockorder, replace
{txt}blockorder: all characters numeric; {res}replaced {txt}as {res}int
{txt}(814 missing values generated)
{res}{txt}
{com}. save "${c -(}data{c )-}/RCT wave 2/Cleaned/blockrandomizer.dta", replace 
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 2/Cleaned/blockrandomizer.dta{rm}
saved
{p_end}

{com}. 
. * bring in raw data
. import excel "${c -(}data{c )-}/RCT wave 2/Raw/Commute Wave 2 round 1-raw-deidentified.xlsx", ///
> sheet("Commute+Endline+Survey_March+16") firstrow clear
{res}{text}(550 vars, 1,253 obs)

{com}. 
. merge 1:1 ResponseID using "${c -(}data{c )-}/RCT wave 2/Cleaned/blockrandomizer.dta"
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}               2
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}               2{txt}  (_merge==2)

{col 5}Matched{col 30}{res}           1,253{txt}  (_merge==3)
{col 5}{hline 41}

{com}. drop _merge 
{txt}
{com}. 
. * note that there are 101 observations with same participantid of 0, and after collapse, 6 have less than 1000 as their participantID, which does not coincide with lists (participantids 0 3 9 22 77 199)
. * these were just test IDs
. drop if participantid < 1000
{txt}(107 observations deleted)

{com}. 
. * keep variable labels before collapse
.   foreach v of var * {c -(}
{txt}  2{com}.         local l`v' : variable label `v'
{txt}  3{com}.         if `"`l`v''"' == "" {c -(}
{txt}  4{com}.                 local l`v' "`v'"
{txt}  5{com}.         {c )-}
{txt}  6{com}.  {c )-}
{txt}
{com}. 
. * collapse data to last non-missing value. Note that progress and finished vars are not necessarily useful indicators, as can be flagged as having 100% progress and finished, but survey not completed (just came to goodtime = no for example)
. sort participantid consent callanswered attemptnb Progress Finished goodtime 
{txt}
{com}. 
. * collapse works well, but keep in mind it takes last one, even if different response for same variable (for example, see participantid 1001 and takejob_15min variable) 
.   
. collapse (lastnm) StartDate EndDate Progress Finished RecordedDate UserLanguage blockorder enumeratorname participantid_ver participantgroup callbackattempts attemptnb callanswered speakingwithres reachresp reachresp_txt reachresp_txt_other goodtime goodtime_txt phonenb_best phonenb_best_txt numberused consent employed work_area work_area_txt residence_city residence_city_txt residence_area residence_area_txt monthlysalary startjob_year startjob_year_txt startjob_month startjob_month_txt attend_careerfair jobhunt_friends jobhunt_jpc jobhunt_inperson jobhunt_calledemplo jobhunt_advert jobhunt_agency jobhunt_other jobhunt_noanswer jobhunt_callended jobhunt_none jobhunt_other_txt jobsappli_lastmnth jobsappli_lastmnth_txt jobinterv_lastmnth jobinterv_lastmnth_txt jobinterv_go jobinterv_go_txt joboffers_lastmnth joboffers_lastmnth_txt joboffer_accept expectedsalary expectedsalary_txt lowestsalary lowestsalary_txt commutecost_freq commutecost_permnth commutecost_perday wusool_consider_onceprivate wusool_consider wusool_whynot wusool_whynot_txt expectcomm_ehai_freq expectcomm_ehai_amount commutemode_expec commutemode_expec_txt takejob_15min takejob_30min takejob_45min alnahda_enuminterv alnahda_enumwork alnahda_whynot alnahda_whynot_txt enum_upcomsession enum_nointeres enum_nointeres_txt anydrivingtraining sauditraining sauditraining_stop sauditraining_stop_txt drivinglicense drivinh_lastmnth driving_times driving_shopperson driving_shophh driving_work driving_uni driving_friends driving_relatives driving_leisure driving_mealout driving_health driving_gov driving_accompany driving_other driving_noanswer driving_callended driving_other_txt driving_likely concer_learnhard concer_affordcar concer_affordmaint concer_carshared concer_society concer_family concer_reputation concer_riskaccident concer_riskwithmen metro_likely metro_notlikely_why metro_notlikely_why_txt trip_yesterday lasttrip_when lasttrip_noacco_when lasttrip_relat_when lasttrip_friend_when tripnb_yesterday trip1 trip1_origin trip1_destin trip1_departime trip1_arrivtime trip1_purpose trip1_purpose_txt trip1_mode trip1_mode_txt trip1_cost trip1_cost_txt trip1_child trip1_adultfam trip1_adultother trip2 trip2_origin trip2_destin trip2_departime trip2_arrivtime trip2_purpose trip2_purpose_txt trip2_mode trip2_mode_txt trip2_cost trip2_cost_txt trip2_child trip2_adultfam trip2_adultother trip3 trip3_origin trip3_destin trip3_departime trip3_arrivtime trip3_purpose trip3_purpose_txt trip3_mode trip3_mode_txt trip3_cost trip3_cost_txt trip3_child trip3_adultfam trip3_adultother trip4 trip4_origin trip4_destin trip4_departime trip4_arrivtime trip4_purpose trip4_purpose_txt trip4_mode trip4_mode_txt trip4_cost trip4_cost_txt trip4_child trip4_adultfam trip4_adultother trip5 trip5_origin trip5_destin trip5_departime trip5_arrivtime trip5_purpose trip5_purpose_txt trip5_mode trip5_mode_txt trip5_cost trip5_cost_txt trip5_child trip5_adultfam trip5_adultother trip6 trip6_origin trip6_destin trip6_departime trip6_arrivtime trip6_purpose trip6_purpose_txt trip6_mode trip6_mode_txt trip6_cost trip6_cost_txt trip6_child trip6_adultfam trip6_adultother trip7 trip7_origin trip7_destin trip7_departime trip7_arrivtime trip7_purpose trip7_purpose_txt trip7_mode trip7_mode_txt trip7_cost trip7_cost_txt trip7_child trip7_adultfam trip7_adultother trip8 trip8_origin trip8_destin trip8_departime trip8_arrivtime trip8_purpose trip8_purpose_txt trip8_mode trip8_mode_txt trip8_cost trip8_cost_txt trip8_child trip8_adultfam trip8_adultother trip9 trip9_origin trip9_destin trip9_departime trip9_arrivtime trip9_purpose trip9_purpose_txt trip9_mode trip9_mode_txt trip9_cost trip9_cost_txt trip9_child trip9_adultfam trip9_adultother trip10 trip10_origin trip10_destin trip10_departime trip10_arrivtime trip10_purpose trip10_purpose_txt trip10_mode trip10_mode_txt trip10_cost trip10_cost_txt trip10_child trip10_adultfam trip10_adultother, by(participantid) 
{res}{txt}
{com}. 
. * reattach labels
.  foreach v of var * {c -(}
{txt}  2{com}.         label var `v' "`l`v''"
{txt}  3{com}.  {c )-}
{txt}
{com}. 
. *** following vars dropped after collapse, as were either unnecessary or not answered (note nothing after Trip 10 in diary)
. * Trip TripOriginorcloselandm TripDestinationorclose StarttimeoftripCurrent ArrivaltimeoftripCurre Purposeoftripenumeratordo JT Travelmodeoftripenumerator JV EstimatedcostoftripCurrentL JX NumberofPeopleAccompanyingy JZ KA KB KC KD KE KF KG KH KI KJ KK KL KM KN KO KP KQ KR KS KT KU KV KW KX KY KZ LA LB LC LD LE LF LG LH LI LJ LK LL LM LN LO LP LQ LR LS LT LU LV LW LX LY LZ MA MB MC MD ME MF MG MH MI MJ MK ML MM MN MO MP MQ MR MS MT MU MV MW MX MY MZ NA NB NC ND NE NF NG NH NI NJ NK NL NM NN NO NP NQ NR NS NT NU NV NW NX NY NZ OA OB OC OD OE OF OG OH OI OJ OK OL OM ON OO OP OQ OR OS OT OU OV OW OX OY OZ PA PB PC PD PE PF PG PH PI PJ PK PL PM PN PO PP PQ PR PS PT PU PV PW PX PY PZ QA QB QC QD QE QF QG QH QI QJ QK QL QM QN QO QP QQ QR QS QT QU QV QW QX QY QZ RA RB RC RD RE RF RG RH RI RJ RK RL RM RN RO RP RQ RR RS RT RU RV RW RX RY RZ SA SB SC SD SE SF SG SH SI SJ SK SL SM SN SO SP SQ SR SS ST SU SV SW SX SY SZ TA TB TC TD TE TF TG TH TI TJ TK TL TM TN TO TP TQ TR TS TT TU TV TW TX TY TZ UA UB UC UD UE UF UG ResponseType IPAddress Durationinseconds RecipientLastName RecipientFirstName RecipientEmail ResponseID ExternalDataReference LocationLatitude LocationLongitude DistributionChannel 
. 
. 
. * Merge in treatment status from wave 1
. save "${c -(}data{c )-}/RCT wave 2/Cleaned/Wave2_raw.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 2/Cleaned/Wave2_raw.dta{rm}
saved
{p_end}

{com}. 
. use "${c -(}data{c )-}/RCT admin and wave 1/Final/Wave1.dta", clear
{txt}
{com}. 
. keep participantid treat
{txt}
{com}. 
. merge 1:1 participantid using "${c -(}data{c )-}/RCT wave 2/Cleaned/Wave2_raw.dta"
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}             462
{txt}{col 9}from master{col 30}{res}             461{txt}  (_merge==1)
{col 9}from using{col 30}{res}               1{txt}  (_merge==2)

{col 5}Matched{col 30}{res}             601{txt}  (_merge==3)
{col 5}{hline 41}

{com}. keep if _merge==3
{txt}(462 observations deleted)

{com}. drop _merge
{txt}
{com}. 
. 
. * extract time of call 
. gen sd = StartDate
{txt}
{com}. gen fullstartdate=clock(sd,"MDYhm#")
{txt}(257 missing values generated)

{com}. format fullstartdate %tc
{txt}
{com}. replace sd = "" if fullstartdate !=.
{txt}(344 real changes made)

{com}. gen time=clock(sd,"DMYhms")
{txt}(344 missing values generated)

{com}. format time %tc
{txt}
{com}. replace fullstartdate = time if fullstartdate == .
{txt}(257 real changes made)

{com}. sctorezone +9, force only(fullstartdate)
The following variable(s) have been shifted:  fullstartdate
- 601 observations shifted forwards by 9 hours.
{txt}
{com}. gen hour = hh(fullstartdate)
{txt}
{com}. gen minute = mm(fullstartdate)
{txt}
{com}. gen mytime=string(hour) + ":" + string(minute)
{txt}
{com}. gen starttime = clock(mytime, "hm")
{txt}
{com}. format starttime %tcHH:MM
{txt}
{com}. drop hour minute mytime time sd
{txt}
{com}. 
. gen timecat = 1 if starttime <= tc(11:00)
{txt}(482 missing values generated)

{com}. replace timecat = 2 if starttime > tc(11:00) & starttime <= tc(13:00)
{txt}(170 real changes made)

{com}. replace timecat = 3 if starttime > tc(13:00) & starttime <= tc(15:00)
{txt}(144 real changes made)

{com}. replace timecat = 4 if starttime > tc(15:00) & starttime <= tc(17:00)
{txt}(119 real changes made)

{com}. replace timecat = 5 if starttime > tc(17:00)
{txt}(49 real changes made)

{com}. label var timecat "Start Time, Categ"
{txt}
{com}. label define timecat 1 "Before 11AM" 2 "11AM-1PM" 3 "1PM-3PM" 4 "3PM-5PM" 5 "After 5PM"
{txt}
{com}. label values timecat timecat
{txt}
{com}. 
. * fix dates
. gen startdate=date(StartDate,"MDY###")
{txt}(257 missing values generated)

{com}. format startdate %td
{txt}
{com}. replace StartDate = "" if startdate !=.
{txt}(344 real changes made)

{com}. gen startdate2=date(StartDate,"DMY###")
{txt}(344 missing values generated)

{com}. format startdate2 %td
{txt}
{com}. replace startdate = startdate2 if startdate == .
{txt}(257 real changes made)

{com}. gen dow = dow(startdate)
{txt}
{com}. label variable dow "Day of Week, 0=Sun"
{txt}
{com}. 
. gen enddate=date(EndDate,"MDY###")
{txt}(257 missing values generated)

{com}. format enddate %td
{txt}
{com}. replace EndDate = "" if enddate !=.
{txt}(344 real changes made)

{com}. gen enddate2=date(EndDate,"DMY###")
{txt}(344 missing values generated)

{com}. format enddate2 %td
{txt}
{com}. replace enddate = enddate2 if enddate == .
{txt}(257 real changes made)

{com}. 
. gen recordeddate=date(RecordedDate,"MDY###")
{txt}(256 missing values generated)

{com}. format recordeddate %td
{txt}
{com}. replace RecordedDate = "" if recordeddate !=.
{txt}(345 real changes made)

{com}. gen recordeddate2=date(RecordedDate,"DMY###")
{txt}(345 missing values generated)

{com}. format recordeddate2 %td
{txt}
{com}. replace recordeddate = recordeddate2 if recordeddate == .
{txt}(256 real changes made)

{com}. 
. drop StartDate EndDate RecordedDate startdate2 enddate2 recordeddate2
{txt}
{com}. 
. ****** create, encode, and recode important variables ******
. label define yesno 0 "No" 1 "Yes"
{txt}
{com}. 
. * create intensity measure dummy (assumption that missing is 3 attempts )
. gen intensive = 0 if callbackattempts == "3 attempts" | callbackattempts == ""
{txt}(295 missing values generated)

{com}. replace intensive = 1 if callbackattempts == "5 attempts"
{txt}(295 real changes made)

{com}. label values intensive yesno
{txt}
{com}. tab callbackattempts intensive

{txt}callbackat {c |}       intensive
    tempts {c |}        No        Yes {c |}     Total
{hline 11}{c +}{hline 22}{c +}{hline 10}
3 attempts {c |}{res}       303          0 {txt}{c |}{res}       303 
{txt}5 attempts {c |}{res}         0        295 {txt}{c |}{res}       295 
{txt}{hline 11}{c +}{hline 22}{c +}{hline 10}
     Total {c |}{res}       303        295 {txt}{c |}{res}       598 
{txt}
{com}. label variable intensive "Intensive Callback"
{txt}
{com}. 
. * treatment variables 
. tab participantgroup

{txt}participant {c |}
      group {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
    Control {c |}{res}        103       17.14       17.14
{txt}  Uber only {c |}{res}        193       32.11       49.25
{txt}Uber-Wusool {c |}{res}        190       31.61       80.87
{txt}Wusool only {c |}{res}        115       19.13      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        601      100.00
{txt}
{com}. encode participantgroup, gen(group)
{txt}
{com}. 
. * answered call and consent variable dummies
. gen finalanswer = (callanswered == "Answered")
{txt}
{com}. label values finalanswer yesno
{txt}
{com}. label var finalanswer "Answered Call"
{txt}
{com}. tab callanswered finalanswer

             {txt}{c |}     Answered Call
callanswered {c |}        No        Yes {c |}     Total
{hline 13}{c +}{hline 22}{c +}{hline 10}
    Answered {c |}{res}         0        477 {txt}{c |}{res}       477 
{txt}Not answered {c |}{res}       124          0 {txt}{c |}{res}       124 
{txt}{hline 13}{c +}{hline 22}{c +}{hline 10}
       Total {c |}{res}       124        477 {txt}{c |}{res}       601 
{txt}
{com}. 
. gen fullconsent = (consent == "Yes")
{txt}
{com}. replace fullconsent = . if consent == "" | consent == "Call ended / connection lost / respondent hung up the phone"
{txt}(138 real changes made, 138 to missing)

{com}. label values fullconsent yesno
{txt}
{com}. tab consent fullconsent

           {txt}{c |}      fullconsent
   consent {c |}        No        Yes {c |}     Total
{hline 11}{c +}{hline 22}{c +}{hline 10}
        No {c |}{res}        29          0 {txt}{c |}{res}        29 
{txt}       Yes {c |}{res}         0        434 {txt}{c |}{res}       434 
{txt}{hline 11}{c +}{hline 22}{c +}{hline 10}
     Total {c |}{res}        29        434 {txt}{c |}{res}       463 
{txt}
{com}. label var fullconsent "Follow Up Consent"
{txt}
{com}. 
. * gen attrition related variables
. gen participate = (consent == "Yes")
{txt}
{com}. label values participate yesno
{txt}
{com}. label var participate "Follow Up Participation"
{txt}
{com}. 
. gen consentall = 0 if finalanswer != .
{txt}
{com}. replace consentall = 1 if fullconsent == 1
{txt}(434 real changes made)

{com}. label var consentall "Consent"
{txt}
{com}. 
. * clean salaries 
. gen salary_monthly = .
{txt}(601 missing values generated)

{com}. replace salary_monthly = 1 if monthlysalary == " Less than 3000"
{txt}(18 real changes made)

{com}. replace salary_monthly = 2 if monthlysalary == " 3000 – 4999"
{txt}(51 real changes made)

{com}. replace salary_monthly = 3 if monthlysalary == " 5000 – 6999"
{txt}(16 real changes made)

{com}. replace salary_monthly = 4 if monthlysalary == " 7000 – 8999"
{txt}(2 real changes made)

{com}. label define salary_monthly 1 "< 3000 SAR" 2 "3000 - 4999 SAR" 3 "5000 - 6999 SAR" 4 "7000 - 8999 SAR" 
{txt}
{com}. label values salary_monthly salary_monthly
{txt}
{com}. tab monthlysalary salary_monthly

                      {txt}{c |}               salary_monthly
        monthlysalary {c |} < 3000 SA  3000 - 49  5000 - 69  7000 - 89 {c |}     Total
{hline 22}{c +}{hline 44}{c +}{hline 10}
        3000 – 4999 {c |}{res}         0         51          0          0 {txt}{c |}{res}        51 
{txt}        5000 – 6999 {c |}{res}         0          0         16          0 {txt}{c |}{res}        16 
{txt}        7000 – 8999 {c |}{res}         0          0          0          2 {txt}{c |}{res}         2 
{txt}     Less than 3000 {c |}{res}        18          0          0          0 {txt}{c |}{res}        18 
{txt}{hline 22}{c +}{hline 44}{c +}{hline 10}
                Total {c |}{res}        18         51         16          2 {txt}{c |}{res}        87 
{txt}
{com}. label var salary_monthly "Monthly Salary, Cate"
{txt}
{com}. 
. ***** First Stage PAP variables *****
. * any drive training dummy
. gen anydrivetraining = 0 if anydrivingtraining == "No"
{txt}(440 missing values generated)

{com}. replace anydrivetraining = 1 if anydrivingtraining == "Yes"
{txt}(257 real changes made)

{com}. label values anydrivetraining yesno
{txt}
{com}. tab anydrivingtraining anydrivetraining

                      {txt}{c |}   anydrivetraining
   anydrivingtraining {c |}        No        Yes {c |}     Total
{hline 22}{c +}{hline 22}{c +}{hline 10}
                   No {c |}{res}       161          0 {txt}{c |}{res}       161 
{txt}                  Yes {c |}{res}         0        257 {txt}{c |}{res}       257 
{txt}{hline 22}{c +}{hline 22}{c +}{hline 10}
                Total {c |}{res}       161        257 {txt}{c |}{res}       418 
{txt}
{com}. label var anydrivetraining "Drive Training, KSA or Other"
{txt}
{com}. 
. label var attemptnb "Attempt Number Answered"
{txt}
{com}. 
. * saudi specific training categorical 
. gen saudidrivetraining = 0 if sauditraining == "Noو Please explain:" | anydrivetraining == 0
{txt}(402 missing values generated)

{com}. replace saudidrivetraining = 1 if sauditraining == "Yes and completed successfully"
{txt}(151 real changes made)

{com}. replace saudidrivetraining = 2 if sauditraining == "Yes but stopped the training for other reasons. Please explain:" | sauditraining == "Yes but failed the practical test" | sauditraining == "Yes but failed the theoretical test"
{txt}(68 real changes made)

{com}. label define saudidrive 0 "No" 1 "Yes" 2 "Yes, but failed or stopped"
{txt}
{com}. label values saudidrivetraining saudidrive
{txt}
{com}. tab sauditraining saudidrivetraining

                      {txt}{c |}        saudidrivetraining
        sauditraining {c |}        No        Yes  Yes, but  {c |}     Total
{hline 22}{c +}{hline 33}{c +}{hline 10}
  Noو Please explain: {c |}{res}        38          0          0 {txt}{c |}{res}        38 
{txt}Yes and completed s.. {c |}{res}         0        151          0 {txt}{c |}{res}       151 
{txt}Yes but failed the .. {c |}{res}         0          0         53 {txt}{c |}{res}        53 
{txt}Yes but failed the .. {c |}{res}         0          0          2 {txt}{c |}{res}         2 
{txt}Yes but stopped the.. {c |}{res}         0          0         13 {txt}{c |}{res}        13 
{txt}{hline 22}{c +}{hline 33}{c +}{hline 10}
                Total {c |}{res}        38        151         68 {txt}{c |}{res}       257 
{txt}
{com}. label var saudidrivetraining "Saudi Drive Training, Cate"
{txt}
{com}. 
. gen saudidrive = 0 if saudidrivetraining == 0 
{txt}(402 missing values generated)

{com}. replace saudidrive = 1 if saudidrivetraining == 1 | saudidrivetraining == 2
{txt}(219 real changes made)

{com}. label values saudidrive yesno
{txt}
{com}. label var saudidrive "Saudi Drive Training"
{txt}
{com}. 
. 
. * driver's license dummy 
. gen license = 0 if drivinglicense == "No" | saudidrive !=.
{txt}(183 missing values generated)

{com}. replace license = 1 if drivinglicense == "Yes"
{txt}(138 real changes made)

{com}. label values license yesno
{txt}
{com}. tab drivinglicense license

{txt}drivinglic {c |}        license
      ense {c |}        No        Yes {c |}     Total
{hline 11}{c +}{hline 22}{c +}{hline 10}
        No {c |}{res}        13          0 {txt}{c |}{res}        13 
{txt}       Yes {c |}{res}         0        138 {txt}{c |}{res}       138 
{txt}{hline 11}{c +}{hline 22}{c +}{hline 10}
     Total {c |}{res}        13        138 {txt}{c |}{res}       151 
{txt}
{com}. label variable license "Driver's License"
{txt}
{com}. 
. * expected cost of e-hailing services 
. label var expectcomm_ehai_freq "Cost of Commute (30 min), freq"
{txt}
{com}. label var expectcomm_ehai_amount "Cost of Commute (30 min), amt"
{txt}
{com}. tab expectcomm_ehai_freq

         {txt}Cost of Commute (30 min), freq {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
Call ended / connection lost / respon.. {c |}{res}          2        0.48        0.48
{txt}                          Cost per trip {c |}{res}        344       82.30       82.78
{txt}                           I don't know {c |}{res}         68       16.27       99.04
{txt}   I prefer not to answer this question {c |}{res}          4        0.96      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}        418      100.00
{txt}
{com}. tab expectcomm_ehai_amount

    {txt}Cost of {c |}
Commute (30 {c |}
  min), amt {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          5 {c |}{res}          3        0.87        0.87
{txt}          6 {c |}{res}          2        0.58        1.45
{txt}          9 {c |}{res}          1        0.29        1.74
{txt}         10 {c |}{res}          7        2.03        3.78
{txt}         12 {c |}{res}          1        0.29        4.07
{txt}         14 {c |}{res}          2        0.58        4.65
{txt}         15 {c |}{res}         20        5.81       10.47
{txt}         16 {c |}{res}          1        0.29       10.76
{txt}         18 {c |}{res}          2        0.58       11.34
{txt}         20 {c |}{res}         26        7.56       18.90
{txt}         22 {c |}{res}          2        0.58       19.48
{txt}         23 {c |}{res}          1        0.29       19.77
{txt}         25 {c |}{res}         38       11.05       30.81
{txt}         26 {c |}{res}          1        0.29       31.10
{txt}         27 {c |}{res}          1        0.29       31.40
{txt}         28 {c |}{res}          1        0.29       31.69
{txt}         30 {c |}{res}         60       17.44       49.13
{txt}         35 {c |}{res}         18        5.23       54.36
{txt}         38 {c |}{res}          1        0.29       54.65
{txt}         39 {c |}{res}          1        0.29       54.94
{txt}         40 {c |}{res}         54       15.70       70.64
{txt}         43 {c |}{res}          1        0.29       70.93
{txt}         44 {c |}{res}          1        0.29       71.22
{txt}         45 {c |}{res}          8        2.33       73.55
{txt}         48 {c |}{res}          1        0.29       73.84
{txt}         50 {c |}{res}         34        9.88       83.72
{txt}         55 {c |}{res}          3        0.87       84.59
{txt}         56 {c |}{res}          1        0.29       84.88
{txt}         59 {c |}{res}          1        0.29       85.17
{txt}         60 {c |}{res}         13        3.78       88.95
{txt}         65 {c |}{res}          2        0.58       89.53
{txt}         67 {c |}{res}          1        0.29       89.83
{txt}         70 {c |}{res}         13        3.78       93.60
{txt}         75 {c |}{res}          2        0.58       94.19
{txt}         78 {c |}{res}          1        0.29       94.48
{txt}         80 {c |}{res}          9        2.62       97.09
{txt}         87 {c |}{res}          1        0.29       97.38
{txt}         95 {c |}{res}          1        0.29       97.67
{txt}        100 {c |}{res}          3        0.87       98.55
{txt}        110 {c |}{res}          1        0.29       98.84
{txt}        200 {c |}{res}          1        0.29       99.13
{txt}        400 {c |}{res}          1        0.29       99.42
{txt}        500 {c |}{res}          2        0.58      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        344      100.00
{txt}
{com}. winsor2 expectcomm_ehai_amount, cuts(0 95) trim
{txt}
{com}. label var expectcomm_ehai_amount_tr "Cost of Commute (30 min), amt tr"
{txt}
{com}. gen expectcommDK = 0 if expectcomm_ehai_amount != .
{txt}(257 missing values generated)

{com}. replace expectcommDK = 1 if expectcomm_ehai_freq == "I don't know"
{txt}(68 real changes made)

{com}. label var expectcommDK "Cost of Commute, DK dummy"
{txt}
{com}. 
. 
. ***** Job Search PAP variables *****
. 
. * employment status dummy 
. gen currentlyemployed = 0 if employed == "No, I am a student and I plan to work after graduation" | employed == "No, I am a student and I’m not looking for a job" | employed == "No, I am not employed and I am looking for a job" | employed == "No, I am not employed and I’m not looking for a job"
{txt}(265 missing values generated)

{com}. replace currentlyemployed = 1 if employed == "Yes, I am employed and open to looking for a different job" | employed == "Yes, I am employed but not looking for a different job"
{txt}(92 real changes made)

{com}. label values currentlyemployed yesno 
{txt}
{com}. tab employed currentlyemployed

                      {txt}{c |}   currentlyemployed
             employed {c |}        No        Yes {c |}     Total
{hline 22}{c +}{hline 22}{c +}{hline 10}
No, I am a student .. {c |}{res}        51          0 {txt}{c |}{res}        51 
{txt}No, I am a student .. {c |}{res}        19          0 {txt}{c |}{res}        19 
{txt}No, I am not employ.. {c |}{res}       201          0 {txt}{c |}{res}       201 
{txt}No, I am not employ.. {c |}{res}        65          0 {txt}{c |}{res}        65 
{txt}Yes, I am employed .. {c |}{res}         0         58 {txt}{c |}{res}        58 
{txt}Yes, I am employed .. {c |}{res}         0         34 {txt}{c |}{res}        34 
{txt}{hline 22}{c +}{hline 22}{c +}{hline 10}
                Total {c |}{res}       336         92 {txt}{c |}{res}       428 
{txt}
{com}. label var currentlyemployed "Currently Employed"
{txt}
{com}. 
. * looking for a job dummy (include last category? future questions in survey as conditional on it )
. gen jobsearch = 0 if currentlyemployed != .
{txt}(173 missing values generated)

{com}. replace jobsearch = 1 if employed == "No, I am not employed and I am looking for a job" | employed == "Yes, I am employed and open to looking for a different job" | employed == "No, I am a student and I plan to work after graduation"
{txt}(310 real changes made)

{com}. label values jobsearch yesno 
{txt}
{com}. tab employed jobsearch

                      {txt}{c |}       jobsearch
             employed {c |}        No        Yes {c |}     Total
{hline 22}{c +}{hline 22}{c +}{hline 10}
No, I am a student .. {c |}{res}         0         51 {txt}{c |}{res}        51 
{txt}No, I am a student .. {c |}{res}        19          0 {txt}{c |}{res}        19 
{txt}No, I am not employ.. {c |}{res}         0        201 {txt}{c |}{res}       201 
{txt}No, I am not employ.. {c |}{res}        65          0 {txt}{c |}{res}        65 
{txt}Yes, I am employed .. {c |}{res}         0         58 {txt}{c |}{res}        58 
{txt}Yes, I am employed .. {c |}{res}        34          0 {txt}{c |}{res}        34 
{txt}{hline 22}{c +}{hline 22}{c +}{hline 10}
                Total {c |}{res}       118        310 {txt}{c |}{res}       428 
{txt}
{com}. label var jobsearch "Searching for Job"
{txt}
{com}. 
. * career fair attendance
. gen careerfair = 0 if currentlyemployed !=.
{txt}(173 missing values generated)

{com}. replace careerfair = . if fullconsent == . | fullconsent == 0 | attend_careerfair == "Call ended / connection lost / respondent hung up the phone"
{txt}(1 real change made, 1 to missing)

{com}. replace  careerfair = 1  if attend_careerfair == "Yes"
{txt}(38 real changes made)

{com}. label values careerfair yesno
{txt}
{com}. tab attend_careerfair careerfair

                      {txt}{c |}      careerfair
    attend_careerfair {c |}        No        Yes {c |}     Total
{hline 22}{c +}{hline 22}{c +}{hline 10}
                   No {c |}{res}       268          0 {txt}{c |}{res}       268 
{txt}                  Yes {c |}{res}         0         38 {txt}{c |}{res}        38 
{txt}{hline 22}{c +}{hline 22}{c +}{hline 10}
                Total {c |}{res}       268         38 {txt}{c |}{res}       306 
{txt}
{com}. label var careerfair "Attend Career Fair"
{txt}
{com}. 
. ** Proportion of possible job search activities the respondent has taken in the last month
. gen jh_friends = 1 if jobhunt_friends == "Asked friends, relatives to help you find a job" 
{txt}(393 missing values generated)

{com}. gen jh_jobcentre = 1 if jobhunt_jpc == "Visited a job centre (JPC) in person" 
{txt}(546 missing values generated)

{com}. gen jh_inperson = 1 if jobhunt_inperson == "Travelled to employers in person to ask about job opportunities or drop off your CV"
{txt}(457 missing values generated)

{com}. gen jh_calledemp = 1 if jobhunt_calledemplo == "Called or emailed employers to ask about job opportunities or send your CV" 
{txt}(465 missing values generated)

{com}. gen  jh_agency = 1 if jobhunt_agency == "Registered with an employment agency or job search service through the internet or on the phone"
{txt}(531 missing values generated)

{com}. gen jh_advert = 1 if jobhunt_advert == "Placed or answered advertisements in the newspaper or online" 
{txt}(501 missing values generated)

{com}. gen jh_other = 1 if jobhunt_other == "Any other step ________________________ (please specify):"
{txt}(589 missing values generated)

{com}. lab var jh_friends "Search activity: Asked friends/relatives to help find job"
{txt}
{com}. lab var jh_jobcentre "Search activity: Visited job center"
{txt}
{com}. lab var jh_inperson "Search activity: travelled to employers in person"
{txt}
{com}. lab var jh_calledemp "Search activity: called or emailed employers"
{txt}
{com}. lab var jh_agency "Search activity: registered with an employment agency"
{txt}
{com}. lab var jh_advert "Search activity: placed/answered adverts"
{txt}
{com}. lab var jh_other "Other"
{txt}
{com}. 
. *** Ignore the other category until discussion/ translation of
. tab jobhunt_other_txt

            {txt}jobhunt_other_txt {c |}      Freq.     Percent        Cum.
{hline 30}{c +}{hline 35}
               التجيل في حافز {c |}{res}          1        8.33        8.33
{txt}                   عن الوتساب {c |}{res}          1        8.33       16.67
{txt}             لا ابحث عن وظيفه {c |}{res}          1        8.33       25.00
{txt}                        لا شي {c |}{res}          1        8.33       33.33
{txt}                         لاشي {c |}{res}          1        8.33       41.67
{txt}             لم تقم بأي إجراء {c |}{res}          2       16.67       58.33
{txt}              لم تقم بأي خطوة {c |}{res}          2       16.67       75.00
{txt}                       ماقدمت {c |}{res}          2       16.67       91.67
{txt}                       ولا شي {c |}{res}          1        8.33      100.00
{txt}{hline 30}{c +}{hline 35}
                        Total {c |}{res}         12      100.00
{txt}
{com}. 
. * create sum and proportion
. egen jobhuntsum = rowtotal(jh_friends jh_jobcentre jh_inperson jh_calledemp jh_agency jh_advert)
{txt}
{com}. replace jobhuntsum = . if currentlyemployed == .
{txt}(173 real changes made, 173 to missing)

{com}. gen jobhuntprop = (jobhuntsum/6)*100
{txt}(173 missing values generated)

{com}. tab jobhuntsum

 {txt}jobhuntsum {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        157       36.68       36.68
{txt}          1 {c |}{res}         65       15.19       51.87
{txt}          2 {c |}{res}         73       17.06       68.93
{txt}          3 {c |}{res}         68       15.89       84.81
{txt}          4 {c |}{res}         33        7.71       92.52
{txt}          5 {c |}{res}         26        6.07       98.60
{txt}          6 {c |}{res}          6        1.40      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        428      100.00
{txt}
{com}. tab jobhuntprop

{txt}jobhuntprop {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        157       36.68       36.68
{txt}   16.66667 {c |}{res}         65       15.19       51.87
{txt}   33.33333 {c |}{res}         73       17.06       68.93
{txt}         50 {c |}{res}         68       15.89       84.81
{txt}   66.66666 {c |}{res}         33        7.71       92.52
{txt}   83.33334 {c |}{res}         26        6.07       98.60
{txt}        100 {c |}{res}          6        1.40      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        428      100.00
{txt}
{com}. label var jobhuntprop "Job Hunt, Percent of Activities"
{txt}
{com}. lab var jobhuntsum "Search activity: sum of activities taken"
{txt}
{com}. 
. * travel to search (correct zero?)
. gen jh_travel = 0 if currentlyemployed !=. 
{txt}(173 missing values generated)

{com}. replace jh_travel = 1 if jh_jobcentre == 1 | jh_inperson == 1 
{txt}(159 real changes made)

{com}. label values jh_travel yesno
{txt}
{com}. tab jh_travel

  {txt}jh_travel {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
         No {c |}{res}        269       62.85       62.85
{txt}        Yes {c |}{res}        159       37.15      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        428      100.00
{txt}
{com}. label var jh_travel "Travel for Job Search"
{txt}
{com}. 
. * expected/ reservation wage
. tab expectedsalary_txt

{txt}expectedsal {c |}
    ary_txt {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
       1200 {c |}{res}          1        0.33        0.33
{txt}       2000 {c |}{res}          4        1.33        1.66
{txt}       2500 {c |}{res}          4        1.33        2.99
{txt}       3000 {c |}{res}         54       17.94       20.93
{txt}       3500 {c |}{res}         19        6.31       27.24
{txt}       4000 {c |}{res}         92       30.56       57.81
{txt}       4500 {c |}{res}         25        8.31       66.11
{txt}       5000 {c |}{res}         55       18.27       84.39
{txt}       5500 {c |}{res}          4        1.33       85.71
{txt}       6000 {c |}{res}         15        4.98       90.70
{txt}       7000 {c |}{res}         15        4.98       95.68
{txt}       8000 {c |}{res}          6        1.99       97.67
{txt}       9000 {c |}{res}          1        0.33       98.01
{txt}      10000 {c |}{res}          5        1.66       99.67
{txt}      15000 {c |}{res}          1        0.33      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        301      100.00
{txt}
{com}. tab lowestsalary_txt

{txt}lowestsalar {c |}
      y_txt {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
       1000 {c |}{res}          3        0.99        0.99
{txt}       1500 {c |}{res}          5        1.65        2.64
{txt}       1800 {c |}{res}          1        0.33        2.97
{txt}       2000 {c |}{res}         25        8.25       11.22
{txt}       2500 {c |}{res}         14        4.62       15.84
{txt}       2800 {c |}{res}          1        0.33       16.17
{txt}       3000 {c |}{res}         90       29.70       45.87
{txt}       3500 {c |}{res}         21        6.93       52.81
{txt}       3600 {c |}{res}          2        0.66       53.47
{txt}       3700 {c |}{res}          4        1.32       54.79
{txt}       4000 {c |}{res}         75       24.75       79.54
{txt}       4300 {c |}{res}          1        0.33       79.87
{txt}       4500 {c |}{res}         14        4.62       84.49
{txt}       5000 {c |}{res}         31       10.23       94.72
{txt}       5500 {c |}{res}          2        0.66       95.38
{txt}       6000 {c |}{res}          6        1.98       97.36
{txt}       7000 {c |}{res}          1        0.33       97.69
{txt}       8000 {c |}{res}          4        1.32       99.01
{txt}       9000 {c |}{res}          1        0.33       99.34
{txt}      10000 {c |}{res}          1        0.33       99.67
{txt}      35000 {c |}{res}          1        0.33      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        303      100.00
{txt}
{com}. replace lowestsalary_txt = 3500 if lowestsalary_txt == 35000
{txt}(1 real change made)

{com}. gen llowestsalary_txt = log(lowestsalary_txt)
{txt}(298 missing values generated)

{com}. gen lexpectedsalary_txt = log(expectedsalary_txt)
{txt}(300 missing values generated)

{com}. label var lowestsalary_txt "Self-Reported Reservation Wage"
{txt}
{com}. label var expectedsalary_txt "Expected Wage"
{txt}
{com}. label var llowestsalary_txt "Log of Self-Reported Reservation Wage"
{txt}
{com}. label var lexpectedsalary_txt "Log of Expected Wage"
{txt}
{com}. 
. * Number of jobs respondent applied to in last month, Interview calls, Interview attendance
. gen jobapplied_lastm = 0 if jobsappli_lastmnth == "None" | jobsappli_lastmnth_txt == 0 | currentlyemployed != .
{txt}(173 missing values generated)

{com}. replace jobapplied_lastm = jobsappli_lastmnth_txt if jobsappli_lastmnth_txt > 0 & jobsappli_lastmnth_txt !=.
{txt}(196 real changes made)

{com}. tab jobsappli_lastmnth

                     {txt}jobsappli_lastmnth {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
Call ended / connection lost / respon.. {c |}{res}          1        0.33        0.33
{txt}   I prefer not to answer this question {c |}{res}          1        0.33        0.65
{txt}                                   None {c |}{res}        108       35.29       35.95
{txt}                         Number of jobs {c |}{res}        196       64.05      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}        306      100.00
{txt}
{com}. tab jobapplied_lastm

{txt}jobapplied_ {c |}
      lastm {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        232       54.21       54.21
{txt}          1 {c |}{res}         27        6.31       60.51
{txt}          2 {c |}{res}         32        7.48       67.99
{txt}          3 {c |}{res}         56       13.08       81.07
{txt}          4 {c |}{res}         26        6.07       87.15
{txt}          5 {c |}{res}         24        5.61       92.76
{txt}          6 {c |}{res}          5        1.17       93.93
{txt}          7 {c |}{res}          6        1.40       95.33
{txt}          8 {c |}{res}          1        0.23       95.56
{txt}         10 {c |}{res}          9        2.10       97.66
{txt}         11 {c |}{res}          2        0.47       98.13
{txt}         13 {c |}{res}          1        0.23       98.36
{txt}         15 {c |}{res}          1        0.23       98.60
{txt}         20 {c |}{res}          3        0.70       99.30
{txt}         25 {c |}{res}          1        0.23       99.53
{txt}         30 {c |}{res}          2        0.47      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        428      100.00
{txt}
{com}. label var jobapplied_lastm "Jobs Applied, Cate"
{txt}
{com}. 
. gen jobintervinv_lastm = 0 if jobinterv_lastmnth_txt == . & jobinterv_lastmnth == "None" | jobapplied_lastm == 0 | jobinterv_lastmnth_txt == 0 | currentlyemployed != .
{txt}(173 missing values generated)

{com}. replace jobintervinv_lastm = jobinterv_lastmnth_txt if jobinterv_lastmnth_txt > 0 & jobinterv_lastmnth_txt !=.
{txt}(80 real changes made)

{com}. tab jobinterv_lastmnth

                  {txt}jobinterv_lastmnth {c |}      Freq.     Percent        Cum.
{hline 37}{c +}{hline 35}
                                None {c |}{res}        223       73.11       73.11
{txt}     Number of interview invitations {c |}{res}         82       26.89      100.00
{txt}{hline 37}{c +}{hline 35}
                               Total {c |}{res}        305      100.00
{txt}
{com}. tab jobintervinv_lastm

{txt}jobintervin {c |}
    v_lastm {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        348       81.31       81.31
{txt}          1 {c |}{res}         42        9.81       91.12
{txt}          2 {c |}{res}         23        5.37       96.50
{txt}          3 {c |}{res}         10        2.34       98.83
{txt}          4 {c |}{res}          4        0.93       99.77
{txt}         10 {c |}{res}          1        0.23      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        428      100.00
{txt}
{com}. label var jobintervinv_lastm "Jobs Interviewed, Cate"
{txt}
{com}. 
. gen jobintervattend_lastm = 0 if jobinterv_go_txt == . & jobinterv_lastmnth == "None" | jobapplied_lastm == 0 | jobinterv_go_txt == 0 | currentlyemployed != .
{txt}(173 missing values generated)

{com}. replace jobintervattend_lastm = jobinterv_go_txt if jobinterv_go_txt > 0 & jobinterv_go_txt !=.
{txt}(71 real changes made)

{com}. tab jobinterv_go_txt

{txt}jobinterv_g {c |}
      o_txt {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}          9       11.25       11.25
{txt}          1 {c |}{res}         43       53.75       65.00
{txt}          2 {c |}{res}         18       22.50       87.50
{txt}          3 {c |}{res}          6        7.50       95.00
{txt}          4 {c |}{res}          3        3.75       98.75
{txt}         10 {c |}{res}          1        1.25      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}         80      100.00
{txt}
{com}. tab jobintervattend_lastm

{txt}jobintervat {c |}
 tend_lastm {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        357       83.41       83.41
{txt}          1 {c |}{res}         43       10.05       93.46
{txt}          2 {c |}{res}         18        4.21       97.66
{txt}          3 {c |}{res}          6        1.40       99.07
{txt}          4 {c |}{res}          3        0.70       99.77
{txt}         10 {c |}{res}          1        0.23      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        428      100.00
{txt}
{com}. label var jobintervattend_lastm "Job Interview Attendance, Cate"
{txt}
{com}. 
. * binary versions
. gen job_applied = (jobapplied_lastm > 0) if jobapplied_lastm !=.
{txt}(173 missing values generated)

{com}. gen job_interview = (jobintervinv_lastm > 0) if jobintervinv_lastm !=.
{txt}(173 missing values generated)

{com}. gen job_interviewattend = (jobintervattend_lastm > 0) if jobintervattend_lastm !=.
{txt}(173 missing values generated)

{com}. label values job_applied job_interview job_interviewattend yesno
{txt}
{com}. label var job_applied "Job Applied"
{txt}
{com}. label var job_interview "Job Interviewed"
{txt}
{com}. label var job_interviewattend "Job Interview Attend"
{txt}
{com}. 
. **** how do we want to code these?
. tab takejob_15min

                       {txt}takejob_15min {c |}      Freq.     Percent        Cum.
{hline 37}{c +}{hline 35}
I prefer not to answer this question {c |}{res}          1        0.33        0.33
{txt}                             Neutral {c |}{res}         24        8.00        8.33
{txt}                  No, definitely not {c |}{res}         40       13.33       21.67
{txt}                    No, probably not {c |}{res}         32       10.67       32.33
{txt}                        Yes probably {c |}{res}         78       26.00       58.33
{txt}                     Yes, definitely {c |}{res}        125       41.67      100.00
{txt}{hline 37}{c +}{hline 35}
                               Total {c |}{res}        300      100.00
{txt}
{com}. tab takejob_30min

                       {txt}takejob_30min {c |}      Freq.     Percent        Cum.
{hline 37}{c +}{hline 35}
I prefer not to answer this question {c |}{res}          1        0.33        0.33
{txt}                             Neutral {c |}{res}         33       11.00       11.33
{txt}                  No, definitely not {c |}{res}        102       34.00       45.33
{txt}                    No, probably not {c |}{res}         45       15.00       60.33
{txt}                        Yes probably {c |}{res}         47       15.67       76.00
{txt}                     Yes, definitely {c |}{res}         72       24.00      100.00
{txt}{hline 37}{c +}{hline 35}
                               Total {c |}{res}        300      100.00
{txt}
{com}. 
. 
. * put no and neutral together
. gen takejob_15mins = 0 if takejob_15min == "No, definitely not" | takejob_15min == "No, probably not" | takejob_15min == "Neutral" | jobsearch == 0
{txt}(387 missing values generated)

{com}. replace takejob_15mins = 1 if takejob_15min == "Yes probably" | takejob_15min == "Yes, definitely"
{txt}(203 real changes made)

{com}. label values takejob_15mins yesno
{txt}
{com}. tab takejob_15min takejob_15mins

                      {txt}{c |}    takejob_15mins
        takejob_15min {c |}        No        Yes {c |}     Total
{hline 22}{c +}{hline 22}{c +}{hline 10}
              Neutral {c |}{res}        24          0 {txt}{c |}{res}        24 
{txt}   No, definitely not {c |}{res}        40          0 {txt}{c |}{res}        40 
{txt}     No, probably not {c |}{res}        32          0 {txt}{c |}{res}        32 
{txt}         Yes probably {c |}{res}         0         78 {txt}{c |}{res}        78 
{txt}      Yes, definitely {c |}{res}         0        125 {txt}{c |}{res}       125 
{txt}{hline 22}{c +}{hline 22}{c +}{hline 10}
                Total {c |}{res}        96        203 {txt}{c |}{res}       299 
{txt}
{com}. 
. gen takejob_30mins = 0 if takejob_30min == "No, definitely not" | takejob_30min == "No, probably not" | takejob_30min == "Neutral" | jobsearch == 0
{txt}(303 missing values generated)

{com}. replace takejob_30mins = 1 if takejob_30min == "Yes probably" | takejob_30min == "Yes, definitely"
{txt}(119 real changes made)

{com}. label values takejob_30mins yesno
{txt}
{com}. tab takejob_30min takejob_30mins

                      {txt}{c |}    takejob_30mins
        takejob_30min {c |}        No        Yes {c |}     Total
{hline 22}{c +}{hline 22}{c +}{hline 10}
              Neutral {c |}{res}        33          0 {txt}{c |}{res}        33 
{txt}   No, definitely not {c |}{res}       102          0 {txt}{c |}{res}       102 
{txt}     No, probably not {c |}{res}        45          0 {txt}{c |}{res}        45 
{txt}         Yes probably {c |}{res}         0         47 {txt}{c |}{res}        47 
{txt}      Yes, definitely {c |}{res}         0         72 {txt}{c |}{res}        72 
{txt}{hline 22}{c +}{hline 22}{c +}{hline 10}
                Total {c |}{res}       180        119 {txt}{c |}{res}       299 
{txt}
{com}. 
. label var takejob_15mins "Take job 15 mins away, 3000 SAR"
{txt}
{com}. label var takejob_30mins "Take job 30 mins away, 3000 SAR"
{txt}
{com}. 
. ***** Mobility PAP variables *****
. 
. *** can they drive without the license? Bc more driving last month than have license...
. * Drove in the last month
. gen drive_lastm = 0 if drivinh_lastmnth == "No" | drivinglicense == "No" | drivinglicense == "Yes"
{txt}(236 missing values generated)

{com}. replace drive_lastm = 1 if drivinh_lastmnth == "Yes" 
{txt}(151 real changes made)

{com}. label values drive_lastm yesno
{txt}
{com}. tab drivinh_lastmnth drive_lastm

                      {txt}{c |}      drive_lastm
     drivinh_lastmnth {c |}        No        Yes {c |}     Total
{hline 22}{c +}{hline 22}{c +}{hline 10}
                   No {c |}{res}       266          0 {txt}{c |}{res}       266 
{txt}                  Yes {c |}{res}         0        151 {txt}{c |}{res}       151 
{txt}{hline 22}{c +}{hline 22}{c +}{hline 10}
                Total {c |}{res}       266        151 {txt}{c |}{res}       417 
{txt}
{com}. label var drive_lastm "Driven in last month"
{txt}
{com}. 
. * Driving frequency: estimated number of trips per month/ week
. gen drive_month = 0 if drive_lastm == 0
{txt}(335 missing values generated)

{com}. replace drive_month = 1 if driving_times == "Less than once a week"
{txt}(23 real changes made)

{com}. replace drive_month = 2 if driving_times == "About once a week"
{txt}(34 real changes made)

{com}. replace drive_month = 3 if driving_times == "A few times a week"
{txt}(69 real changes made)

{com}. replace drive_month = 4 if driving_times == "Almost every day"
{txt}(25 real changes made)

{com}. label define drive_month 0 "Never" 1 "< 4 times per month" 2 "4 times per month" 3 "few times per week" 4 "Almost everyday"
{txt}
{com}. label values drive_month drive_month
{txt}
{com}. tab driving_times drive_month

                      {txt}{c |}                 drive_month
        driving_times {c |} < 4 times  4 times p  few times  Almost ev {c |}     Total
{hline 22}{c +}{hline 44}{c +}{hline 10}
   A few times a week {c |}{res}         0          0         69          0 {txt}{c |}{res}        69 
{txt}    About once a week {c |}{res}         0         34          0          0 {txt}{c |}{res}        34 
{txt}     Almost every day {c |}{res}         0          0          0         25 {txt}{c |}{res}        25 
{txt}Less than once a week {c |}{res}        23          0          0          0 {txt}{c |}{res}        23 
{txt}{hline 22}{c +}{hline 44}{c +}{hline 10}
                Total {c |}{res}        23         34         69         25 {txt}{c |}{res}       151 
{txt}
{com}. label var drive_month "Driving frequency"
{txt}
{com}. 
. * Expected likelihood of driving in the future (what should "zero" be?)
. gen future_drive = 0 if driving_likely == "Not Likely"
{txt}(583 missing values generated)

{com}. replace future_drive = 1 if driving_likely == "Somewhat unlikely"
{txt}(2 real changes made)

{com}. replace future_drive = 2 if driving_likely == "Neutral"
{txt}(15 real changes made)

{com}. replace future_drive = 3 if driving_likely == "Somewhat likely"
{txt}(35 real changes made)

{com}. replace future_drive = 4 if driving_likely == "Likely" | drive_lastm == 1
{txt}(347 real changes made)

{com}. label define future_drive 0 "Not likely" 1 "Somewhat unlikely" 2 "Neutral" 3 "Somewhat likely" 4 "Likely"
{txt}
{com}. label values future_drive future_drive
{txt}
{com}. tab driving_likely future_drive

                      {txt}{c |}                      future_drive
       driving_likely {c |} Not likel  Somewhat     Neutral  Somewhat      Likely {c |}     Total
{hline 22}{c +}{hline 55}{c +}{hline 10}
               Likely {c |}{res}         0          0          0          0        196 {txt}{c |}{res}       196 
{txt}              Neutral {c |}{res}         0          0         15          0          0 {txt}{c |}{res}        15 
{txt}           Not Likely {c |}{res}        18          0          0          0          0 {txt}{c |}{res}        18 
{txt}      Somewhat likely {c |}{res}         0          0          0         35          0 {txt}{c |}{res}        35 
{txt}    Somewhat unlikely {c |}{res}         0          2          0          0          0 {txt}{c |}{res}         2 
{txt}{hline 22}{c +}{hline 55}{c +}{hline 10}
                Total {c |}{res}        18          2         15         35        196 {txt}{c |}{res}       266 
{txt}
{com}. label var future_drive "Expect to Drive, Cate"
{txt}
{com}. 
. sum future_drive if treat == 0, detail

                    {txt}Expect to Drive, Cate
{hline 61}
      Percentiles      Smallest
 1%    {res}        0              0
{txt} 5%    {res}        2              0
{txt}10%    {res}        3              0       {txt}Obs         {res}         69
{txt}25%    {res}        4              2       {txt}Sum of wgt. {res}         69

{txt}50%    {res}        4                      {txt}Mean          {res}  3.57971
                        {txt}Largest       Std. dev.     {res} .9299873
{txt}75%    {res}        4              4
{txt}90%    {res}        4              4       {txt}Variance      {res} .8648764
{txt}95%    {res}        4              4       {txt}Skewness      {res}-2.720696
{txt}99%    {res}        4              4       {txt}Kurtosis      {res} 10.25719
{txt}
{com}. gen future_drive_med = 0 if future_drive !=.
{txt}(184 missing values generated)

{com}. replace future_drive_med = 1 if future_drive == 4 | drive_lastm == 1
{txt}(347 real changes made)

{com}. label values future_drive_med yesno
{txt}
{com}. label var future_drive_med "Expect to Drive"
{txt}
{com}. 
. * Time since most recent trip
. tab lasttrip_when

         {txt}lasttrip_when {c |}      Freq.     Percent        Cum.
{hline 23}{c +}{hline 35}
           A month ago {c |}{res}          5        2.54        2.54
{txt}Less than one week ago {c |}{res}         96       48.73       51.27
{txt} More than a month ago {c |}{res}          2        1.02       52.28
{txt}  More than a week ago {c |}{res}         18        9.14       61.42
{txt}                 NEVER {c |}{res}          1        0.51       61.93
{txt}          One week ago {c |}{res}         41       20.81       82.74
{txt}                 Today {c |}{res}         33       16.75       99.49
{txt}             Yesterday {c |}{res}          1        0.51      100.00
{txt}{hline 23}{c +}{hline 35}
                 Total {c |}{res}        197      100.00
{txt}
{com}. gen recenttrip = 0 if lasttrip_when == "NEVER"
{txt}(600 missing values generated)

{com}. replace recenttrip = 1 if lasttrip_when == "More than a month ago"
{txt}(2 real changes made)

{com}. replace recenttrip = 2 if lasttrip_when == "A month ago"
{txt}(5 real changes made)

{com}. replace recenttrip = 3 if lasttrip_when == "More than a week ago"
{txt}(18 real changes made)

{com}. replace recenttrip = 4 if lasttrip_when == "One week ago"
{txt}(41 real changes made)

{com}. replace recenttrip = 5 if lasttrip_when == "Less than one week ago"
{txt}(96 real changes made)

{com}. replace recenttrip = 6 if lasttrip_when == "Yesterday" | trip_yesterday == "Yes"
{txt}(218 real changes made)

{com}. replace recenttrip = 7 if lasttrip_when == "Today"
{txt}(33 real changes made)

{com}. label define triprecency 0 "Never" 1 "> Month" 2 "One Month" 3 "> Week" 4 "One Week" 5 "< Week" 6 "Yesterday" 7 "Today"
{txt}
{com}. label values recenttrip triprecency
{txt}
{com}. label var recenttrip "Recent Trip, Cate"
{txt}
{com}. 
. * dummy equivalents for regression
. gen recenttripmoreweek = 0 if recenttrip == 4 | recenttrip == 5 | recenttrip == 6 | recenttrip == 7
{txt}(213 missing values generated)

{com}. replace recenttripmoreweek = 1 if recenttrip == 0 | recenttrip == 1 | recenttrip == 2  | recenttrip == 3
{txt}(26 real changes made)

{com}. gen recenttripwithinweek = 0 if recenttrip == 0 | recenttrip == 1 | recenttrip == 2  | recenttrip == 3
{txt}(575 missing values generated)

{com}. replace recenttripwithinweek = 1 if recenttrip == 4 | recenttrip == 5 | recenttrip == 6 | recenttrip == 7
{txt}(388 real changes made)

{com}. gen recenttripyestod = 0 if recenttrip == 0 | recenttrip == 1 | recenttrip == 2  | recenttrip == 3 | recenttrip == 4 | recenttrip == 5
{txt}(438 missing values generated)

{com}. replace recenttripyestod = 1 if recenttrip == 6 | recenttrip == 7
{txt}(251 real changes made)

{com}. label var recenttripmoreweek "Recent Trip, GT Week"
{txt}
{com}. label var recenttripwithinweek "Recent Trip, Last Week"
{txt}
{com}. label var recenttripyestod "Recent Trip, Yest or Today"
{txt}
{com}. 
. * Time since the most recent trip without any family member accompanying
. tab lasttrip_noacco_when

                   {txt}lasttrip_noacco_when {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                            A month ago {c |}{res}         25        6.04        6.04
{txt}Call ended / connection lost / respon.. {c |}{res}          1        0.24        6.28
{txt}                 Less than one week ago {c |}{res}         67       16.18       22.46
{txt}                  More than a month ago {c |}{res}         27        6.52       28.99
{txt}                   More than a week ago {c |}{res}         26        6.28       35.27
{txt}                                  NEVER {c |}{res}        111       26.81       62.08
{txt}                           One week ago {c |}{res}         43       10.39       72.46
{txt}                                  Today {c |}{res}         65       15.70       88.16
{txt}                              Yesterday {c |}{res}         49       11.84      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}        414      100.00
{txt}
{com}. gen recenttrip_nofam = 0 if lasttrip_noacco_when == "NEVER"
{txt}(490 missing values generated)

{com}. replace recenttrip_nofam = 1 if lasttrip_noacco_when == "More than a month ago"
{txt}(27 real changes made)

{com}. replace recenttrip_nofam = 2 if lasttrip_noacco_when == "A month ago"
{txt}(25 real changes made)

{com}. replace recenttrip_nofam = 3 if lasttrip_noacco_when == "More than a week ago"
{txt}(26 real changes made)

{com}. replace recenttrip_nofam = 4 if lasttrip_noacco_when == "One week ago"
{txt}(43 real changes made)

{com}. replace recenttrip_nofam = 5 if lasttrip_noacco_when == "Less than one week ago"
{txt}(67 real changes made)

{com}. replace recenttrip_nofam = 6 if lasttrip_noacco_when == "Yesterday"
{txt}(49 real changes made)

{com}. replace recenttrip_nofam = 7 if lasttrip_noacco_when == "Today"
{txt}(65 real changes made)

{com}. label values recenttrip_nofam triprecency
{txt}
{com}. label var recenttrip_nofam "Recent Trip, No Fam, Cate"
{txt}
{com}. 
. * dummy equivalents for regression
. gen rectripevernofam = 0 if recenttrip_nofam == 0
{txt}(490 missing values generated)

{com}. replace rectripevernofam = 1 if recenttrip_nofam > 0 & recenttrip_nofam !=.
{txt}(302 real changes made)

{com}. gen rectripmoreweeknofam = 0 if recenttrip_nofam == 4 | recenttrip_nofam == 5 | recenttrip_nofam == 6 | recenttrip_nofam == 7
{txt}(377 missing values generated)

{com}. replace rectripmoreweeknofam = 1 if recenttrip_nofam == 0 | recenttrip_nofam == 1 | recenttrip_nofam == 2  | recenttrip_nofam == 3
{txt}(189 real changes made)

{com}. gen rectripwithinweeknofam = 0 if recenttrip_nofam == 0 | recenttrip_nofam == 1 | recenttrip_nofam == 2  | recenttrip_nofam == 3
{txt}(412 missing values generated)

{com}. replace rectripwithinweeknofam = 1 if recenttrip_nofam == 4 | recenttrip_nofam == 5 | recenttrip_nofam == 6 | recenttrip_nofam == 7
{txt}(224 real changes made)

{com}. gen rectripyestodnofam = 0 if recenttrip_nofam == 0 | recenttrip_nofam == 1 | recenttrip_nofam == 2  | recenttrip_nofam == 3 | recenttrip_nofam == 4 | recenttrip_nofam == 5
{txt}(302 missing values generated)

{com}. replace rectripyestodnofam = 1 if recenttrip_nofam == 6 | recenttrip_nofam == 7
{txt}(114 real changes made)

{com}. label var rectripevernofam "Recent Trip, No Fam"
{txt}
{com}. label var rectripmoreweeknofam "Recent Trip, No Fam, GT Week"
{txt}
{com}. label var rectripwithinweeknofam "Recent Trip, No Fam, Last Week"
{txt}
{com}. label var rectripyestodnofam "Recent Trip, No Fam, Yest or Today"
{txt}
{com}. 
. 
. * Time since the most recent trip to visit relatives
. tab lasttrip_relat_when

                    {txt}lasttrip_relat_when {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                            A month ago {c |}{res}         42       10.17       10.17
{txt}   I prefer not to answer this question {c |}{res}          2        0.48       10.65
{txt}                 Less than one week ago {c |}{res}        101       24.46       35.11
{txt}                  More than a month ago {c |}{res}         51       12.35       47.46
{txt}                   More than a week ago {c |}{res}         52       12.59       60.05
{txt}Not applicable - e.g. parents passed .. {c |}{res}         31        7.51       67.55
{txt}                           One week ago {c |}{res}        100       24.21       91.77
{txt}                                  Today {c |}{res}          8        1.94       93.70
{txt}                              Yesterday {c |}{res}         26        6.30      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}        413      100.00
{txt}
{com}. gen recenttrip_relat = 0 if lasttrip_relat_when == "Not applicable - e.g. parents passed away"
{txt}(570 missing values generated)

{com}. replace recenttrip_relat = 1 if lasttrip_relat_when == "More than a month ago"
{txt}(51 real changes made)

{com}. replace recenttrip_relat = 2 if lasttrip_relat_when == "A month ago"
{txt}(42 real changes made)

{com}. replace recenttrip_relat = 3 if lasttrip_relat_when == "More than a week ago"
{txt}(52 real changes made)

{com}. replace recenttrip_relat = 4 if lasttrip_relat_when == "One week ago"
{txt}(100 real changes made)

{com}. replace recenttrip_relat = 5 if lasttrip_relat_when == "Less than one week ago"
{txt}(101 real changes made)

{com}. replace recenttrip_relat = 6 if lasttrip_relat_when == "Yesterday"
{txt}(26 real changes made)

{com}. replace recenttrip_relat = 7 if lasttrip_relat_when == "Today"
{txt}(8 real changes made)

{com}. label define triprecencyf 0 "NA" 1 "> Month" 2 "One Month" 3 "> Week" 4 "One Week" 5 "< Week" 6 "Yesterday" 7 "Today"
{txt}
{com}. label values recenttrip_relat triprecencyf
{txt}
{com}. label var recenttrip_relat "Recent Trip to Relatives, Cate"
{txt}
{com}. 
. * dummy equivalents for regression
. * treating NA as .
. gen rectripmoreweekrelat = 0 if recenttrip_relat == 4 | recenttrip_relat == 5 | recenttrip_relat == 6 | recenttrip_relat == 7
{txt}(366 missing values generated)

{com}. replace rectripmoreweekrelat = 1 if recenttrip_relat == 1 | recenttrip_relat == 2  | recenttrip_relat == 3
{txt}(145 real changes made)

{com}. gen rectripwithinweekrelat = 0 if recenttrip_relat == 1 | recenttrip_relat == 2  | recenttrip_relat == 3
{txt}(456 missing values generated)

{com}. replace rectripwithinweekrelat = 1 if recenttrip_relat == 4 | recenttrip_relat == 5 | recenttrip_relat == 6 | recenttrip_relat == 7
{txt}(235 real changes made)

{com}. gen rectripyestodrelat = 0 if recenttrip_relat == 1 | recenttrip_relat == 2  | recenttrip_relat == 3 | recenttrip_relat == 4 | recenttrip_relat == 5
{txt}(255 missing values generated)

{com}. replace rectripyestodrelat = 1 if recenttrip_relat == 6 | recenttrip_relat == 7
{txt}(34 real changes made)

{com}. label var rectripmoreweekrelat "Recent Trip to Relatives, GT Week"
{txt}
{com}. label var rectripwithinweekrelat "Recent Trip to Relatives, Last Week"
{txt}
{com}. label var rectripyestodrelat "Recent Trip to Relatives, Yest or Today"
{txt}
{com}. 
. * Time since the most recent trip to visit friends
. tab lasttrip_friend_when

                {txt}lasttrip_friend_when {c |}      Freq.     Percent        Cum.
{hline 37}{c +}{hline 35}
                         A month ago {c |}{res}         34        8.23        8.23
{txt}I prefer not to answer this question {c |}{res}          2        0.48        8.72
{txt}              Less than one week ago {c |}{res}         46       11.14       19.85
{txt}               More than a month ago {c |}{res}        108       26.15       46.00
{txt}                More than a week ago {c |}{res}         47       11.38       57.38
{txt}                               NEVER {c |}{res}        105       25.42       82.81
{txt}                        One week ago {c |}{res}         40        9.69       92.49
{txt}                               Today {c |}{res}         17        4.12       96.61
{txt}                           Yesterday {c |}{res}         14        3.39      100.00
{txt}{hline 37}{c +}{hline 35}
                               Total {c |}{res}        413      100.00
{txt}
{com}. gen recenttrip_fd = 0 if lasttrip_friend_when == "NEVER"
{txt}(496 missing values generated)

{com}. replace recenttrip_fd = 1 if lasttrip_friend_when == "More than a month ago"
{txt}(108 real changes made)

{com}. replace recenttrip_fd = 2 if lasttrip_friend_when == "A month ago"
{txt}(34 real changes made)

{com}. replace recenttrip_fd = 3 if lasttrip_friend_when == "More than a week ago"
{txt}(47 real changes made)

{com}. replace recenttrip_fd = 4 if lasttrip_friend_when == "One week ago"
{txt}(40 real changes made)

{com}. replace recenttrip_fd = 5 if lasttrip_friend_when == "Less than one week ago"
{txt}(46 real changes made)

{com}. replace recenttrip_fd = 6 if lasttrip_friend_when == "Yesterday"
{txt}(14 real changes made)

{com}. replace recenttrip_fd = 7 if lasttrip_friend_when == "Today"
{txt}(17 real changes made)

{com}. label values recenttrip_fd triprecency
{txt}
{com}. label var recenttrip_fd "Recent Trip to Friend, Cate"
{txt}
{com}. 
. * dummy equivalents for regression
. gen rectripeverfd = 0 if recenttrip_fd == 0
{txt}(496 missing values generated)

{com}. replace rectripeverfd = 1 if recenttrip_fd > 0 & recenttrip_fd !=.
{txt}(306 real changes made)

{com}. gen rectripmoreweekfd = 0 if recenttrip_fd == 4 | recenttrip_fd == 5 | recenttrip_fd == 6 | recenttrip_fd == 7
{txt}(484 missing values generated)

{com}. replace rectripmoreweekfd = 1 if recenttrip_fd == 0 | recenttrip_fd == 1 | recenttrip_fd == 2  | recenttrip_fd == 3
{txt}(294 real changes made)

{com}. gen rectripwithinweekfd = 0 if recenttrip_fd == 0 | recenttrip_fd == 1 | recenttrip_fd == 2  | recenttrip_fd == 3
{txt}(307 missing values generated)

{com}. replace rectripwithinweekfd = 1 if recenttrip_fd == 4 | recenttrip_fd == 5 | recenttrip_fd == 6 | recenttrip_fd == 7
{txt}(117 real changes made)

{com}. gen rectripyestodfd = 0 if recenttrip_fd == 0 | recenttrip_fd == 1 | recenttrip_fd == 2  | recenttrip_fd == 3 | recenttrip_fd == 4 | recenttrip_fd == 5
{txt}(221 missing values generated)

{com}. replace rectripyestodfd = 1 if recenttrip_fd == 6 | recenttrip_fd == 7
{txt}(31 real changes made)

{com}. label var rectripeverfd "Recent Trip to Friend"
{txt}
{com}. label var rectripmoreweekfd "Recent Trip to Friend, GT Week"
{txt}
{com}. label var rectripwithinweekfd "Recent Trip to Friend, Last Week"
{txt}
{com}. label var rectripyestodfd "Recent Trip to Friend, Yest or Today"
{txt}
{com}. 
. label values recenttripmoreweek recenttripwithinweek recenttripyestod rectripevernofam rectripmoreweeknofam rectripwithinweeknofam rectripyestodnofam rectripmoreweekrelat rectripwithinweekrelat rectripyestodrelat rectripeverfd rectripmoreweekfd rectripwithinweekfd rectripyestodfd yesno
{txt}
{com}. 
. * Any travel yesterday to any destination other than work / study commute (correct?)
. tab tripnb_yesterday

{txt}tripnb_yest {c |}
      erday {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        191       46.47       46.47
{txt}          1 {c |}{res}         18        4.38       50.85
{txt}          2 {c |}{res}        140       34.06       84.91
{txt}          3 {c |}{res}         30        7.30       92.21
{txt}          4 {c |}{res}         25        6.08       98.30
{txt}          5 {c |}{res}          3        0.73       99.03
{txt}          6 {c |}{res}          3        0.73       99.76
{txt}         10 {c |}{res}          1        0.24      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        411      100.00
{txt}
{com}. label var tripnb_yesterday "Trips Yesterday"
{txt}
{com}. 
. ***** Trip Diary
. 
. * trip yesterday from earlier in survey
. gen trip_yest = 0 if trip_yesterday == "No" 
{txt}(404 missing values generated)

{com}. replace trip_yest = 1 if trip_yesterday == "Yes"
{txt}(217 real changes made)

{com}. label values trip_yest yesno
{txt}
{com}. tab trip_yesterday trip_yest

                      {txt}{c |}       trip_yest
       trip_yesterday {c |}        No        Yes {c |}     Total
{hline 22}{c +}{hline 22}{c +}{hline 10}
                   No {c |}{res}       197          0 {txt}{c |}{res}       197 
{txt}                  Yes {c |}{res}         0        217 {txt}{c |}{res}       217 
{txt}{hline 22}{c +}{hline 22}{c +}{hline 10}
                Total {c |}{res}       197        217 {txt}{c |}{res}       414 
{txt}
{com}. label var trip_yest "Trip Yesterday"
{txt}
{com}. 
. gen tripnb_yest = (tripnb_yesterday != .)
{txt}
{com}. replace tripnb_yest = 0 if tripnb_yesterday == 0
{txt}(191 real changes made)

{com}. replace tripnb_yest = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. tab tripnb_yesterday trip_yest

     {txt}Trips {c |}    Trip Yesterday
 Yesterday {c |}        No        Yes {c |}     Total
{hline 11}{c +}{hline 22}{c +}{hline 10}
         0 {c |}{res}       191          0 {txt}{c |}{res}       191 
{txt}         1 {c |}{res}         0         18 {txt}{c |}{res}        18 
{txt}         2 {c |}{res}         2        135 {txt}{c |}{res}       137 
{txt}         3 {c |}{res}         0         30 {txt}{c |}{res}        30 
{txt}         4 {c |}{res}         0         24 {txt}{c |}{res}        24 
{txt}         5 {c |}{res}         0          3 {txt}{c |}{res}         3 
{txt}         6 {c |}{res}         0          2 {txt}{c |}{res}         2 
{txt}        10 {c |}{res}         0          1 {txt}{c |}{res}         1 
{txt}{hline 11}{c +}{hline 22}{c +}{hline 10}
     Total {c |}{res}       193        213 {txt}{c |}{res}       406 
{txt}
{com}. tab tripnb_yest trip_yest

{txt}tripnb_yes {c |}    Trip Yesterday
         t {c |}        No        Yes {c |}     Total
{hline 11}{c +}{hline 22}{c +}{hline 10}
         0 {c |}{res}       195          4 {txt}{c |}{res}       199 
{txt}         1 {c |}{res}         2        213 {txt}{c |}{res}       215 
{txt}{hline 11}{c +}{hline 22}{c +}{hline 10}
     Total {c |}{res}       197        217 {txt}{c |}{res}       414 
{txt}
{com}. label var tripnb_yest "Trip Yesterday"
{txt}
{com}. 
. * for consistency, dropping non-trip diary version
. drop trip_yest
{txt}
{com}. 
. ****** unaccompanied trips
. gen drivediaryadultfam = 0 if trip1_adultfam != . & trip1_adultfam > 0 | trip2_adultfam != . & trip2_adultfam > 0 | trip3_adultfam != . & trip3_adultfam > 0 | trip4_adultfam != . & trip4_adultfam > 0 | trip5_adultfam != . & trip5_adultfam > 0 | trip6_adultfam != . & trip6_adultfam > 0 | trip7_adultfam != . & trip7_adultfam > 0 | trip8_adultfam != . & trip8_adultfam > 0 | trip9_adultfam != . & trip9_adultfam > 0 | trip10_adultfam != . & trip10_adultfam > 0
{txt}(494 missing values generated)

{com}. replace drivediaryadultfam = 1 if trip1_adultfam != . & trip1_adultfam == 0 | trip2_adultfam != . & trip2_adultfam == 0 | trip3_adultfam != . & trip3_adultfam == 0 | trip4_adultfam != . & trip4_adultfam == 0 | trip5_adultfam != . & trip5_adultfam == 0 | trip6_adultfam != . & trip6_adultfam == 0 | trip7_adultfam != . & trip7_adultfam == 0 | trip8_adultfam != . & trip8_adultfam == 0 | trip9_adultfam != . & trip9_adultfam == 0 | trip10_adultfam != . & trip10_adultfam == 0
{txt}(134 real changes made)

{com}. replace drivediaryadultfam = 0 if tripnb_yesterday == 0
{txt}(191 real changes made)

{com}. 
. gen drivediaryadultother = 0 if trip1_adultother != . & trip1_adultother > 0 | trip2_adultother != . & trip2_adultother > 0 | trip3_adultother != . & trip3_adultother > 0 | trip4_adultother != . & trip4_adultother > 0 | trip5_adultother != . & trip5_adultother > 0 | trip6_adultother != . & trip6_adultother > 0 | trip7_adultother != . & trip7_adultother > 0 | trip8_adultother != . & trip8_adultother > 0 | trip9_adultother != . & trip9_adultother > 0 | trip10_adultother != . & trip10_adultother > 0
{txt}(562 missing values generated)

{com}. replace drivediaryadultother = 1 if trip1_adultother != . & trip1_adultother == 0 | trip2_adultother != . & trip2_adultother == 0 | trip3_adultother != . & trip3_adultother == 0 | trip4_adultother != . & trip4_adultother == 0 | trip5_adultother != . & trip5_adultother == 0 | trip6_adultother != . & trip6_adultother == 0 | trip7_adultother != . & trip7_adultother == 0 | trip8_adultother != . & trip8_adultother == 0 | trip9_adultother != . & trip9_adultother == 0 | trip10_adultother != . & trip10_adultother == 0
{txt}(188 real changes made)

{com}. replace drivediaryadultother = 0 if tripnb_yesterday == 0
{txt}(191 real changes made)

{com}. 
. label var drivediaryadultfam "Unacompanied Trip, without Adult Family"
{txt}
{com}. label var drivediaryadultother "Unacompanied Trip, without Adult Other"
{txt}
{com}. 
. * trip diary: purpose dummy cleaning 
. mvencode tripnb_yesterday trip1 trip2 trip3 trip4 trip5 trip6 trip7 trip8 trip9 trip10 if consentall == 1, mv(0) override 
{txt}tripnb_yes~y:{col 15}{res}23{txt} missing values recoded
       trip1:{col 15}{res}214{txt} missing values recoded
       trip2:{col 15}{res}232{txt} missing values recoded
       trip3:{col 15}{res}372{txt} missing values recoded
       trip4:{col 15}{res}402{txt} missing values recoded
       trip5:{col 15}{res}427{txt} missing values recoded
       trip6:{col 15}{res}430{txt} missing values recoded
       trip7:{col 15}{res}433{txt} missing values recoded
       trip8:{col 15}{res}433{txt} missing values recoded
       trip9:{col 15}{res}433{txt} missing values recoded
      trip10:{col 15}{res}433{txt} missing values recoded

{com}. 
. gen leisure = inlist(trip1_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip2_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip3_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip4_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip5_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip6_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip7_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip8_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip9_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside") | inlist(trip10_purpose, "(Leisure) - Meet friends", "(Leisure) - Meet relatives", "(Leisure) - park, movies, etc..", "(Leisure)- Eat a meal outside")
{txt}
{com}. replace leisure = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label var leisure "Leisure"
{txt}
{com}. 
. gen personalb = inlist(trip1_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip2_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip3_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip4_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip5_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip6_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip7_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip8_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip9_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") | inlist(trip10_purpose, "(Personal business) - Complete government procedures, e.g. a court appointment", "(Personal business) - Go out for health reasons, e.g. hospital/Doctor appointment, pharmacy, etc..", "(Take someone else) - Take or accompany someone else") 
{txt}
{com}. replace personalb = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label var personalb "Personal Business"
{txt}
{com}. 
. gen shopping = inlist(trip1_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip2_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip3_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip1_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip4_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip5_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip6_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip7_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip8_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip1_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip9_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items") | inlist(trip10_purpose, "(Shopping) - Shop for personal items", "(Shopping) - Shop for household items")
{txt}
{com}. replace shopping = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label var shopping "Shopping"
{txt}
{com}. 
. gen workcom = inlist(trip1_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip2_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip3_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip4_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip5_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip6_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip7_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip8_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip9_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute") | inlist(trip10_purpose, "(Work/School Commute) - Attend university/classes", "(Work/School Commute) - Work commute")
{txt}
{com}. replace workcom = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label variable workcom "Work/School Commute"
{txt}
{com}. 
. gen tripother = inlist(trip1_purpose, "Other (please specify):", "18", "23", "27", "32") | inlist(trip2_purpose, "Other (please specify):", "18", "20") | inlist(trip3_purpose, "Other (please specify):", "19", "27") | inlist(trip5_purpose, "Other (please specify):", "23")
{txt}
{com}. replace tripother = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label variable tripother "Other Purpose"
{txt}
{com}. 
. gen returnhome = inlist(trip1_purpose, "Return home") | inlist(trip2_purpose, "Return home")  | inlist(trip3_purpose, "Return home")  | inlist(trip4_purpose, "Return home")  | inlist(trip5_purpose, "Return home")  | inlist(trip6_purpose, "Return home")  | inlist(trip7_purpose, "Return home")  | inlist(trip8_purpose, "Return home")  | inlist(trip9_purpose, "Return home")  | inlist(trip10_purpose, "Return home")
{txt}
{com}. replace returnhome = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label variable returnhome "Return Home"
{txt}
{com}. 
. * trip diary: mode dummy cleaning 
. gen modeother = inlist(trip1_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip2_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip3_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip4_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip5_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip6_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip7_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip8_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip9_mode, "Other", "Bus provided by employer or university", "By foot (walking)") | inlist(trip10_mode, "Other", "Bus provided by employer or university", "By foot (walking)") 
{txt}
{com}. replace modeother = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label var modeother "Other Mode"
{txt}
{com}. 
. gen taxi = inlist(trip1_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand") | inlist(trip2_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand") | inlist(trip3_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand")  | inlist(trip4_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand")  | inlist(trip5_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand")  | inlist(trip6_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand")  | inlist(trip7_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand")  | inlist(trip8_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand")  | inlist(trip9_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand")  | inlist(trip10_mode, "Taxi", "Car (as a passenger with a paid driver)", "Car pooling (shared driver)", "E-Ride hailing (Uber/Careem)", "Driver on demand")  
{txt}
{com}. replace taxi = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label var taxi "Taxi"
{txt}
{com}. 
. gen carfam = inlist(trip1_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip2_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip3_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip4_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip5_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip6_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip7_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip8_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip9_mode, "Car (as a passenger with a family member or friend driving)") | inlist(trip10_mode, "Car (as a passenger with a family member or friend driving)")
{txt}
{com}. replace carfam = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label variable carfam "Car with Family"
{txt}
{com}. 
. gen driver = inlist(trip1_mode, "Car (driver)") | inlist(trip2_mode, "Car (driver)") | inlist(trip3_mode, "Car (driver)") | inlist(trip4_mode, "Car (driver)") | inlist(trip5_mode, "Car (driver)") | inlist(trip6_mode, "Car (driver)") | inlist(trip7_mode, "Car (driver)") | inlist(trip8_mode, "Car (driver)") | inlist(trip9_mode, "Car (driver)") | inlist(trip10_mode, "Car (driver)")
{txt}
{com}. replace driver = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label variable driver "Driver of Car"
{txt}
{com}. 
. gen driversolo = (driver == 1 & drivediaryadultfam == 1 & drivediaryadultother == 1)
{txt}
{com}. replace driversolo = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. gen driverfam = (driver == 1 & drivediaryadultfam == 0)
{txt}
{com}. replace driverfam = . if consentall == 0
{txt}(167 real changes made, 167 to missing)

{com}. label variable driversolo "Solo Driver"
{txt}
{com}. label variable driverfam "Driver with Family"
{txt}
{com}. 
. save "${c -(}data{c )-}/RCT wave 2/Cleaned/cleaned_wave2_dataset_full.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 2/Cleaned/cleaned_wave2_dataset_full.dta{rm}
saved
{p_end}

{com}. 
. * if desired, remove string equivalents of the above new numeric variables so as to not have duplicate variables
. drop callbackattempts participantgroup callanswered consent monthlysalary attend_careerfair jobhunt_friends jobhunt_jpc jobhunt_inperson jobhunt_calledemplo jobhunt_advert jobhunt_agency jobhunt_other jobhunt_noanswer jobhunt_callended jobhunt_none jobsappli_lastmnth jobsappli_lastmnth_txt jobinterv_lastmnth jobinterv_lastmnth_txt jobinterv_go jobinterv_go_txt drivinglicense anydrivingtraining sauditraining drivinh_lastmnth driving_times driving_likely trip_yesterday lasttrip_when lasttrip_noacco_when lasttrip_relat_when lasttrip_friend_when
{txt}
{com}. 
. * ADDITIONAL CLEANING FOR WAVE 3 MERGE/FINAL ANALYSIS
. 
. * cost of commute
.         gen comm_cost_mo_w2 = commutecost_permnth 
{txt}(538 missing values generated)

{com}.         lab var comm_cost_mo_w2 "Monthly cost of commute to work (in 2020 USD)"
{txt}
{com}.         * convert to 2020 USD (exchange rate of 0.2665)
.         replace comm_cost_mo_w2 = comm_cost_mo_w2*.2665
{txt}(62 real changes made)

{com}.         
.         gen comm_cost_day_w2 = commutecost_perday
{txt}(584 missing values generated)

{com}.         lab var comm_cost_day_w2 "Daily cost of commute to work (in 2020 USD)"
{txt}
{com}.         * convert to 2020 USD (exchange rate of 0.2665)
.         replace comm_cost_day_w2 = comm_cost_day_w2*.2665
{txt}(17 real changes made)

{com}.         * now combine this with our monthly cost
.         replace comm_cost_mo_w2 = 40*comm_cost_day_w2 if comm_cost_mo_w2==. & ///
>                 comm_cost_day_w2!=.
{txt}(17 real changes made)

{com}.         
.         * rename expected commute
.                 * convert to 2020 USD (exchange rate of 0.2665)
.         gen expectcomm_w2 = expectcomm_ehai_amount_tr
{txt}(267 missing values generated)

{com}.         replace expectcomm_w2 = expectcomm_w2*.2665
{txt}(334 real changes made)

{com}.         lab var expectcomm_w2 "Expected 30 min commute cost in 2020 USD"
{txt}
{com}.         
.         * Drove yesterday 
.         gen drove_yest_w2 = 0 if tripnb_yesterday!=.
{txt}(167 missing values generated)

{com}.         
. 
.         forval i = 2/10 {c -(}
{txt}  2{com}.                 replace drove_yest_w2 = 1 if trip`i'_mode=="Car (driver)"
{txt}  3{com}.         {c )-}
{txt}(12 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

{com}.         lab var drove_yest_w2 "Drove yesterday (wave 2)"
{txt}
{com}.         
.         * fix to code bug in wave 2 cleaning: recent trips
.                 * to relatives
.                 replace rectripyestodrelat = 0 if recenttripyestod==0 & rectripyestodrelat==.
{txt}(19 real changes made)

{com}.                 replace rectripyestodrelat = 0 if recenttrip_relat==0 & rectripyestodrelat==.
{txt}(13 real changes made)

{com}.         
.                 * to friends 
.                 replace rectripyestodfd = 0 if recenttripyestod==0 & rectripyestodfd==.
{txt}(2 real changes made)

{com}.                 
.         * let's also make this variable for wave 2
.                 gen nonwork_trip_w2 = 0 if inlist(recenttrip_relat, 0,1,2,3) 
{txt}(425 missing values generated)

{com}.                 replace nonwork_trip_w2 = 0 if inlist(recenttrip_fd, 0,1,2,3) 
{txt}(158 real changes made)

{com}.                 replace nonwork_trip_w2 = 1 if inlist(recenttrip_relat, 4,5,6,7) 
{txt}(235 real changes made)

{com}.                 replace nonwork_trip_w2 = 1 if inlist(recenttrip_fd, 4,5,6,7) 
{txt}(41 real changes made)

{com}.                 lab var nonwork_trip_w2 ///
>                 "Any visit to family or friends in past 1 week (wave 2)"
{txt}
{com}.                 
.                 * Clean travel time 
. 
.         foreach i of varlist *_arrivtime *_departime {c -(}
{txt}  2{com}. 
.         replace `i' = "4:00:00PM" if `i'=="40:00PM"
{txt}  3{com}. 
.         replace `i' = subinstr(`i',"١","1",.)
{txt}  4{com}.         replace `i' = subinstr(`i',"٢","2",.)
{txt}  5{com}.         replace `i' = subinstr(`i',"٣","3",.)
{txt}  6{com}.         replace `i' = subinstr(`i',"٤","4",.)
{txt}  7{com}.         replace `i' = subinstr(`i',"٥","5",.)
{txt}  8{com}.         replace `i' = subinstr(`i',"٦","6",.)
{txt}  9{com}.         replace `i' = subinstr(`i',"٧","7",.)
{txt} 10{com}.         replace `i' = subinstr(`i',"٨","8",.)
{txt} 11{com}.         replace `i' = subinstr(`i',"٩","9",.)
{txt} 12{com}.         replace `i' = subinstr(`i',"٠","0",.)
{txt} 13{com}. 
.         replace `i' = subinstr(`i',"م","PM",.)
{txt} 14{com}.         replace `i' = subinstr(`i',"ص","AM",.)
{txt} 15{com}.         replace `i' = subinstr(`i',"س","PM",.)
{txt} 16{com}. 
.         replace `i' = subinstr(`i'," ","",.)
{txt} 17{com}. 
.         foreach j in ح ب ا ء  {c -(}
{txt} 18{com}.         replace `i' = subinstr(`i',"`j'","",.) 
{txt} 19{com}.         {c )-}
{txt} 20{com}. 
.         replace `i' = subinstr(`i',"PMPM","PM",.)
{txt} 21{com}.         replace `i' = subinstr(`i',"AMAM","AM",.)
{txt} 22{com}.         {c )-}
{txt}(0 real changes made)
(5 real changes made)
(5 real changes made)
(7 real changes made)
(6 real changes made)
(9 real changes made)
(6 real changes made)
(6 real changes made)
(5 real changes made)
(1 real change made)
(11 real changes made)
(110 real changes made)
(81 real changes made)
(64 real changes made)
(168 real changes made)
(58 real changes made)
(58 real changes made)
(122 real changes made)
(64 real changes made)
(64 real changes made)
(0 real changes made)
(0 real changes made)
(11 real changes made)
(4 real changes made)
(6 real changes made)
(10 real changes made)
(10 real changes made)
(1 real change made)
(0 real changes made)
(4 real changes made)
(1 real change made)
(16 real changes made)
(148 real changes made)
(28 real changes made)
(92 real changes made)
(148 real changes made)
(19 real changes made)
(19 real changes made)
(111 real changes made)
(92 real changes made)
(92 real changes made)
(0 real changes made)
(0 real changes made)
(2 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(3 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(2 real changes made)
(1 real change made)
(48 real changes made)
(5 real changes made)
(28 real changes made)
(45 real changes made)
(4 real changes made)
(4 real changes made)
(32 real changes made)
(28 real changes made)
(28 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(24 real changes made)
(1 real change made)
(14 real changes made)
(21 real changes made)
(1 real change made)
(1 real change made)
(15 real changes made)
(14 real changes made)
(14 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(4 real changes made)
(2 real changes made)
(3 real changes made)
(3 real changes made)
(2 real changes made)
(2 real changes made)
(5 real changes made)
(3 real changes made)
(3 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(3 real changes made)
(0 real changes made)
(3 real changes made)
(2 real changes made)
(0 real changes made)
(0 real changes made)
(3 real changes made)
(3 real changes made)
(3 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(4 real changes made)
(2 real changes made)
(8 real changes made)
(2 real changes made)
(6 real changes made)
(8 real changes made)
(4 real changes made)
(3 real changes made)
(0 real changes made)
(11 real changes made)
(109 real changes made)
(87 real changes made)
(65 real changes made)
(171 real changes made)
(64 real changes made)
(64 real changes made)
(129 real changes made)
(65 real changes made)
(65 real changes made)
(0 real changes made)
(0 real changes made)
(9 real changes made)
(5 real changes made)
(14 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(4 real changes made)
(1 real change made)
(13 real changes made)
(155 real changes made)
(26 real changes made)
(95 real changes made)
(154 real changes made)
(20 real changes made)
(20 real changes made)
(115 real changes made)
(95 real changes made)
(95 real changes made)
(0 real changes made)
(0 real changes made)
(3 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(3 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(2 real changes made)
(1 real change made)
(49 real changes made)
(4 real changes made)
(29 real changes made)
(44 real changes made)
(3 real changes made)
(3 real changes made)
(32 real changes made)
(29 real changes made)
(29 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(25 real changes made)
(1 real change made)
(15 real changes made)
(19 real changes made)
(1 real change made)
(1 real change made)
(16 real changes made)
(15 real changes made)
(15 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(4 real changes made)
(2 real changes made)
(3 real changes made)
(3 real changes made)
(2 real changes made)
(2 real changes made)
(5 real changes made)
(3 real changes made)
(3 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(3 real changes made)
(0 real changes made)
(3 real changes made)
(3 real changes made)
(0 real changes made)
(0 real changes made)
(3 real changes made)
(3 real changes made)
(3 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

{com}. 
.         * Sometimes the enumerator wrote AM / PM in the first entry only, resulting in inconsistent time conversion - assume 7am - 7:05 implies 7am - 7:05am:  
.         forvalues i = 1 / 10 {c -(}
{txt}  2{com}. 
.         replace trip`i'_arrivtime = trip`i'_arrivtime + "AM" ///
>                 if regexm( trip`i'_departime,"AM")==1 ///
>                 & regexm( trip`i'_arrivtime,"AM")==0 ///
>                 & regexm( trip`i'_arrivtime,"PM")==0 
{txt}  3{com}.                 
.         replace trip`i'_arrivtime = trip`i'_arrivtime + "PM" ///
>                 if regexm( trip`i'_departime,"PM")==1 ///
>                 &  regexm( trip`i'_arrivtime,"AM")==0 ///
>                 & regexm( trip`i'_arrivtime,"PM")==0
{txt}  4{com}.                 
.         replace trip`i'_departime = trip`i'_departime + "AM" ///
>                 if regexm( trip`i'_arrivtime,"AM")==1 ///
>                 & regexm( trip`i'_departime,"AM")==0 ///
>                 & regexm( trip`i'_departime,"PM")==0 
{txt}  5{com}.                 
.         replace trip`i'_departime = trip`i'_departime + "PM" ///
>                 if regexm( trip`i'_arrivtime,"PM")==1 ///
>                 &  regexm( trip`i'_departime,"AM")==0 ///
>                 & regexm( trip`i'_departime,"PM")==0
{txt}  6{com}.         lab var trip`i'_arrivtime "Trip `i' arrive time (wave 2)"
{txt}  7{com}.         lab var trip`i'_departime "Trip `i' depart time (wave 2)"
{txt}  8{com}.         {c )-}
{txt}(2 real changes made)
(6 real changes made)
(1 real change made)
(2 real changes made)
(3 real changes made)
(3 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

{com}. 
.         foreach i of varlist *_arrivtime *_departime {c -(}
{txt}  2{com}. 
.         * Align times from different formats (7am, 7:00am, 7:00:00am)
.         gen double `i'_num1 = clock(`i', "hms")
{txt}  3{com}.         format `i'_num1 %tc 
{txt}  4{com}.         gen double `i'_num2 = clock(`i', "hm")
{txt}  5{com}.         format `i'_num2 %tc 
{txt}  6{com}.         gen double `i'_num3 = clock(`i', "h")
{txt}  7{com}.         format `i'_num3 %tc 
{txt}  8{com}. 
.         egen double `i'_num = rowmean(`i'_num1 `i'_num2 `i'_num3) 
{txt}  9{com}.         format `i'_num %tc 
{txt} 10{com}.         drop `i'_num1 `i'_num2 `i'_num3
{txt} 11{com}.         {c )-}
{txt}(576 missing values generated)
(426 missing values generated)
(581 missing values generated)
(381 missing values generated)
(574 missing values generated)
(439 missing values generated)
(588 missing values generated)
(399 missing values generated)
(592 missing values generated)
(552 missing values generated)
(597 missing values generated)
(539 missing values generated)
(594 missing values generated)
(578 missing values generated)
(599 missing values generated)
(569 missing values generated)
(600 missing values generated)
(595 missing values generated)
(601 missing values generated)
(594 missing values generated)
(600 missing values generated)
(598 missing values generated)
(601 missing values generated)
(597 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(580 missing values generated)
(445 missing values generated)
(559 missing values generated)
(382 missing values generated)
(582 missing values generated)
(449 missing values generated)
(570 missing values generated)
(399 missing values generated)
(593 missing values generated)
(557 missing values generated)
(591 missing values generated)
(539 missing values generated)
(595 missing values generated)
(577 missing values generated)
(599 missing values generated)
(569 missing values generated)
(600 missing values generated)
(595 missing values generated)
(601 missing values generated)
(594 missing values generated)
(600 missing values generated)
(598 missing values generated)
(601 missing values generated)
(597 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)
(601 missing values generated)
(600 missing values generated)

{com}. 
. 
.         ** Travel time = difference between arrival & departure time
. 
.         forvalues i = 1 / 10 {c -(} 
{txt}  2{com}. 
.         gen trip`i'_duration = trip`i'_arrivtime_num - trip`i'_departime_num 
{txt}  3{com}.         replace trip`i'_duration = trip`i'_duration / 60000                                 // Rescale to minutes
{txt}  4{com}. 
.         * there are 2 negative values (stata error when arrive time is AM and departure is PM)
.         replace trip`i'_duration = 1440 + trip`i'_duration if trip`i'_duration<0 & trip`i'_duration!=.
{txt}  5{com}.         replace trip`i'_duration = 180 if trip`i'_duration>180 & trip`i'_duration<.             // Topcode very long trips
{txt}  6{com}.         lab var trip`i'_duration "trip`i'_duration (wave 2)"
{txt}  7{com}.         lab var trip`i'_arrivtime_num "Trip `i' arrive time, numeric (wave 2)"
{txt}  8{com}.         lab var trip`i'_departime_num "Trip `i' depart time, numeric (wave 2)"  
{txt}  9{com}.         {c )-}
{txt}(382 missing values generated)
(219 real changes made)
(2 real changes made)
(5 real changes made)
(399 missing values generated)
(202 real changes made)
(11 real changes made)
(5 real changes made)
(539 missing values generated)
(62 real changes made)
(1 real change made)
(0 real changes made)
(569 missing values generated)
(32 real changes made)
(1 real change made)
(1 real change made)
(594 missing values generated)
(7 real changes made)
(0 real changes made)
(0 real changes made)
(597 missing values generated)
(4 real changes made)
(0 real changes made)
(0 real changes made)
(600 missing values generated)
(1 real change made)
(0 real changes made)
(0 real changes made)
(600 missing values generated)
(1 real change made)
(0 real changes made)
(0 real changes made)
(600 missing values generated)
(1 real change made)
(0 real changes made)
(0 real changes made)
(600 missing values generated)
(1 real change made)
(0 real changes made)
(0 real changes made)

{com}. 
.         ** Max & Mean travel time across trips (egen rowmean / rowmax) 
.         rename tripnb_yesterday tripnb_yesterday_w2
{res}{txt}
{com}. 
.         egen mean_trip_duration = rowmean(trip*duration) 
{txt}(381 missing values generated)

{com}.         gen mean_trip_duration_uncond = mean_trip_duration
{txt}(381 missing values generated)

{com}.         replace mean_trip_duration_uncond = 0 if tripnb_yesterday_w2 < . & mean_trip_duration_uncond==0 
{txt}(0 real changes made)

{com}.         egen max_trip_duration = rowmax(trip*duration) 
{txt}(381 missing values generated)

{com}.         egen total_trip_duration = rowtotal(trip*duration) 
{txt}
{com}.         replace total_trip_duration = . if trip1_duration==.
{txt}(382 real changes made, 382 to missing)

{com}. 
.         foreach i in max_trip_duration total_trip_duration {c -(}
{txt}  2{com}.         replace `i' = 0 if tripnb_yesterday_w2==0 
{txt}  3{com}.         {c )-}
{txt}(214 real changes made)
(214 real changes made)

{com}. 
. 
. 
.         label var mean_trip_duration "Mean one-way trip duration mins $|$ any trip yesterday (wave 2)"  //  - missing if no trip
{txt}
{com}.         label var mean_trip_duration_uncond "Mean trip duration mins - 0 if no trip (wave 2)"
{txt}
{com}.         label var max_trip_duration "Max trip duration mins - 0 if no trip (wave 2)"
{txt}
{com}.         label var total_trip_duration "Total trip duration mins - 0 if no trip (wave 2)"
{txt}
{com}. 
.         * Clean travel mode
. 
.         foreach i in bus foot car_family car_paiddriver car_driver car_pooling hailing taxi other  {c -(}
{txt}  2{com}.                 
.         gen trip_mode_`i' = 0 if tripnb_yesterday_w2 < .
{txt}  3{com}.                 
.         {c )-}
{txt}(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)

{com}. 
.         forvalues i = 1 / 10 {c -(}
{txt}  2{com}.         replace trip_mode_bus = 1 if regexm(trip`i'_mode, "Bus provided")==1
{txt}  3{com}.         replace trip_mode_foot = 1 if regexm(trip`i'_mode, "By foot")==1
{txt}  4{com}.         replace trip_mode_car_family = 1 if regexm(trip`i'_mode, "as a passenger with a family")==1
{txt}  5{com}.         replace trip_mode_car_paiddriver = 1 if regexm(trip`i'_mode, "as a passenger with a paid")==1
{txt}  6{com}.         replace trip_mode_car_driver = 1 if trip`i'_mode=="Car (driver)"
{txt}  7{com}.         replace trip_mode_car_pooling = 1 if regexm(trip`i'_mode, "Car pooling")==1
{txt}  8{com}.         replace trip_mode_hailing = 1 if regexm(trip`i'_mode, "Driver on demand")==1 | regexm(trip`i'_mode, "E-Ride hailing")==1
{txt}  9{com}.         replace trip_mode_other = 1 if regexm(trip`i'_mode, "Other")==1
{txt} 10{com}.         replace trip_mode_taxi = 1 if regexm(trip`i'_mode, "Taxi")==1
{txt} 11{com}.         {c )-}
{txt}(7 real changes made)
(11 real changes made)
(50 real changes made)
(32 real changes made)
(13 real changes made)
(6 real changes made)
(56 real changes made)
(19 real changes made)
(26 real changes made)
(0 real changes made)
(2 real changes made)
(6 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(3 real changes made)
(4 real changes made)
(7 real changes made)
(0 real changes made)
(5 real changes made)
(4 real changes made)
(2 real changes made)
(1 real change made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(2 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

{com}. 
.         label variable trip_mode_bus "Trip yesterday - Bus provided by university or employer (wave 2)"
{txt}
{com}.         label variable trip_mode_foot "Trip yesterday - Walking (wave 2)"
{txt}
{com}.         label variable trip_mode_car_driver "Trip yesterday - Drove herself (wave 2)"
{txt}
{com}.         label variable trip_mode_car_family "Trip yesterday - Car - family member driving (wave 2)"
{txt}
{com}.         label variable trip_mode_car_paiddriver "Trip yesterday - Car with paid driver (wave 2)"
{txt}
{com}.         label variable trip_mode_car_pooling "Trip yesterday - Car pooling (wave 2)"
{txt}
{com}.         label variable trip_mode_hailing "Trip yesterday - Ride-hailing (e.g. Uber) (wave 2)"
{txt}
{com}.         label variable trip_mode_taxi "Trip yesterday - Taxi (wave 2)"
{txt}
{com}.         label variable trip_mode_other "Trip yesterday - Other mode (wave 2)"
{txt}
{com}. 
. 
. 
.         * Clean purpose of travel 
. 
.         foreach i in leisure_friends leisure_rel leisure_park leisure_meal ///
>                 pers_govt pers_health shopping_hh shopping_pers pickdrop uni work {c -(}
{txt}  2{com}.         gen trip_any_`i' = 0 if tripnb_yesterday_w2 < .
{txt}  3{com}.         {c )-}
{txt}(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)
(167 missing values generated)

{com}. 
.         forvalues i = 1 / 10 {c -(}
{txt}  2{com}. 
.         replace trip_any_leisure_friends = 1 if regexm(trip`i'_purpose,"Meet friends")==1
{txt}  3{com}.         replace trip_any_leisure_rel = 1 if regexm(trip`i'_purpose,"Meet relatives")==1
{txt}  4{com}.         replace trip_any_leisure_park = 1 if regexm(trip`i'_purpose,"park, movies, etc")==1
{txt}  5{com}.         replace trip_any_leisure_meal = 1 if regexm(trip`i'_purpose,"Eat a meal outside")==1
{txt}  6{com}.         replace trip_any_pers_govt = 1 if regexm(trip`i'_purpose,"Complete govern")==1
{txt}  7{com}.         replace trip_any_pers_health = 1 if regexm(trip`i'_purpose,"Go out for heal")==1
{txt}  8{com}.         replace trip_any_shopping_hh = 1 if regexm(trip`i'_purpose,"Shop for household items")==1
{txt}  9{com}.         replace trip_any_shopping_pers = 1 if regexm(trip`i'_purpose,"Shop for personal items")==1
{txt} 10{com}.         replace trip_any_pickdrop = 1 if regexm(trip`i'_purpose,"Take or accompa")==1
{txt} 11{com}.         replace trip_any_uni = 1 if regexm(trip`i'_purpose,"Attend unive")==1
{txt} 12{com}.         replace trip_any_work = 1 if regexm(trip`i'_purpose,"Work commute")==1
{txt} 13{com}. 
.         {c )-}
{txt}(5 real changes made)
(22 real changes made)
(2 real changes made)
(3 real changes made)
(2 real changes made)
(24 real changes made)
(14 real changes made)
(23 real changes made)
(10 real changes made)
(31 real changes made)
(52 real changes made)
(2 real changes made)
(6 real changes made)
(0 real changes made)
(5 real changes made)
(0 real changes made)
(5 real changes made)
(10 real changes made)
(6 real changes made)
(0 real changes made)
(1 real change made)
(4 real changes made)
(1 real change made)
(2 real changes made)
(2 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(6 real changes made)
(5 real changes made)
(2 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(2 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

{com}. 
.         gen trip_duration_work = 0 if   tripnb_yesterday_w2 < . 
{txt}(167 missing values generated)

{com}.         gen trip_duration_driving = 0 if   tripnb_yesterday_w2 < . 
{txt}(167 missing values generated)

{com}. 
.         forvalues i = 1 / 10 {c -(}
{txt}  2{com}.                 
.                 replace trip_duration_work = trip_duration_work + trip`i'_duration if regexm(trip`i'_purpose,"Work commute")==1
{txt}  3{com}.                 
.                 replace trip_duration_driving = trip_duration_driving + trip`i'_duration if trip`i'_mode=="Car (driver)"
{txt}  4{com}.                 
.         {c )-}
{txt}(52 real changes made)
(13 real changes made)
(4 real changes made)
(12 real changes made)
(1 real change made)
(9 real changes made)
(0 real changes made)
(5 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

{com}. 
.         gen trip_duration_work_cond = trip_duration_work if trip_any_work==1 
{txt}(545 missing values generated)

{com}.         label variable trip_duration_work_cond "One-way commute duration mins $|$ any commute to work yesterday (wave 2)"
{txt}
{com}.         lab var trip_duration_work "Work commute duration (wave 2)"
{txt}
{com}.         lab var trip_duration_driving "Driving duration (wave 2)"
{txt}
{com}. 
.         * Bigger purpose categories 
.         egen trip_any_leisure = rowmax(trip_any_leisure*) 
{txt}(167 missing values generated)

{com}.         egen trip_any_errands = rowmax(trip_any_pers* trip_any_shopping*) 
{txt}(167 missing values generated)

{com}. 
.         label variable trip_any_leisure_friends "Trip yesterday - Leisure to meet friends (wave 2)"
{txt}
{com}.         label variable trip_any_leisure_rel "Trip yesterday - Leisure to meet relatives (wave 2)"
{txt}
{com}.         label variable trip_any_leisure_park "Trip yesterday - Leisure to park or movies (wave 2)"
{txt}
{com}.         label variable trip_any_leisure_meal "Trip yesterday - Leisure for meal (wave 2)"
{txt}
{com}.         label variable trip_any_pers_govt "Trip yesterday - Errands - personal business (wave 2)"
{txt}
{com}.         label variable trip_any_pers_health "Trip yesterday - Errands - health (wave 2)"
{txt}
{com}.         label variable trip_any_shopping_hh "Trip yesterday - Errands - HH shopping (wave 2)"
{txt}
{com}.         label variable trip_any_shopping_pers "Trip yesterday - Errands - personal shopping (wave 2)"
{txt}
{com}.         label variable trip_any_pickdrop "Trip yesterday - Pick or drop someone (wave 2)"
{txt}
{com}.         label variable trip_any_uni "Trip yesterday - University commute (wave 2)"
{txt}
{com}.         label variable trip_any_work "Trip yesterday - Work commute (wave 2)"
{txt}
{com}.         label variable trip_any_leisure "Trip yesterday - Any leisure trip (wave 2)"
{txt}
{com}.         label variable trip_any_errands "Trip yesterday - Any errands trip (wave 2)"
{txt}
{com}. 
.         gen trip_any = tripnb_yesterday_w2 > 0 & tripnb_yesterday_w2 < .
{txt}
{com}.         replace trip_any = . if  tripnb_yesterday_w2==.
{txt}(167 real changes made, 167 to missing)

{com}.         label variable trip_any "Any trip yesterday  (wave 2)"
{txt}
{com}.                 
. 
.         * Desc stats for paper - C group only, Wave 2 detailed travel 
.         gen travel_duration_diary = .
{txt}(601 missing values generated)

{com}.         replace travel_duration_diary = 0 if tripnb_yesterday_w2==0 
{txt}(214 real changes made)

{com}.         replace travel_duration_diary = 1 if total_trip_duration > 0 & total_trip_duration <= 15 
{txt}(18 real changes made)

{com}.         replace travel_duration_diary = 2 if total_trip_duration > 15 & total_trip_duration <= 30
{txt}(29 real changes made)

{com}.         replace travel_duration_diary = 3 if total_trip_duration > 30 & total_trip_duration <= 45
{txt}(24 real changes made)

{com}.         replace travel_duration_diary = 4 if total_trip_duration > 45 & total_trip_duration <= 60
{txt}(41 real changes made)

{com}.         replace travel_duration_diary = 5 if total_trip_duration > 60 & total_trip_duration <= 90
{txt}(33 real changes made)

{com}.         replace travel_duration_diary = 6 if total_trip_duration > 90 & total_trip_duration <= 120
{txt}(24 real changes made)

{com}.         replace travel_duration_diary = 7 if total_trip_duration > 120 & total_trip_duration < .
{txt}(50 real changes made)

{com}.         lab var travel_duration_diary "Trip duration, category (wave 2)"
{txt}
{com}. 
.         label define frequency 0 "Did not travel" 1 "< 15 mins" 2 "16-30 mins" 3 "31 - 45 mins" 4 "45 - 60 mins" 5 "61 - 90 mins" 6 "90 - 120 mins" 7 "> 120 mins"
{txt}
{com}.                 
.                 
.         * create wave 2 travel vars that are conditional on having made a trip yesterday
.         global travelvars1 mean_trip_duration mean_trip_duration_uncond max_trip_duration total_trip_duration 
{txt}
{com}.         global travelvars2 rectripwithinweeknofam_w2 drivediaryadultfam_w2 drivediaryadultother_w2 
{txt}
{com}.         global travelvars3 trip_family_pool trip_friends_pool nonwork_trip_pool
{txt}
{com}.         global travelvars4 trip_any_work trip_any_uni trip_any_pickdrop trip_any_errands trip_any_leisure // Simple purpose
{txt}
{com}.         global travelvars5 trip_any_leisure_friends trip_any_leisure_rel ///
>                 trip_any_leisure_park trip_any_leisure_meal trip_any_pers_govt ///
>                 trip_any_pers_health trip_any_shopping_hh trip_any_shopping_pers ///
>                 trip_any_pickdrop trip_any_uni trip_any_work                                                            // Detailed purpose
{txt}
{com}. 
.         global travelvars6 trip_duration_work trip_duration_work_cond
{txt}
{com}.         global travelvars7 trip_mode_* 
{txt}
{com}. 
.         global travelvars8 ""
{txt}
{com}.         foreach var of varlist $travelvars5 $travelvars7 {c -(}
{txt}  2{com}.                 
.                 gen `var'cond = `var' 
{txt}  3{com}.                 replace `var'cond = . if tripnb_yesterday_w2==0 
{txt}  4{com}.                 global travelvars8 $travelvars8 `var'cond 
{txt}  5{com}.                 local lab: variable label `var'
{txt}  6{com}.                 label variable `var'cond "`lab'"
{txt}  7{com}.                 
.         {c )-}
{txt}(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)
(167 missing values generated)
(214 real changes made, 214 to missing)

{com}. 
.         * Create combined travel groups
.         
.                 * Leisure: trip_any_leisure_friendscond trip_any_leisure_relcond_w2 ///
>                 trip_any_leisure_parkcond_w2 trip_any_leisure_mealcond_w2               
.                 egen trip_all_leisure_cond = rowmax(trip_any_leisure_friendscond ///
>                 trip_any_leisure_relcond trip_any_leisure_parkcond ///
>                 trip_any_leisure_mealcond) 
{txt}(381 missing values generated)

{com}.                 lab var trip_all_leisure_cond "Trip yesterday - Any leisure (wave 2)"
{txt}
{com}.                 
.                 * Create unconditional version
.                 egen trip_all_leisure = rowmax(trip_any_leisure_friends ///
>                 trip_any_leisure_rel trip_any_leisure_park ///
>                 trip_any_leisure_meal) 
{txt}(167 missing values generated)

{com}.                 lab var trip_all_leisure "Any leisure trip; uncond. (wave 2)"
{txt}
{com}.                 
.                 * Personal errands: trip_any_pers_govtcond, trip_any_pers_healthcond, ///
>                 trip_any_shopping_perscond
.                 egen trip_personal_errands_cond = rowmax(trip_any_pers_govtcond ///
>                 trip_any_pers_healthcond trip_any_shopping_perscond)
{txt}(381 missing values generated)

{com}.                 lab var trip_personal_errands_cond "Trip yesterday - Any personal errands (wave 2)"
{txt}
{com}.                 
.                 * Create unconditional version
.                 egen trip_personal_errands = rowmax(trip_any_pers_govt ///
>                 trip_any_pers_health)
{txt}(167 missing values generated)

{com}.                 lab var trip_personal_errands "Other personal errands; uncond. (wave 2)"
{txt}
{com}. 
.                 
.                 * HH errands: trip_any_pickdropcond trip_any_shopping_hhcond
.                 egen trip_HH_errands_cond = rowmax(trip_any_pickdropcond ///
>                 trip_any_shopping_hhcond)
{txt}(381 missing values generated)

{com}.                 lab var trip_HH_errands_cond "Trip yesterday - Any HH errands (wave 2)"
{txt}
{com}. 
.                 * Create unconditional version
.                 egen trip_HH_errands = rowmax(trip_any_pickdrop trip_any_shopping_hh)
{txt}(167 missing values generated)

{com}.                 lab var trip_HH_errands "Any HH errands; uncond. (wave 2)"
{txt}
{com}. 
.                 * Commute: trip_any_unicond trip_any_workcond
.                 egen trip_commute_cond = rowmax(trip_any_unicond trip_any_workcond)
{txt}(381 missing values generated)

{com}.                 lab var trip_commute_cond "Trip yesterday - Any commute (wave 2)"
{txt}
{com}.                 
.                 * Create unconditional version
.                 egen trip_commute = rowmax(trip_any_uni trip_any_work)
{txt}(167 missing values generated)

{com}.                 lab var trip_commute "Any commute; uncond. (wave 2)"
{txt}
{com}. 
. 
. * Finally, add "_w2" to end of all vars
.         * some already have '_w2' at the end, let's skip these
.         lookfor _w2

{txt}Variable      Storage   Display    Value
    name         type    format    label      Variable label
{hline}
{p 0 48}{res}{bind:tripnb_yester~2}{txt}{bind: byte    }{bind:%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Trips Yesterday{p_end}
{p 0 48}{bind:comm_cost_mo_w2}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Monthly cost of commute to work (in 2020 USD){p_end}
{p 0 48}{bind:comm_cost_day~2}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Daily cost of commute to work (in 2020 USD){p_end}
{p 0 48}{bind:expectcomm_w2  }{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Expected 30 min commute cost in 2020 USD{p_end}
{p 0 48}{bind:drove_yest_w2  }{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Drove yesterday (wave 2){p_end}
{p 0 48}{bind:nonwork_trip_w2}{txt}{bind: float   }{bind:%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}Any visit to family or friends in past 1 week (wave 2){p_end}
{txt}
{com}.         local suffix_vars `r(varlist)'
{txt}
{com}.         * and some we don't want to include
.         local   skip_vars Institution file_nbr participantid randomization_cohort ///
>                         randomization_cohort2 NGO num_enrolled_HH group_strata Randomization ///
>                         driving_ct wusool_ct national_id hh_les18 hh_more18 driving_ct2 ///
>                         wusool_ct2 driving_T wusool_T driving_ctoriginal wusool_ctoriginal ///
>                         Excluded Exclusion household_size HH_enrolled 
{txt}
{com}.         ds _all
{txt}{col 1}participan~d{col 15}driving_me~t{col 29}trip4_arri~e{col 43}trip9_origin{col 57}job_interv~d{col 71}trip3_dura~n
{col 1}treat{col 15}driving_he~h{col 29}trip4_purp~e{col 43}trip9_destin{col 57}takejob_15~s{col 71}trip4_dura~n
{col 1}Progress{col 15}driving_gov{col 29}trip4_purp~t{col 43}trip9_depa~e{col 57}takejob_30~s{col 71}trip5_dura~n
{col 1}Finished{col 15}driving_ac~y{col 29}trip4_mode{col 43}trip9_arri~e{col 57}drive_lastm{col 71}trip6_dura~n
{col 1}UserLanguage{col 15}driving_ot~r{col 29}trip4_mode~t{col 43}trip9_purp~e{col 57}drive_month{col 71}trip7_dura~n
{col 1}blockorder{col 15}driving_no~r{col 29}trip4_cost{col 43}trip9_purp~t{col 57}future_drive{col 71}trip8_dura~n
{col 1}enumerator~e{col 15}driving_ca~d{col 29}trip4_cost~t{col 43}trip9_mode{col 57}future_dri~d{col 71}trip9_dura~n
{col 1}participan~r{col 15}driving_ot~t{col 29}trip4_child{col 43}trip9_mode~t{col 57}recenttrip{col 71}trip10_dur~n
{col 1}attemptnb{col 15}concer_lea~d{col 29}trip4_adul~m{col 43}trip9_cost{col 57}recent~eweek{col 71}mean_trip_~n
{col 1}speakingwi~s{col 15}concer_aff~r{col 29}trip4_adul~r{col 43}trip9_cost~t{col 57}recent~nweek{col 71}mean_trip_~d
{col 1}reachresp{col 15}concer_aff~t{col 29}trip5{col 43}trip9_child{col 57}recenttri~od{col 71}max_trip_d~n
{col 1}reachresp_~t{col 15}concer_car~d{col 29}trip5_origin{col 43}trip9_adul~m{col 57}recenttrip~m{col 71}total_trip~n
{col 1}reachresp_~r{col 15}concer_soc~y{col 29}trip5_destin{col 43}trip9_adul~r{col 57}rectripeve~m{col 71}trip_mode_~s
{col 1}goodtime{col 15}concer_fam~y{col 29}trip5_depa~e{col 43}trip10{col 57}rectripmor~m{col 71}trip_mode_~t
{col 1}goodtime_txt{col 15}concer_rep~n{col 29}trip5_arri~e{col 43}trip10_ori~n{col 57}rectripwit~m{col 71}trip_mode_~y
{col 1}phonenb_best{col 15}concer_ris~t{col 29}trip5_purp~e{col 43}trip10_des~n{col 57}rectripyes~m{col 71}trip~ddriver
{col 1}phonenb_b~xt{col 15}concer_ris~n{col 29}trip5_purp~t{col 43}trip10_dep~e{col 57}recenttrip~t{col 71}trip~_driver
{col 1}numberused{col 15}metro_likely{col 29}trip5_mode{col 43}trip10_arr~e{col 57}rectripmor~t{col 71}trip_m~oling
{col 1}employed{col 15}metro_notl~y{col 29}trip5_mode~t{col 43}trip10_pur~e{col 57}rectripwit~t{col 71}trip_m~iling
{col 1}work_area{col 15}metro_notl~t{col 29}trip5_cost{col 43}trip10_pur~t{col 57}rectripyes~t{col 71}trip_mode_~i
{col 1}work_area_~t{col 15}tripnb_yes~2{col 29}trip5_cost~t{col 43}trip10_mode{col 57}recenttri~fd{col 71}trip_mod~her
{col 1}residence_~y{col 15}trip1{col 29}trip5_child{col 43}trip10_mod~t{col 57}rectripeve~d{col 71}trip_any_l~s
{col 1}reside~y_txt{col 15}trip1_origin{col 29}trip5_adul~m{col 43}trip10_cost{col 57}rectripmor~d{col 71}trip_any_~el
{col 1}residence_~a{col 15}trip1_destin{col 29}trip5_adul~r{col 43}trip10_co~xt{col 57}rectripwit~d{col 71}trip_any_l~k
{col 1}reside~a_txt{col 15}trip1_depa~e{col 29}trip6{col 43}trip10_child{col 57}rectripyes~d{col 71}trip_any_~al
{col 1}startjob_y~r{col 15}trip1_arri~e{col 29}trip6_origin{col 43}trip10_adu~m{col 57}tripnb_yest{col 71}trip_any_p~t
{col 1}startjob_y~t{col 15}trip1_purp~e{col 29}trip6_destin{col 43}trip10_adu~r{col 57}drivediary~m{col 71}trip_any_p~h
{col 1}startjob_m~h{col 15}trip1_purp~t{col 29}trip6_depa~e{col 43}fullstartd~e{col 57}drivediary~r{col 71}trip_any_s~h
{col 1}startjob_m~t{col 15}trip1_mode{col 29}trip6_arri~e{col 43}starttime{col 57}leisure{col 71}trip_any_s~s
{col 1}jobhunt_ot~t{col 15}trip1_mode~t{col 29}trip6_purp~e{col 43}timecat{col 57}personalb{col 71}trip_any_p~p
{col 1}joboffers_~h{col 15}trip1_cost{col 29}trip6_purp~t{col 43}startdate{col 57}shopping{col 71}trip_any_uni
{col 1}joboffers_~t{col 15}trip1_cost~t{col 29}trip6_mode{col 43}dow{col 57}workcom{col 71}trip_any_w~k
{col 1}joboffer_a~t{col 15}trip1_child{col 29}trip6_mode~t{col 43}enddate{col 57}tripother{col 71}trip_durat~k
{col 1}expectedsa~y{col 15}trip1_adul~m{col 29}trip6_cost{col 43}recordeddate{col 57}returnhome{col 71}trip_durat~g
{col 1}expectedsa~t{col 15}trip1_adul~r{col 29}trip6_cost~t{col 43}intensive{col 57}modeother{col 71}trip_durat~d
{col 1}lowestsalary{col 15}trip2{col 29}trip6_child{col 43}group{col 57}taxi{col 71}trip_any_l~e
{col 1}lowestsala~t{col 15}trip2_origin{col 29}trip6_adul~m{col 43}finalanswer{col 57}carfam{col 71}trip_any_e~s
{col 1}commutecos~q{col 15}trip2_destin{col 29}trip6_adul~r{col 43}fullconsent{col 57}driver{col 71}trip_any
{col 1}commutecos~h{col 15}trip2_depa~e{col 29}trip7{col 43}participate{col 57}driversolo{col 71}travel_dur~y
{col 1}commutecos~y{col 15}trip2_arri~e{col 29}trip7_origin{col 43}consentall{col 57}driverfam{col 71}trip_~dscond
{col 1}wusool_con~e{col 15}trip2_purp~e{col 29}trip7_destin{col 43}salary_mon~y{col 57}comm_co~o_w2{col 71}trip_~elcond
{col 1}wusool_con~r{col 15}trip2_purp~t{col 29}trip7_depa~e{col 43}anydrivetr~g{col 57}comm_co~y_w2{col 71}trip~arkcond
{col 1}wusool_wh~ot{col 15}trip2_mode{col 29}trip7_arri~e{col 43}saudidrive~g{col 57}expectcomm~2{col 71}trip_~alcond
{col 1}wusool_wh~xt{col 15}trip2_mode~t{col 29}trip7_purp~e{col 43}saudidrive{col 57}drove_yest~2{col 71}trip_a~tcond
{col 1}expectcomm~q{col 15}trip2_cost{col 29}trip7_purp~t{col 43}license{col 57}nonwork_tr~2{col 71}trip_~thcond
{col 1}expectcomm~t{col 15}trip2_cost~t{col 29}trip7_mode{col 43}expectcomm~r{col 57}trip1_arri~m{col 71}trip_~hhcond
{col 1}commutemod~c{col 15}trip2_child{col 29}trip7_mode~t{col 43}expectcommDK{col 57}trip2_arri~m{col 71}trip_~rscond
{col 1}commutemod~t{col 15}trip2_adul~m{col 29}trip7_cost{col 43}currentlye~d{col 57}trip3_arri~m{col 71}trip_a~pcond
{col 1}takejob_15~n{col 15}trip2_adul~r{col 29}trip7_cost~t{col 43}jobsearch{col 57}trip4_arri~m{col 71}trip_any_u~d
{col 1}takejob_30~n{col 15}trip3{col 29}trip7_child{col 43}careerfair{col 57}trip5_arri~m{col 71}trip_any_w~d
{col 1}takejob_45~n{col 15}trip3_origin{col 29}trip7_adul~m{col 43}jh_friends{col 57}trip6_arri~m{col 71}trip_m~scond
{col 1}alnahda_en~v{col 15}trip3_destin{col 29}trip7_adul~r{col 43}jh_jobcentre{col 57}trip7_arri~m{col 71}trip_m~tcond
{col 1}alnahda_en~k{col 15}trip3_depa~e{col 29}trip8{col 43}jh_inperson{col 57}trip8_arri~m{col 71}trip_m~ycond
{col 1}alnahda_w~ot{col 15}trip3_arri~e{col 29}trip8_origin{col 43}jh_calledemp{col 57}trip9_arri~m{col 71}~ddrivercond
{col 1}alnahda_w~xt{col 15}trip3_purp~e{col 29}trip8_destin{col 43}jh_agency{col 57}trip10_arr~m{col 71}~_drivercond
{col 1}enum_upcom~n{col 15}trip3_purp~t{col 29}trip8_depa~e{col 43}jh_advert{col 57}trip1_depa~m{col 71}tr~olingcond
{col 1}enum_noint~s{col 15}trip3_mode{col 29}trip8_arri~e{col 43}jh_other{col 57}trip2_depa~m{col 71}tr~ilingcond
{col 1}enum_noint~t{col 15}trip3_mode~t{col 29}trip8_purp~e{col 43}jobhuntsum{col 57}trip3_depa~m{col 71}trip_m~icond
{col 1}sauditrain~p{col 15}trip3_cost{col 29}trip8_purp~t{col 43}jobhuntprop{col 57}trip4_depa~m{col 71}trip~hercond
{col 1}sauditrain~t{col 15}trip3_cost~t{col 29}trip8_mode{col 43}jh_travel{col 57}trip5_depa~m{col 71}trip_all_l~d
{col 1}driving_sh~n{col 15}trip3_child{col 29}trip8_mode~t{col 43}llowestsal~t{col 57}trip6_depa~m{col 71}trip_all_l~e
{col 1}driving_sh~h{col 15}trip3_adul~m{col 29}trip8_cost{col 43}lexpecteds~t{col 57}trip7_depa~m{col 71}trip_perso~d
{col 1}driving_work{col 15}trip3_adul~r{col 29}trip8_cost~t{col 43}jobapplied~m{col 57}trip8_depa~m{col 71}trip_perso~s
{col 1}driving_uni{col 15}trip4{col 29}trip8_child{col 43}jobintervi~m{col 57}trip9_depa~m{col 71}trip_HH_er~d
{col 1}driving_fr~s{col 15}trip4_origin{col 29}trip8_adul~m{col 43}jobinterva~m{col 57}trip10_dep~m{col 71}trip_HH_er~s
{col 1}driving_re~s{col 15}trip4_destin{col 29}trip8_adul~r{col 43}job_applied{col 57}trip1_dura~n{col 71}trip_commu~d
{col 1}driving_le~e{col 15}trip4_depa~e{col 29}trip9{col 43}job_interv~w{col 57}trip2_dura~n{col 71}trip_commute

{com}.         local full_list `r(varlist)'
{txt}
{com}. 
.         local missing_w2_suffix: list full_list - suffix_vars 
{txt}
{com}.         local missing_w2_suffix: list missing_w2_suffix - skip_vars
{txt}
{com}. 
. foreach var of local missing_w2_suffix {c -(}
{txt}  2{com}.         rename `var' `var'_w2
{txt}  3{com}. {c )-}
{res}{txt}
{com}.                 
. 
. save "${c -(}data{c )-}/RCT wave 2/Final/Wave2.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 2/Final/Wave2.dta{rm}
saved
{p_end}

{com}. 
. 
{txt}end of do-file

{com}.         do              "$rep_code/cleaning/Wave 1 & 2 merge.do"
{txt}
{com}. ***** REMEMBER TO RUN SETTINGS.DO FILE FIRST ******
. 
. /******************************************************************************
> Purpose: Merge wave 1 and wave 2
>                                            
> Created: June 17, 2020
> *******************************************************************************/
. clear all
{res}{txt}
{com}. set more off
{txt}
{com}. 
. **************************************************************************
. 
. use "${c -(}data{c )-}/RCT admin and wave 1/Final/Wave1.dta", clear
{txt}
{com}. 
. 
. merge 1:1 participantid using "${c -(}data{c )-}/RCT wave 2/Final/Wave2.dta"
{res}{txt}(label {bf:{txt}treatments_4} already defined)

{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}             461
{txt}{col 9}from master{col 30}{res}             461{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}Matched{col 30}{res}             601{txt}  (_merge==3)
{col 5}{hline 41}

{com}. drop _merge
{txt}
{com}. 
. 
. save "${c -(}data{c )-}/RCT wave 2/Final/Combined_waves1and2_final.dta", replace 
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 2/Final/Combined_waves1and2_final.dta{rm}
saved
{p_end}

{com}. 
. 
{txt}end of do-file

{com}.         do              "$rep_code/cleaning/Wave 3 cleaning.do"
{txt}
{com}. ***********************************************************************************
. ***********************************************************************************
. * WAVE 3 CLEANING
. ***********************************************************************************
. 
. * Automating pull for latest dataset
. global rawdata ///
>         "$data/RCT wave 3/Raw/Wave 3 - High Freq 1_redownload with module randomizer info_August 26, 2022.xlsx"
{txt}
{com}. global rawdata_limited ///
>         "$data/RCT wave 3/Raw/Wave 3 - Limited Version_October 4, 2022_08.36.xlsx"
{txt}
{com}. global missingids1 "$data/RCT wave 3/Data for survey embedding/Feb 2022 Limited Survey/Wave_3__Limited_Version-Distribution_History_AlNahda survey links_27Feb2022.csv"
{txt}
{com}. global missing16 "$data/RCT wave 3/Raw/Wave 3 IDs for missing respondents_5Oct2022.xlsx"
{txt}
{com}. 
. *****************************************************************
. * SECTION 1 - PULL IN DATA AND DROP OUT NON-SURVEYS
. * SECTION 2 - MERGE IN DATA FROM WAVES 1 AND 2
. * SECTION 3 - CLEANING
. * SECTION 4 - GENERATE STATS ON MODULES STARTED AND COMPLETED
. * SECTION 5 - INCORPORAT DATA FROM QUDRA LINK AND MERGE IN
. * SECTION 6 - FINAL CLEAN UP AND LABELLING
. *****************************************************************
. 
. 
. *****************************************************************
. * SECTION 1 - PULL IN DATA AND DROP OUT NON-SURVEYS
. *****************************************************************
. 
. * pull in full main survey
. import excel "$rawdata", firstrow allstring clear
{res}{text}(143 vars, 1,369 obs)

{com}. 
. 
. 
. foreach v of varlist * {c -(}
{txt}  2{com}.     local value = `v'[1]
{txt}  3{com}.         local vname = strtoname(`"`value'"')
{txt}  4{com}.     label var `v' `"`vname'"'
{txt}  5{com}. {c )-}
{txt}
{com}. 
.         * drop first two observations as they are labels
.         drop if _n==1 | _n==2
{txt}(2 observations deleted)

{com}.         drop if Status=="Survey Preview" 
{txt}(18 observations deleted)

{com}.         *| Status == "Spam"
.         destring ExternalReference, replace
{txt}ExternalReference: all characters numeric; {res}replaced {txt}as {res}int
{txt}(3 missing values generated)
{res}{txt}
{com}.         drop if ExternalReference==0
{txt}(38 observations deleted)

{com}.         
. * tag these as long survey
. gen short_survey = 0
{txt}
{com}. 
. save "$data/RCT wave 3/Raw/Wave 3 new wording survey - Raw.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Raw/Wave 3 new wording survey - Raw.dta{rm}
saved
{p_end}

{com}. 
. *********************************************************************************
. 
. * merge data from before we changed question wording (on gov acting fast enough)
. import excel "$data/RCT wave 3/Raw/Wave 3 - High Freq 1_pre wording change for govt progress.xlsx", ///
> firstrow allstring clear
{res}{text}(137 vars, 900 obs)

{com}. 
. drop if _n==1 | _n==2
{txt}(2 observations deleted)

{com}. drop if Status=="Survey Preview" 
{txt}(9 observations deleted)

{com}. *| Status == "Spam"
. destring ExternalReference, replace
{txt}ExternalReference: all characters numeric; {res}replaced {txt}as {res}int
{txt}(3 missing values generated)
{res}{txt}
{com}. drop if ExternalReference==0
{txt}(23 observations deleted)

{com}. 
. keep ExternalReference P1_1 ResponseId
{txt}
{com}. rename P1_1 OLD_P1_1
{res}{txt}
{com}. 
. *  fix spacing issue 
. 
.         replace OLD_P1_1 = "Completely disagree" if OLD_P1_1 == "Completely disagree "
{txt}(2 real changes made)

{com}.         replace OLD_P1_1 = "Neither disagree nor agree" if OLD_P1_1 == "Neither disagree nor agree " ///
>                 | OLD_P1_1 == "Neither agree nor disagree" | OLD_P1_1 == "Neither agree nor disagree "
{txt}(3 real changes made)

{com}.         replace OLD_P1_1 = "Somewhat agree" if OLD_P1_1 == "Somewhat agree "
{txt}(9 real changes made)

{com}.         lab var OLD_P1_1 "Old version of 'gov working fast enough' qn"
{txt}
{com}.                                 
. * Generate numeric likert vars (1-completely disagree -> 5-completely agree)
. 
.         gen OLD_P1_1_likert = .
{txt}(866 missing values generated)

{com}.         replace OLD_P1_1_likert = 1 if OLD_P1_1 == "Completely disagree"
{txt}(2 real changes made)

{com}.         replace OLD_P1_1_likert = 2 if OLD_P1_1 == "Somewhat disagree"
{txt}(1 real change made)

{com}.         replace OLD_P1_1_likert = 3 if OLD_P1_1 == "Neither disagree nor agree" ///
>         | OLD_P1_1 == "Neither agree nor disagree"
{txt}(3 real changes made)

{com}.         replace OLD_P1_1_likert = 4 if OLD_P1_1 == "Somewhat agree"
{txt}(9 real changes made)

{com}.         replace OLD_P1_1_likert = 5 if OLD_P1_1 == "Completely agree"
{txt}(287 real changes made)

{com}.         label var OLD_P1_1_likert "Old version of 'gov working fast enough' qn - in likert scale"
{txt}
{com}. 
.         gen question_timing = 0
{txt}
{com}.         lab var question_timing "Original question wording for P1"
{txt}
{com}.         
. * merge into our latest data
. merge 1:1 ExternalReference ResponseId using ///
> "$data/RCT wave 3/Raw/Wave 3 new wording survey - Raw.dta"
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}             445
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}             445{txt}  (_merge==2)

{col 5}Matched{col 30}{res}             866{txt}  (_merge==3)
{col 5}{hline 41}

{com}. drop _merge
{txt}
{com}. 
. save "$data/RCT wave 3/Raw/Wave 3 full survey - Raw.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Raw/Wave 3 full survey - Raw.dta{rm}
saved
{p_end}

{com}.  
. *********************************************************************************
. 
. * pull in IDs from the 16 respondents that were dropped in wave 2 
. import excel "$missing16", firstrow allstring clear
{res}{text}(7 vars, 13 obs)

{com}. rename participantid ID
{res}{txt}
{com}. 
. save "$data/RCT wave 3/Raw/Wave 3 IDs for missing respondents_5Oct2022.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Raw/Wave 3 IDs for missing respondents_5Oct2022.dta{rm}
saved
{p_end}

{com}. 
. * pull in limited survey (new as of Oct 2022) to append to full main survey
. import excel "$rawdata_limited", firstrow allstring clear
{res}{text}(52 vars, 95 obs)

{com}. 
. foreach v of varlist * {c -(}
{txt}  2{com}.     local value = `v'[1]
{txt}  3{com}.         local vname = strtoname(`"`value'"')
{txt}  4{com}.     label var `v' `"`vname'"'
{txt}  5{com}. {c )-}
{txt}
{com}. 
. * drop out var label obs and test cases
. drop if _n==1 | _n==2
{txt}(2 observations deleted)

{com}. drop if Status=="Survey Preview" 
{txt}(3 observations deleted)

{com}. *| Status == "Spam"
. 
. * pull respondent ID from "email" list
. drop ExternalReference 
{txt}
{com}. gen ExternalReference = substr(RecipientEmail, 1, length(RecipientEmail) - 8)
{txt}(27 missing values generated)

{com}. 
. * give filler ID to missing IDs
. replace ExternalReference= "9" if RecipientEmail=="1@23.com"
{txt}(9 real changes made)

{com}. 
. * merge in the 16 missing IDs
. merge 1:1 StartDate EndDate Durationinseconds using ///
> "$data/RCT wave 3/Raw/Wave 3 IDs for missing respondents_5Oct2022.dta"
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}              77
{txt}{col 9}from master{col 30}{res}              77{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}Matched{col 30}{res}              13{txt}  (_merge==3)
{col 5}{hline 41}

{com}. drop _merge
{txt}
{com}. 
. replace ExternalReference = ID if ID!=""
{txt}(13 real changes made)

{com}. * test link was ".@123.com" - drop any of those
. drop if ExternalReference=="."
{txt}(1 observation deleted)

{com}. 
. ***************************** TO SOLVE ******************************************
. * NOTE: we have a couple cases where an anonymous link was used, and not matched to an ID, drop
. drop if ExternalReference==""
{txt}(5 observations deleted)

{com}. 
. /* NOTE: 'ideal age to have first child' format is wonky (perhaps from Arabic keyboard?) - 
> will have to drop weird responses */
. tab G13_7_TEXT

       {txt}In_your_opinion__what_is_the_ide {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                                     18 {c |}{res}          1        1.67        1.67
{txt}                                     20 {c |}{res}          2        3.33        5.00
{txt}                                     23 {c |}{res}          1        1.67        6.67
{txt}                                     24 {c |}{res}          3        5.00       11.67
{txt}                                     25 {c |}{res}         21       35.00       46.67
{txt}                                     26 {c |}{res}          7       11.67       58.33
{txt}                                     27 {c |}{res}          7       11.67       70.00
{txt}                                     28 {c |}{res}          7       11.67       81.67
{txt}                                     29 {c |}{res}          1        1.67       83.33
{txt}                                     30 {c |}{res}          7       11.67       95.00
{txt}                                     32 {c |}{res}          1        1.67       96.67
{txt}                                     35 {c |}{res}          2        3.33      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}         60      100.00
{txt}
{com}. *drop if strlen(G13_7_TEXT) > 3
. 
. *********************************************************************************
. 
. destring ExternalReference, replace 
{txt}ExternalReference: all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. 
. 
. * we changed the format of  Q133 to work with phone browser - rename to avoid confusion
. rename Q133 Q133_new
{res}{txt}
{com}. lab var Q133_new "Q133 reformatted for limited survey - society change pace"
{txt}
{com}. 
. * tag these observations
. gen short_survey = 1
{txt}
{com}. 
. append using "$data/RCT wave 3/Raw/Wave 3 full survey - Raw.dta"
{txt}{p 0 7 2}
(variable
{bf:M3} was {bf:str47}, now {bf:str116} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:N1} was {bf:str387}, now {bf:str454} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:N1_4_TEXT} was {bf:str387}, now {bf:str454} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:N3} was {bf:str389}, now {bf:str461} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:N3_1_TEXT} was {bf:str388}, now {bf:str460} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:E4} was {bf:str67}, now {bf:str126} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:E4_6_TEXT} was {bf:str74}, now {bf:str133} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G6_1} was {bf:str478}, now {bf:str644} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G6_2} was {bf:str483}, now {bf:str649} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G6_3} was {bf:str481}, now {bf:str647} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G8_1} was {bf:str475}, now {bf:str641} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G8_2} was {bf:str480}, now {bf:str646} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G8_3} was {bf:str478}, now {bf:str644} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G10_1} was {bf:str463}, now {bf:str629} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G10_2} was {bf:str468}, now {bf:str634} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:G10_3} was {bf:str466}, now {bf:str632} to accommodate using data's values)
{p_end}
{p 0 7 2}
(variable
{bf:P3} was {bf:str45}, now {bf:str59} to accommodate using data's values)
{p_end}

{com}. 
. 
. * save new raw dataset
. save "$data/RCT wave 3/Raw/Wave 3 - combined full and lim survey.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Raw/Wave 3 - combined full and lim survey.dta{rm}
saved
{p_end}

{com}. 
. 
. 
. ************
. * MERGE IN MISSING IDS FROM LIST OF SURVEY LINKS
. 
. import delimited "$missingids1", clear 
{res}{txt}(encoding automatically selected: ISO-8859-1)
{text}(5 vars, 72 obs)

{com}. 
. rename link Q_URL
{res}{txt}
{com}. keep responseid Q_URL
{txt}
{com}. merge 1:m Q_URL using "$data/RCT wave 3/Raw/Wave 3 - combined full and lim survey.dta"
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}           1,449
{txt}{col 9}from master{col 30}{res}              63{txt}  (_merge==1)
{col 9}from using{col 30}{res}           1,386{txt}  (_merge==2)

{col 5}Matched{col 30}{res}               9{txt}  (_merge==3)
{col 5}{hline 41}

{com}. drop if _merge==1
{txt}(63 observations deleted)

{com}. drop _merge
{txt}
{com}. 
. replace ExternalReference=responseid if ExternalReference==9
{txt}(9 real changes made)

{com}. 
. ************
. 
. *see if any observations started before official start date (6/1/2021)
. gen startmo = substr(StartDate, 1,6)
{txt}
{com}. tab startmo

    {txt}startmo {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
        1/5 {c |}{res}          2        0.14        0.14
{txt}        2/3 {c |}{res}         55        3.94        4.09
{txt}        3/2 {c |}{res}          4        0.29        4.37
{txt}        6/1 {c |}{res}         11        0.79        5.16
{txt}        6/2 {c |}{res}         34        2.44        7.60
{txt}        6/3 {c |}{res}         29        2.08        9.68
{txt}        6/4 {c |}{res}         14        1.00       10.68
{txt}        6/5 {c |}{res}         16        1.15       11.83
{txt}        6/6 {c |}{res}         25        1.79       13.62
{txt}        6/7 {c |}{res}         27        1.94       15.56
{txt}        6/8 {c |}{res}         15        1.08       16.63
{txt}        6/9 {c |}{res}         24        1.72       18.35
{txt}        7/1 {c |}{res}          5        0.36       18.71
{txt}        7/3 {c |}{res}          1        0.07       18.78
{txt}        7/4 {c |}{res}          6        0.43       19.21
{txt}        7/5 {c |}{res}          9        0.65       19.86
{txt}        7/6 {c |}{res}         24        1.72       21.58
{txt}        7/7 {c |}{res}         40        2.87       24.44
{txt}        7/8 {c |}{res}          4        0.29       24.73
{txt}        8/1 {c |}{res}          1        0.07       24.80
{txt}        8/2 {c |}{res}          4        0.29       25.09
{txt}        8/3 {c |}{res}          1        0.07       25.16
{txt}        8/4 {c |}{res}          8        0.57       25.73
{txt}        8/5 {c |}{res}          4        0.29       26.02
{txt}        8/8 {c |}{res}         14        1.00       27.03
{txt}        8/9 {c |}{res}         14        1.00       28.03
{txt}        9/1 {c |}{res}         10        0.72       28.75
{txt}        9/5 {c |}{res}          1        0.07       28.82
{txt}        9/6 {c |}{res}          5        0.36       29.18
{txt}        9/7 {c |}{res}          3        0.22       29.39
{txt}       1/1/ {c |}{res}         13        0.93       30.32
{txt}       1/13 {c |}{res}          4        0.29       30.61
{txt}       1/19 {c |}{res}          9        0.65       31.25
{txt}       1/23 {c |}{res}         10        0.72       31.97
{txt}       10/1 {c |}{res}          4        0.29       32.26
{txt}       10/2 {c |}{res}          4        0.29       32.54
{txt}       10/3 {c |}{res}          3        0.22       32.76
{txt}       10/4 {c |}{res}          2        0.14       32.90
{txt}       11/2 {c |}{res}          1        0.07       32.97
{txt}       11/3 {c |}{res}          4        0.29       33.26
{txt}       11/4 {c |}{res}         13        0.93       34.19
{txt}       11/7 {c |}{res}          3        0.22       34.41
{txt}       11/8 {c |}{res}          7        0.50       34.91
{txt}       11/9 {c |}{res}          5        0.36       35.27
{txt}       12/1 {c |}{res}          5        0.36       35.63
{txt}       12/2 {c |}{res}          4        0.29       35.91
{txt}       12/5 {c |}{res}          1        0.07       35.99
{txt}       12/7 {c |}{res}          1        0.07       36.06
{txt}       12/8 {c |}{res}          4        0.29       36.34
{txt}       2/16 {c |}{res}          7        0.50       36.85
{txt}       2/27 {c |}{res}          3        0.22       37.06
{txt}       2/28 {c |}{res}          1        0.07       37.13
{txt}       6/1/ {c |}{res}          5        0.36       37.49
{txt}       6/10 {c |}{res}         19        1.36       38.85
{txt}       6/12 {c |}{res}          2        0.14       39.00
{txt}       6/13 {c |}{res}         26        1.86       40.86
{txt}       6/14 {c |}{res}         28        2.01       42.87
{txt}       6/15 {c |}{res}          7        0.50       43.37
{txt}       6/16 {c |}{res}         13        0.93       44.30
{txt}       6/17 {c |}{res}         15        1.08       45.38
{txt}       6/18 {c |}{res}          3        0.22       45.59
{txt}       6/19 {c |}{res}         13        0.93       46.52
{txt}       6/2/ {c |}{res}          4        0.29       46.81
{txt}       6/20 {c |}{res}         19        1.36       48.17
{txt}       6/21 {c |}{res}         17        1.22       49.39
{txt}       6/22 {c |}{res}         13        0.93       50.32
{txt}       6/23 {c |}{res}         11        0.79       51.11
{txt}       6/24 {c |}{res}          6        0.43       51.54
{txt}       6/26 {c |}{res}          6        0.43       51.97
{txt}       6/27 {c |}{res}         18        1.29       53.26
{txt}       6/28 {c |}{res}          7        0.50       53.76
{txt}       6/29 {c |}{res}         14        1.00       54.77
{txt}       6/3/ {c |}{res}          1        0.07       54.84
{txt}       6/30 {c |}{res}         15        1.08       55.91
{txt}       6/5/ {c |}{res}          4        0.29       56.20
{txt}       6/6/ {c |}{res}         14        1.00       57.20
{txt}       6/7/ {c |}{res}         11        0.79       57.99
{txt}       6/8/ {c |}{res}          5        0.36       58.35
{txt}       6/9/ {c |}{res}          1        0.07       58.42
{txt}       7/1/ {c |}{res}          1        0.07       58.49
{txt}       7/12 {c |}{res}          1        0.07       58.57
{txt}       7/13 {c |}{res}          1        0.07       58.64
{txt}       7/14 {c |}{res}          4        0.29       58.92
{txt}       7/26 {c |}{res}         19        1.36       60.29
{txt}       7/28 {c |}{res}          4        0.29       60.57
{txt}       7/29 {c |}{res}         21        1.51       62.08
{txt}       7/3/ {c |}{res}          1        0.07       62.15
{txt}       7/4/ {c |}{res}          3        0.22       62.37
{txt}       7/5/ {c |}{res}          2        0.14       62.51
{txt}       7/6/ {c |}{res}          5        0.36       62.87
{txt}       7/7/ {c |}{res}          6        0.43       63.30
{txt}       7/8/ {c |}{res}          2        0.14       63.44
{txt}       7/9/ {c |}{res}          1        0.07       63.51
{txt}       8/1/ {c |}{res}          1        0.07       63.58
{txt}       8/11 {c |}{res}          4        0.29       63.87
{txt}       8/12 {c |}{res}          3        0.22       64.09
{txt}       8/2/ {c |}{res}          2        0.14       64.23
{txt}       8/23 {c |}{res}          1        0.07       64.30
{txt}       8/25 {c |}{res}          1        0.07       64.37
{txt}       8/27 {c |}{res}          2        0.14       64.52
{txt}       8/3/ {c |}{res}          1        0.07       64.59
{txt}       8/4/ {c |}{res}          2        0.14       64.73
{txt}       8/5/ {c |}{res}          2        0.14       64.87
{txt}       8/9/ {c |}{res}          5        0.36       65.23
{txt}       9/20 {c |}{res}          5        0.36       65.59
{txt}       9/21 {c |}{res}          3        0.22       65.81
{txt}       9/6/ {c |}{res}          2        0.14       65.95
{txt}      1/15/ {c |}{res}          1        0.07       66.02
{txt}      10/12 {c |}{res}          2        0.14       66.16
{txt}      10/14 {c |}{res}          1        0.07       66.24
{txt}      10/17 {c |}{res}          3        0.22       66.45
{txt}      10/18 {c |}{res}         10        0.72       67.17
{txt}      10/19 {c |}{res}         13        0.93       68.10
{txt}      10/20 {c |}{res}          9        0.65       68.75
{txt}      10/21 {c |}{res}          4        0.29       69.03
{txt}      10/22 {c |}{res}          1        0.07       69.10
{txt}      10/23 {c |}{res}          2        0.14       69.25
{txt}      10/24 {c |}{res}          3        0.22       69.46
{txt}      10/25 {c |}{res}          6        0.43       69.89
{txt}      10/26 {c |}{res}         14        1.00       70.90
{txt}      10/27 {c |}{res}          6        0.43       71.33
{txt}      10/28 {c |}{res}         13        0.93       72.26
{txt}      10/31 {c |}{res}         17        1.22       73.48
{txt}      11/1/ {c |}{res}          5        0.36       73.84
{txt}      11/10 {c |}{res}          2        0.14       73.98
{txt}      11/11 {c |}{res}          2        0.14       74.12
{txt}      11/16 {c |}{res}          1        0.07       74.19
{txt}      11/20 {c |}{res}         15        1.08       75.27
{txt}      11/22 {c |}{res}          1        0.07       75.34
{txt}      11/23 {c |}{res}          1        0.07       75.41
{txt}      11/28 {c |}{res}          1        0.07       75.48
{txt}      11/29 {c |}{res}          5        0.36       75.84
{txt}      11/3/ {c |}{res}          5        0.36       76.20
{txt}      11/30 {c |}{res}          2        0.14       76.34
{txt}      11/5/ {c |}{res}          1        0.07       76.42
{txt}      11/7/ {c |}{res}          2        0.14       76.56
{txt}      11/8/ {c |}{res}          6        0.43       76.99
{txt}      11/9/ {c |}{res}          8        0.57       77.56
{txt}      12/1/ {c |}{res}          2        0.14       77.71
{txt}      12/12 {c |}{res}          2        0.14       77.85
{txt}      12/13 {c |}{res}         22        1.58       79.43
{txt}      12/14 {c |}{res}          4        0.29       79.71
{txt}      12/15 {c |}{res}         10        0.72       80.43
{txt}      12/18 {c |}{res}         11        0.79       81.22
{txt}      12/19 {c |}{res}          2        0.14       81.36
{txt}      12/20 {c |}{res}          2        0.14       81.51
{txt}      12/21 {c |}{res}          6        0.43       81.94
{txt}      12/22 {c |}{res}          4        0.29       82.22
{txt}      12/29 {c |}{res}          4        0.29       82.51
{txt}      12/6/ {c |}{res}          2        0.14       82.65
{txt}      12/8/ {c |}{res}          6        0.43       83.08
{txt}      2/28/ {c |}{res}          1        0.07       83.15
{txt}      6/10/ {c |}{res}          1        0.07       83.23
{txt}      6/11/ {c |}{res}          1        0.07       83.30
{txt}      6/12/ {c |}{res}          2        0.14       83.44
{txt}      6/13/ {c |}{res}          9        0.65       84.09
{txt}      6/14/ {c |}{res}          6        0.43       84.52
{txt}      6/15/ {c |}{res}          4        0.29       84.80
{txt}      6/16/ {c |}{res}          2        0.14       84.95
{txt}      6/17/ {c |}{res}         15        1.08       86.02
{txt}      6/19/ {c |}{res}          3        0.22       86.24
{txt}      6/20/ {c |}{res}         10        0.72       86.95
{txt}      6/21/ {c |}{res}          1        0.07       87.03
{txt}      6/22/ {c |}{res}          6        0.43       87.46
{txt}      6/23/ {c |}{res}         10        0.72       88.17
{txt}      6/24/ {c |}{res}          1        0.07       88.24
{txt}      6/26/ {c |}{res}          4        0.29       88.53
{txt}      6/27/ {c |}{res}          7        0.50       89.03
{txt}      6/28/ {c |}{res}          7        0.50       89.53
{txt}      6/29/ {c |}{res}          6        0.43       89.96
{txt}      6/30/ {c |}{res}          1        0.07       90.04
{txt}      7/11/ {c |}{res}          4        0.29       90.32
{txt}      7/13/ {c |}{res}          2        0.14       90.47
{txt}      7/14/ {c |}{res}          5        0.36       90.82
{txt}      7/27/ {c |}{res}          1        0.07       90.90
{txt}      7/29/ {c |}{res}          1        0.07       90.97
{txt}      8/10/ {c |}{res}          8        0.57       91.54
{txt}      8/12/ {c |}{res}          4        0.29       91.83
{txt}      8/15/ {c |}{res}          2        0.14       91.97
{txt}      8/17/ {c |}{res}          6        0.43       92.40
{txt}      8/18/ {c |}{res}          4        0.29       92.69
{txt}      8/29/ {c |}{res}          1        0.07       92.76
{txt}     10/11/ {c |}{res}          1        0.07       92.83
{txt}     10/12/ {c |}{res}          1        0.07       92.90
{txt}     10/13/ {c |}{res}          6        0.43       93.33
{txt}     10/17/ {c |}{res}          2        0.14       93.48
{txt}     10/19/ {c |}{res}          1        0.07       93.55
{txt}     10/22/ {c |}{res}          2        0.14       93.69
{txt}     10/23/ {c |}{res}          4        0.29       93.98
{txt}     10/24/ {c |}{res}          6        0.43       94.41
{txt}     10/25/ {c |}{res}          3        0.22       94.62
{txt}     10/26/ {c |}{res}          5        0.36       94.98
{txt}     10/27/ {c |}{res}          5        0.36       95.34
{txt}     10/31/ {c |}{res}          4        0.29       95.63
{txt}     11/10/ {c |}{res}          1        0.07       95.70
{txt}     11/15/ {c |}{res}          8        0.57       96.27
{txt}     11/16/ {c |}{res}          4        0.29       96.56
{txt}     11/17/ {c |}{res}          3        0.22       96.77
{txt}     11/18/ {c |}{res}          3        0.22       96.99
{txt}     11/19/ {c |}{res}          4        0.29       97.28
{txt}     11/21/ {c |}{res}          5        0.36       97.63
{txt}     11/22/ {c |}{res}          3        0.22       97.85
{txt}     12/12/ {c |}{res}          5        0.36       98.21
{txt}     12/13/ {c |}{res}          7        0.50       98.71
{txt}     12/19/ {c |}{res}          4        0.29       99.00
{txt}     12/20/ {c |}{res}          5        0.36       99.35
{txt}     12/21/ {c |}{res}          9        0.65      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      1,395      100.00
{txt}
{com}. 
. * Resolve duplicate IDs by taking the most recent value for each observation
. generate double EndDate2 = clock(EndDate, "MDYhm")
{txt}
{com}. format EndDate2 %tc
{txt}
{com}. lab var EndDate2 "EndDate as date and time var"
{txt}
{com}. 
. 
. sort ExternalReference EndDate2 Durationinseconds               // Aug2,2023 update: added Durationinseconds as an additional sort var because it gives a unique sort 
{txt}
{com}. collapse (lastnm) responseid-FL_37_DO short_survey-EndDate2, by(ExternalReference)
{res}{txt}
{com}. 
. 
. * Add time trend for question wording for new wording
. replace question_timing=1 if question_timing==.
{txt}(191 real changes made)

{com}. 
. * Flag observations that we know are completed surveys
. gen start_survey_w3 = 1
{txt}
{com}. replace start_survey_w3 = 0 if C2!="Yes"
{txt}(107 real changes made)

{com}. replace start_survey_w3 = 1  if M1!="" | E1!="" | G1_1!="" | R1!=""             // old version used M4_1_TEXT!=""
{txt}(2 real changes made)

{com}. lab var start_survey_w3 "Started wave 3 survey"
{txt}
{com}. 
. * we have one blank observation that got left in
. drop if ExternalReference==.
{txt}(1 observation deleted)

{com}. 
. 
. 
. * update naming of participantid from survey
. destring participantid, replace 
{txt}participantid: all characters numeric; {res}replaced {txt}as {res}int
{txt}(13 missing values generated)
{res}{txt}
{com}. 
. rename participantid pid_verified 
{res}{txt}
{com}.         lab var pid_verified "Participant ID from embedded data"
{txt}
{com}.         destring pid_verified, replace
{txt}pid_verified already numeric; no {res}replace
{txt}
{com}.         
.         rename ExternalReference participantid 
{res}{txt}
{com}.         lab var participantid "Participant ID"
{txt}
{com}. 
. * Save so we can merge in waves 1 and 2
. save "$data/RCT wave 3/Cleaned/Wave3_combinedrawdata.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Cleaned/Wave3_combinedrawdata.dta{rm}
saved
{p_end}

{com}. 
. *****************************************************************
. * SECTION 2 - MERGE IN DATA FROM WAVES 1 AND 2
. *****************************************************************
. 
.  use "$data/RCT wave 2/Final/Combined_waves1and2_final.dta", clear
{txt}
{com}.  
.         * let's remove observations that have been excluded from the sample (sample = 606)
.         drop if Excluded==1
{txt}(456 observations deleted)

{com}.         
.         * there is also a blank observation - drop this
.         drop if participantid==.
{txt}(0 observations deleted)

{com}.         
.         
.         * Merge into wave 3 data
.         merge 1:1 participantid using "$data/RCT wave 3/Cleaned/Wave3_combinedrawdata.dta"
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}              14
{txt}{col 9}from master{col 30}{res}               3{txt}  (_merge==1)
{col 9}from using{col 30}{res}              11{txt}  (_merge==2)

{col 5}Matched{col 30}{res}             603{txt}  (_merge==3)
{col 5}{hline 41}

{com}.         
.         * some Excluded participants got called in this survey, let's drop them
.         drop if _merge==2
{txt}(11 observations deleted)

{com}.         drop _merge
{txt}
{com}.         
.         lab var participantid "Participant ID"
{txt}
{com}.         
.         * let's save this combined dataset
.         save "$data/RCT wave 3/Cleaned/Wave3raw_mergedwaves1and2.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Cleaned/Wave3raw_mergedwaves1and2.dta{rm}
saved
{p_end}

{com}. 
. 
. *****************************************************************
. * SECTION 3 - DATA CLEANING
. *****************************************************************
. 
.         * create treatment var
.         gen treatment = 0 if inlist(treat,0,2)
{txt}(375 missing values generated)

{com}.         replace treatment = 1 if inlist(treat,1,3)
{txt}(375 real changes made)

{com}.         lab var treatment "Treatment"
{txt}
{com}. 
.         
. 
. ***************************************
. * GENDER ATTITUDES
. ***************************************
. 
.         * labelling
.         lab var  G1_1 "GA 1st: OK to put own needs above those of family - likert (wave 3)"
{txt}
{com}.         lab var G1_2 "GA 1st: Doesn't need permission to meet a friend outside home - likert (wave 3)"
{txt}
{com}.         lab var G1_3 "GA 1st: Doesn't need permission to make a purchase - likert (wave 3)"
{txt}
{com}.         lab var G5_1 "GA 1st: Men make better business execs than women - likert (wave 3)"
{txt}
{com}.         lab var G6_1 "GA 2nd - male fam: Men make better business execs than women - likert (wave 3)"
{txt}
{com}.         lab var G6_2 "GA 2nd - fem net: Men make better business execs than women - likert (wave 3)"
{txt}
{com}.         lab var G6_3 "GA 2nd - male net: Men make better business execs than women - likert (wave 3)"
{txt}
{com}.         lab var G7_1 "GA 1st: woman's priority should be home - likert (wave 3)"
{txt}
{com}.         lab var G8_1 "GA 2nd - male fam: woman's priority should be home - likert (wave 3)"
{txt}
{com}.         lab var G8_2 "GA 2nd - fem net: woman's priority should be home - likert (wave 3)"
{txt}
{com}.         lab var G8_3 "GA 2nd - male net: woman's priority should be home - likert (wave 3)"
{txt}
{com}.         lab var G9_1 "GA 1st: when mother works, children suffer - likert (wave 3)"
{txt}
{com}.         lab var G10_1 "GA 2nd - male fam: when mother works, children suffer - likert (wave 3)"
{txt}
{com}.         lab var G10_2 "GA 2nd - fem net: when mother works, children suffer - likert (wave 3)"
{txt}
{com}.         lab var G10_3 "GA 2nd - male net: when mother works, children suffer - likert (wave 3)"
{txt}
{com}.         lab var G13_7_TEXT "Ideal age to have first child (wave 3)"
{txt}
{com}.         lab var Q133_new "wording update: pave of change is fast enough to give women same rights and doesn't need to be faster (wave 3)"
{txt}note: label truncated to 80 characters

{com}.         lab var Q134 "Prefer gender reforms to move slower (wave 3)" 
{txt}
{com}.         lab var P3 "Voting in the next municipal election (wave 3)" 
{txt}
{com}.         lab var question_timing "Original question wording for P1"
{txt}
{com}.         lab var G3_1 "GA 1st: Education is more important for a boy than a girl - likert (wave 3)"
{txt}
{com}.         lab var G4_1 "GA 2nd - male fam: Education is more important for a boy than a girl - likert (wave 3)"
{txt}note: label truncated to 80 characters

{com}.         lab var G4_2 "GA 2nd - fem net: Education is more important for a boy than a girl - likert (wave 3)"
{txt}note: label truncated to 80 characters

{com}.         lab var G4_3 "GA 2nd - male net: Education is more important for a boy than a girl - likert (wave 3)"
{txt}note: label truncated to 80 characters

{com}.         lab var G11 "Desired edu for hypothetical daughter/granddaughter (wave 3)"
{txt}
{com}.         lab var G12 "Desire for hypothetical daughter/granddaughter to work (wave 3)"
{txt}
{com}.         lab var G14 "Groups belong to (wave 3)"
{txt}
{com}.         lab var G15 "Number of times in past month attended meetings of groups belonging to (wave 3)"
{txt}
{com}.         lab var P1_1 "Government/society is moving fast enough to make women'ss rights same as men's (wave 3)"
{txt}note: label truncated to 80 characters

{com}.         
. 
. 
. * rename P1_1 and P2_2 to match var names from before we changed the question
.         rename P1_2 P1_3
{res}{txt}
{com}.         lab var P1_3 "Gov should allow a women's soccer team - likert (wave 3)"
{txt}
{com}.         rename P1_1 P1_2
{res}{txt}
{com}.         lab var P1_2 "Feels impact of changes gov is making to give women same rights as men - likert (wave 3)"
{txt}note: label truncated to 80 characters

{com}. 
.         
. * Now update Q133 to match P1_1 from orig version (before we changed the wording of that question)
. rename Q133_1 P1_1
{res}{txt}
{com}. 
. gen P1_1_likert = 1 if P1_1=="5"
{txt}(567 missing values generated)

{com}. replace P1_1_likert = 2 if P1_1=="4"
{txt}(6 real changes made)

{com}. replace P1_1_likert = 3 if P1_1=="3"
{txt}(11 real changes made)

{com}. replace P1_1_likert = 4 if P1_1=="2"
{txt}(6 real changes made)

{com}. replace P1_1_likert = 5 if P1_1=="1"
{txt}(57 real changes made)

{com}. lab var P1_1_likert "society moving fast enough to give equal rights to women (disagree...agree) (wave 3)"
{txt}note: label truncated to 80 characters

{com}. 
. *** NEW ADDITION WITH LIMITED SURVEY ***
. * incorporate new revision that occured with limited survey
. 
. gen P_1_1_limited = 1 if Q133_new=="Completely agree with Statement B"
{txt}(606 missing values generated)

{com}. replace P_1_1_limited = 2 if Q133_new=="Mostly agree with Statement B"
{txt}(10 real changes made)

{com}. replace P_1_1_limited = 3 if Q133_new=="Neutral between Statement A and Statement B"
{txt}(12 real changes made)

{com}. replace P_1_1_limited = 4 if Q133_new=="Mostly agree with Statement A"
{txt}(6 real changes made)

{com}. replace P_1_1_limited = 5 if Q133_new=="Completely agree with Statement A"
{txt}(26 real changes made)

{com}. lab var P_1_1_limited "Pace of society change - limited survey version (wave 3)"
{txt}
{com}. 
. * Now let's merge the old version of the question with the new version
. gen Combined_P1_1_likert = P1_1_likert
{txt}(487 missing values generated)

{com}. replace Combined_P1_1_likert = OLD_P1_1_likert if P1_1_likert==. & OLD_P1_1_likert!=.
{txt}(291 real changes made)

{com}. replace Combined_P1_1_likert = P_1_1_limited if P1_1_likert==. & P_1_1_limited!=.
{txt}(54 real changes made)

{com}. lab var Combined_P1_1_likert "Combined old and new versions of 'society moving fast enough' qn (wave 3)"
{txt}
{com}. 
. 
.         * first fix spacing issue 
.         
.         global text_fix G1_1 G1_2 G1_3  P1_2 P1_3
{txt}
{com}.         
.         foreach var of global text_fix {c -(}
{txt}  2{com}.                 replace `var' = "Completely disagree" if `var' == "Completely disagree "
{txt}  3{com}.                 replace `var' = "Neither disagree nor agree" if `var' == "Neither disagree nor agree " | `var' == "Neither agree nor disagree" | `var' == "Neither agree nor disagree "
{txt}  4{com}.                 replace `var' = "Somewhat agree" if `var' == "Somewhat agree "
{txt}  5{com}.                 {c )-}
{txt}(236 real changes made)
(42 real changes made)
(89 real changes made)
(240 real changes made)
(18 real changes made)
(55 real changes made)
(153 real changes made)
(25 real changes made)
(72 real changes made)
(3 real changes made)
(14 real changes made)
(43 real changes made)
(180 real changes made)
(85 real changes made)
(70 real changes made)

{com}.                                 
.         * Generate numeric likert vars (1-completely disagree -> 5-completely agree)
.         
.         global likert_GA G1_1 G1_2 G1_3 P1_2 P1_3
{txt}
{com}.         
.         foreach var of global likert_GA {c -(}
{txt}  2{com}.                 gen `var'_likert = .
{txt}  3{com}.                 replace `var'_likert = 1 if `var' == "Completely disagree"
{txt}  4{com}.                 replace `var'_likert = 2 if `var' == "Somewhat disagree"
{txt}  5{com}.                 replace `var'_likert = 3 if `var' == "Neither disagree nor agree" | `var' == "Neither agree nor disagree"
{txt}  6{com}.                 replace `var'_likert = 4 if `var' == "Somewhat agree"
{txt}  7{com}.                 replace `var'_likert = 5 if `var' == "Completely agree"
{txt}  8{com}.                 label var `var'_likert "`var' in likert scale (wave 3)"
{txt}  9{com}.                 
.                 xtile `var'_abovemed = `var'_likert, nq(2)
{txt} 10{com}.                 recode `var'_abovemed (1 = 0) (2 = 1)
{txt} 11{com}.                 lab var `var'_abovemed "`var' - binary at median (wave 3)"
{txt} 12{com}.                 
.                 * for binaries
.                 sum `var'_abovemed if treatment==0 
{txt} 13{com}.                 gen `var'_abovemed_st = . 
{txt} 14{com}.                 replace `var'_abovemed_st = (`var'_abovemed-r(mean))/r(sd)
{txt} 15{com}.                 lab var `var'_abovemed_st "`var' - centered/standardized binary at median (wave 3)"
{txt} 16{com}.                 
.                 * for likert version
.                 sum `var'_likert if treatment==0 
{txt} 17{com}.                 gen `var'_likert_st = .
{txt} 18{com}.                 replace `var'_likert_st = (`var'_likert - r(mean))/r(sd)
{txt} 19{com}.                 lab var `var'_likert_st "`var' - center/standardized likert (wave 3)"
{txt} 20{com}. 
.         {c )-}
{txt}(606 missing values generated)
(236 real changes made)
(56 real changes made)
(42 real changes made)
(89 real changes made)
(67 real changes made)
(490 changes made to {bf:G1_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G1_1_above~d {c |}{res}        184    .3478261      .47758          0          1
{txt}(606 missing values generated)
(490 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G1_1_likert {c |}{res}        184    2.201087    1.549828          1          5
{txt}(606 missing values generated)
(490 real changes made)
(606 missing values generated)
(240 real changes made)
(59 real changes made)
(18 real changes made)
(55 real changes made)
(116 real changes made)
(488 changes made to {bf:G1_2_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G1_2_above~d {c |}{res}        183    .3442623    .4764306          0          1
{txt}(606 missing values generated)
(488 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G1_2_likert {c |}{res}        183    2.398907    1.703067          1          5
{txt}(606 missing values generated)
(488 real changes made)
(606 missing values generated)
(153 real changes made)
(22 real changes made)
(25 real changes made)
(72 real changes made)
(214 real changes made)
(486 changes made to {bf:G1_3_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G1_3_above~d {c |}{res}        182    .4835165    .5011068          0          1
{txt}(606 missing values generated)
(486 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G1_3_likert {c |}{res}        182    3.412088    1.790233          1          5
{txt}(606 missing values generated)
(486 real changes made)
(606 missing values generated)
(3 real changes made)
(12 real changes made)
(14 real changes made)
(43 real changes made)
(412 real changes made)
(484 changes made to {bf:P1_2_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P1_2_above~d {c |}{res}        179           0           0          0          0
{txt}(606 missing values generated)
(0 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}P1_2_likert {c |}{res}        179    4.798883    .6304973          1          5
{txt}(606 missing values generated)
(484 real changes made)
(606 missing values generated)
(180 real changes made)
(36 real changes made)
(85 real changes made)
(70 real changes made)
(110 real changes made)
(481 changes made to {bf:P1_3_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P1_3_above~d {c |}{res}        178    .3820225    .4872526          0          1
{txt}(606 missing values generated)
(481 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}P1_3_likert {c |}{res}        178    2.775281    1.651931          1          5
{txt}(606 missing values generated)
(481 real changes made)

{com}.         
.         * Now add Combined_P1_1_likert
.         xtile P1_1_abovemed = Combined_P1_1_likert, nq(2)
{txt}
{com}.                 recode P1_1_abovemed (1 = 0) (2 = 1)
{txt}(464 changes made to {bf:P1_1_abovemed})

{com}.                 lab var P1_1_abovemed "society moving fast enough - binary at median (wave 3)"
{txt}
{com}.                 
.                 * for binary
.                 sum P1_1_abovemed if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P1_1_above~d {c |}{res}        169           0           0          0          0
{txt}
{com}.                 gen P1_1_abovemed_st = .
{txt}(606 missing values generated)

{com}.                 replace P1_1_abovemed_st = (P1_1_abovemed-r(mean))/r(sd)
{txt}(0 real changes made)

{com}.                 lab var P1_1_abovemed_st "society moving fast enough - centered/standardized binary at median (wave 3)"
{txt}
{com}.                 
.                 * for likert version
.                 sum Combined_P1_1_likert if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
Combined_P~t {c |}{res}        169    4.508876    1.134514          1          5
{txt}
{com}.                 gen Combined_P1_1_likert_st = .
{txt}(606 missing values generated)

{com}.                 replace Combined_P1_1_likert_st = (Combined_P1_1_likert - r(mean))/r(sd)
{txt}(464 real changes made)

{com}.                 lab var Combined_P1_1_likert_st "Combined_P1_1 - center/standardized likert (wave 3)"
{txt}
{com}.         
.                 
.         
.         /* Anomalies: some binaries end up with just one value because too much gets 
>                 placed on one end of the likert scale - let's manually adjust these */
.                         
.                 * P1_1  
.                 drop P1_1_abovemed P1_1_abovemed_st
{txt}
{com}.                 sum Combined_P1_1_likert, detail

      {txt}Combined old and new versions of 'society moving
                  fast enough' qn (wave 3)
{hline 61}
      Percentiles      Smallest
 1%    {res}        1              1
{txt} 5%    {res}        1              1
{txt}10%    {res}        2              1       {txt}Obs         {res}        464
{txt}25%    {res}        5              1       {txt}Sum of wgt. {res}        464

{txt}50%    {res}        5                      {txt}Mean          {res}  4.37931
                        {txt}Largest       Std. dev.     {res} 1.277181
{txt}75%    {res}        5              5
{txt}90%    {res}        5              5       {txt}Variance      {res} 1.631191
{txt}95%    {res}        5              5       {txt}Skewness      {res}-1.862647
{txt}99%    {res}        5              5       {txt}Kurtosis      {res} 4.912985
{txt}
{com}.                 scalar med = r(p50)
{txt}
{com}.                 gen P1_1_abovemed = 1 if Combined_P1_1_likert>=med & Combined_P1_1_likert!=.
{txt}(247 missing values generated)

{com}.                 replace P1_1_abovemed = 0 if Combined_P1_1_likert<med & Combined_P1_1_likert!=.
{txt}(105 real changes made)

{com}.                 lab var P1_1_abovemed "society moving fast enough - binary at mean (wave 3)"
{txt}
{com}.                 
.                 sum P1_1_abovemed if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P1_1_above~d {c |}{res}        169    .8047337    .3975836          0          1
{txt}
{com}.                 gen P1_1_abovemed_st =.
{txt}(606 missing values generated)

{com}.                 replace P1_1_abovemed_st = (P1_1_abovemed-r(mean))/r(sd)
{txt}(464 real changes made)

{com}.                 lab var P1_1_abovemed_st "society moving fast enough - centered/standardized binary at mean (wave 3)"
{txt}
{com}.                 
.                                 
.                 * P1_2
.                 drop P1_2_abovemed P1_2_abovemed_st
{txt}
{com}.                 sum P1_2_likert, detail

                {txt}P1_2 in likert scale (wave 3)
{hline 61}
      Percentiles      Smallest
 1%    {res}        2              1
{txt} 5%    {res}        3              1
{txt}10%    {res}        4              1       {txt}Obs         {res}        484
{txt}25%    {res}        5              2       {txt}Sum of wgt. {res}        484

{txt}50%    {res}        5                      {txt}Mean          {res} 4.754132
                        {txt}Largest       Std. dev.     {res} .6836477
{txt}75%    {res}        5              5
{txt}90%    {res}        5              5       {txt}Variance      {res} .4673742
{txt}95%    {res}        5              5       {txt}Skewness      {res}-3.225686
{txt}99%    {res}        5              5       {txt}Kurtosis      {res} 13.62241
{txt}
{com}.                 scalar med = r(p50)
{txt}
{com}.                 gen P1_2_abovemed = 1 if P1_2_likert>=med & P1_2_likert!=.
{txt}(194 missing values generated)

{com}.                 replace P1_2_abovemed = 0 if P1_2_likert<med & P1_2_likert!=.
{txt}(72 real changes made)

{com}.                 lab var P1_2_abovemed "Feels impact of changes gov is making - binary at mean (wave 3)"
{txt}
{com}.                 
.                 sum P1_2_abovemed if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P1_2_above~d {c |}{res}        179     .877095    .3292491          0          1
{txt}
{com}.                 gen P1_2_abovemed_st =.
{txt}(606 missing values generated)

{com}.                 replace P1_2_abovemed_st = (P1_2_abovemed-r(mean))/r(sd)
{txt}(484 real changes made)

{com}.                 lab var P1_2_abovemed_st "Feels impact of changes gov is making-centered/standardized binary at mean (wave 3)"
{txt}note: label truncated to 80 characters

{com}.                         
.         * Preference for even slower gender reforms (Q134)
.         gen slower_reforms_Q134 = 1 if Q134=="Yes, I would like these social changes to move slower"
{txt}(549 missing values generated)

{com}.         replace slower_reforms_Q134 = 0 if Q134=="No, I do not want these social changes to move any slower"
{txt}(106 real changes made)

{com}.         lab val slower_reforms_Q134 yesno
{txt}
{com}.         lab var slower_reforms_Q134 "Would you prefer even slower gender reforms? (wave 3)"
{txt}
{com}.         
.         
.         * Generate numeric likert vars that are reversed for consistency (1-completely agree -> 5-completely disagree) 
.         global likert_reverse_GA G7_1 G9_1 G3_1 G5_1
{txt}
{com}.         
.         foreach var of global likert_reverse_GA {c -(}
{txt}  2{com}.                 gen `var'_likert_reverse = .
{txt}  3{com}.                 replace `var'_likert_reverse = 5 if `var' == "Completely disagree"
{txt}  4{com}.                 replace `var'_likert_reverse = 4 if `var' == "Somewhat disagree"
{txt}  5{com}.                 replace `var'_likert_reverse = 3 if `var' == "Neither disagree nor agree" ///
>                 | `var' == "Neither agree nor disagree"
{txt}  6{com}.                 replace `var'_likert_reverse = 2 if `var' == "Somewhat agree"
{txt}  7{com}.                 replace `var'_likert_reverse = 1 if `var' == "Completely agree"
{txt}  8{com}.                 label var `var'_likert_reverse "`var' in reversed likert scale (wave 3)"        
{txt}  9{com}.                 
.                 xtile `var'_abovemed = `var'_likert_reverse, nq(2)
{txt} 10{com}.                 recode `var'_abovemed (1 = 0) (2 = 1)
{txt} 11{com}.                 lab var `var'_abovemed "`var' - binary at median (wave 3)"
{txt} 12{com}.                 
.                 * for binaries
.                 sum `var'_abovemed if treatment==0 
{txt} 13{com}.                 gen `var'_abovemed_st = .
{txt} 14{com}.                 replace `var'_abovemed_st = (`var'_abovemed-r(mean))/r(sd)
{txt} 15{com}.                 lab var `var'_abovemed_st "`var' - centered/standardized binary at median (wave 3)"
{txt} 16{com}.                 
.                 * for likert version
.                 sum `var'_likert_reverse if treatment==0 
{txt} 17{com}.                 gen `var'_likert_reverse_st = .
{txt} 18{com}.                 replace `var'_likert_reverse_st = (`var'_likert_reverse - r(mean))/r(sd)
{txt} 19{com}.                 lab var `var'_likert_reverse_st "`var' - center/standardized likert (wave 3)"
{txt} 20{com}.                 
.         {c )-}
{txt}(606 missing values generated)
(113 real changes made)
(44 real changes made)
(53 real changes made)
(94 real changes made)
(182 real changes made)
(486 changes made to {bf:G7_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G7_1_above~d {c |}{res}        181    .3922652    .4896097          0          1
{txt}(606 missing values generated)
(486 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G7_1_liker~e {c |}{res}        181    2.497238    1.558576          1          5
{txt}(606 missing values generated)
(486 real changes made)
(606 missing values generated)
(75 real changes made)
(61 real changes made)
(88 real changes made)
(121 real changes made)
(137 real changes made)
(482 changes made to {bf:G9_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G9_1_above~d {c |}{res}        179    .4692737    .5004549          0          1
{txt}(606 missing values generated)
(482 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G9_1_liker~e {c |}{res}        179    2.569832    1.491318          1          5
{txt}(606 missing values generated)
(482 real changes made)
(606 missing values generated)
(341 real changes made)
(15 real changes made)
(29 real changes made)
(12 real changes made)
(20 real changes made)
(417 changes made to {bf:G3_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G3_1_above~d {c |}{res}        147           0           0          0          0
{txt}(606 missing values generated)
(0 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G3_1_liker~e {c |}{res}        147    4.659864    .8797306          1          5
{txt}(606 missing values generated)
(417 real changes made)
(606 missing values generated)
(147 real changes made)
(56 real changes made)
(109 real changes made)
(61 real changes made)
(114 real changes made)
(487 changes made to {bf:G5_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G5_1_above~d {c |}{res}        182    .4340659    .4970009          0          1
{txt}(606 missing values generated)
(487 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G5_1_liker~e {c |}{res}        182    3.181319    1.557403          1          5
{txt}(606 missing values generated)
(487 real changes made)

{com}. 
. *XTILE FOR G3_1 RETURNS SINGLE-VAL VARIABLE, RECREATE THAT VAR
.                 drop G3_1_abovemed G3_1_abovemed_st 
{txt}
{com}.                 
.                 
.                 sum G3_1_likert_reverse, detail

           {txt}G3_1 in reversed likert scale (wave 3)
{hline 61}
      Percentiles      Smallest
 1%    {res}        1              1
{txt} 5%    {res}        2              1
{txt}10%    {res}        3              1       {txt}Obs         {res}        417
{txt}25%    {res}        5              1       {txt}Sum of wgt. {res}        417

{txt}50%    {res}        5                      {txt}Mean          {res} 4.546763
                        {txt}Largest       Std. dev.     {res} 1.066692
{txt}75%    {res}        5              5
{txt}90%    {res}        5              5       {txt}Variance      {res} 1.137832
{txt}95%    {res}        5              5       {txt}Skewness      {res}-2.317213
{txt}99%    {res}        5              5       {txt}Kurtosis      {res} 7.168285
{txt}
{com}.                 scalar med = r(p50)
{txt}
{com}.                 gen G3_1_abovemed = 1 if G3_1_likert_reverse>=med & G3_1_likert_reverse!=.
{txt}(265 missing values generated)

{com}.                 replace G3_1_abovemed = 0 if G3_1_likert_reverse<med & G3_1_likert_reverse!=.
{txt}(76 real changes made)

{com}.                 lab var G3_1_abovemed "G3 - binary at median (created using mean) (wave 3)"
{txt}
{com}.                 
.                 sum G3_1_abovemed if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G3_1_above~d {c |}{res}        147    .8367347    .3708712          0          1
{txt}
{com}.                 gen G3_1_abovemed_st =.
{txt}(606 missing values generated)

{com}.                 replace G3_1_abovemed_st = (G3_1_abovemed-r(mean))/r(sd)
{txt}(417 real changes made)

{com}.                 lab var G3_1_abovemed_st "G3 - centered/standardized binary at median (created using mean) (wave 3)"
{txt}
{com}. 
.                 
.                 * Voting
.         
.         gen P3_scale = .
{txt}(606 missing values generated)

{com}.         replace P3_scale = 1 if inlist(P3, "Definitely no", "I do not know how to vote", ///
>                 "I do not know about any elections")
{txt}(188 real changes made)

{com}.         replace P3_scale = 2 if P3 == "Probably no"
{txt}(45 real changes made)

{com}.         replace P3_scale = 3 if P3 == "Unsure"
{txt}(31 real changes made)

{com}.         replace P3_scale = 4 if P3 == "Probably yes"
{txt}(117 real changes made)

{com}.         replace P3_scale = 5 if P3 == "Definitely yes"
{txt}(100 real changes made)

{com}.         label var P3_scale "Voting in the next election, numeric scale for likert (wave 3)"
{txt}
{com}.         
.                 * center/standardize for index
.                 sum P3_scale if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 4}P3_scale {c |}{res}        177     2.79661    1.662894          1          5
{txt}
{com}.                 gen P3_scale_st = .
{txt}(606 missing values generated)

{com}.                 replace P3_scale_st = (P3_scale-r(mean))/r(sd)
{txt}(481 real changes made)

{com}.                 lab var P3_scale_st "P3 (Will vote) - centered/standardized binary at median (wave 3)"
{txt}
{com}. 
.         * Generate vars for proportion of male family/women in community/men in community/men
.         
.         global proportions_GA G4_1 G4_2 G4_3 G6_1 G6_2 G6_3 G8_1 G8_2 G8_3 G10_1 G10_2 G10_3
{txt}
{com}.         
.         foreach var of global proportions_GA {c -(}
{txt}  2{com}.                 gen `var'_propor = .
{txt}  3{com}.                 replace `var'_propor = 1 if `var' == "All of them"
{txt}  4{com}.                 replace `var'_propor = 2 if `var' == "A majority"
{txt}  5{com}.                 replace `var'_propor = 3 if `var' == "About half"
{txt}  6{com}.                 replace `var'_propor = 4 if `var' == "A minority"
{txt}  7{com}.                 replace `var'_propor = 5 if `var' == "None of them"
{txt}  8{com}.                 label var `var'_propor "`var' in reversed numeric categories (wave 3)"
{txt}  9{com}.                 
.                 *for binaries
.                 xtile `var'_abovemed = `var'_propor, nq(2)
{txt} 10{com}.                 recode `var'_abovemed (1 = 0) (2 = 1)
{txt} 11{com}.                 lab var `var'_abovemed "`var' - binary at median (wave 3)"
{txt} 12{com}.                 
.                 sum `var'_abovemed if treatment==0 
{txt} 13{com}.                 gen `var'_abovemed_st = .
{txt} 14{com}.                 replace `var'_abovemed_st = (`var'_abovemed-r(mean))/r(sd)
{txt} 15{com}.                 lab var `var'_abovemed_st "`var' - centered/standardized binary at median (wave 3)"
{txt} 16{com}.                 
.                 * for likert version
.                 sum `var'_propor if treatment==0
{txt} 17{com}.                 gen `var'_propor_st = .
{txt} 18{com}.                 replace `var'_propor_st = (`var'_propor-r(mean))/r(sd)
{txt} 19{com}.                 lab var `var'_propor_st "`var' - center/standardized likert (wave 3)"
{txt} 20{com}.         {c )-}
{txt}(606 missing values generated)
(42 real changes made)
(41 real changes made)
(36 real changes made)
(52 real changes made)
(246 real changes made)
(417 changes made to {bf:G4_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G4_1_above~d {c |}{res}        147           0           0          0          0
{txt}(606 missing values generated)
(0 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G4_1_propor {c |}{res}        147    4.034014      1.4591          1          5
{txt}(606 missing values generated)
(417 real changes made)
(606 missing values generated)
(24 real changes made)
(30 real changes made)
(44 real changes made)
(76 real changes made)
(243 real changes made)
(417 changes made to {bf:G4_2_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G4_2_above~d {c |}{res}        147           0           0          0          0
{txt}(606 missing values generated)
(0 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G4_2_propor {c |}{res}        147    4.047619    1.289225          1          5
{txt}(606 missing values generated)
(417 real changes made)
(606 missing values generated)
(31 real changes made)
(67 real changes made)
(69 real changes made)
(74 real changes made)
(176 real changes made)
(417 changes made to {bf:G4_3_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G4_3_above~d {c |}{res}        147    .4217687    .4955303          0          1
{txt}(606 missing values generated)
(417 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G4_3_propor {c |}{res}        147    3.809524    1.267796          1          5
{txt}(606 missing values generated)
(417 real changes made)
(606 missing values generated)
(113 real changes made)
(112 real changes made)
(106 real changes made)
(86 real changes made)
(69 real changes made)
(486 changes made to {bf:G6_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G6_1_above~d {c |}{res}        181    .3535912    .4794103          0          1
{txt}(606 missing values generated)
(486 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G6_1_propor {c |}{res}        181    2.889503    1.307649          1          5
{txt}(606 missing values generated)
(486 real changes made)
(606 missing values generated)
(59 real changes made)
(76 real changes made)
(135 real changes made)
(117 real changes made)
(97 real changes made)
(484 changes made to {bf:G6_2_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G6_2_above~d {c |}{res}        180    .4611111    .4998758          0          1
{txt}(606 missing values generated)
(484 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G6_2_propor {c |}{res}        180    3.316667    1.266125          1          5
{txt}(606 missing values generated)
(484 real changes made)
(606 missing values generated)
(95 real changes made)
(149 real changes made)
(127 real changes made)
(72 real changes made)
(40 real changes made)
(483 changes made to {bf:G6_3_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G6_3_above~d {c |}{res}        181    .5359116    .5000921          0          1
{txt}(606 missing values generated)
(483 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G6_3_propor {c |}{res}        181    2.707182     1.20065          1          5
{txt}(606 missing values generated)
(483 real changes made)
(606 missing values generated)
(191 real changes made)
(95 real changes made)
(72 real changes made)
(71 real changes made)
(55 real changes made)
(484 changes made to {bf:G8_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G8_1_above~d {c |}{res}        179     .424581    .4956657          0          1
{txt}(606 missing values generated)
(484 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G8_1_propor {c |}{res}        179    2.385475    1.370644          1          5
{txt}(606 missing values generated)
(484 real changes made)
(606 missing values generated)
(91 real changes made)
(94 real changes made)
(130 real changes made)
(102 real changes made)
(67 real changes made)
(484 changes made to {bf:G8_2_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G8_2_above~d {c |}{res}        181    .3149171    .4657713          0          1
{txt}(606 missing values generated)
(484 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G8_2_propor {c |}{res}        181    2.812155    1.294461          1          5
{txt}(606 missing values generated)
(484 real changes made)
(606 missing values generated)
(144 real changes made)
(135 real changes made)
(117 real changes made)
(54 real changes made)
(33 real changes made)
(483 changes made to {bf:G8_3_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G8_3_above~d {c |}{res}        180    .4555556      .49941          0          1
{txt}(606 missing values generated)
(483 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G8_3_propor {c |}{res}        180    2.405556    1.203799          1          5
{txt}(606 missing values generated)
(483 real changes made)
(606 missing values generated)
(140 real changes made)
(136 real changes made)
(88 real changes made)
(64 real changes made)
(55 real changes made)
(483 changes made to {bf:G10_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G10_1_abov~d {c |}{res}        178    .4269663    .4960326          0          1
{txt}(606 missing values generated)
(483 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G10_1_propor {c |}{res}        178    2.477528    1.302779          1          5
{txt}(606 missing values generated)
(483 real changes made)
(606 missing values generated)
(68 real changes made)
(107 real changes made)
(141 real changes made)
(106 real changes made)
(58 real changes made)
(480 changes made to {bf:G10_2_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G10_2_abov~d {c |}{res}        177    .3276836    .4707003          0          1
{txt}(606 missing values generated)
(480 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G10_2_propor {c |}{res}        177    2.909605    1.226028          1          5
{txt}(606 missing values generated)
(480 real changes made)
(606 missing values generated)
(111 real changes made)
(154 real changes made)
(120 real changes made)
(62 real changes made)
(33 real changes made)
(480 changes made to {bf:G10_3_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G10_3_abov~d {c |}{res}        177    .4745763    .5007698          0          1
{txt}(606 missing values generated)
(480 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G10_3_propor {c |}{res}        177    2.491525    1.153644          1          5
{txt}(606 missing values generated)
(480 real changes made)

{com}. 
. * XTILE RETURNS SINGLE VAL VAR FOR G4_1 and G4_2, LET'S RECREATE THIS VAR
. 
.                 drop G4_1_abovemed G4_1_abovemed_st G4_2_abovemed G4_2_abovemed_st 
{txt}
{com}.                 
.                 foreach var of varlist G4_1 G4_2 {c -(}
{txt}  2{com}.                 sum `var'_propor, detail
{txt}  3{com}.                 scalar med = r(p50)
{txt}  4{com}.                 gen `var'_abovemed = 1 if `var'_propor>=med & `var'_propor!=.
{txt}  5{com}.                 replace `var'_abovemed = 0 if `var'_propor<med & `var'_propor!=. 
{txt}  6{com}.                 lab var `var'_abovemed "`var' - binary at median (created manually)"
{txt}  7{com}.                 
.                 sum `var'_abovemed if treatment==0 
{txt}  8{com}.                 gen `var'_abovemed_st =.
{txt}  9{com}.                 replace `var'_abovemed_st = (`var'_abovemed-r(mean))/r(sd)
{txt} 10{com}.                 lab var `var'_abovemed_st "`var' - centered/standardized binary at median (created manually) (wave 3)"  
{txt} 11{com}.                 {c )-}

        {txt}G4_1 in reversed numeric categories (wave 3)
{hline 61}
      Percentiles      Smallest
 1%    {res}        1              1
{txt} 5%    {res}        1              1
{txt}10%    {res}        1              1       {txt}Obs         {res}        417
{txt}25%    {res}        3              1       {txt}Sum of wgt. {res}        417

{txt}50%    {res}        5                      {txt}Mean          {res} 4.004796
                        {txt}Largest       Std. dev.     {res}  1.40739
{txt}75%    {res}        5              5
{txt}90%    {res}        5              5       {txt}Variance      {res} 1.980746
{txt}95%    {res}        5              5       {txt}Skewness      {res}-1.091145
{txt}99%    {res}        5              5       {txt}Kurtosis      {res} 2.680339
{txt}(360 missing values generated)
(171 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G4_1_above~d {c |}{res}        147    .6326531    .4837303          0          1
{txt}(606 missing values generated)
(417 real changes made)

        G4_2 in reversed numeric categories (wave 3)
{hline 61}
      Percentiles      Smallest
 1%    {res}        1              1
{txt} 5%    {res}        1              1
{txt}10%    {res}        2              1       {txt}Obs         {res}        417
{txt}25%    {res}        4              1       {txt}Sum of wgt. {res}        417

{txt}50%    {res}        5                      {txt}Mean          {res} 4.160671
                        {txt}Largest       Std. dev.     {res} 1.213144
{txt}75%    {res}        5              5
{txt}90%    {res}        5              5       {txt}Variance      {res} 1.471719
{txt}95%    {res}        5              5       {txt}Skewness      {res}-1.328909
{txt}99%    {res}        5              5       {txt}Kurtosis      {res} 3.615038
{txt}(363 missing values generated)
(174 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G4_2_above~d {c |}{res}        147    .5442177    .4997437          0          1
{txt}(606 missing values generated)
(417 real changes made)

{com}.                         
. 
. 
. 
. * Now generate numeric scales for the odd vars:
.                         
.         * Level of desired edu for daughter/granddaughter
. 
.                         gen G11_scale = .
{txt}(606 missing values generated)

{com}.                         replace G11_scale = 1 if G11 == "Complete high school "
{txt}(17 real changes made)

{com}.                         replace G11_scale = 2 if G11 == "Complete diploma"
{txt}(3 real changes made)

{com}.                         replace G11_scale = 3 if G11 == "Complete vocational training"
{txt}(0 real changes made)

{com}.                         replace G11_scale = 4 if G11 == "Complete a university degree"
{txt}(143 real changes made)

{com}.                         replace G11_scale = 5 if G11 == "Complete a degree beyond university (graduate/professional)"
{txt}(253 real changes made)

{com}.                         label var G11_scale "Desired edu level for daughter/granddaughter (wave 3)"
{txt}
{com}.                 
. 
.         * Desire for daughter/granddaughter to work - likert
. 
.                         gen G12_scale = .
{txt}(606 missing values generated)

{com}.                         replace G12_scale = 1 if G12 == "Definitely no"
{txt}(0 real changes made)

{com}.                         replace G12_scale = 2 if G12 == "Probably no"
{txt}(2 real changes made)

{com}.                         replace G12_scale = 3 if G12 == "Not sure"
{txt}(0 real changes made)

{com}.                         replace G12_scale = 4 if G12 == "Probably yes"
{txt}(6 real changes made)

{com}.                         replace G12_scale = 5 if G12 == "Definitely yes"
{txt}(406 real changes made)

{com}.                         label var G12_scale "Desire for hypothetical daughter/granddaughter to work - numeric scale (wave 3)"
{txt}
{com}.                                                         
.         * Ideal age for a woman to have her first child
. 
.                 * fix typing error
.                 replace G13_7_TEXT="20" if G13_7_TEXT=="20 ŸÅŸÖÿß ŸÅŸàŸÇ"
{txt}(1 real change made)

{com}.                 destring G13_7_TEXT, gen(G13_scale)
{txt}G13_7_TEXT: all characters numeric; G13_scale {res}generated {txt}as {res}byte
{txt}(133 missing values generated)
{res}{txt}
{com}.                 lab var G13_scale "Ideal age to have 1st child (wave 3)"
{txt}
{com}.                 
.                 * this one doesn't need a binary created, so we just center/standardize it
.                 sum G13_scale if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 3}G13_scale {c |}{res}        178    25.08989    2.925209         18         35
{txt}
{com}.                 gen G13_scale_st = .
{txt}(606 missing values generated)

{com}.                 replace G13_scale_st = (G13_scale-r(mean))/r(sd)
{txt}(473 real changes made)

{com}.                 lab var G13_scale_st "G13 - centered/standardized (wave 3)"
{txt}
{com}.                 
. 
.         * Agreement with statement A vs statement B
.                 
.                 global statements P2_1 P2_2 P2_3 P2_4
{txt}
{com}.                 
.                 foreach var of global statements {c -(}
{txt}  2{com}.                         gen `var'_scale = .
{txt}  3{com}.                         replace `var'_scale = 1 if `var' == "8"
{txt}  4{com}.                         replace `var'_scale = 2 if `var' == "7"
{txt}  5{com}.                         replace `var'_scale = 3 if `var' == "6"
{txt}  6{com}.                         replace `var'_scale = 4 if `var' == "5"
{txt}  7{com}.                         replace `var'_scale = 5 if `var' == "1"
{txt}  8{com}.                         label var `var'_scale "`var' - numeric scale (wave 3)"
{txt}  9{com}.                 {c )-}
{txt}(606 missing values generated)
(101 real changes made)
(43 real changes made)
(53 real changes made)
(15 real changes made)
(200 real changes made)
(606 missing values generated)
(49 real changes made)
(13 real changes made)
(37 real changes made)
(27 real changes made)
(286 real changes made)
(606 missing values generated)
(293 real changes made)
(60 real changes made)
(16 real changes made)
(11 real changes made)
(26 real changes made)
(606 missing values generated)
(163 real changes made)
(39 real changes made)
(31 real changes made)
(17 real changes made)
(158 real changes made)

{com}. 
.                 
.                 * Create binaries at the median for these odd vars and center/standardized
. 
.                 global other_GA G11 G12 P2_1 P2_2 P2_3 P2_4 P3
{txt}
{com}. 
.                 foreach var of global other_GA {c -(}
{txt}  2{com}.                         xtile `var'_abovemed = `var'_scale , nq(2)
{txt}  3{com}.                         recode `var'_abovemed (1 = 0) (2 = 1)
{txt}  4{com}.                         lab var `var'_abovemed "`var' - binary at median (wave 3)"
{txt}  5{com}. 
.                         sum `var'_abovemed if treatment==0 
{txt}  6{com}.                         gen `var'_abovemed_st = .
{txt}  7{com}.                         replace `var'_abovemed_st = (`var'_abovemed-r(mean))/r(sd)
{txt}  8{com}.                         lab var `var'_abovemed_st "`var' - centered/standardized binary at median (wave 3)"
{txt}  9{com}.                         {c )-}
{txt}(416 changes made to {bf:G11_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G11_abovemed {c |}{res}        146           0           0          0          0
{txt}(606 missing values generated)
(0 real changes made)
(414 changes made to {bf:G12_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G12_abovemed {c |}{res}        145           0           0          0          0
{txt}(606 missing values generated)
(0 real changes made)
(412 changes made to {bf:P2_1_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P2_1_above~d {c |}{res}        144    .4861111    .5015516          0          1
{txt}(606 missing values generated)
(412 real changes made)
(412 changes made to {bf:P2_2_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P2_2_above~d {c |}{res}        143           0           0          0          0
{txt}(606 missing values generated)
(0 real changes made)
(406 changes made to {bf:P2_3_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P2_3_above~d {c |}{res}        141    .2624113    .4415135          0          1
{txt}(606 missing values generated)
(406 real changes made)
(408 changes made to {bf:P2_4_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P2_4_above~d {c |}{res}        142    .3732394     .485377          0          1
{txt}(606 missing values generated)
(408 real changes made)
(481 changes made to {bf:P3_abovemed})

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}P3_abovemed {c |}{res}        177    .4519774    .4991004          0          1
{txt}(606 missing values generated)
(481 real changes made)

{com}.                         
. * xtile creates single val var for P2_2, G11 and G12, fix
.                 drop P2_2_abovemed P2_2_abovemed_st G11_abovemed G11_abovemed_st ///
>                         G12_abovemed G12_abovemed_st 
{txt}
{com}.                 
.                 global median_fix P2_2 G11 G12
{txt}
{com}.                 
.                 foreach var of global median_fix {c -(}
{txt}  2{com}.                 sum `var'_scale, detail
{txt}  3{com}.                 scalar med = r(p50)
{txt}  4{com}.                 gen `var'_abovemed = 1 if `var'_scale>=med & `var'_scale!=.
{txt}  5{com}.                 replace `var'_abovemed = 0 if `var'_scale<med & `var'_scale!=.
{txt}  6{com}.                 lab var `var'_abovemed "`var' - binary at median (created using mean)"
{txt}  7{com}.                 
.                 sum `var'_abovemed if treatment==0 
{txt}  8{com}.                 gen `var'_abovemed_st =.
{txt}  9{com}.                 replace `var'_abovemed_st = (`var'_abovemed-r(mean))/r(sd)
{txt} 10{com}.                 lab var `var'_abovemed_st "`var' - centered/standardized binary at median (created using mean)"
{txt} 11{com}.                 {c )-}

                {txt}P2_2 - numeric scale (wave 3)
{hline 61}
      Percentiles      Smallest
 1%    {res}        1              1
{txt} 5%    {res}        1              1
{txt}10%    {res}        1              1       {txt}Obs         {res}        412
{txt}25%    {res}        4              1       {txt}Sum of wgt. {res}        412

{txt}50%    {res}        5                      {txt}Mean          {res} 4.184466
                        {txt}Largest       Std. dev.     {res} 1.396886
{txt}75%    {res}        5              5
{txt}90%    {res}        5              5       {txt}Variance      {res} 1.951291
{txt}95%    {res}        5              5       {txt}Skewness      {res}-1.451764
{txt}99%    {res}        5              5       {txt}Kurtosis      {res} 3.545177
{txt}(320 missing values generated)
(126 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
P2_2_above~d {c |}{res}        143    .6783217    .4687622          0          1
{txt}(606 missing values generated)
(412 real changes made)

     Desired edu level for daughter/granddaughter (wave
                             3)
{hline 61}
      Percentiles      Smallest
 1%    {res}        1              1
{txt} 5%    {res}        4              1
{txt}10%    {res}        4              1       {txt}Obs         {res}        416
{txt}25%    {res}        4              1       {txt}Sum of wgt. {res}        416

{txt}50%    {res}        5                      {txt}Mean          {res} 4.471154
                        {txt}Largest       Std. dev.     {res} .8858375
{txt}75%    {res}        5              5
{txt}90%    {res}        5              5       {txt}Variance      {res} .7847081
{txt}95%    {res}        5              5       {txt}Skewness      {res}-2.546801
{txt}99%    {res}        5              5       {txt}Kurtosis      {res} 10.22522
{txt}(353 missing values generated)
(163 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G11_abovemed {c |}{res}        146    .6506849    .4783948          0          1
{txt}(606 missing values generated)
(416 real changes made)

      Desire for hypothetical daughter/granddaughter to
                work - numeric scale (wave 3)
{hline 61}
      Percentiles      Smallest
 1%    {res}        4              2
{txt} 5%    {res}        5              2
{txt}10%    {res}        5              4       {txt}Obs         {res}        414
{txt}25%    {res}        5              4       {txt}Sum of wgt. {res}        414

{txt}50%    {res}        5                      {txt}Mean          {res} 4.971014
                        {txt}Largest       Std. dev.     {res} .2393098
{txt}75%    {res}        5              5
{txt}90%    {res}        5              5       {txt}Variance      {res} .0572692
{txt}95%    {res}        5              5       {txt}Skewness      {res}-10.24758
{txt}99%    {res}        5              5       {txt}Kurtosis      {res} 119.2683
{txt}(200 missing values generated)
(8 real changes made)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G12_abovemed {c |}{res}        145    .9862069    .1170355          0          1
{txt}(606 missing values generated)
(414 real changes made)

{com}. 
.         lab def likert 1 "Completely disagree" 2 "Somewhat disagree" 3 "Neither agree nor disagree" ///
>         4 "Somewhat agree" 5 "Completely agree"
{txt}
{com}.         
.         lab def likert_reverse 5 "Completely disagree" 4 "Somewhat disagree" 3 "Neither agree nor disagree" ///
>         2 "Somewhat agree" 1 "Completely agree"
{txt}
{com}.         
.         lab val G1_1_likert G1_2_likert G1_3_likert Combined_P1_1_likert P1_2_likert P1_3_likert likert
{txt}
{com}.         lab val G3_1_likert_reverse G7_1_likert_reverse G9_1_likert_reverse  G5_1_likert_reverse likert_reverse
{txt}
{com}.         
.         * age for 1st child
.         replace G13_7_TEXT="20" if G13_7_TEXT== "20 ŸÅŸÖÿß ŸÅŸàŸÇ"
{txt}(0 real changes made)

{com}.         destring G13_7_TEXT, replace
{txt}G13_7_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(133 missing values generated)
{res}{txt}
{com}.         *histogram G13_7_TEXT, percent
.         
.          * relabel for Statement A/B and run plots
.         lab def statements 1 "Completely agree with B" 2 "Mostly agree with B" ///
>         3 "Neutral" 4 "Mostly agree with A" 5 "Completely agree with A"
{txt}
{com}.         lab val P2_1_scale P2_2_scale P2_3_scale P2_4_scale statements
{txt}
{com}.         
. 
. ********************************
. * DRIVE TRAINING AND LICENSE
. ********************************
.         
.         * create our drive training variable
.          gen saudi_drive_training = 1 if M1 == "No"  ///
>          | M1=="" & sauditraining == "No_ Please explain:"
{txt}(471 missing values generated)

{com}.          replace saudi_drive_training = 2 if M1 == "No, trained outside of driving school" 
{txt}(45 real changes made)

{com}.          replace saudi_drive_training = 3 if M1 == "Yes but failed the theoretical test" ///
>                 | M1 == "Yes but failed the practical test" ///
>                 | M1=="Yes but stopped the training for other reasons. Please explain:" 
{txt}(32 real changes made)

{com}.          replace saudi_drive_training = 3 if M1=="" & ///
>                 sauditraining=="Yes but failed the practical test"
{txt}(52 real changes made)

{com}.          replace saudi_drive_training = 3 if M1=="" & ///
>                 sauditraining=="Yes but failed the theoretical test"
{txt}(2 real changes made)

{com}.          replace saudi_drive_training=3 if M1=="" & ///
>                 sauditraining=="Yes but stopped the training for other reasons. Please explain:"
{txt}(13 real changes made)

{com}.          replace saudi_drive_training = 4 if M1 == "Yes and completed successfully"
{txt}(42 real changes made)

{com}.          replace saudi_drive_training = 4 if M1=="" & ///
>                 sauditraining=="Yes and completed successfully"
{txt}(147 real changes made)

{com}.                 
.                 * replace missing values with responses from wave 2 only if they started wave 3 survey
.                 * No
.                 replace saudi_drive_training = 1 if saudidrivetraining_w2==0 & ///
>                  saudi_drive_training==. & start_survey_w3==1
{txt}(20 real changes made)

{com}.                 * Yes but failed test
.                 replace saudi_drive_training = 3 if saudidrivetraining_w2==2 & ///
>                 inlist(saudi_drive_training, ., 1,2) & start_survey_w3==1
{txt}(0 real changes made)

{com}.                 * Yes and completed
.                 replace saudi_drive_training = 4 if saudidrivetraining_w2==1 & start_survey_w3==1
{txt}(0 real changes made)

{com}.                 lab var saudi_drive_training "Have you done the official Saudi drive training? (wave 3)"
{txt}
{com}.                 
.                  * label 
.                  lab def drivetrain 1 "No" 2 "Trained outside of the school" 3 "Yes but failed or stopped" ///
>                  4 "Yes and completed successfully"
{txt}
{com}.                  lab val saudi_drive_training drivetrain
{txt}
{com}.                  lab var saudi_drive_training "Have you done the official Saudi drive training? (wave 3)"
{txt}
{com}.                  
.                  * create binary version
.                 gen s_train_bi_w3 = 1 if inlist(saudi_drive_training, 3, 4)
{txt}(318 missing values generated)

{com}.                 replace s_train_bi_w3 = 0 if inlist(saudi_drive_training, 1,2)
{txt}(200 real changes made)

{com}.                 lab var s_train_bi_w3 "Did any official drive training (wave 3)"
{txt}
{com}.          
. 
.         * received license
.          gen license_w3 = 1 if M2=="Yes" &  start_survey==1
{txt}(557 missing values generated)

{com}.          replace license_w3 = 1 if  drivinglicense=="Yes" &  start_survey==1
{txt}(126 real changes made)

{com}.          replace license_w3 = 0 if M2=="No" & license_w3==. &  start_survey==1
{txt}(263 real changes made)

{com}.          replace license_w3 = 0 if  drivinglicense=="No" & license_w3==. &  start_survey==1
{txt}(0 real changes made)

{com}.          
.                 * replace missing values with responses from wave 2 only if they started wave 3 survey
.                  replace license_w3 = 1 if license_w2==1 & start_survey_w3==1
{txt}(0 real changes made)

{com}.                  replace license_w3 = 0 if license_w2==0 & license_w3==. & start_survey_w3==1
{txt}(31 real changes made)

{com}.                  lab var license_w3 "Has received license (wave 3)" 
{txt}
{com}.                  
.                  * label
.                   lab def binary 0 "No" 1 "Yes"
{txt}
{com}.                  lab val license_w3 binary
{txt}
{com}.                  lab var license_w3 "Has received license (wave 3)"
{txt}
{com}.                 
.                 * create binary version
.                 gen s_train_complete = 1 if saudi_drive_training==4
{txt}(417 missing values generated)

{com}.                 replace s_train_complete = 0 if inrange(saudi_drive_training, 1,3)
{txt}(299 real changes made)

{com}.                 lab var s_train_complete "Successfully completed the drive training (wave 3)"
{txt}
{com}.                 
. 
.                 /* let's also make sure we relabel vars we don't want to use for analysis;
>                    will drop these out for the final dataset    */
.                  lab var M2 "OLD - did you receive the driving license"
{txt}
{com}.                  lab var drivinglicense "OLD - wave 1&2 received license"
{txt}
{com}.                  lab var license_w2 "Received license (wave 2)"
{txt}
{com}.                  lab var saudidrivetraining_w2 "OLD - did the saudi driving training"
{txt}
{com}.                  lab var sauditraining "W3 ONLY - did the saudi driving training"
{txt}
{com}.          
. ********************************
. * MOBILITY
. ********************************
. 
.         destring M4_1_TEXT M5_1_TEXT M6_1_TEXT M7_1_TEXT M8_1_TEXT M9_2_TEXT, replace
{txt}M4_1_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(136 missing values generated)
{res}{txt}M5_1_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(210 missing values generated)
{res}{txt}M6_1_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(210 missing values generated)
{res}{txt}M7_1_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(211 missing values generated)
{res}{txt}M8_1_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(212 missing values generated)
{res}{txt}M9_2_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(291 missing values generated)
{res}{txt}
{com}.         
.         * Labeling
.         lab var M3 "Number of times driven in last month (wave 3)"
{txt}
{com}.         lab var M4_1_TEXT "Number of times left house in last 7 days (wave 3)"
{txt}
{com}.         lab var M9_2_TEXT "Number of trips in last 7 days not accompanied by a mahrem (wave 3)"
{txt}
{com}.         lab var M5_1_TEXT "Number of times left house in last 7 days: visit relatives (wave 3)"
{txt}
{com}.         lab var M6_1_TEXT "Number of times left house in last 7 days: visit friends (wave 3)"
{txt}
{com}.         lab var M7_1_TEXT "Number of times left house in last 7 days: HH errands (wave 3)"
{txt}
{com}.         lab var M8_1_TEXT "Number of times left house in last 7 days: personal errands (wave 3)"
{txt}
{com}.         lab var Q132_2_TEXT "Number of trips in last 7 days made alone (wave 3)"
{txt}
{com}.         lab var M10 "Types of trips made without being accompanied by a family member (wave 3)"
{txt}
{com}. 
.         
.         * Driving frequency in past month
.         gen drive_freq_mo_cat_w3 = 0 if M3=="None" 
{txt}(339 missing values generated)

{com}.         replace drive_freq_mo_cat_w3 = 1 if M3=="Less than once a week" 
{txt}(44 real changes made)

{com}.         replace drive_freq_mo_cat_w3 = 2 if M3=="About once a week" 
{txt}(21 real changes made)

{com}.         replace drive_freq_mo_cat_w3 = 3 if M3=="A few times a week" 
{txt}(71 real changes made)

{com}.         replace drive_freq_mo_cat_w3 = 4 if M3=="Almost every day" 
{txt}(86 real changes made)

{com}.         lab var drive_freq_mo_cat_w3 "Driving freq in past month (wave 3)"
{txt}
{com}. 
. 
.         /* Let's adjust travel type freq if they said they never went out (currently is 
>         missing obs. for each travel type if they said they never left the house in 
>         past week)      */
.         destring Q132_2_TEXT, replace
{txt}Q132_2_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(427 missing values generated)
{res}{txt}
{com}. 
.         global travel_types M5_1_TEXT M6_1_TEXT M7_1_TEXT M8_1_TEXT M9_2_TEXT ///
>         Q132_2_TEXT 
{txt}
{com}.         
.         foreach var of global travel_types {c -(}
{txt}  2{com}.                 replace `var' = 0 if M4_1_TEXT == 0 
{txt}  3{com}.         {c )-}
{txt}(21 real changes made)
(21 real changes made)
(21 real changes made)
(21 real changes made)
(24 real changes made)
(24 real changes made)

{com}.         
.         * Now replace M9_2_TEXT with 0 if they selected 'none' in M9 or if they didn't go out
.         replace M9_2_TEXT = 0 if M9=="None (all of my trips were accompanied by a mahrem)"
{txt}(122 real changes made)

{com}. 
.         
.         * trips alone 
.         replace Q132_2_TEXT = 0 if Q132== ///
>         "None (all of my trips were made with at least one other person)"
{txt}(58 real changes made)

{com}.                 
. 
.         * trips without a mahrem / alone
.         gen trips_unaccompanied_w3 = M9_2_TEXT
{txt}(145 missing values generated)

{com}.         replace trips_unaccompanied_w3 = 0 if strpos(M9,"None")
{txt}(0 real changes made)

{com}.         replace trips_unaccompanied_w3 = Q132_2_TEXT if trips_unaccompanied_w3==.
{txt}(0 real changes made)

{com}.         lab var trips_unaccompanied_w3 "Number of trips made without a chaperone (wave 3)"
{txt}
{com}.         
.         * trips without a mahrem / alone as a share of total trips
.         gen share_trips_unaccomp_w3 = trips_unaccompanied_w3/M4_1_TEXT if trips_unaccompanied_w3!=.
{txt}(178 missing values generated)

{com}.         replace share_trips_unaccomp_w3 = 0 if trips_unaccompanied_w3==0
{txt}(33 real changes made)

{com}.         lab var share_trips_unaccomp_w3 "Share of trips unaccompanied (wave 3)"
{txt}
{com}.         
.         * no trips without a chaperone
.         gen no_trips_unaccomp_w3 = 1 if trips_unaccompanied_w3==0
{txt}(404 missing values generated)

{com}.         replace no_trips_unaccomp_w3 = 0 if trips_unaccompanied_w3>0 & trips_unaccompanied_w3!=.
{txt}(259 real changes made)

{com}.         lab var no_trips_unaccomp_w3 "No trips made without a chaperone (wave 3)"
{txt}
{com}.         
.         
.         * create estimate of # times per month
.                 gen drive_freq_mo_w3 = 0 if M3=="None" 
{txt}(339 missing values generated)

{com}.                 replace drive_freq_mo_w3 = 2 if M3=="Less than once a week" 
{txt}(44 real changes made)

{com}.                 replace drive_freq_mo_w3 = 4 if M3=="About once a week" 
{txt}(21 real changes made)

{com}.                 replace drive_freq_mo_w3 = 12 if M3=="A few times a week" 
{txt}(71 real changes made)

{com}.                 replace drive_freq_mo_w3 = 28 if M3=="Almost every day" 
{txt}(86 real changes made)

{com}.                 lab var drive_freq_mo_w3 "Driving freq in past month - approx. # (wave 3)"
{txt}
{com}.         
. 
.         
.         * Any driving in past month
.                 gen  drive_any_mo_bi_w3 = 0 if M3=="None" 
{txt}(339 missing values generated)

{com}.                 replace drive_any_mo_bi_w3 = 1 if inlist(M3,"Less than once a week", ///
>                 "About once a week", "A few times a week", "Almost every day") 
{txt}(222 real changes made)

{com}.                 lab var drive_any_mo_bi_w3 "Any driving in prev month (wave 3)"
{txt}
{com}.         
. 
.         
.         /* avg trips per day. Let's take the following steps:
>                         divide total trips made last week by 7  */
.                 gen approx_trips_per_day_w3 = M4_1_TEXT/7 if M4_1_TEXT!=. 
{txt}(136 missing values generated)

{com}.                 replace approx_trips_per_day_w3 = round(approx_trips_per_day_w3)
{txt}(384 real changes made)

{com}.                 lab var approx_trips_per_day_w3 "Avg no. trips per day (wave 3)"
{txt}
{com}.                 
. 
.                                 
.                 
.         /* any travel made without family member. To do this let's:
>                         create var for any travel in last week without family/mahrem */
.                 gen  unaccompanied_travel_w3 = 0 if M9_2_TEXT==0 
{txt}(404 missing values generated)

{com}.                 replace unaccompanied_travel_w3 = 0 if M4_1_TEXT == 0 
{txt}(0 real changes made)

{com}.                 replace unaccompanied_travel_w3 = 0 if (M9_2_TEXT==. & Q132_2_TEXT==0) 
{txt}(0 real changes made)

{com}.                 replace unaccompanied_travel_w3 = 1 if M9_2_TEXT>0 & M9_2_TEXT!=. 
{txt}(259 real changes made)

{com}.                 replace unaccompanied_travel_w3 = 1 if Q132_2_TEXT>0 & Q132_2_TEXT!=. 
{txt}(44 real changes made)

{com}.                 lab var unaccompanied_travel_w3 "Travel in past week without family/mahrem (wave 3)"
{txt}
{com}.                 
.         
.                                 
.                 
.         /* any trip in last week to visit family:
>                         any trip in past week   */
.                 gen trip_family_w3 = 0 if M5_1_TEXT==0 
{txt}(446 missing values generated)

{com}.                 replace trip_family_w3 = 0 if  M4_1_TEXT==0 
{txt}(0 real changes made)

{com}.                 replace trip_family_w3 = 1 if (M5_1_TEXT>0 & M5_1_TEXT!=.) 
{txt}(257 real changes made)

{com}.                 lab var trip_family_w3 "Any trip to visit family in past 1 week (wave 3)"
{txt}
{com}.                 
. 
.                 * number of visits to family
.                 gen numtrips_fam_w3 = M5_1_TEXT 
{txt}(189 missing values generated)

{com}.                 replace numtrips_fam_w3 = 0 if M5_1_TEXT==. & M4_1_TEXT==0 
{txt}(0 real changes made)

{com}.                 lab var numtrips_fam_w3 "Number of trips to visit family in past week (wave 3)"
{txt}
{com}.                 
.         /* any trip to visit friends in last week:
>                         any trip in last week   */      
.                 gen trip_friends_w3 = 0 if M6_1_TEXT==0 
{txt}(284 missing values generated)

{com}.                 replace trip_friends_w3 = 0 if  M4_1_TEXT==0 
{txt}(0 real changes made)

{com}.                 replace trip_friends_w3 = 1 if M6_1_TEXT>0 & M6_1_TEXT!=. 
{txt}(95 real changes made)

{com}.                 lab var trip_friends_w3 "Any trip to visit friends in past 1 week (wave 3)"
{txt}
{com}.                 
.                 
.                 * number of visits to friends
.                 gen numtrips_friend_w3 = M6_1_TEXT 
{txt}(189 missing values generated)

{com}.                 replace numtrips_friend_w3 = 0 if M6_1_TEXT==. & M4_1_TEXT==0
{txt}(0 real changes made)

{com}.                 lab var numtrips_friend_w3 "Number of trips to visit friends in past week (Wave 3)"
{txt}
{com}.                 
.         /* any trip other than work/study. For this let's not include household or 
>                 personal errands:
>                         any trip for family/friend      */
.                 gen nonwork_trip_w3 = 0 if (M5_1_TEXT==0 | M6_1_TEXT==0 |  M4_1_TEXT==0) 
{txt}(261 missing values generated)

{com}.                 replace nonwork_trip_w3 = 1 if M5_1_TEXT>0 & M5_1_TEXT!=. 
{txt}(257 real changes made)

{com}.                 replace nonwork_trip_w3 = 1 if M6_1_TEXT>0 & M6_1_TEXT!=.
{txt}(23 real changes made)

{com}.                 lab var nonwork_trip_w3 ///
>                 "Any visit to family or friends in past 1 week (wave 3)"
{txt}
{com}.                 
.                 
.                 
.                  
.                         
.         * household errands (binary)
.         gen trip_hherrand_w3 = 0 if M7_1_TEXT == 0 | M4_1_TEXT == 0
{txt}(491 missing values generated)

{com}.         replace trip_hherrand_w3 = 1 if M7_1_TEXT > 0 & M7_1_TEXT!=.
{txt}(301 real changes made)

{com}.         lab var trip_hherrand_w3 "Any trip for household errands in past 1 week (Wave 3)"
{txt}
{com}.         
.         * household errands (number)
.         gen numtrip_hherrand_w3 = M7_1_TEXT 
{txt}(190 missing values generated)

{com}.         replace numtrip_hherrand_w3 = 0 if M7_1_TEXT == . & M4_1_TEXT == 0
{txt}(0 real changes made)

{com}.         lab var numtrip_hherrand_w3 ///
>         "Number of trips for household errands in past 1 week (Wave 3, winsor99)"
{txt}
{com}.         
.         
.         * personal errands
.         gen trip_perrand_w3 = 0 if M8_1_TEXT == 0 | M4_1_TEXT == 0
{txt}(421 missing values generated)

{com}.         replace trip_perrand_w3 = 1 if M8_1_TEXT > 0 & M8_1_TEXT!=.
{txt}(230 real changes made)

{com}.         lab var trip_perrand_w3 "Any trip for personal errands in past 1 week (Wave 3)"
{txt}
{com}.         
.         * personal errands (number)
.         gen numtrip_perrand_w3 = M8_1_TEXT 
{txt}(191 missing values generated)

{com}.         replace numtrip_perrand_w3 = 0 if M8_1_TEXT == . & M4_1_TEXT == 0
{txt}(0 real changes made)

{com}.         lab var numtrip_perrand_w3 ///
>         "Number of trips for personal errands in past 1 week (Wave 3)"
{txt}
{com}.         
.         * combined errands (number)
.         gen numtrip_allerrand_w3 = numtrip_hherrand_w3 +  numtrip_perrand_w3
{txt}(192 missing values generated)

{com}.         replace numtrip_allerrand_w3 = 0 if M7_1_TEXT == . & M7_1_TEXT == . & M4_1_TEXT == 0
{txt}(0 real changes made)

{com}.         lab var numtrip_allerrand_w3 ///
>         "Number of trips for all errands in past 1 week (Wave 3)"
{txt}
{com}.         
.         * Wave 3 only - approximate work trips
.         gen approx_work_trips_w3 = M4_1_TEXT 
{txt}(136 missing values generated)

{com}.         replace approx_work_trips_w3 = approx_work_trips_w3 - numtrips_fam_w3 if numtrips_fam_w3!=.
{txt}(257 real changes made)

{com}.         replace approx_work_trips_w3 = approx_work_trips_w3 - numtrips_friend_w3 if numtrips_friend_w3!=.
{txt}(95 real changes made)

{com}.         replace approx_work_trips_w3 = approx_work_trips_w3 - numtrip_hherrand_w3 if numtrip_hherrand_w3!=.
{txt}(301 real changes made)

{com}.         replace approx_work_trips_w3 = approx_work_trips_w3 - numtrip_perrand_w3 if numtrip_perrand_w3!=.
{txt}(230 real changes made)

{com}.         // move any negative values to 0
.         replace approx_work_trips_w3 = 0 if approx_work_trips_w3<0 & approx_work_trips_w3!=.
{txt}(74 real changes made)

{com}.         lab var approx_work_trips_w3 "Approximated number of work trips in past 1 week (wave 3)"
{txt}
{com}. 
.         
.         * Generate trip frequency vars for regression figures
. * Generate variables
. 
.         tab                     drive_freq_mo_cat_w3 , gen(drive_freq_num_)

    {txt}Driving {c |}
    freq in {c |}
 past month {c |}
   (wave 3) {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        267       54.60       54.60
{txt}          1 {c |}{res}         44        9.00       63.60
{txt}          2 {c |}{res}         21        4.29       67.89
{txt}          3 {c |}{res}         71       14.52       82.41
{txt}          4 {c |}{res}         86       17.59      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        489      100.00
{txt}
{com}.         
.         forvalues               i = 1/5 {c -(}
{txt}  2{com}.                                         lab var drive_freq_num_`i' "Binary indicator for category `i' of number of times driven in past month (wave 3)"
{txt}  3{com}.         {c )-}
{txt}
{com}. 
.         * 0 = none; 1 = once or twice a month; 2 = once a week; 3 = a few times a week; 4 = every day 
. 
. * Trimmed variable for frequency of leaving house in last 7 days
. 
.         generate                leave_house_cat_w3 = 0 if M4_1_TEXT==0
{txt}(582 missing values generated)

{com}.         replace                 leave_house_cat_w3 = 1 if M4_1_TEXT>= 1 & M4_1_TEXT< 2
{txt}(33 real changes made)

{com}.         replace                 leave_house_cat_w3 = 2 if M4_1_TEXT>= 2 & M4_1_TEXT< 3
{txt}(59 real changes made)

{com}.         replace                 leave_house_cat_w3 = 3 if M4_1_TEXT>= 3 & M4_1_TEXT< 6
{txt}(176 real changes made)

{com}.         replace                 leave_house_cat_w3 = 4 if M4_1_TEXT>= 6 & M4_1_TEXT< 10
{txt}(102 real changes made)

{com}.         replace                 leave_house_cat_w3 = 5 if M4_1_TEXT>= 10 & M4_1_TEXT< 15
{txt}(52 real changes made)

{com}.         replace                 leave_house_cat_w3 = 6 if M4_1_TEXT>= 15 & M4_1_TEXT< .
{txt}(24 real changes made)

{com}.         lab var                 leave_house_cat_w3 "Number of times left house in last 7 days, category (wave 3)"
{txt}
{com}.                                 
.         tab                             leave_house_cat_w3 , gen(leave_house_cat_)

  {txt}Number of {c |}
 times left {c |}
   house in {c |}
     last 7 {c |}
      days, {c |}
   category {c |}
   (wave 3) {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         24        5.11        5.11
{txt}          1 {c |}{res}         33        7.02       12.13
{txt}          2 {c |}{res}         59       12.55       24.68
{txt}          3 {c |}{res}        176       37.45       62.13
{txt}          4 {c |}{res}        102       21.70       83.83
{txt}          5 {c |}{res}         52       11.06       94.89
{txt}          6 {c |}{res}         24        5.11      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        470      100.00
{txt}
{com}.         
.         forvalues               i = 1/7 {c -(}
{txt}  2{com}.                                         lab var leave_house_cat_`i' "Binary indicator for left house `i' time(s) in last 7 days (wave 3)"
{txt}  3{com}.         {c )-}
{txt}
{com}.         
. * Trimmed variable for number of trips in past week without male chaperone
.         gen                     unaccomp_trips_cat_w3 = 0 if trips_unaccompanied_w3==0
{txt}(404 missing values generated)

{com}.         replace                 unaccomp_trips_cat_w3 = 1 if trips_unaccompanied_w3>= 1 & ///
>                                         trips_unaccompanied_w3< 2
{txt}(33 real changes made)

{com}.         replace                 unaccomp_trips_cat_w3 = 2 if trips_unaccompanied_w3>= 2 & ///
>                                         trips_unaccompanied_w3< 3
{txt}(40 real changes made)

{com}.         replace                 unaccomp_trips_cat_w3 = 3 if trips_unaccompanied_w3>= 3 & ///
>                                         trips_unaccompanied_w3< 6
{txt}(90 real changes made)

{com}.         replace                 unaccomp_trips_cat_w3 = 4 if trips_unaccompanied_w3>= 6 & ///
>                                         trips_unaccompanied_w3< 10
{txt}(57 real changes made)

{com}.         replace                 unaccomp_trips_cat_w3 = 5 if trips_unaccompanied_w3>= 10 & ///
>                                         trips_unaccompanied_w3< 15
{txt}(29 real changes made)

{com}.         replace                 unaccomp_trips_cat_w3 = 6 if trips_unaccompanied_w3>= 15 & ///
>                                         trips_unaccompanied_w3< .
{txt}(10 real changes made)

{com}.                                         
.         lab variable    unaccomp_trips_cat_w3 "Number of unaccompanied trips in last 7 days, category (wave 3)"
{txt}
{com}.                                         
.         tab                             unaccomp_trips_cat_w3 , gen(unaccomp_trips_cat_)

  {txt}Number of {c |}
unaccompani {c |}
ed trips in {c |}
     last 7 {c |}
      days, {c |}
   category {c |}
   (wave 3) {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        202       43.82       43.82
{txt}          1 {c |}{res}         33        7.16       50.98
{txt}          2 {c |}{res}         40        8.68       59.65
{txt}          3 {c |}{res}         90       19.52       79.18
{txt}          4 {c |}{res}         57       12.36       91.54
{txt}          5 {c |}{res}         29        6.29       97.83
{txt}          6 {c |}{res}         10        2.17      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        461      100.00
{txt}
{com}.         
.         forvalues               i = 1/7 {c -(}
{txt}  2{com}.                                         lab var unaccomp_trips_cat_`i' "Binary indicator for left house unaccompanied `i' time(s) in last 7 days (wave 3)"
{txt}  3{com}.         {c )-}
{txt}
{com}.         
. * Trimmed variable for number of trips in past week to visit family
.         gen                     fam_trips_cat_w3 = 0 if numtrips_fam_w3==0
{txt}(446 missing values generated)

{com}.         replace                 fam_trips_cat_w3 = 1 if numtrips_fam_w3>= 1 & numtrips_fam_w3< 2
{txt}(144 real changes made)

{com}.         replace                 fam_trips_cat_w3 = 2 if numtrips_fam_w3>= 2 & numtrips_fam_w3< 3
{txt}(60 real changes made)

{com}.         replace                 fam_trips_cat_w3 = 3 if numtrips_fam_w3>= 3 & numtrips_fam_w3< 6
{txt}(45 real changes made)

{com}.         replace                 fam_trips_cat_w3 = 4 if numtrips_fam_w3>= 6 & numtrips_fam_w3< .
{txt}(8 real changes made)

{com}.         lab var                 fam_trips_cat_w3 "Number of trips in last 7 days to visit family, category (wave 3)"
{txt}
{com}.                                         
.         tab                             fam_trips_cat_w3 , gen(fam_trips_cat_)

  {txt}Number of {c |}
   trips in {c |}
last 7 days {c |}
   to visit {c |}
    family, {c |}
   category {c |}
   (wave 3) {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        160       38.37       38.37
{txt}          1 {c |}{res}        144       34.53       72.90
{txt}          2 {c |}{res}         60       14.39       87.29
{txt}          3 {c |}{res}         45       10.79       98.08
{txt}          4 {c |}{res}          8        1.92      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        417      100.00
{txt}
{com}.         
.         forvalues               i = 1/5 {c -(}
{txt}  2{com}.                                         lab var fam_trips_cat_`i' "Binary indicator for `i' trips in last 7 days to visit family (wave 3)"
{txt}  3{com}.         {c )-}
{txt}
{com}.         
. * Trimmed variable for number of trips in past week to visit friends
.         gen                     fr_trips_cat_w3 = 0 if numtrips_friend_w3==0
{txt}(284 missing values generated)

{com}.         replace                 fr_trips_cat_w3 = 1 if numtrips_friend_w3>= 1 & numtrips_friend_w3< 2
{txt}(57 real changes made)

{com}.         replace                 fr_trips_cat_w3 = 2 if numtrips_friend_w3>= 2 & numtrips_friend_w3< 3
{txt}(24 real changes made)

{com}.         replace                 fr_trips_cat_w3 = 3 if numtrips_friend_w3>= 3 & numtrips_friend_w3< 6
{txt}(12 real changes made)

{com}.         replace                 fr_trips_cat_w3 = 4 if numtrips_friend_w3>= 6 & numtrips_friend_w3< .
{txt}(2 real changes made)

{com}.         lab variable    fr_trips_cat_w3 "Number of trips in last 7 days to visit friends (wave 3)"
{txt}
{com}.                                         
.         tab                             fr_trips_cat_w3 , gen(fr_trips_cat_)

  {txt}Number of {c |}
   trips in {c |}
last 7 days {c |}
   to visit {c |}
    friends {c |}
   (wave 3) {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        322       77.22       77.22
{txt}          1 {c |}{res}         57       13.67       90.89
{txt}          2 {c |}{res}         24        5.76       96.64
{txt}          3 {c |}{res}         12        2.88       99.52
{txt}          4 {c |}{res}          2        0.48      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        417      100.00
{txt}
{com}.         
.         forvalues               i = 1/5 {c -(}
{txt}  2{com}.                                         lab var fr_trips_cat_`i' "Binary indicator for `i' trips in last 7 days to visit friends (wave 3)"
{txt}  3{com}.         {c )-}
{txt}
{com}. 
. * Trimmed variable for number of trips in past week for HH errands
.         gen                     he_trips_cat_w3 = 0 if numtrip_hherrand_w3==0
{txt}(491 missing values generated)

{com}.         replace                 he_trips_cat_w3 = 1 if numtrip_hherrand_w3>= 1 & numtrip_hherrand_w3< 2
{txt}(120 real changes made)

{com}.         replace                 he_trips_cat_w3 = 2 if numtrip_hherrand_w3>= 2 & numtrip_hherrand_w3< 3
{txt}(82 real changes made)

{com}.         replace                 he_trips_cat_w3 = 3 if numtrip_hherrand_w3>= 3 & numtrip_hherrand_w3< 6
{txt}(73 real changes made)

{com}.         replace                 he_trips_cat_w3 = 4 if numtrip_hherrand_w3>= 6 & numtrip_hherrand_w3< .
{txt}(26 real changes made)

{com}.         lab var                 he_trips_cat_w3 "Number of trips in last 7 days for HH errands (wave 3)"
{txt}
{com}.                                         
.         tab                             he_trips_cat_w3 , gen(he_trips_cat_)

  {txt}Number of {c |}
   trips in {c |}
last 7 days {c |}
     for HH {c |}
    errands {c |}
   (wave 3) {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        115       27.64       27.64
{txt}          1 {c |}{res}        120       28.85       56.49
{txt}          2 {c |}{res}         82       19.71       76.20
{txt}          3 {c |}{res}         73       17.55       93.75
{txt}          4 {c |}{res}         26        6.25      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        416      100.00
{txt}
{com}.         
.         forvalues               i = 1/5 {c -(}
{txt}  2{com}.                                         lab var he_trips_cat_`i' "Binary indicator for `i' trips in last 7 days for HH errands (wave 3)"
{txt}  3{com}.         {c )-}
{txt}
{com}.         
. * Trimmed variable for number of trips in past week for personal errands
.         gen                     pe_trips_cat_w3 = 0 if numtrip_perrand_w3==0
{txt}(421 missing values generated)

{com}.         replace                 pe_trips_cat_w3 = 1 if numtrip_perrand_w3>= 1 & numtrip_perrand_w3< 2
{txt}(122 real changes made)

{com}.         replace                 pe_trips_cat_w3 = 2 if numtrip_perrand_w3>= 2 & numtrip_perrand_w3< 3
{txt}(44 real changes made)

{com}.         replace                 pe_trips_cat_w3 = 3 if numtrip_perrand_w3>= 3 & numtrip_perrand_w3< 6
{txt}(46 real changes made)

{com}.         replace                 pe_trips_cat_w3 = 4 if numtrip_perrand_w3>= 6 & numtrip_perrand_w3< .
{txt}(18 real changes made)

{com}.         lab var                 pe_trips_cat_w3 "Number of trips in last 7 days for personal errands (wave 3)"
{txt}
{com}.                                         
.         tab                             pe_trips_cat_w3 , gen(pe_trips_cat_)

  {txt}Number of {c |}
   trips in {c |}
last 7 days {c |}
        for {c |}
   personal {c |}
    errands {c |}
   (wave 3) {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        185       44.58       44.58
{txt}          1 {c |}{res}        122       29.40       73.98
{txt}          2 {c |}{res}         44       10.60       84.58
{txt}          3 {c |}{res}         46       11.08       95.66
{txt}          4 {c |}{res}         18        4.34      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        415      100.00
{txt}
{com}.         
.         forvalues               i = 1/5 {c -(}
{txt}  2{com}.                                         lab var pe_trips_cat_`i' "Binary indicator for `i' trips in last 7 days for personal errands (wave 3)"
{txt}  3{com}.         {c )-}
{txt}
{com}.         
. * Trimmed variable for number of trips in past week for all errands
.         gen                     errand_trips_cat_w3 = 0 if numtrip_allerrand_w3==0
{txt}(529 missing values generated)

{com}.         replace                 errand_trips_cat_w3 = 1 if numtrip_allerrand_w3>= 1 & numtrip_allerrand_w3< 2
{txt}(66 real changes made)

{com}.         replace                 errand_trips_cat_w3 = 2 if numtrip_allerrand_w3>= 2 & numtrip_allerrand_w3< 3
{txt}(87 real changes made)

{com}.         replace                 errand_trips_cat_w3 = 3 if numtrip_allerrand_w3>= 3 & numtrip_allerrand_w3< 6
{txt}(121 real changes made)

{com}.         replace                 errand_trips_cat_w3 = 4 if numtrip_allerrand_w3>= 6 & numtrip_allerrand_w3< .
{txt}(63 real changes made)

{com}.         lab var                 errand_trips_cat_w3 "Number of trips in last 7 days for all errands (wave 3)"
{txt}
{com}.                                         
.         tab                             errand_trips_cat_w3 , gen(errand_trips_cat_)

  {txt}Number of {c |}
   trips in {c |}
last 7 days {c |}
    for all {c |}
    errands {c |}
   (wave 3) {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}         77       18.60       18.60
{txt}          1 {c |}{res}         66       15.94       34.54
{txt}          2 {c |}{res}         87       21.01       55.56
{txt}          3 {c |}{res}        121       29.23       84.78
{txt}          4 {c |}{res}         63       15.22      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}        414      100.00
{txt}
{com}. 
.         forvalues               i = 1/5 {c -(}
{txt}  2{com}.                                         lab var errand_trips_cat_`i' "Binary indicator for `i' trips in last 7 days for all errands (wave 3)"
{txt}  3{com}.         {c )-}
{txt}
{com}.         
. 
.         
. ********************************
. * EMPLOYMENT AND JOB SEARCH
. ********************************
. 
.         * labelling 
.         lab var E1 "Employment status (wave 3)"
{txt}
{com}.         lab var E4_6_TEXT "Number of jobs applied to in last month (wave 3)"
{txt}
{com}.         lab var E2_12_TEXT "Number of hours worked | employed (wave 3)"
{txt}
{com}.         lab var E3 "Steps taken in past month to search for job (wave 3)"
{txt}
{com}.         
.         * employment
.                 * first drop employed var (this was part of embedded data from wave 1&2)
.                 drop employed 
{txt}
{com}.                 
.         gen employed_w3 = 0 if strpos(E1, "No")
{txt}(249 missing values generated)

{com}.         replace employed_w3 = 1 if strpos(E1, "Yes")
{txt}(131 real changes made)

{com}.         lab var employed_w3 "Employed (wave 3)"
{txt}
{com}.         lab val employed_w3 binary
{txt}
{com}.         
.         * category version
.         gen employ_cat_w3 = 0 if E1=="No, I am not employed and I‚Äôm not looking for a job" ///
>                 | E1== "No, I am a student and I plan to work after graduation " ///
>                 | E1== "No, I am a student and I‚Äôm not looking for a job"
{txt}(492 missing values generated)

{com}.                 replace employ_cat_w3 = 1 if E1== "No, I am not employed and I am looking for a job "
{txt}(243 real changes made)

{com}.                 replace employ_cat_w3 = 2 if E1== "Yes, I am employed but not looking for a different job" ///
>                 | E1== "Yes, I am employed and open to looking for a different or additional job"
{txt}(131 real changes made)

{com}.         lab var employ_cat_w3 "Employment category (wave 3)"
{txt}
{com}.         
.         
.         * create center/standardized version for labor force index
.         sum employed_w3 if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}employed_w3 {c |}{res}        181    .2099448    .4083986          0          1
{txt}
{com}.         gen employed_st_w3 = .
{txt}(606 missing values generated)

{com}.         replace employed_st_w3 = (employed_w3-r(mean))/r(sd)
{txt}(488 real changes made)

{com}.         lab var employed_st_w3 "Employed - centered/standardized (wave 3)"
{txt}
{com}. 
.         
.         
.         * number of hours worked
.         destring E2_12_TEXT, replace
{txt}E2_12_TEXT: all characters numeric; {res}replaced {txt}as {res}double
{txt}(500 missing values generated)
{res}{txt}
{com}.         *histogram E2_12_TEXT
.         * NOTE: let's start with creating a binary at the median, can revise later 
.         xtile hrs_worked_w3 = E2_12_TEXT, nq(2)
{txt}
{com}.         lab var hrs_worked_w3 "Hours worked last week: binary at median (wave 3)"
{txt}
{com}.         
.                 * now create unconditional version
.                 gen E2_unconditional = E2_12_TEXT
{txt}(500 missing values generated)

{com}.                 replace E2_unconditional = 0 if employed_w3==0 
{txt}(356 real changes made)

{com}.                 lab var E2_unconditional "E2 (hours worked last week) - unconditional (wave 3)"
{txt}
{com}.         
.         
.         * number of jobs applied to in last month
.         destring E4_6_TEXT, replace
{txt}E4_6_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(378 missing values generated)
{res}{txt}
{com}.         replace E4_6_TEXT = 0 if E4=="None "
{txt}(97 real changes made)

{com}.                 
. 
.         
.         * number of activities taken in last month to search for a job
.         gen E3_ncommas = length(E3) - length(subinstr(E3, ",", "", .))
{txt}
{com}.         replace E3_ncommas = . if E3==""
{txt}(329 real changes made, 329 to missing)

{com}.         gen E3_numbered = E3_ncommas + 1
{txt}(329 missing values generated)

{com}.         replace E3_numbered = 0 if E3=="" & E1!=""
{txt}(216 real changes made)

{com}.         replace E3_numbered = 0 if (strpos(E1, "not looking"))
{txt}(0 real changes made)

{com}.         replace E3_numbered = 0 if E3=="I prefer not to answer this question" | ///
>         E3=="I have not taken any steps in the last 30 days to look for a job"
{txt}(43 real changes made)

{com}.         replace E3_numbered =. if E3== "Call ended / connection lost / respondent hung up the phone"
{txt}(0 real changes made)

{com}.         lab var E3_numbered "E3: number of job search activities undertaken in past month (wave 3)"
{txt}
{com}. 
.         * desired edu for (grand)daughter
.          lab def edu 1 "Complete high school " 2 "Complete diploma" ///
>                 3 "Complete vocational training" 4 "Complete a university degree" ///
>                 5 "Complete a degree beyond university (graduate/professional)"
{txt}
{com}.         lab val G11_scale edu
{txt}
{com}.         
.         lab def agreement 1 "Definitely no" 2 "Probably no" 3 "Unsure" 4 "Probably yes" ///
>         5 "Definitely yes"
{txt}
{com}.         lab val G12_scale agreement
{txt}
{com}.         
.         
.         
.                 
.                 * Not in LFP - 0 if in LF and 1 if not
.                 gen not_in_LF_w3 = .
{txt}(606 missing values generated)

{com}.                 replace not_in_LF_w3 = 1 if E1=="No, I am not employed and I‚Äôm not looking for a job" ///
>                         | E1== "No, I am a student and I plan to work after graduation " ///
>                         | E1== "No, I am a student and I‚Äôm not looking for a job"
{txt}(114 real changes made)

{com}.                 replace not_in_LF_w3 = 0 if E1== "No, I am not employed and I am looking for a job "
{txt}(243 real changes made)

{com}.                 replace not_in_LF_w3 = 0 if E1== "Yes, I am employed but not looking for a different job" ///
>                         | E1== "Yes, I am employed and open to looking for a different or additional job"
{txt}(131 real changes made)

{com}.                 lab var not_in_LF_w3 "Not in labor force (wave 3)"
{txt}
{com}.                 lab def noLF 0 "in LF" 1 "not in LF" 
{txt}
{com}.                 lab val not_in_LF_w3 noLF
{txt}
{com}.                 
.                 
.                 * LFP - 0 if  not employed and not looking,  1 if unemployed and looking, 2 if employed
.                 gen LFP_w3 = .
{txt}(606 missing values generated)

{com}.                 replace LFP_w3 = 0 if E1=="No, I am not employed and I‚Äôm not looking for a job" ///
>                         | E1== "No, I am a student and I plan to work after graduation " ///
>                         | E1== "No, I am a student and I‚Äôm not looking for a job"
{txt}(114 real changes made)

{com}.                         
.                 replace LFP_w3 = 1 if E1== "No, I am not employed and I am looking for a job "
{txt}(243 real changes made)

{com}.                 replace LFP_w3 = 2 if E1== "Yes, I am employed but not looking for a different job" ///
>                         | E1== "Yes, I am employed and open to looking for a different or additional job"
{txt}(131 real changes made)

{com}.                 
.                 lab var LFP_w3 "Labor force participation (wave 3)"
{txt}
{com}.                 lab def lfp 0 "out of LF" 1 "unemployed" 2 "employed"
{txt}
{com}.                 lab val LFP_w3 lfp      
{txt}
{com}.                 
.                 * Binary LFP
.                 gen in_LF_w3 = LFP_w3
{txt}(118 missing values generated)

{com}.                 replace in_LF_w3 = 1 if LFP_w3==2
{txt}(131 real changes made)

{com}.                 lab var in_LF_w3 "In the labor force (wave 3)"
{txt}
{com}.                 lab def lf_bi 0 "out of LF" 1 "in LF"
{txt}
{com}.                 lab val in_LF_w3 lf_bi
{txt}
{com}.                 
.                 * create center/standardized version for labor force index
.                 sum in_LF_w3 if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 4}in_LF_w3 {c |}{res}        181    .7790055    .4160677          0          1
{txt}
{com}.                 gen in_LF_st_w3 = .
{txt}(606 missing values generated)

{com}.                 replace in_LF_st_w3 = (in_LF_w3-r(mean))/r(sd)
{txt}(488 real changes made)

{com}.                 lab var in_LF_st_w3 "In labor force - centered/standardized (wave 3)"
{txt}
{com}.                 
.                 
.         /* searching for a job (NOTE: simple defn of any search, we don't use this and 
>                 instead use defn of search to be actively applying to jobs)     */
.                 gen job_search_w3 = .
{txt}(606 missing values generated)

{com}.                 replace job_search_w3 = 0 if (strpos(E1, "not looking"))
{txt}(156 real changes made)

{com}.                 replace job_search_w3 = 0 if E1=="No, I am a student and I plan to work after graduation "
{txt}(19 real changes made)

{com}.                 replace job_search_w3 = 1 if E1=="No, I am not employed and I am looking for a job " ///
>                         | E1=="Yes, I am employed and open to looking for a different or additional job"        
{txt}(313 real changes made)

{com}.                 lab var job_search_w3 "Searching for a job (wave 3)"
{txt}
{com}.                 
.                         /* on the job search - 0 not empl., or empl but not looking; 1 - empl
>                         and looking */
.                         gen on_job_search_w3 = .
{txt}(606 missing values generated)

{com}.                         replace on_job_search_w3 = 0 if E1=="No, I am not employed and I‚Äôm not looking for a job" ///
>                         | E1== "No, I am a student and I plan to work after graduation " ///
>                         | E1== "No, I am a student and I‚Äôm not looking for a job" ///
>                         | E1== "No, I am not employed and I am looking for a job " ///
>                         | E1== "Yes, I am employed but not looking for a different job"
{txt}(418 real changes made)

{com}.                         replace on_job_search_w3 = 1 if ///
>                         E1== "Yes, I am employed and open to looking for a different or additional job"
{txt}(70 real changes made)

{com}.                         lab var on_job_search_w3 "On the job search (wave 3)"
{txt}
{com}.                         
.                 
.                         
.                         * off the job search (unemployed search)
.                         gen unemployed_w3 = .
{txt}(606 missing values generated)

{com}.                         replace unemployed_w3 = 0 if E1=="No, I am not employed and I‚Äôm not looking for a job" ///
>                         | E1== "No, I am a student and I plan to work after graduation " ///
>                         | E1== "No, I am a student and I‚Äôm not looking for a job" ///
>                         | E1== "Yes, I am employed but not looking for a different job" ///
>                         | E1 == "Yes, I am employed and open to looking for a different or additional job"
{txt}(245 real changes made)

{com}.                         replace unemployed_w3 = 1 if ///
>                         E1== "No, I am not employed and I am looking for a job "
{txt}(243 real changes made)

{com}.                         lab var unemployed_w3 "Unemployed job search (wave 3)"
{txt}
{com}.                         
.                                 * standardize for indices
.                                 sum unemployed_w3 if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
unemployed~3 {c |}{res}        181    .5690608    .4965813          0          1
{txt}
{com}.                                 gen unemployed_w3_st =.
{txt}(606 missing values generated)

{com}.                                 replace unemployed_w3_st = (unemployed_w3-r(mean))/r(sd)
{txt}(488 real changes made)

{com}.                                 lab var unemployed_w3_st "Unemployed (wave 3) - centered/standardized binary (created using mean)"
{txt}
{com}.                         
.                 
.                         
.                         * employed not searching 
.                         gen employed_nosearch_w3 = .
{txt}(606 missing values generated)

{com}.                         replace employed_nosearch_w3 = 0 if E1== ///
>                         "No, I am not employed and I‚Äôm not looking for a job" ///
>                         | E1== "No, I am a student and I plan to work after graduation " ///
>                         | E1== "No, I am a student and I‚Äôm not looking for a job" ///
>                         | E1== "No, I am not employed and I am looking for a job " ///
>                         | E1== "Yes, I am employed and open to looking for a different or additional job"
{txt}(427 real changes made)

{com}.                         replace employed_nosearch_w3 = 1 if E1== ///
>                         "Yes, I am employed but not looking for a different job"
{txt}(61 real changes made)

{com}.                         lab var employed_nosearch_w3 "Employed and not searching (wave 3)"
{txt}
{com}.                         
.                         
.                 
.         * percent of job search activities undertaken
.                 gen search_act_prop_w3 = (E3_numbered/8) 
{txt}(113 missing values generated)

{com}.                 replace search_act_prop_w3 = 0 if (strpos(E1, "not looking")) 
{txt}(0 real changes made)

{com}.                 lab var search_act_prop_w3 "Percentage of job search activities undertaken (wave 3)"
{txt}
{com}.                 
.                         
.         
.         * travelled to search for job
.                 gen  travel_job_search_w3 = 0 if ///
>                         !(strpos(E3, "Visited a job centre (JPC) in person")) ///
>                         & !(strpos(E3,"Travelled to employers in person to ask about job opportunities or drop off your CV")) ///
>                         & !(strpos(E3,"Call ended / connection lost / respondent hung up the phone")) ///
>                          & E1!=""
{txt}(240 missing values generated)

{com}.                 replace travel_job_search_w3 = 0 if (strpos(E1, "not looking")) 
{txt}(0 real changes made)

{com}.                 replace travel_job_search_w3 = 1 if ((strpos(E3,"Visited a job centre (JPC) in person") | ///
>                         strpos(E3,"Travelled to employers in person to ask about job opportunities or drop off your CV")))
{txt}(127 real changes made)

{com}.                 lab var travel_job_search_w3 "Travelled for job search (wave 3)"
{txt}
{com}.                 
.                 
.                 
.         * number of jobs applied to in last month
.                 gen jobs_applied_w3 = E4_6_TEXT 
{txt}(281 missing values generated)

{com}.                 replace jobs_applied_w3 = 0 if E4=="None " 
{txt}(0 real changes made)

{com}.                 replace jobs_applied_w3 = 0 if (strpos(E1, "not looking")) 
{txt}(156 real changes made)

{com}.                 replace jobs_applied_w3 = 0 if (strpos(E1, "I am a student")) 
{txt}(5 real changes made)

{com}.                 lab var jobs_applied_w3 "Number of jobs applied to in last month (wave 3)"
{txt}
{com}.                 
.         * number of jobs applied to in last month by employed
.         gen jobs_applied_empl_w3 = jobs_applied_w3*employed_w3
{txt}(125 missing values generated)

{com}.         lab var jobs_applied_empl_w3 "Jobs applied to in last month x employed (wave 3)"
{txt}
{com}.         
.         * number of jobs applied to in last month by employed
.         gen jobs_applied_unempl_w3 = jobs_applied_w3*unemployed_w3
{txt}(125 missing values generated)

{com}.         lab var jobs_applied_unempl_w3 "Jobs applied to in last month x unemployed (wave 3)"
{txt}
{com}.         
.         
.                 
.         * binary indicator for applied to any job in last month
.                 gen job_any_applied_w3 = 0 if jobs_applied_w3!=.
{txt}(124 missing values generated)

{com}.                 replace job_any_applied_w3 = 1 if jobs_applied_w3>0 & jobs_applied_w3!=.
{txt}(223 real changes made)

{com}.                 lab var job_any_applied_w3 "Applied to any job in past month (wave 3)"
{txt}
{com}.                         
.         * employed job search (binary indicator for employed and applied to any job)
.         gen empl_jobsearch_w3 = 0 if jobs_applied_w3!=. & employed_w3!=.
{txt}(125 missing values generated)

{com}.         replace empl_jobsearch_w3 = 0 if jobs_applied_w3==. & employed_w3==0
{txt}(2 real changes made)

{com}.         replace empl_jobsearch_w3 = 1 if jobs_applied_w3!=. & jobs_applied_w3>0 & employed_w3==1
{txt}(47 real changes made)

{com}.         lab var empl_jobsearch_w3 "Employed and applied in past month (wave 3)"
{txt}
{com}.         
.                 * Standardize for indices
.                 sum empl_jobsearch_w3 if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
empl_jobse~3 {c |}{res}        180    .0722222    .2595776          0          1
{txt}
{com}.                 gen empl_jobsearch_w3_st =.
{txt}(606 missing values generated)

{com}.                 replace empl_jobsearch_w3_st = (empl_jobsearch_w3-r(mean))/r(sd)
{txt}(483 real changes made)

{com}.                 lab var empl_jobsearch_w3_st "Emp and applied in past month (wave 3) - centered/standardized binary (created using mean)"
{txt}note: label truncated to 80 characters

{com}.         
.         * unemployed job search (binary indicator for unemployed and applied to any job)
.         gen unempl_jobsearch_w3 = 0 if jobs_applied_w3!=. & unemployed_w3!=.
{txt}(125 missing values generated)

{com}.         replace unempl_jobsearch_w3 = 0 if jobs_applied_w3==. & unemployed_w3==0
{txt}(5 real changes made)

{com}.         replace unempl_jobsearch_w3 = 1 if jobs_applied_w3!=. & jobs_applied_w3>0 & unemployed_w3==1
{txt}(175 real changes made)

{com}.         lab var unempl_jobsearch_w3 "Unemployed and applied in past month (wave 3)"
{txt}
{com}.         
.         * any job search 
.         gen any_jobsearch_w3 = 0 if jobs_applied_w3!=. & unemployed_w3!=. & employed_w3!=.
{txt}(125 missing values generated)

{com}.         replace any_jobsearch_w3 = 0 if unemployed_w3==0 & employed_w3==0
{txt}(0 real changes made)

{com}.         replace any_jobsearch_w3 = 1 if unemployed_w3==1 | empl_jobsearch_w3==1
{txt}(290 real changes made)

{com}.         lab var any_jobsearch_w3 "Searching for job (wave 3)"
{txt}
{com}.                         
.           
. ********************************        
. * SOCIAL NETWORK AND CIVIC ENGAGEMENT VARS
. ********************************
. 
.         * labelling 
.         lab var N2_4_TEXT "Number of people texted with in last 7 days (wave 3)"
{txt}
{com}.         lab var N4 "Met anyone in past month and exchanged contact info (wave 3)"
{txt}
{com}.         lab var R1 "Do you have a Whatsapp account (wave 3)"
{txt}
{com}.         lab var R2 "Do you have a LinkedIn account (wave 3)"
{txt}
{com}.         lab var R6 "Do you have an Instagram account (wave 3)"
{txt}
{com}.         lab var R8 "Option selected for Instagram followers (wave 3)"
{txt}
{com}.         lab var R8_1_TEXT "Number of people followed on Instagram (wave 3)"
{txt}
{com}.         lab var R8_2_TEXT "Number of followers on Instagram (wave 3)"
{txt}
{com}.         lab var R10 "Do you have a Twitter account (wave 3)"
{txt}
{com}.         lab var R12 "Option selected for Twitter followers (wave 3)"
{txt}
{com}.         lab var R12_1_TEXT "Number of people followed on Twitter (wave 3)"
{txt}
{com}.         lab var R12_2_TEXT "Number of followers on Twitter (wave 3)"
{txt}
{com}.         lab var R16 "Would you like to nominate friends for Qudra (wave 3)"
{txt}
{com}.         lab var R16_5_TEXT "Number of people she'd like to nominate for Qudra (wave 3)"
{txt}
{com}.         lab var Q124 "Registered on national volunteering platform (wave 3)"
{txt}
{com}.         lab var Q125 "Registered on national volunteering platform (wave 3)"
{txt}
{com}.         lab var CM1 "People can spread COVID-19 without symptoms (wave 3)"
{txt}
{com}.         lab var CM2 "Agreement with government saying there cannot be large public gatherings due to COVID-19 (wave 3)"
{txt}note: label truncated to 80 characters

{com}.         lab var CM3 "Agreement with WHO saying there cannot be large public gatherings due to COVID-19 (wave 3)"
{txt}note: label truncated to 80 characters

{com}.         lab var CM8 "Feelings about restrictions being placed in response to COVID-19 (wave 3)"
{txt}
{com}.         lab var CM9 "Stated feeling about reaction of government to COVID-19 (wave 3)"
{txt}
{com}. 
.         
. 
.         * interactions in past 1 week
.         destring  N1_4_TEXT, replace
{txt}N1_4_TEXT: all characters numeric; {res}replaced {txt}as {res}int
{txt}(134 missing values generated)
{res}{txt}
{com}.                 * one outlier at 403, let's drop this outlier
.         gen N1_cleaned = N1_4_TEXT
{txt}(134 missing values generated)

{com}.         replace N1_cleaned = . if N1_cleaned==403
{txt}(1 real change made, 1 to missing)

{com}.         lab var N1_cleaned "Number of people spoken to on phone (wave 3)"
{txt}
{com}.         
.                 * create binary version for index
.                 xtile N1_cleaned_abovemed = N1_cleaned, nq(2)
{txt}
{com}.                 recode N1_cleaned_abovemed (1 = 0) (2 = 1)
{txt}(471 changes made to {bf:N1_cleaned_abovemed})

{com}.                 lab var N1_cleaned_abovemed "Number of people spoken to on phone - binary at median (wave 3)"
{txt}
{com}.                 
.                 sum N1_cleaned_abovemed if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
N1_cleaned~d {c |}{res}        173    .4682081    .5004367          0          1
{txt}
{com}.                 gen N1_cleaned_abovemed_st = .
{txt}(606 missing values generated)

{com}.                 replace N1_cleaned_abovemed_st = (N1_cleaned_abovemed - r(mean))/r(sd)
{txt}(471 real changes made)

{com}.                 lab var N1_cleaned_abovemed_st "N1_cleaned_abovemed - center/standardized likert (wave 3)"
{txt}
{com}.                 
.         * texted with in past week
.         destring  N2_4_TEXT, replace
{txt}N2_4_TEXT: all characters numeric; {res}replaced {txt}as {res}int
{txt}(197 missing values generated)
{res}{txt}
{com}.         
.         * met up with in past week
.         tab N3_1_TEXT

                     {txt}(lastnm) N3_1_TEXT {c |}      Freq.     Percent        Cum.
{hline 40}{c +}{hline 35}
                                      0 {c |}{res}         68       14.75       14.75
{txt}                                      1 {c |}{res}         34        7.38       22.13
{txt}                                     10 {c |}{res}         36        7.81       29.93
{txt}                                     11 {c |}{res}          7        1.52       31.45
{txt}                                     12 {c |}{res}          6        1.30       32.75
{txt}                                     13 {c |}{res}          1        0.22       32.97
{txt}                                     14 {c |}{res}          5        1.08       34.06
{txt}                                     15 {c |}{res}         16        3.47       37.53
{txt}                                     18 {c |}{res}          2        0.43       37.96
{txt}                                     19 {c |}{res}          3        0.65       38.61
{txt}                                      2 {c |}{res}         28        6.07       44.69
{txt}                                     20 {c |}{res}         24        5.21       49.89
{txt}                                    200 {c |}{res}          1        0.22       50.11
{txt}                                     22 {c |}{res}          2        0.43       50.54
{txt}                                     23 {c |}{res}          2        0.43       50.98
{txt}                                     24 {c |}{res}          1        0.22       51.19
{txt}                                     25 {c |}{res}          8        1.74       52.93
{txt}                                     29 {c |}{res}          1        0.22       53.15
{txt}                                      3 {c |}{res}         45        9.76       62.91
{txt}                                     30 {c |}{res}          7        1.52       64.43
{txt}                                    300 {c |}{res}          1        0.22       64.64
{txt}                                     32 {c |}{res}          2        0.43       65.08
{txt}                                     35 {c |}{res}          3        0.65       65.73
{txt}                                     38 {c |}{res}          1        0.22       65.94
{txt}                                      4 {c |}{res}         40        8.68       74.62
{txt}                                     40 {c |}{res}          5        1.08       75.70
{txt}                                      5 {c |}{res}         23        4.99       80.69
{txt}                                     50 {c |}{res}          5        1.08       81.78
{txt}                                      6 {c |}{res}         29        6.29       88.07
{txt}                                      7 {c |}{res}         23        4.99       93.06
{txt}                                      8 {c |}{res}         23        4.99       98.05
{txt}                                      9 {c |}{res}          8        1.74       99.78
{txt}                                     90 {c |}{res}          1        0.22      100.00
{txt}{hline 40}{c +}{hline 35}
                                  Total {c |}{res}        461      100.00
{txt}
{com}.         
.         *** NOTE: fix character error for one entry ('50Ÿ™')
.         replace N3_1_TEXT="50" if N3_1_TEXT =="50Ÿ™"
{txt}(0 real changes made)

{com}.         destring N3_1_TEXT, replace
{txt}N3_1_TEXT: all characters numeric; {res}replaced {txt}as {res}int
{txt}(145 missing values generated)
{res}{txt}
{com}.                 * there's one val of 300, which seems like an outlier - let's move that to missing
.         gen N3_cleaned = N3_1_TEXT
{txt}(145 missing values generated)

{com}.         replace N3_cleaned = . if N3_cleaned==300
{txt}(1 real change made, 1 to missing)

{com}.         lab var N3_cleaned "Number of people met with in last 7 days (wave 3)"
{txt}
{com}.         
.                 * create binary version for index
.                 xtile N3_cleaned_abovemed = N3_cleaned, nq(2)
{txt}
{com}.                 recode N3_cleaned_abovemed (1 = 0) (2 = 1)
{txt}(460 changes made to {bf:N3_cleaned_abovemed})

{com}.                 lab var N3_cleaned_abovemed "Number of people met with in last 7 days - binary at median (wave 3)"
{txt}
{com}.                 
.                 sum N3_cleaned_abovemed if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
N3_cleaned~d {c |}{res}        170    .4764706    .5009215          0          1
{txt}
{com}.                 gen N3_cleaned_abovemed_st = .
{txt}(606 missing values generated)

{com}.                 replace N3_cleaned_abovemed_st = (N3_cleaned_abovemed - r(mean))/r(sd)
{txt}(460 real changes made)

{com}.                 lab var N3_cleaned_abovemed_st "N3_cleaned_abovemed - center/standardized likert (wave 3)"
{txt}
{com}.         
.         * met anyone in past month where contact info was exchanged
.         gen N4_cleaned = 1 if N4=="Yes"
{txt}(511 missing values generated)

{com}.         replace N4_cleaned = 0 if N4=="No"
{txt}(318 real changes made)

{com}.         lab var N4_cleaned "N4 as binary yes/no"
{txt}
{com}.         
.         * number of people texted in last 24 hrs
.         winsor2 N2_4_TEXT, cuts(0 98)
{txt}
{com}.         rename N2_4_TEXT_w text_prev_24hr_w3
{res}{txt}
{com}.         lab var text_prev_24hr_w3 "Number of people texted in prev. 24 hrs (right tail winsor to 98p) (wave 3)" 
{txt}
{com}.         
.         * LinkedIn connections (only 39 respondents have an account)
.         destring R5_5_TEXT, replace
{txt}R5_5_TEXT: all characters numeric; {res}replaced {txt}as {res}int
{txt}(573 missing values generated)
{res}{txt}
{com}.         gen R5_cleaned = R5_5_TEXT
{txt}(573 missing values generated)

{com}.         * let's replace missings with 0 as they don't have an account
.         destring R5_6_TEXT, replace
{txt}R5_6_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(605 missing values generated)
{res}{txt}
{com}.         replace R5_cleaned = 0 if R2=="No"
{txt}(343 real changes made)

{com}.         replace R5_cleaned = R5_6_TEXT if R5_6_TEXT!=.
{txt}(1 real change made)

{com}.         lab var R5_cleaned "R5 - number of LinkedIn connections"
{txt}
{com}.         
.                 * let's transform this: inverse hyperbolic sine
.                 ihstrans R5_cleaned
{txt}(229 missing values generated)

{com}.                 lab var ihs_R5_cleaned "No. of LinkedIn connections (IHS transformation) (wave 3)"
{txt}
{com}.         
.         * Instagram followers
.         gen insta_followers =  R8_2_TEXT 
{txt}(414 missing values generated)

{com}.         
.                 * remove unwanted characters (add additional characters below)
.                 global characters _ asa sa ,
{txt}
{com}.                 foreach j of global characters {c -(}
{txt}  2{com}.                 replace insta_followers = subinstr(insta_followers, "`j'", "", .)
{txt}  3{com}.                 {c )-}
{txt}(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

{com}. 
.                 * replace 'k' with additional zeroes
.                 replace insta_followers = insta_followers + "000" if strpos(R8_2_TEXT, "k")
{txt}(1 real change made)

{com}.                 replace insta_followers = subinstr(insta_followers, "k", "", .)
{txt}(1 real change made)

{com}.                 replace insta_followers = "" if insta_followers=="Ÿ°Ÿ©Ÿ†"
{txt}(1 real change made)

{com}.                 destring insta_followers, replace
{txt}insta_followers: all characters numeric; {res}replaced {txt}as {res}long
{txt}(415 missing values generated)
{res}{txt}
{com}.                 replace insta_followers = 0 if R6=="No"
{txt}(142 real changes made)

{com}.                 
.                 * let's transform this: inverse hyperbolic sine
.                 ihstrans insta_followers
{txt}(274 missing values generated)

{com}.                 lab var insta_followers "No. of instagram followers"
{txt}
{com}.                 lab var ihs_insta_followers "No. of instagram followers (IHS transformation) (wave 3)"
{txt}
{com}. 
. 
.         
.         * Twitter followers
.         destring R12_2_TEXT, replace
{txt}R12_2_TEXT: all characters numeric; {res}replaced {txt}as {res}int
{txt}(472 missing values generated)
{res}{txt}
{com}.         gen twitter_followers = R12_2_TEXT
{txt}(472 missing values generated)

{com}.         replace twitter_followers = 0 if R10 == "No"
{txt}(220 real changes made)

{com}.         lab var twitter_followers "Number of Twitter followers"
{txt}
{com}.         
.                 * let's transform this: inverse hyperbolic sine
.                 ihstrans twitter_followers
{txt}(252 missing values generated)

{com}.                 lab var ihs_twitter_followers "No. of Twitter followers (IHS transformation) (wave 3)"
{txt}
{com}.                 
.         
. 
.         
.         /* volunteering using national registry: let's create binary if they've signed up for 
>         any opportunities (too few have even registered that I'm not sure it makes sense to 
>         look at how many times they've actually volunteered) */
.         destring  Q125_1_TEXT, replace
{txt}Q125_1_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(586 missing values generated)
{res}{txt}
{com}.         gen volunt_regist = 0 if Q124=="Yes" | strpos(Q125, "I have not")
{txt}(581 missing values generated)

{com}.         replace volunt_regist = 1 if Q125_1_TEXT>0 &  Q125_1_TEXT!=.
{txt}(19 real changes made)

{com}.         lab var volunt_regist "Registered for natl vol & signed up for 1+ opport (wave 3)"
{txt}
{com}.         
.         * number of volunteer opportunities
.         gen num_volunteer = Q125_1_TEXT
{txt}(586 missing values generated)

{com}.         replace num_volunteer = 0 if strpos(Q125, "I have not")
{txt}(5 real changes made)

{com}.         lab var num_volunteer "Number of volunteer opportunities signed up for (wave 3)"
{txt}
{com}.         
.         * number of volunteer opportunities attended
.         destring Q126_1_TEXT, replace
{txt}Q126_1_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(594 missing values generated)
{res}{txt}
{com}.         gen num_times_volunteer = Q126_1_TEXT
{txt}(594 missing values generated)

{com}.         replace num_times_volunteer = 0 if strpos(Q126, "I have not")
{txt}(7 real changes made)

{com}.         lab var num_times_volunteer "Number of volunteer opportunities attended (wave 3)"
{txt}
{com}.         
.         * number of groups respondent belongs to (G14)
.         gen G14_ncommas = length(G14) - length(subinstr(G14, ",", "", .)) if G14!=""
{txt}(270 missing values generated)

{com}.         gen G14_numbered = G14_ncommas + 1
{txt}(270 missing values generated)

{com}.         replace G14_numbered = . if G14=="Prefer not to answer"
{txt}(13 real changes made, 13 to missing)

{com}.         * | G14=="" 
.         lab var G14_numbered "Number of group types she belongs to (wave 3)"
{txt}
{com}.         
.         * number of times in past month she attended meetings of any of these groups
.         destring G15_4_TEXT, replace
{txt}G15_4_TEXT: all characters numeric; {res}replaced {txt}as {res}byte
{txt}(339 missing values generated)
{res}{txt}
{com}.         gen G15_cleaned = G15_4_TEXT
{txt}(339 missing values generated)

{com}.         replace G15_cleaned = 0 if strpos(G15, "I did not attend")
{txt}(132 real changes made)

{com}.         lab var G15_cleaned "Number of times attended meetings of any group in past month (wave 3)"
{txt}
{com}.         
.         * Now create social network vars that are centered/standardized for index
.         global socnet N1_cleaned N2_4_TEXT N3_cleaned N4_cleaned R5_cleaned ihs_insta_followers ///
>         twitter_followers G14_numbered G15_cleaned
{txt}
{com}.         
.         foreach var of global socnet {c -(}
{txt}  2{com}.                         gen `var'_st = .
{txt}  3{com}.                         sum `var' if treatment==0 
{txt}  4{com}.                         replace `var'_st = (`var'-r(mean))/r(sd)
{txt}  5{com}.                         lab var `var'_st "`var' - centered/standardized (wave 3)"       
{txt}  6{com}.         {c )-}
{txt}(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 2}N1_cleaned {c |}{res}        173    7.358382    12.13868          0        100
{txt}(471 real changes made)
(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 3}N2_4_TEXT {c |}{res}        143    20.33566    94.37496          0       1000
{txt}(409 real changes made)
(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 2}N3_cleaned {c |}{res}        170    8.264706    10.91145          0         90
{txt}(460 real changes made)
(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 2}N4_cleaned {c |}{res}        144    .2847222    .4528572          0          1
{txt}(413 real changes made)
(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 2}R5_cleaned {c |}{res}        131    2.763359    23.14431          0        260
{txt}(377 real changes made)
(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
ihs_insta_~s {c |}{res}        118    2.663226    2.820186          0   8.070281
{txt}(332 real changes made)
(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
twitter_fo~s {c |}{res}        130    103.3538    470.7585          0       5000
{txt}(354 real changes made)
(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
G14_numbered {c |}{res}        111    1.792793    .9450071          1          5
{txt}(323 real changes made)
(606 missing values generated)

    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 1}G15_cleaned {c |}{res}        139    9.503597    18.33875          0        100
{txt}(398 real changes made)

{com}.         
. 
. * MISC CLEANING
.         lab var participantid "Participant ID"
{txt}
{com}.         
. 
. 
.         
. *****************************************************************
. * SECTION 4 - GENERATE STATS ON MODULES STARTED AND COMPLETED
. *****************************************************************
. 
.         
.         * create globals for each module
.         * mobility
.                 global mobility M1 M3 M4 M4_1_TEXT M5_1_TEXT M6_1_TEXT M7_1_TEXT M8_1_TEXT ///
>                 M9_2_TEXT Q132_2_TEXT M10 N1_4_TEXT N2_4_TEXT N3_1_TEXT N4
{txt}
{com}.                 
.         local mobility=0
{txt}
{com}.         foreach var of global mobility {c -(}
{txt}  2{com}.                 local mobility = `mobility' + 1
{txt}  3{com}.         {c )-}
{txt}
{com}.         di `mobility'
{res}15
{txt}
{com}.         * 15 vars of interest
.         
.         egen mobility_miss = rownonmiss($mobility), strok
{txt}
{com}.         replace mobility_miss = mobility_miss/`mobility' 
{txt}(496 real changes made)

{com}.         
.         * employment
.         gen E1_response = E1 if E1!="Call ended / connection lost / respondent hung up the phone" ///
>         & E1!=""
{txt}(116 missing values generated)

{com}.         
.         gen employ_modstart = 1 if E1_response!=""
{txt}(116 missing values generated)

{com}.         replace employ_modstart = 0 if E1_response==""
{txt}(116 real changes made)

{com}.         lab var employ_modstart "Started employment module (wave 3)"
{txt}
{com}. 
.         
.         * gender/political attitudes and civic engagement
.         global attitudes G1_1 G1_2 G1_3 G3_1 G4_1 G4_2 G4_3 G5_1 G6_1 G6_2 G6_3 ///
>                 G7_1 G8_1 G8_2 G8_3 G9_1 G10_1 G10_2 G10_3 G11 G12 G13_7_TEXT G14 ///
>                 G15_cleaned Combined_P1_1_likert P1_2 P1_3 P2_1 P2_2 P2_3 P2_4 P3_scale
{txt}
{com}.                 
.         local attitudes=0
{txt}
{com}.         foreach var of global attitudes {c -(}
{txt}  2{com}.                 local attitudes = `attitudes' + 1
{txt}  3{com}.         {c )-}
{txt}
{com}. 
.         egen attitudes_miss = rownonmiss($attitudes), strok
{txt}
{com}.         replace attitudes_miss = attitudes_miss/`attitudes' 
{txt}(492 real changes made)

{com}.         
.         * real choice
.         global real R1 R2 R5_cleaned R6 R8 R10 R14 R16 Q124 R17
{txt}
{com}.         
.         local real=0
{txt}
{com}.         foreach var of global real {c -(}
{txt}  2{com}.                 local real = `real' + 1
{txt}  3{com}.         {c )-}
{txt}
{com}. 
.         egen real_miss = rownonmiss($real) , strok
{txt}
{com}.         replace real_miss = real_miss/`real' 
{txt}(414 real changes made)

{com}.         
. * now created a "started X module var"
. global module_complete mobility attitudes real
{txt}
{com}. 
. foreach i of global module_complete {c -(}
{txt}  2{com}.         gen `i'_modstart = 0
{txt}  3{com}.         replace `i'_modstart = 1 if `i'_miss >0 & `i'_miss!=.
{txt}  4{com}.         lab var `i'_modstart "`i' module started"
{txt}  5{com}. {c )-}
{txt}(496 real changes made)
(492 real changes made)
(414 real changes made)

{com}. 
. foreach i of global module_complete {c -(}
{txt}  2{com}.         gen `i'_mod50 = 0
{txt}  3{com}.         replace `i'_mod50 = 1 if `i'_miss >=.5 & `i'_miss!=.
{txt}  4{com}.         lab var `i'_mod50 "`i' module 50% completed"
{txt}  5{com}. {c )-}
{txt}(417 real changes made)
(483 real changes made)
(410 real changes made)

{com}.         
. 
. 
. * FLAG RANDOMIZED MODULE ORDER AND MISSINGS ACROSS MODULES
. 
. 
. * randomized module order (combine the two order vars)
. gen module_order = FL_37_DO
{txt}(524 missing values generated)

{com}. replace module_order = FL_20_DO if short_survey==0
{txt}(420 real changes made)

{com}. lab var module_order "Module order presented to respondent"
{txt}
{com}. 
. split module_order, p(|)
{res}variables created as string: 
{txt}{col 1}module_ord~1{col 15}module_ord~2{col 29}module_ord~3

{com}. // This gives us three variables in the order in which the modules were presented
. lab var module_order1 "First module presented"
{txt}
{com}. lab var module_order2 "Second module presented"
{txt}
{com}. lab var module_order3 "Third module presented"
{txt}
{com}. 
. 
. * Tag missings for each section
.         * Mobility
.         gen mobility_missing = 0
{txt}
{com}.         replace mobility_missing = 1 if M3=="" & M4=="" & M4_1_TEXT==. & M9=="" & ///
>                 M9_2_TEXT==. & N1=="" & N1_4_TEXT==. & N3=="" & N3_1_TEXT==.
{txt}(113 real changes made)

{com}.         lab var mobility_missing "Missing all mobility (short survey) module responses"
{txt}
{com}.         
.         * Gender & Political Attitudes and Civic Engagement
.         gen gpa_ce_missing = 0
{txt}
{com}.         replace gpa_ce_missing = 1 if G1_1=="" & G1_2=="" & G1_3=="" & G5_1=="" & ///
>                 G6_1=="" & G6_2=="" & G6_3=="" & G7_1=="" & G8_1=="" & G8_2=="" & G8_3=="" ///
>                 & G9_1=="" & G10_1=="" & G10_2=="" & G10_3=="" & G13=="" & G13_7_TEXT==. ///
>                 & Combined_P1_1_likert==. & P1_2=="" & P1_3=="" & Q134=="" & P3==""
{txt}(113 real changes made)

{com}.         lab var gpa_ce_missing ///
>                 "Missing all gender/political attitudes and civic engage (short survey) module responses"
{txt}note: label truncated to 80 characters

{com}.                 
.         * Employment
.         gen employ_missing = 0 
{txt}
{com}.         replace employ_missing = 1 if E1=="" & E4=="" & E4_6_TEXT==.
{txt}(113 real changes made)

{com}.         lab var employ_missing "Missing all employment (short survey) module responses"
{txt}
{com}.         
.         * create var for whether they started the endline based on these
.         gen endline_start_w3 = 0
{txt}
{com}.         replace endline_start_w3 = 1 if employ_modstart==1 | mobility_modstart==1 | ///
>         attitudes_modstart==1 | real_modstart==1
{txt}(501 real changes made)

{com}.         replace endline_start_w3 = 1  if M1!="" | E1!="" | G1_1!="" | R1!=""    
{txt}(0 real changes made)

{com}.         lab var endline_start_w3 "Started endline survey"
{txt}
{com}.         
.         * create var for whether they started the Xth module presented to them (1st,2nd,3rd)
.         
.                 * first tag which module they saw 1st, 2nd, 3rd
.                 gen module_appear = FL_37_DO
{txt}(524 missing values generated)

{com}.                 replace module_appear = FL_20_DO if module_appear==""
{txt}(420 real changes made)

{com}.                 split module_appear, p(|)
{res}variables created as string: 
{txt}{col 1}module_app~1{col 15}module_app~2{col 29}module_app~3

{com}.         
.         
.                 gen modstart_1 = 0
{txt}
{com}.                 replace modstart_1 = 1 if employ_modstart==1 & substr(module_appear1,1,10)=="Employment"
{txt}(165 real changes made)

{com}.                 replace modstart_1 = 1 if employ_modstart==1 & substr(module_appear1,1,10)=="Employment"
{txt}(0 real changes made)

{com}.                 replace modstart_1 = 1 if mobility_modstart==1 & substr(module_appear1,1,8)=="Mobility"
{txt}(152 real changes made)

{com}.                 replace modstart_1 = 1 if mobility_modstart==1 & substr(module_appear1,1,8)=="Mobility"
{txt}(0 real changes made)

{com}.                 replace modstart_1 = 1 if attitudes_modstart==1 & substr(module_appear1,1,6)=="Gender"
{txt}(184 real changes made)

{com}.                 replace modstart_1 = 1 if attitudes_modstart==1 & substr(module_appear1,1,6)=="Gender"
{txt}(0 real changes made)

{com}.                 lab var modstart_1 "Started Module 1"
{txt}
{com}.                 
.                 gen modstart_2 = 0
{txt}
{com}.                 replace modstart_2 = 1 if employ_modstart==1 & substr(module_appear2,1,10)=="Employment"
{txt}(160 real changes made)

{com}.                 replace modstart_2 = 1 if employ_modstart==1 & substr(module_appear2,1,10)=="Employment"
{txt}(0 real changes made)

{com}.                 replace modstart_2 = 1 if mobility_modstart==1 & substr(module_appear2,1,8)=="Mobility"
{txt}(180 real changes made)

{com}.                 replace modstart_2 = 1 if mobility_modstart==1 & substr(module_appear2,1,8)=="Mobility"
{txt}(0 real changes made)

{com}.                 replace modstart_2 = 1 if attitudes_modstart==1 & substr(module_appear2,1,6)=="Gender"
{txt}(151 real changes made)

{com}.                 replace modstart_2 = 1 if attitudes_modstart==1 & substr(module_appear2,1,6)=="Gender"
{txt}(0 real changes made)

{com}.                 lab var modstart_2 "Started Module 2"
{txt}
{com}. 
.                 gen modstart_3 = 0
{txt}
{com}.                 replace modstart_3 = 1 if employ_modstart==1 & substr(module_appear3,1,10)=="Employment"
{txt}(165 real changes made)

{com}.                 replace modstart_3 = 1 if employ_modstart==1 & substr(module_appear3,1,10)=="Employment"
{txt}(0 real changes made)

{com}.                 replace modstart_3 = 1 if mobility_modstart==1 & substr(module_appear3,1,8)=="Mobility"
{txt}(164 real changes made)

{com}.                 replace modstart_3 = 1 if mobility_modstart==1 & substr(module_appear3,1,8)=="Mobility"
{txt}(0 real changes made)

{com}.                 replace modstart_3 = 1 if attitudes_modstart==1 & substr(module_appear3,1,6)=="Gender"
{txt}(157 real changes made)

{com}.                 replace modstart_3 = 1 if attitudes_modstart==1 & substr(module_appear3,1,6)=="Gender"
{txt}(0 real changes made)

{com}.                 lab var modstart_3 "Started Module 3"
{txt}
{com}. 
. * Volunteer and leadership sign-up      
.         * Qudra sign up - we sent reminders to anyone who started the survey, so set to 0
.                 gen R14_scale = 0 if endline_start_w3==1
{txt}(105 missing values generated)

{com}.                 replace R14_scale = 1 if R14 == "Yes "
{txt}(296 real changes made)

{com}.                 *replace R14_scale = 0 if R14 != "Yes " & R14 != ""
.                 lab var R14_scale "Interested in signing up for Qudra (wave 3)"
{txt}
{com}.                 
.                 * Giving this a num scale created the binary, so we can just center/standardize
.                 sum R14_scale if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 3}R14_scale {c |}{res}        188    .5585106    .4978906          0          1
{txt}
{com}.                 gen R14_scale_st = .
{txt}(606 missing values generated)

{com}.                 replace R14_scale_st = (R14_scale-r(mean))/r(sd)
{txt}(501 real changes made)

{com}.                 lab var R14_scale_st "R14 - centered/standardized (wave 3)"
{txt}
{com}.                 
.         * Himma sign up - we sent reminders to anyone who started the survey, so set to 0
.                 gen R17_scale = 0 if endline_start_w3==1
{txt}(105 missing values generated)

{com}.                 replace R17_scale = 1 if R17 == "Yes"
{txt}(331 real changes made)

{com}.                 *replace R17_scale = 0 if R17 == "No"
.                 lab var R17_scale "Interested in Himma (wave 3)"
{txt}
{com}.                 
.                 * Giving this a num scale created the binary, so we can just center/standardize
.                 sum R17_scale if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 3}R17_scale {c |}{res}        188     .643617    .4802091          0          1
{txt}
{com}.                 gen R17_scale_st = .
{txt}(606 missing values generated)

{com}.                 replace R17_scale_st = (R17_scale-r(mean))/r(sd)
{txt}(501 real changes made)

{com}.                 lab var R17_scale_st "R17 - centered/standardized (wave 3)"
{txt}
{com}.                         
.         
.         * save 
.         save "$data/RCT wave 3/Final/Combined_allwaves_final.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Final/Combined_allwaves_final.dta{rm}
saved
{p_end}

{com}. 
. *****************************************************************
. * SECTION 5 - INCORPORAT DATA FROM QUDRA LINK AND MERGE IN
. *****************************************************************
. 
. * Import qudra follow up dataset
. import excel "$data/RCT wave 3/Raw/Qudra Follow-up_September 21, 2022_14.47.xlsx", ///
>         sheet("Qudra Follow-up_September 21, 2") firstrow clear
{res}{text}(22 vars, 473 obs)

{com}. 
. 
. * drop first row (excel labels), and test responses (participandid==0 or ==.)
. drop if _n==1 | _n==2
{txt}(2 observations deleted)

{com}. drop if inlist(participantid, "0", "")
{txt}(32 observations deleted)

{com}. 
. * let's use IP address to collapse to individuals instead of individual clicks
. generate double EndDate2 = clock(EndDate, "MDYhm")
{txt}
{com}. format EndDate2 %tc
{txt}
{com}. lab var EndDate2 "EndDate as date and time var"
{txt}
{com}. 
. 
. sort IPAddress EndDate2
{txt}
{com}. collapse (lastnm) Status Progress-EndDate2, by(IPAddress)
{res}{txt}
{com}. 
. 
. * CREATE OUTCOME VARS
.         
.         * anyone clicked
.         gen anyone_clicked_w3 = 1
{txt}
{com}.         
.         * number of people clicked
.         gen number_people_clicked_w3 = .
{txt}(324 missing values generated)

{com}.         bysort participantid: replace number_people_clicked_w3 = _N
{txt}(324 real changes made)

{com}.         
.         * number of people who clicked and said friend sent
.         bysort participantid: egen number_friends_clicked_w3 = total(Q2=="Someone else sent me this link")
{txt}
{com}.         
. * collapse to participandid level
. collapse (first) IPAddress-participantgroup residence_area-number_friends_clicked_w3, by(participantid)
{res}{txt}
{com}.         lab var anyone_clicked_w3 "Any clicks on Qudra link"
{txt}
{com}.         lab var number_people_clicked_w3 "Number of people who clicked on Qudra link"
{txt}
{com}.         lab var number_friends_clicked_w3 "Number of friends who clicked on Qudra link"
{txt}
{com}. 
. * keep just the vars we need and merge to our dataset
. destring participantid, replace
{txt}participantid: all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. keep anyone_clicked_w3 number_people_clicked_w3 number_friends_clicked_w3 participantid
{txt}
{com}. merge 1:1 participantid using "$data/RCT wave 3/Final/Combined_allwaves_final.dta"
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}             423
{txt}{col 9}from master{col 30}{res}               3{txt}  (_merge==1)
{col 9}from using{col 30}{res}             420{txt}  (_merge==2)

{col 5}Matched{col 30}{res}             186{txt}  (_merge==3)
{col 5}{hline 41}

{com}. 
. // NOTE: we have a few IDs who got a link but had been excluded from the sample, let's drop
. drop if _merge==1
{txt}(3 observations deleted)

{com}. drop _merge 
{txt}
{com}. 
. * clean up missing vars
. replace anyone_clicked_w3 = 0 if anyone_clicked_w3==. & endline_start_w3==1
{txt}(315 real changes made)

{com}. replace number_people_clicked_w3 = 0 if number_people_clicked_w3==. & endline_start_w3==1
{txt}(315 real changes made)

{com}. replace number_friends_clicked_w3 = 0 if number_friends_clicked_w3==. & endline_start_w3==1
{txt}(315 real changes made)

{com}. 
. * create centered/standardized version of anyone_clicked and number_friends_clicked for indices
.         
.         * anyone_clicked
.         sum anyone_clicked_w3 if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
anyone_cli~3 {c |}{res}        188    .3404255    .4751176          0          1
{txt}
{com}.         gen anyone_clicked_st_w3 = . 
{txt}(606 missing values generated)

{com}.         replace anyone_clicked_st_w3 = (anyone_clicked_w3-r(mean))/r(sd)
{txt}(501 real changes made)

{com}.         lab var anyone_clicked_st_w3 "Anyone clicked on Qudra link - centered/standardized (wave 3)"
{txt}
{com}.         
.                 
.         * number of clicks
.                 * continuos version
.                 sum number_people_clicked_w3 if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
number_peo~3 {c |}{res}        188    .5851064    1.692447          0         21
{txt}
{com}.                 gen num_ppl_clicked_st_w3 = . 
{txt}(606 missing values generated)

{com}.                 replace num_ppl_clicked_st_w3 = (number_people_clicked_w3-r(mean))/r(sd)
{txt}(501 real changes made)

{com}.                 lab var num_ppl_clicked_st_w3 "Num. people clicked on Qudra link - centered/standardized (wave 3)"
{txt}
{com}.         
.         
.                 * binary version
.                 xtile numppl_click_abovemed = number_people_clicked_w3, nq(2)
{txt}
{com}.                 recode numppl_click_abovemed (1 = 0) (2 = 1)
{txt}(501 changes made to {bf:numppl_click_abovemed})

{com}.                 lab var numppl_click_abovemed "Num. people clicked on Qudra link - binary at median (wave 3)"
{txt}
{com}.                 
.                 sum numppl_click_abovemed if treatment==0 

{txt}    Variable {c |}        Obs        Mean    Std. dev.       Min        Max
{hline 13}{c +}{hline 57}
numppl_cli~d {c |}{res}        188    .3404255    .4751176          0          1
{txt}
{com}.                 gen numppl_click_abovemed_st = . 
{txt}(606 missing values generated)

{com}.                 replace numppl_click_abovemed_st = (numppl_click_abovemed-r(mean))/r(sd)
{txt}(501 real changes made)

{com}.                 lab var numppl_click_abovemed_st "Num. people clicked on Qudra link - centered/standardized binary at median (wave 3)"
{txt}note: label truncated to 80 characters

{com}. 
. 
. 
. **************************************  
. * NOW CREATE INDICES
. **************************************
. 
. 
.         * create indicator for control to use with swindex
.         gen control = 1 if treatment==0
{txt}(375 missing values generated)

{com}.         replace control =0 if treatment==1
{txt}(375 real changes made)

{com}. 
.                 
.         * Gender Attitudes - First Order Beliefs
. 
.                 * binary version
.                         global GA_1stOrder G1_1_abovemed_st G5_1_abovemed_st G7_1_abovemed_st ///
>                         G9_1_abovemed_st G13_scale_st P1_3_abovemed_st
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_1stOrder, generate(ga_1st_order_binary_sw) normby(control)
{res}{txt}
{com}.                         lab var ga_1st_order_binary_sw ///
>                         "Gender Attitudes: 1st Order Index - binary, swindex (wave 3)"
{txt}
{com}.                         
.                 * likert version
.                         global GA_1stOrder_likert G1_1_likert_st G5_1_likert_reverse_st G7_1_likert_reverse_st ///
>                         G9_1_likert_reverse_st G13_scale_st P1_3_likert_st
{txt}
{com}.                         
.                         * Using swindex
.                         swindex $GA_1stOrder_likert, generate(ga_1st_order_likert_sw) normby(control)
{res}{txt}
{com}.                         lab var ga_1st_order_likert_sw ///
>                         "Gender Attitudes: 1st Order Index - likert, swindex (wave 3)"
{txt}
{com}. 
. 
.                 
.         * Gender Attitudes - Second Order: Men in Respondent's family
. 
.                 * binary version
.                         global GA_2ndOrder_MaleFam G6_1_abovemed_st G8_1_abovemed_st G10_1_abovemed_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_2ndOrder_MaleFam, generate(ga2nd_mfam_binary_sw) normby(control)
{res}{txt}
{com}.                         lab var ga2nd_mfam_binary_sw ///
>                         "Gender Attitudes: 2nd Order (Male Fam) Index - binary, swindex (wave 3)"
{txt}
{com}.                         
.                 * likert version
.                         global GA_2ndOrder_MaleFam_likert G6_1_propor_st  G8_1_propor_st G10_1_propor_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_2ndOrder_MaleFam_likert, generate(ga2nd_mfam_likert_sw) normby(control)
{res}{txt}
{com}.                         lab var ga2nd_mfam_likert_sw ///
>                         "Gender Attitudes: 2nd Order (Male Fam) Index - likert, swindex (wave 3)"
{txt}
{com}.                 
. 
.                 
.         * Gender Attitudes - Second Order: Women in Community
. 
.                 * binary version
.                         global GA_2ndOrder_FemCom G6_2_abovemed_st G8_2_abovemed_st G10_2_abovemed_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_2ndOrder_FemCom, generate(ga2nd_fcom_binary_sw) normby(control)
{res}{txt}
{com}.                         lab var ga2nd_fcom_binary_sw ///
>                         "Gender Attitudes: 2nd Order (Female Commm.) Index - binary, swindex (wave 3)"
{txt}
{com}.                         
.                 * likert version
.                         global GA_2ndOrder_FemCom_likert G6_2_propor_st G8_2_propor_st G10_2_propor_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_2ndOrder_FemCom_likert, generate(ga2nd_fcom_likert_sw) normby(control)
{res}{txt}
{com}.                         lab var ga2nd_fcom_likert_sw ///
>                         "Gender Attitudes: 2nd Order (Female Commm.) Index - likert, swindex (wave 3)"
{txt}
{com}. 
.                         
.         * Gender Attitudes - Second Order: Men in Community
.                 
.                 * binary version
.                         global GA_2ndOrder_MaleCom G6_3_abovemed_st G8_3_abovemed_st G10_3_abovemed_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_2ndOrder_MaleCom, generate(ga2nd_mcom_binary_sw) normby(control)
{res}{txt}
{com}.                         lab var ga2nd_mcom_binary_sw ///
>                         "Gender Attitudes - 2nd Order (Male Commm.) Index - binary, swindex (wave 3)"
{txt}
{com}.                         
.                 * likert version
.                         global GA_2ndOrder_MaleCom_likert G6_3_propor_st G8_3_propor_st G10_3_propor_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_2ndOrder_MaleCom_likert, generate(ga2nd_mcom_likert_sw) normby(control)
{res}{txt}
{com}.                         lab var ga2nd_mcom_likert_sw ///
>                         "Gender Attitudes - 2nd Order (Male Commm.) Index - likert, swindex (wave 3)"
{txt}
{com}.                 
.         * Create index of all male attitudes (combining male family and male social network)
.                 * binary version
.                         global GA_2ndOrder_AllMen G6_1_abovemed_st G8_1_abovemed_st ///
>                         G10_1_abovemed_st G6_3_abovemed_st G8_3_abovemed_st G10_3_abovemed_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_2ndOrder_AllMen, generate(ga2nd_allmen_binary_sw) normby(control)
{res}{txt}
{com}.                         lab var ga2nd_allmen_binary_sw ///
>                         "Gender Attitudes - 2nd Order (All men) Index - binary, swindex (wave 3)"
{txt}
{com}.                         
.                 * likert version
.                         global GA_2ndOrder_AllMen_likert G6_1_propor_st  G8_1_propor_st ///
>                         G10_1_propor_st G6_3_propor_st G8_3_propor_st G10_3_propor_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $GA_2ndOrder_AllMen_likert, generate(ga2nd_allmen_likert_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var ga2nd_allmen_likert_sw ///
>                         "Gender Attitudes - 2nd Order (All men) Index - likert, swindex (wave 3)"
{txt}
{com}.                         
.         /* Create index of social contact (number of people spoken to on phone and met
>                         in last 24 hrs) */
.                 * binary version
.                         global socialcontact_bi N1_cleaned_abovemed_st N3_cleaned_abovemed_st 
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $socialcontact_bi, generate(social_contact_binary_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var social_contact_binary_sw ///
>                         "Social Contact Index - binary, swindex (wave 3)"       
{txt}
{com}.                         
.                 * continuous version
.                         global socialcontact N1_cleaned_st N3_cleaned_st
{txt}
{com}.                         
.                         * UPDATE: using swindex
.                         swindex $socialcontact, generate(social_contact_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var social_contact_sw ///
>                         "Social Contact Index - swindex (wave 3)"
{txt}
{com}.                         
.         * Labor force index (using employed dummy and in LF dummy)
.         swindex employed_st_w3 in_LF_st_w3, generate(LF_index_sw_w3) normby(control)
{res}{txt}
{com}.         lab var LF_index_sw_w3 "Labor force index, swindex (wave 3)"
{txt}
{com}.         
.         
.         * Stated approval of gender policy (`gov is working fast enough' and `feels the impact')
.                 * binary version
.                 global approval_bi P1_1_abovemed_st P1_2_abovemed_st
{txt}
{com}.                 
.                         * UPDATE: using swindex
.                         swindex $approval_bi, generate(gen_policy_binary_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var gen_policy_binary_sw ///
>                         "Stated Approval of Gender Policy Index - binary, swindex (wave 3)"     
{txt}
{com}.                         
.                 * continuos version
.                         global approval Combined_P1_1_likert_st P1_2_likert_st
{txt}
{com}.                 
.                         * UPDATE: using swindex
.                         swindex $approval, generate(gen_policy_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var gen_policy_sw ///
>                         "Stated Approval of Gender Policy Index - swindex (wave 3)"
{txt}
{com}.                         
.         * Civic engagement (P3_abovemed R17_scale R14_scale anyone_clicked ppl_clicked)
.                 * binary version
.                 global  civ_eng_bi P3_abovemed_st R17_scale_st R14_scale_st anyone_clicked_st_w3 ///
>                                 numppl_click_abovemed_st
{txt}
{com}.                                 
.                 * UPDATE: using swindex
.                         swindex $civ_eng_bi, generate(civ_engage_binary_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var civ_engage_binary_sw ///
>                         "Civic Engagement Index - binary, swindex (wave 3)"     
{txt}
{com}.                 
.                 * continuous version 
.                 global  civ_eng P3_scale_st R17_scale_st R14_scale_st anyone_clicked_st_w3 ///
>                                 num_ppl_clicked_st_w3
{txt}
{com}.                                 
.                                 
.                         * UPDATE: using swindex
.                         swindex $civ_eng, generate(civ_engage_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var civ_engage_sw ///
>                         "Civic Engagement Index - swindex (wave 3)"
{txt}
{com}.                         
.         * Mobility and Spending control 
.         global mobspencntrl G1_2_abovemed_st G1_3_abovemed_st
{txt}
{com}.         
.                 * SWINDEX
.                 swindex $mobspencntrl, generate(mobspencntrl_binary_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var mobspencntrl_binary_sw ///
>                         "Mobility and Spending Control Index - binary, swindex (wave 3)"
{txt}
{com}.                         
.         * Job search index (unemployed + on the job search)
.         global job_search unemployed_w3_st empl_jobsearch_w3_st
{txt}
{com}.         
.                 * SWINDEX
.                 swindex $job_search, generate(job_search_binary_sw) ///
>                         normby(control)
{res}{txt}
{com}.                         lab var job_search_binary_sw ///
>                         "Job Search Index - binary, swindex (wave 3)"
{txt}
{com}. 
.                         
. *****************************************************************
. * SECTION 6 - FINAL CLEAN UP AND LABELLING
. *****************************************************************
. 
. 
. 
. 
. 
. * Save a version of the dataset that includes all variables from wave 3
. save "$data/RCT wave 3/Cleaned/Combined_allwaves_fullwave3vars_cleaned.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Cleaned/Combined_allwaves_fullwave3vars_cleaned.dta{rm}
saved
{p_end}

{com}. 
. 
. * Now drop out vars we don't need/use in analysis for paper
. keep    randomization_cohort2 file_nbr participantid treatment ///
>                 husb_influence_kids hte_rel_status hte_rel_status_alt husb_influence_kids_alt ////
>                 age_4group_BL  edu_category_BL  married ///
>                 divorced_separated widowed single  household_size ///
>                  one_car mult_cars cars ///
>                  employed_BL unemployed_BL  treatment question_timing ///
>                 unaccomp_trips_cat_* employed_w3 G1_3_abovemed G1_3_abovemed_st s_train_bi_w3 license_w3 ///
>                 drive_any_mo_bi_w3 M4_1_TEXT share_trips_unaccomp_w3 unemployed_w3 not_in_LF_w3 ///
>                 empl_jobsearch_w3 no_trips_unaccomp_w3 G1_2_abovemed G1_2_abovemed_st  mobility_modstart ///
>                 employ_modstart attitudes_modstart real_modstart drive_freq_num_* ///
>                 leave_house_cat_* age_BL household_size ///
>                 hh_les18_w hh_more18_w cars_num driving_likely_BL less_than_primary_BL ///
>                 elementary_BL highschool_BL any_tertiary_edu_BL not_in_LF_BL unemployed_BL ///
>                 employed_BL on_job_search_BL ever_employed_BL work_experience_cond_BL ///
>                 salary_less3k_BL salary_3kto4999_BL salary_5kto6999_BL rel_status_BL ///
>                 trip_any_w2 tripnb_yesterday_w2 mean_trip_duration_w2 trip_duration_work_cond_w2 ///
>                 trip_any_leisure_friendscond_w2 trip_any_leisure_relcond_w2 ///
>                 trip_any_leisure_parkcond_w2 trip_any_leisure_mealcond_w2 trip_any_pers_govtcond_w2 ///
>                 trip_any_pers_healthcond_w2 trip_any_shopping_hhcond_w2 ///
>                 trip_any_shopping_perscond_w2 trip_any_pickdropcond_w2 trip_any_unicond_w2 ///
>                 trip_any_workcond_w2 trip_mode_buscond_w2 trip_mode_footcond_w2 ///
>                 trip_mode_car_drivercond_w2 trip_mode_car_familycond_w2 ///
>                 trip_mode_car_paiddrivercond_w2 trip_mode_car_poolingcond_w2 ///
>                 trip_mode_hailingcond_w2 trip_mode_taxicond_w2 trip_mode_othercond_w2 ///
>                 ga2nd_fcom_binary_sw G6_2_abovemed G8_2_abovemed G10_2_abovemed ///
>                 ga2nd_mfam_binary_sw G6_1_abovemed G8_1_abovemed G10_1_abovemed ///
>                 ga2nd_mcom_binary_sw G6_3_abovemed G8_3_abovemed  G10_3_abovemed ///
>                 number_people_clicked number_friends_clicked N1_cleaned N3_cleaned P3_abovemed ///
>                 R17_scale R14_scale P1_2_abovemed ga_1st_order_binary_sw  G5_1_abovemed ///
>                 G7_1_abovemed G9_1_abovemed G1_1_abovemed G13_scale P1_3_abovemed ///   
>                 wusool_T driving_T group_strata saudidrive_w2 license_w2 ///
>                 expectcomm_ehai_amount_tr_w2 drive_lastm_w2 drive_month_w2 ///
>                 future_drive_med_w2 future_drive_w2 drove_yest_w2 recenttripyestod_w2 rectripyestodnofam_w2 ///
>                 rectripyestodrelat_w2 rectripyestodfd_w2 nonwork_trip_w2 jobsearch_w2 ///
>                 careerfair_w2 jobhuntprop_w2 jh_travel_w2 lowestsalary_txt_w2 ///
>                 jobapplied_lastm_w2 job_interview_w2 job_interviewattend_w2 ///
>                 takejob_15mins_w2 takejob_30mins_w2 G5_1_likert_reverse G7_1_likert_reverse ///
>                 G9_1_likert_reverse G6_1_propor G6_2_propor G6_3_propor G8_1_propor ///
>                 G8_2_propor G8_3_propor G10_1_propor G10_2_propor G10_3_propor BLsearch ///
>                 anyone_clicked_w3 P1_1_abovemed G1_2_likert G1_3_likert LFP_w3 M9_2_TEXT ///
>                 hh_kid_adu_ratio LF_BL G1_1_likert P1_2_likert P1_3_likert ///
>                 Combined_P1_1_likert G3_1_likert_reverse G1_1_likert_st G1_2_likert_st ///
>                 G1_3_likert_st P1_2_likert_st P1_3_likert_st Combined_P1_1_likert_st ///
>                 G7_1_likert_reverse_st G9_1_likert_reverse_st G3_1_likert_reverse_st ///
>                 G5_1_likert_reverse_st G4_1_propor G4_2_propor G4_3_propor G4_1_propor_st ///
>                 G4_2_propor_st G4_3_propor_st G6_1_propor_st G6_2_propor_st G6_3_propor_st ///
>                 G8_1_propor_st G8_2_propor_st G8_3_propor_st G10_1_propor_st ///
>                 G10_2_propor_st G10_3_propor_st ga_1st_order_likert_sw ga2nd_mfam_likert_sw ///
>                 ga2nd_fcom_likert_sw ga2nd_mcom_likert_sw P3_scale hh_kid_adult_abovemed_BL ///
>                 salary_BL_cat trip_all_leisure_cond_w2 ///
>                 trip_personal_errands_cond_w2 trip_HH_errands_cond_w2 trip_commute_cond_w2 ///
>                 endline_start_w3 husb_influence_kids_original age_med edu_nohs owns_car ///
>                 relationship_status_BL ever_married trip_any_shopping_pers_w2 trip_commute_w2 ///
>                 trip_HH_errands_w2 trip_personal_errands_w2 trip_all_leisure_w2 LF_index_sw_w3 ///
>                 ga2nd_allmen_likert_sw ga2nd_allmen_binary_sw N1_cleaned_abovemed ///
>                 N1_cleaned_abovemed_st N1_cleaned_st N3_cleaned_abovemed N3_cleaned_abovemed_st ///
>                 N3_cleaned_st social_contact_binary_sw social_contact_sw social_contact_binary_sw gen_policy_binary_sw ///
>                 gen_policy_sw civ_engage_binary_sw civ_engage_sw anyone_clicked_st_w3 ///
>                 numppl_click_abovemed_st P3_scale_st num_ppl_clicked_st_w3 ///
>                 P3_abovemed_st  R17_scale_st R14_scale_st driving_likely_likert_BL jobs_applied_w3 ///
>                 G13_scale_st modstart_1 modstart_2 modstart_3 start_survey_w3 one_child ///
>                 mult_children work_experience_BL unempl_jobsearch_w3 Institution saudi_drive_training ///
>                 trips_unaccompanied_w3 mobspencntrl_binary_sw job_search_binary_sw any_jobsearch_w3
{txt}
{com}.                 
.                   
.                         
. save "$data/RCT wave 3/Final/Combined_allwaves_final.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Final/Combined_allwaves_final.dta{rm}
saved
{p_end}

{com}. 
. 
. 
. 
{txt}end of do-file

{com}.         do              "$rep_code/cleaning/Weighting.do"
{txt}
{com}. /*******************************************************************************
> ********************************************************************************
> ********************************************************************************
> 
> Purpose:                REWEIGHTING     USING NATIONAL ESTIMATES (GASTAT)
> 
> 
> 
> ********************************************************************************
> ********************************************************************************
> *******************************************************************************/
. eststo clear
{txt}
{com}. 
. ************************************************************
. * SECTION 1 - IMPORT AND SET UP NATIONAL ESTIMATES FROM GASTAT
. * SECTION 2 - WEIGHTS FOR: AGE, MARITAL STATUS, EDU, EMPLOYMENT
. ************************************************************
. 
. ************************************************************            
. * SECTION 1 - IMPORT AND SET UP NATIONAL ESTIMATES FROM GASTAT
. ************************************************************
. 
. * pull in national estimates
. import excel "$data/Government admin data/education_and_training_surveyen_1.xlsx", ///
> sheet("8-2 ") cellrange(B7:AE20) firstrow clear
{res}{text}(30 vars, 13 obs)

{com}. drop O-AE
{txt}
{com}. * adjust age and edu categories to match
. insobs 3
{txt}(3 observations added)

{com}. replace AREA="15-29" if _n==14
{txt}(1 real change made)

{com}. replace AREA="30-44" if _n==15
{txt}(1 real change made)

{com}. replace AREA="45+" if _n==16
{txt}(1 real change made)

{com}. rename AREA age
{res}{txt}
{com}. 
. 
. egen less_than_primary = rowtotal(Illiterate ReadWrite Primary)
{txt}
{com}. egen elementary = rowtotal(Intermediate PreSecondaryDiploma)
{txt}
{com}. gen highschool = SecondaryEquivalent
{txt}(3 missing values generated)

{com}. egen any_tertiary = rowtotal(PreUnivDiploma Bachelors HigherDiploma Master PhD)
{txt}
{com}. 
. 
. * sum age-edu bins for updated age ranges
. 
. foreach var in less_than_primary elementary highschool any_tertiary {c -(}
{txt}  2{com}.         replace `var' = `var'[2] + `var'[3] + ///
>                 `var'[4] if _n==14
{txt}  3{com}.                 
.         replace `var' = `var'[5] + `var'[6] + ///
>                 `var'[7] if _n==15
{txt}  4{com}.                 
.         replace `var' = `var'[8] + `var'[9] + ///
>                 `var'[10] + `var'[11] + `var'[12] if _n==16
{txt}  5{com}. {c )-}
{txt}(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

{com}. 
. * update total pop (remove age 10-19 pop)
. global total_20pl = Total[13]-Total[1]
{txt}
{com}. * gen shares of total pop for each age-edu group        
. foreach var in less_than_primary elementary highschool any_tertiary {c -(}
{txt}  2{com}.         gen `var'_share = `var'/$total_20pl if _n>=14
{txt}  3{com}. {c )-}
{txt}(13 missing values generated)
(13 missing values generated)
(13 missing values generated)
(13 missing values generated)

{com}. 
. * drop unnecessary cells
. keep if _n>=14 & _n<17
{txt}(13 observations deleted)

{com}. keep age less_than_primary elementary highschool any_tertiary less_than_primary_share elementary_share highschool_share any_tertiary_share
{txt}
{com}. 
. * reshape to merge
. local i = 1
{txt}
{com}. foreach var in less_than_primary_share elementary_share highschool_share any_tertiary_share {c -(}
{txt}  2{com}.         rename `var' edu`i'
{txt}  3{com}.         local i = `i'+1
{txt}  4{com}. {c )-}
{res}{txt}
{com}. reshape long edu, i(age) j(educat)
{txt}(j = 1 2 3 4)

Data{col 36}Wide{col 43}->{col 48}Long
{hline 77}
Number of observations     {res}           3   {txt}->   {res}12          
{txt}Number of variables        {res}           9   {txt}->   {res}7           
{txt}j variable (4 values)                     ->   {res}educat
{txt}xij variables:
                     {res}edu1 edu2 ... edu4   {txt}->   {res}edu
{txt}{hline 77}

{com}. encode age, gen(age_3grp)
{txt}
{com}. rename edu share_edu_age
{res}{txt}
{com}. 
. lab def edu 1 "Less than primary" 2 "Elementary" 3 "Highschool" 4 "Any tertiary"
{txt}
{com}. lab val educat edu
{txt}
{com}. rename educat edu_4cat
{res}{txt}
{com}. 
. * keep what we need to merge
. keep age_3grp edu_4cat share_edu_age
{txt}
{com}. 
. tempfile pop_estimates
{txt}
{com}. save `pop_estimates'
{txt}{p 0 4 2}
file {bf}
/var/folders/29/7bpvwmjn1pz43gbyl7ml6h4m0000gn/T//S_01035.000001{rm}
saved
as .dta format
{p_end}

{com}. 
. ************************************************************            
. * SECTION 2 - WEIGHTS FOR: AGE, MARITAL STATUS, EDU, EMPLOYMENT
. ************************************************************
. 
. * Now open our dataset and create weights
.         use "$data/RCT wave 3/Final/Combined_allwaves_final.dta", clear
{txt}
{com}.         
. * Create vars to match structure of comparison stats
.         gen age_3grp = 1 if inrange(age_BL, 15,29)
{txt}(369 missing values generated)

{com}.         replace age_3grp = 2 if inrange(age_BL, 30,44)
{txt}(233 real changes made)

{com}.         replace age_3grp = 3 if age_BL>=45 & age_BL!=.
{txt}(135 real changes made)

{com}.         lab var age_3grp "Age grouping for reweighting"
{txt}
{com}.         
.         
.         egen edu_4cat = group(less_than_primary_BL elementary_BL highschool_BL ///
>         any_tertiary_edu_BL)
{txt}(12 missing values generated)

{com}.         
.         egen employment = group(employed_BL unemployed_BL)
{txt}(1 missing value generated)

{com}.         
. 
.         
. * Calculate shares for each var
.         keep if age_3grp!=. & edu_4cat!=. 
{txt}(12 observations deleted)

{com}.         
.         count 
  {res}594
{txt}
{com}.         global tot = r(N)
{txt}
{com}. 
.         * age-edu groups
.         bysort age_3grp edu_4cat: gen samp_eduage_count = _N            // count Ns by category         
{txt}
{com}.         gen share_samp_eduage = samp_eduage_count/$tot                          // sample shares
{txt}
{com}.         
.         * employment
.         bysort employment: gen employment_count = _N                            // count Ns by category
{txt}
{com}.         gen employment_share = employment_count/$tot                            // sample shares
{txt}
{com}.         
. * Now merge in shares from GASTAT
. merge m:1 age_3grp edu_4cat using `pop_estimates'
{res}{txt}{p 0 7 2}
(variable
{bf:age_3grp} was {bf:float}, now {bf:double} to accommodate using data's values)
{p_end}

{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}               0
{txt}{col 5}Matched{col 30}{res}             594{txt}  (_merge==3)
{col 5}{hline 41}

{com}. 
. * Create weights
.         * age-edu
.         gen age_edu_weight = share_edu_age/share_samp_eduage
{txt}
{com}.         
.         * employment (created using KSA MoH and GASTAT stats - Table A2 in paper)
.         gen emp_weight = 0.135/employment_share if employed_BL==1
{txt}(483 missing values generated)

{com}.         replace emp_weight = 0.062/employment_share if unemployed_BL==1
{txt}(387 real changes made)

{com}.         replace emp_weight = (1-0.135-0.062)/employment_share if LF_BL==0
{txt}(95 real changes made)

{com}.         
. 
. * now just keep weight vars and merge to dataset
.         keep participantid age_edu_weight emp_weight
{txt}
{com}. 
.         merge 1:1 participantid using "$data/RCT wave 3/Final/Combined_allwaves_final.dta"
{res}{txt}(label {bf:{txt}future_drive} already defined)
(label {bf:{txt}drive_month} already defined)
(label {bf:{txt}yesno} already defined)
(label {bf:{txt}car} already defined)
(label {bf:{txt}c} already defined)
(label {bf:{txt}salary} already defined)
(label {bf:{txt}status} already defined)
(label {bf:{txt}husb_infl_kids} already defined)
(label {bf:{txt}relstatus} already defined)
(label {bf:{txt}lf} already defined)
(label {bf:{txt}educat} already defined)
(label {bf:{txt}likert} already defined)
(label {bf:{txt}likert_reverse} already defined)
(label {bf:{txt}drivetrain} already defined)
(label {bf:{txt}binary} already defined)
(label {bf:{txt}noLF} already defined)
(label {bf:{txt}lfp} already defined)

{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}              12
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}              12{txt}  (_merge==2)

{col 5}Matched{col 30}{res}             594{txt}  (_merge==3)
{col 5}{hline 41}

{com}.         drop _merge
{txt}
{com}.         
. * label weights 
.         lab var age_edu_weight "Weight: Age and Edu"
{txt}
{com}.         lab var emp_weight "Weight: Employment"
{txt}
{com}. 
. * save final data set
.         save "$data/RCT wave 3/Final/Combined_allwaves_final.dta", replace
{txt}{p 0 4 2}
file {bf}
/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/data/RCT wave 3/Final/Combined_allwaves_final.dta{rm}
saved
{p_end}

{com}.         
.         
.         
. 
{txt}end of do-file

{com}.         
.         log close
      {txt}name:  {res}<unnamed>
       {txt}log:  {res}/Users/kendalswanson/OneDrive - Duke University/saudi_women_driving/results/log_files/Data cleaning_30 Mar 2025.smcl
  {txt}log type:  {res}smcl
 {txt}closed on:  {res}30 Mar 2025, 22:49:59
{txt}{.-}
{smcl}
{txt}{sf}{ul off}